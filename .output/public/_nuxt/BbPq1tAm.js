import{e as je,f as Ne,g as Oe,r as R,S as C,h as A,C as Ee,i as ve,j as Ie,k as te,l as ie,m as qe,n as Pe,c as h,o as d,F as ae,p as ge,q as s,s as ee,t as o,a as e,v as He,b as W,x as he,y as L,z as Ye,d as ke,A as fe,B as De,T as ne,w as ce,D as Ge,E as Je,G as Ke,H as Ze,I as Re,u as Qe,J as xe}from"./CUnuYHxR.js";import{_ as se}from"./DlAUqK2U.js";import{_ as Xe}from"./DgM-zN9R.js";function et(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Ae={exports:{}},tt=Ae.exports,Be;function st(){return Be||(Be=1,(function(c,i){(function(t,l){c.exports=l()})(tt,(function(){var t=1e3,l=6e4,a=36e5,p="millisecond",n="second",b="minute",f="hour",V="day",S="week",u="month",N="quarter",w="year",I="date",m="Invalid Date",T=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,F=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(k){var y=["th","st","nd","rd"],v=k%100;return"["+k+(y[(v-20)%10]||y[v]||y[0])+"]"}},G=function(k,y,v){var $=String(k);return!$||$.length>=y?k:""+Array(y+1-$.length).join(v)+k},E={s:G,z:function(k){var y=-k.utcOffset(),v=Math.abs(y),$=Math.floor(v/60),_=v%60;return(y<=0?"+":"-")+G($,2,"0")+":"+G(_,2,"0")},m:function k(y,v){if(y.date()<v.date())return-k(v,y);var $=12*(v.year()-y.year())+(v.month()-y.month()),_=y.clone().add($,u),P=v-_<0,M=y.clone().add($+(P?-1:1),u);return+(-($+(v-_)/(P?_-M:M-_))||0)},a:function(k){return k<0?Math.ceil(k)||0:Math.floor(k)},p:function(k){return{M:u,y:w,w:S,d:V,D:I,h:f,m:b,s:n,ms:p,Q:N}[k]||String(k||"").toLowerCase().replace(/s$/,"")},u:function(k){return k===void 0}},D="en",O={};O[D]=g;var H="$isDayjsObject",oe=function(k){return k instanceof me||!(!k||!k[H])},X=function k(y,v,$){var _;if(!y)return D;if(typeof y=="string"){var P=y.toLowerCase();O[P]&&(_=P),v&&(O[P]=v,_=P);var M=y.split("-");if(!_&&M.length>1)return k(M[0])}else{var B=y.name;O[B]=y,_=B}return!$&&_&&(D=_),_||!$&&D},q=function(k,y){if(oe(k))return k.clone();var v=typeof y=="object"?y:{};return v.date=k,v.args=arguments,new me(v)},Y=E;Y.l=X,Y.i=oe,Y.w=function(k,y){return q(k,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var me=(function(){function k(v){this.$L=X(v.locale,null,!0),this.parse(v),this.$x=this.$x||v.x||{},this[H]=!0}var y=k.prototype;return y.parse=function(v){this.$d=(function($){var _=$.date,P=$.utc;if(_===null)return new Date(NaN);if(Y.u(_))return new Date;if(_ instanceof Date)return new Date(_);if(typeof _=="string"&&!/Z$/i.test(_)){var M=_.match(T);if(M){var B=M[2]-1||0,z=(M[7]||"0").substring(0,3);return P?new Date(Date.UTC(M[1],B,M[3]||1,M[4]||0,M[5]||0,M[6]||0,z)):new Date(M[1],B,M[3]||1,M[4]||0,M[5]||0,M[6]||0,z)}}return new Date(_)})(v),this.init()},y.init=function(){var v=this.$d;this.$y=v.getFullYear(),this.$M=v.getMonth(),this.$D=v.getDate(),this.$W=v.getDay(),this.$H=v.getHours(),this.$m=v.getMinutes(),this.$s=v.getSeconds(),this.$ms=v.getMilliseconds()},y.$utils=function(){return Y},y.isValid=function(){return this.$d.toString()!==m},y.isSame=function(v,$){var _=q(v);return this.startOf($)<=_&&_<=this.endOf($)},y.isAfter=function(v,$){return q(v)<this.startOf($)},y.isBefore=function(v,$){return this.endOf($)<q(v)},y.$g=function(v,$,_){return Y.u(v)?this[$]:this.set(_,v)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(v,$){var _=this,P=!!Y.u($)||$,M=Y.p(v),B=function(de,Z){var re=Y.w(_.$u?Date.UTC(_.$y,Z,de):new Date(_.$y,Z,de),_);return P?re:re.endOf(V)},z=function(de,Z){return Y.w(_.toDate()[de].apply(_.toDate("s"),(P?[0,0,0,0]:[23,59,59,999]).slice(Z)),_)},j=this.$W,J=this.$M,Q=this.$D,le="set"+(this.$u?"UTC":"");switch(M){case w:return P?B(1,0):B(31,11);case u:return P?B(1,J):B(0,J+1);case S:var ue=this.$locale().weekStart||0,_e=(j<ue?j+7:j)-ue;return B(P?Q-_e:Q+(6-_e),J);case V:case I:return z(le+"Hours",0);case f:return z(le+"Minutes",1);case b:return z(le+"Seconds",2);case n:return z(le+"Milliseconds",3);default:return this.clone()}},y.endOf=function(v){return this.startOf(v,!1)},y.$set=function(v,$){var _,P=Y.p(v),M="set"+(this.$u?"UTC":""),B=(_={},_[V]=M+"Date",_[I]=M+"Date",_[u]=M+"Month",_[w]=M+"FullYear",_[f]=M+"Hours",_[b]=M+"Minutes",_[n]=M+"Seconds",_[p]=M+"Milliseconds",_)[P],z=P===V?this.$D+($-this.$W):$;if(P===u||P===w){var j=this.clone().set(I,1);j.$d[B](z),j.init(),this.$d=j.set(I,Math.min(this.$D,j.daysInMonth())).$d}else B&&this.$d[B](z);return this.init(),this},y.set=function(v,$){return this.clone().$set(v,$)},y.get=function(v){return this[Y.p(v)]()},y.add=function(v,$){var _,P=this;v=Number(v);var M=Y.p($),B=function(J){var Q=q(P);return Y.w(Q.date(Q.date()+Math.round(J*v)),P)};if(M===u)return this.set(u,this.$M+v);if(M===w)return this.set(w,this.$y+v);if(M===V)return B(1);if(M===S)return B(7);var z=(_={},_[b]=l,_[f]=a,_[n]=t,_)[M]||1,j=this.$d.getTime()+v*z;return Y.w(j,this)},y.subtract=function(v,$){return this.add(-1*v,$)},y.format=function(v){var $=this,_=this.$locale();if(!this.isValid())return _.invalidDate||m;var P=v||"YYYY-MM-DDTHH:mm:ssZ",M=Y.z(this),B=this.$H,z=this.$m,j=this.$M,J=_.weekdays,Q=_.months,le=_.meridiem,ue=function(Z,re,be,we){return Z&&(Z[re]||Z($,P))||be[re].slice(0,we)},_e=function(Z){return Y.s(B%12||12,Z,"0")},de=le||function(Z,re,be){var we=Z<12?"AM":"PM";return be?we.toLowerCase():we};return P.replace(F,(function(Z,re){return re||(function(be){switch(be){case"YY":return String($.$y).slice(-2);case"YYYY":return Y.s($.$y,4,"0");case"M":return j+1;case"MM":return Y.s(j+1,2,"0");case"MMM":return ue(_.monthsShort,j,Q,3);case"MMMM":return ue(Q,j);case"D":return $.$D;case"DD":return Y.s($.$D,2,"0");case"d":return String($.$W);case"dd":return ue(_.weekdaysMin,$.$W,J,2);case"ddd":return ue(_.weekdaysShort,$.$W,J,3);case"dddd":return J[$.$W];case"H":return String(B);case"HH":return Y.s(B,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return de(B,z,!0);case"A":return de(B,z,!1);case"m":return String(z);case"mm":return Y.s(z,2,"0");case"s":return String($.$s);case"ss":return Y.s($.$s,2,"0");case"SSS":return Y.s($.$ms,3,"0");case"Z":return M}return null})(Z)||M.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(v,$,_){var P,M=this,B=Y.p($),z=q(v),j=(z.utcOffset()-this.utcOffset())*l,J=this-z,Q=function(){return Y.m(M,z)};switch(B){case w:P=Q()/12;break;case u:P=Q();break;case N:P=Q()/3;break;case S:P=(J-j)/6048e5;break;case V:P=(J-j)/864e5;break;case f:P=J/a;break;case b:P=J/l;break;case n:P=J/t;break;default:P=J}return _?P:Y.a(P)},y.daysInMonth=function(){return this.endOf(u).$D},y.$locale=function(){return O[this.$L]},y.locale=function(v,$){if(!v)return this.$L;var _=this.clone(),P=X(v,$,!0);return P&&(_.$L=P),_},y.clone=function(){return Y.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},k})(),Se=me.prototype;return q.prototype=Se,[["$ms",p],["$s",n],["$m",b],["$H",f],["$W",V],["$M",u],["$y",w],["$D",I]].forEach((function(k){Se[k[1]]=function(y){return this.$g(y,k[0],k[1])}})),q.extend=function(k,y){return k.$i||(k(y,me,q),k.$i=!0),q},q.locale=X,q.isDayjs=oe,q.unix=function(k){return q(1e3*k)},q.en=O[D],q.Ls=O,q.p={},q}))})(Ae)),Ae.exports}var at=st();const $e=et(at);function Me(c,i="сум"){return c==null||isNaN(c)?`0 ${i}`:`${c.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${i}`}function Ce(c){return c?$e(c).format("DD.MM.YYYY"):""}function it(c){return c?c.split(",")[0].trim().split(/\s+/).map(t=>{if(!t)return t;const l=t.charAt(0).toUpperCase(),a=t.slice(1).toLowerCase();return l+a}).join(" "):""}function Ue(c,i="ru"){if(!c)return"";const t=String(c).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?i==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?i==="uz"?"Ayol":"Женский":String(c)}function ot(c){if(!c)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(c))return c;if(/^\d{2}-\d{2}-\d{4}$/.test(c)){const i=c.split("-");return`${i[2]}-${i[1]}-${i[0]}`}try{return $e(c,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return c}}const pe=je("osgo",()=>{const c=Ne(),i=Oe(),t=R({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),l=R({passportSeries:"",passportNumber:"",birthDate:""}),a=R({passportSeries:"",passportNumber:"",birthDate:""}),p=R(C.PARAMS),n=R(!1),b=R(null),f=R(!1),V=R(null),S=R(null),u=R(null),N=R(!1),w=R(null),I=R(!1),m=R(!1),T=R(null),F=R(!1),g=R(!1),G=R(null),E=R(!1),D=R(!1),O=R(null),H=A(()=>t.value.status==="DRAFT"),oe=A(()=>le(p.value).valid),X=A(()=>Object.keys(C).length-1),q=r=>r<=C.OWNER?r+1:r===C.DRIVERS?-1:r,Y=A(()=>q(p.value)),me=A(()=>{const r=Y.value;return Math.round(r/X.value*100)}),Se=A(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,x=t.value.period.coefficient||0,U=t.value.drivedArea.coefficient||0;let K=3;t.value.driversLimited&&t.value.incidentCoeff&&(K=t.value.incidentCoeff);const Te=r*x*K*U,Fe=Te>5*r?Ee*5*r:Ee*Te/100;return Math.round(Fe)}),k=A(()=>{const x=(t.value.entriesJournalKt||[]).reduce((U,K)=>U+(K.amount||0),0);return t.value.premium-x}),y=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},p.value=C.PARAMS,c.isLoaded&&(t.value.discountType=c.getDefaultDiscountType())};ve(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ve(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ve(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const x=parseInt(r.slice(0,2)),U=c.findDrivedAreaByRegion(x);U&&(t.value.drivedArea=U)}),ve(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=Se.value},{deep:!0}),ve(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const v=async()=>{if(t.value.vehicle){I.value=!0,T.value=null,m.value=!1;try{const r=await i.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),x=r?.result||r;if(r?.error&&!x)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&x&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,x),x?.carType&&c.isLoaded&&(t.value.vehicle.carType=c.findCarType(x.carType.id)),m.value=!0,console.log("[OsgoStore] Vehicle verified:",x)}catch(r){throw T.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{I.value=!1}}},$=async()=>{F.value=!0,G.value=null,g.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(a.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.party={...l.value},D.value=!0)),g.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(r){throw G.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{F.value=!1}},_=async()=>{E.value=!0,O.value=null,D.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",r),r&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...r},t.value.party={...a.value}),D.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(r){throw O.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{E.value=!1}},P=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const x=ot(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:x});const U=await i.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:x});if(console.log("[OsgoStore] Driver verification result:",U),!U||!U.id)throw new Error("Driver verification failed: invalid response");const K={...r,...U,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",K),K}catch(x){throw console.error("[OsgoStore] Driver verification failed:",x),x}},M=r=>{t.value.drivers||(t.value.drivers=[]);const x={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(x),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},B=(r,x)=>{t.value.drivers[r]&&(t.value.drivers[r]=x)},z=r=>{t.value.drivers.splice(r,1)},j=(r,x,U)=>t.value.drivers.some(K=>K.passportSeries===r&&K.passportNumber===x&&K.birthDate===U),J=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(j(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}M({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},Q=()=>{j(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||M({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},le=r=>{switch(r){case C.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case C.VEHICLE:return{valid:m.value};case C.OWNER:return{valid:g.value&&(t.value.applicantIsOwner||D.value)};case C.DRIVERS:return{valid:!0};case C.SUMMARY:const x=t.value.applicantIsOwner?l.value.id:a.value.id;return{valid:!!(l.value.id&&x&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(U=>U.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case C.PAYMENT:return{valid:!!(t.value.id&&w.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:a,currentStep:p,saving:n,saveError:b,fetching:f,fetchError:V,fundData:S,fundError:u,fetchingFundData:N,selectedPaymentMethod:w,vehicleVerifying:I,vehicleVerified:m,vehicleVerifyError:T,ownerVerifying:F,ownerVerified:g,ownerVerifyError:G,applicantVerifying:E,applicantVerified:D,applicantVerifyError:O,isEditable:H,canProceedToNextStep:oe,totalSteps:X,displayStepNumber:Y,progressPercentage:me,calculatedPremium:Se,amountPayable:k,initialize:y,verifyVehicle:v,verifyOwner:$,verifyApplicant:_,verifyDriver:P,addDriver:M,updateDriver:B,removeDriver:z,hasDriver:j,addOwnerAsDriver:J,addApplicantAsDriver:Q,validateStepData:le,nextStep:()=>{p.value===C.OWNER?p.value=C.SUMMARY:p.value<C.PAYMENT&&p.value++},previousStep:()=>{p.value===C.SUMMARY?p.value=C.OWNER:p.value>0&&p.value--},goToStep:r=>{r>=0&&r<X.value&&(p.value=r)},createPolicy:async()=>{n.value=!0,b.value=null;try{let r=null;try{r=await i.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Ve){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Ve),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const x=t.value.applicantIsOwner?{...l.value}:{...a.value};x.phone&&(x.phone=x.phone.replace(/[+()-]/g,""));const U={...l.value},K=t.value.discountType||c.meta?.beneficiary?.find(({coefficient:Ve})=>Ve===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const We={party:x,beneficiary:U,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:K,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},ze={user:r,osgo:We};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:x.id,name:x.name},beneficiary:{id:U.id,name:U.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:K?.id}}});const ye=await i.createOsgoApplication(ze);if(!ye||typeof ye!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ye),new Error("Failed to create policy: invalid response");return t.value.id=ye,t.value.applicantIsOwner?(l.value.phone=x.phone,t.value.party=l.value):(a.value.phone=x.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",ye),ye}catch(r){throw b.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{n.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");n.value=!0,b.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?l.value:a.value,beneficiary:l.value};await i.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw b.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{n.value=!1}},fetchPolicy:async r=>{f.value=!0,V.value=null;try{const x=await i.fetchOsgoEntity(r);if(t.value=x,x.party?.id){const U=await i.fetchIndividualEntity(x.party.id);a.value=U,t.value.party=U}if(x.beneficiary?.id){const U=await i.fetchIndividualEntity(x.beneficiary.id);l.value=U,t.value.beneficiary=U}if(c.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=c.findCarType(t.value.vehicle.carType.id)),c.isLoaded&&t.value.period&&(t.value.period=c.findPeriod(t.value.period.id)),c.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=c.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const U=Math.max(...t.value.drivers.map(K=>K.incidentFrequency?.coefficient||0));t.value.incidentCoeff=U}console.log("[OsgoStore] Policy fetched:",r)}catch(x){throw V.value=x.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",x),x}finally{f.value=!1}},fetchFundData:async()=>{if(t.value.id){N.value=!0,u.value=null;try{const r=await i.getFundPolicy(t.value.id);S.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){u.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{N.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:l.value,applicant:a.value,currentStep:p.value};sessionStorage.setItem(Ie.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Ie.OSGO_DRAFT);if(!r)return!1;const x=JSON.parse(r);return t.value=x.osgo,l.value=x.owner,a.value=x.applicant,p.value=x.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Ie.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{y(),m.value=!1,g.value=!1,D.value=!1,S.value=null,b.value=null,V.value=null}}}),lt={class:"language-switcher"},rt=["onClick"],nt=te({__name:"LanguageSwitcher",setup(c){const{locale:i,locales:t}=ie();qe();const l=A(()=>i.value),a=A(()=>t.value.filter(n=>n.code!==i.value)),p=n=>{i.value=n,typeof window<"u"&&localStorage.setItem("app-language",n),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Pe(()=>{if(typeof window<"u"){const n=localStorage.getItem("app-language");n&&(n==="ru"||n==="uz")&&(i.value=n)}}),(n,b)=>(d(),h("div",lt,[(d(!0),h(ae,null,ge(s(a),f=>(d(),h("button",{key:f.code,class:ee(["lang-btn",{active:s(l)===f.code}]),onClick:V=>p(f.code)},o(f.code.toUpperCase()),11,rt))),128))]))}}),ct=se(nt,[["__scopeId","data-v-e748ef5d"]]),ut={class:"progress-bar-container"},dt={class:"progress-track"},pt={class:"steps-container"},vt=["onClick"],ft={key:0,class:"step-check"},ht={key:1,class:"step-number"},mt={class:"step-label"},_t=te({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(c){const i=c,{t}=ie(),l=A(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),a=b=>b<=2?b:b+1,p=A(()=>(i.currentStep+1)/i.totalSteps*100),n=b=>{console.log("Step clicked:",b)};return(b,f)=>(d(),h("div",ut,[e("div",dt,[e("div",{class:"progress-fill",style:He({width:`${p.value}%`})},null,4)]),e("div",pt,[(d(!0),h(ae,null,ge(l.value,(V,S)=>(d(),h("div",{key:S,class:"step-wrapper",onClick:u=>n(S)},[e("div",{class:ee(["step-circle",{"step-active":a(S)===c.currentStep,"step-completed":a(S)<c.currentStep&&a(S)!==s(C).DRIVERS,"step-pending":a(S)>c.currentStep}])},[a(S)<c.currentStep&&a(S)!==s(C).DRIVERS?(d(),h("span",ft,"✓")):(d(),h("span",ht,o(S+1),1))],2),e("div",mt,o(V),1)],8,vt))),128))])]))}}),bt=se(_t,[["__scopeId","data-v-7805c614"]]),yt={class:"fixed-header"},gt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},$t={class:"flex items-center justify-between mb-3"},St={class:"flex items-center gap-3"},wt={class:"text-base font-bold text-text"},Dt=te({__name:"AppHeader",setup(c){const i=pe(),{t}=ie(),l=A(()=>i.currentStep),a=A(()=>i.totalSteps);return(p,n)=>{const b=ct,f=bt;return d(),h("header",yt,[e("div",gt,[e("div",$t,[e("div",St,[n[1]||(n[1]=e("div",{class:"w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg"},[e("img",{src:Xe,alt:"Temiryo'l Sug'urta Logo"})],-1)),e("div",null,[e("div",wt,o(s(t)("header.appTitle")),1),n[0]||(n[0]=e("div",{class:"text-xs text-text-light"}," Temiryo'l Sug'urta ",-1))])]),W(b)]),W(f,{"current-step":l.value,"total-steps":a.value},null,8,["current-step","total-steps"])])])}}}),xt=se(Dt,[["__scopeId","data-v-60581198"]]),Nt={class:"fixed-footer"},kt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},At=["disabled"],Mt={class:"flex-1 text-center"},Ot={class:"text-sm text-text-light font-medium"},Pt=["disabled"],Tt={key:0,class:"spinner"},Vt={key:0},It={key:1},Et={key:2},Ct={key:3,class:"text-lg bx bx-chevron-right"},Lt=te({__name:"AppFooter",setup(c){const i=pe(),t=he(),l=Oe(),{t:a}=ie(),p=R(!1),n=R(null),b=R(null),f=A(()=>i.currentStep),V=A(()=>i.totalSteps),S=A(()=>i.displayStepNumber),u=A(()=>f.value===0),N=A(()=>f.value===C.PAYMENT),w=A(()=>i.canProceedToNextStep),I=A(()=>i.saving||i.fetching||p.value),m=()=>{u.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),i.previousStep())},T=async()=>{if(!w.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(f.value===C.VEHICLE&&!i.vehicleVerified)await i.verifyVehicle();else if(f.value===C.OWNER)i.ownerVerified||await i.verifyOwner(),!i.osgo.applicantIsOwner&&!i.applicantVerified&&await i.verifyApplicant();else if(f.value===C.SUMMARY)i.osgo.id||(await i.createPolicy(),console.log("[AppFooter] Policy created:",i.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(f.value===C.PAYMENT){if(!i.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const g={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[i.selectedPaymentMethod],G=i.osgo.id,D=(i.osgo.applicantIsOwner?i.owner:i.applicant).phone||"",O=i.calculatedPremium;if(!G||!D||!O){const H="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:G,phone:D,amount:O}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(H));return}try{p.value=!0,n.value=null,b.value=null,await l.sendPaymentLink(g,G,D,O),b.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(H){n.value=H.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",H),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(n.value))}finally{p.value=!1}return}N.value?console.log("[AppFooter] Last step reached"):i.nextStep()}catch(F){console.error("[AppFooter] Error:",F),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(F.message||a("errors.unknown")))}};return(F,g)=>(d(),h("footer",Nt,[e("div",kt,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:u.value||I.value,onClick:m},[g[0]||(g[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,o(F.$t("common.previous")),1)],8,At),e("div",Mt,[e("div",Ot,o(F.$t("common.step",{current:S.value,total:V.value})),1)]),e("button",{type:"button",class:ee(["btn flex-1 max-w-[160px]",{"btn-primary":!N.value||f.value!==s(C).PAYMENT,"btn-success":N.value&&f.value===s(C).PAYMENT}]),disabled:!w.value||I.value,onClick:T},[I.value?(d(),h("span",Tt)):(d(),h(ae,{key:1},[f.value===s(C).SUMMARY&&!s(i).osgo.id?(d(),h("span",Vt,o(F.$t("step5.confirm")),1)):N.value&&f.value===s(C).PAYMENT?(d(),h("span",It,[g[1]||(g[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(F.$t("step5.payment")),1)])):(d(),h("span",Et,o(F.$t("common.next")),1)),!N.value&&f.value!==s(C).SUMMARY?(d(),h("i",Ct)):L("",!0)],64))],10,Pt)])]))}}),Ft=se(Lt,[["__scopeId","data-v-9a015344"]]),Yt={class:"step-container"},Rt={key:0,class:"loading-state"},Bt={key:1,class:"error-state"},Ut={key:2,class:"error-state"},Wt={class:"debug-info"},zt={key:3},jt={class:"step-header"},qt={class:"step-title"},Ht={class:"step-description"},Gt={class:"step-content"},Jt={class:"form-section"},Kt={class:"section-title"},Zt={class:"select-wrapper"},Qt=["disabled"],Xt=["value"],es={class:"form-section"},ts={class:"section-title"},ss={class:"select-wrapper"},as=["disabled"],is=["value"],os={class:"form-section",style:{display:"none"}},ls={class:"section-title"},rs={class:"select-wrapper"},ns=["disabled"],cs={value:"false"},us={value:"true"},ds={key:0,class:"form-section"},ps={class:"section-title"},vs={class:"select-wrapper"},fs=["disabled"],hs=["value"],ms={class:"form-section"},_s={class:"section-title"},bs={class:"select-wrapper"},ys=["disabled"],gs=["value"],$s={key:0,class:"premium-card"},Ss={class:"premium-card-content"},ws={class:"premium-label"},Ds={class:"premium-amount"},xs=te({__name:"Step1Params",setup(c){const i=pe(),t=Ne(),l=he(),{locale:a,t:p}=ie(),n=A(()=>i.osgo),b=()=>{if(!(!t.isLoaded||!(!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id))){if(t.carTypes.length>0){const m=t.carTypes[0];n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=m}t.periods.length>0&&(n.value.period=t.periods[0]),t.drivedAreas.length>0&&(n.value.drivedArea=t.drivedAreas[0]),n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited&&!n.value.incidentCoeff&&t.incidentFrequencies.length>0&&(n.value.incidentCoeff=t.incidentFrequencies[0].coefficient)}};ve(()=>t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0,I=>{I&&!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id&&Ye(()=>{b()})},{immediate:!0}),Pe(async()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Periods count:",t.periods.length),await Ye();const I=!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id;t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0&&I&&b()});const f=I=>{const m=t.getLocalizedName(I,a.value||"uz");return it(m)},V=A({get:()=>n.value.vehicle?.carType?.id||"",set:I=>{if(!i.isEditable)return;const m=t.carTypes.find(T=>T.id===I);m&&(n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=m,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),S=A({get:()=>n.value.period?.id||"",set:I=>{if(!i.isEditable)return;const m=t.periods.find(T=>T.id===I);m&&(n.value.period=m,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),u=A({get:()=>(n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited?"true":"false"),set:I=>{i.isEditable&&(n.value.driversLimited=I==="true",n.value.driversLimited||(n.value.incidentCoeff=void 0),l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),N=A({get:()=>n.value.incidentCoeff?.toString()||"",set:I=>{if(!i.isEditable)return;const m=parseFloat(I);isNaN(m)||(n.value.incidentCoeff=m,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),w=A({get:()=>n.value.drivedArea?.id||"",set:I=>{const m=t.findDrivedArea(I);m&&(n.value.drivedArea=m)}});return(I,m)=>(d(),h("div",Yt,[s(t).fetching?(d(),h("div",Rt,[m[6]||(m[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,o(s(p)("common.loading")),1)])):s(t).error?(d(),h("div",Bt,[m[7]||(m[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,o(s(t).error),1),e("button",{onClick:m[0]||(m[0]=T=>s(t).fetchMeta(!0)),class:"btn-retry"},o(s(p)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(d(),h("div",Ut,[m[10]||(m[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,o(s(p)("common.loading")),1),e("p",Wt,[ke(" isLoaded: "+o(s(t).isLoaded),1),m[8]||(m[8]=e("br",null,null,-1)),ke(" carTypes: "+o(s(t).carTypes.length),1),m[9]||(m[9]=e("br",null,null,-1)),ke(" meta: "+o(s(t).meta?"exists":"null"),1)])])):(d(),h("div",zt,[e("div",jt,[e("h2",qt,o(s(p)("step1.title")),1),e("p",Ht,o(s(p)("step1.description")),1)]),e("div",Gt,[e("div",Jt,[e("h3",Kt,o(s(p)("step1.vehicleType")),1),e("div",Zt,[fe(e("select",{"onUpdate:modelValue":m[1]||(m[1]=T=>V.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),h(ae,null,ge(s(t).carTypes,T=>(d(),h("option",{key:T.id,value:T.id},o(f(T)),9,Xt))),128))],8,Qt),[[De,V.value]]),m[11]||(m[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",es,[e("h3",ts,o(s(p)("step1.period")),1),e("div",ss,[fe(e("select",{"onUpdate:modelValue":m[2]||(m[2]=T=>S.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),h(ae,null,ge(s(t).periods,T=>(d(),h("option",{key:T.id,value:T.id},o(f(T)),9,is))),128))],8,as),[[De,S.value]]),m[12]||(m[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",os,[e("h3",ls,o(s(p)("step1.driversLimited")),1),e("div",rs,[fe(e("select",{"onUpdate:modelValue":m[3]||(m[3]=T=>u.value=T),class:"input",disabled:!s(i).isEditable},[e("option",cs,o(s(p)("step1.driversLimitedNo"))+" - "+o(s(p)("step1.driversLimitedNoDesc")),1),e("option",us,o(s(p)("step1.driversLimitedYes"))+" - "+o(s(p)("step1.driversLimitedYesDesc")),1)],8,ns),[[De,u.value]]),m[13]||(m[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),W(ne,{name:"slide-down"},{default:ce(()=>[n.value.driversLimited?(d(),h("div",ds,[e("h3",ps,o(s(p)("step1.incidentFrequency")),1),e("div",vs,[fe(e("select",{"onUpdate:modelValue":m[4]||(m[4]=T=>N.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),h(ae,null,ge(s(t).incidentFrequencies,T=>(d(),h("option",{key:T.id,value:T.coefficient},o(f(T)),9,hs))),128))],8,fs),[[De,N.value]]),m[14]||(m[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])])):L("",!0)]),_:1}),e("div",ms,[e("h3",_s,o(s(p)("step1.usageTerritory")),1),e("div",bs,[fe(e("select",{"onUpdate:modelValue":m[5]||(m[5]=T=>w.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),h(ae,null,ge(s(t).drivedAreas,T=>(d(),h("option",{key:T.id,value:T.id},o(f(T)),9,gs))),128))],8,ys),[[De,w.value]]),m[15]||(m[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),s(i).calculatedPremium>0?(d(),h("div",$s,[e("div",Ss,[e("div",ws,[m[16]||(m[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(p)("step1.premium")),1)]),e("div",Ds,o(s(Me)(s(i).calculatedPremium)),1)])])):L("",!0)])]))]))}}),Ns=se(xs,[["__scopeId","data-v-d91bcbca"]]),ks=["for"],As={key:0,class:"text-error"},Ms={class:"input-wrapper"},Os={key:0,class:"input-icon input-icon-left"},Ps=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Ts={key:2,class:"input-icon input-icon-right"},Vs={key:1,class:"input-message"},Is={key:0,class:"error-message"},Es={key:1,class:"helper-text"},Cs={key:2,class:"input-count"},Ls=te({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(c,{expose:i,emit:t}){const l=c,a=t,{locale:p}=ie(),n=A(()=>{if(l.type==="date")return p.value==="uz"?"uz-UZ":"ru-RU"}),b=R(null),f=A(()=>`input-${Math.random().toString(36).substr(2,9)}`),V=A({get:()=>{const E=String(l.modelValue||"");if(l.dateMask&&E){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(E)||/^\d{2}-\d{2}-\d{4}$/.test(E))return E;if(/^\d{4}-\d{2}-\d{2}$/.test(E)){const D=E.split("-");return`${D[2]}-${D[1]}-${D[0]}`}}return E},set:E=>{if(l.uppercase&&(E=E.toUpperCase()),l.dateMask&&E){if(/^\d{4}-\d{2}-\d{2}$/.test(E)){a("update:modelValue",E);return}if(/^\d{2}-\d{2}-\d{4}$/.test(E)){const D=E.split("-");a("update:modelValue",`${D[2]}-${D[1]}-${D[0]}`);return}a("update:modelValue",E);return}a("update:modelValue",E)}}),S=E=>{const D=E.target;let O=D.value;if(l.uppercase&&(O=O.toUpperCase(),D.value!==O&&(D.value=O)),l.dateMask){const H=F(O);D.value!==H&&(D.value=H),a("update:modelValue",H),a("input",H);return}l.mask&&(O=T(O)),a("update:modelValue",O),a("input",O)},u=()=>{if(l.dateMask&&V.value){const E=String(V.value);if(/^\d{2}-\d{2}-\d{4}$/.test(E)){const D=E.split("-"),O=`${D[2]}-${D[1]}-${D[0]}`,H=new Date(O);isNaN(H.getTime())||a("update:modelValue",O)}}a("blur")},N=()=>{a("focus")},w=E=>{},I=()=>{a("enter")},m=()=>{a("update:modelValue",""),b.value?.focus()},T=E=>{if(l.dateMask)return F(E);if(!l.mask)return E;let D="",O=0;const H=E.replace(/\D/g,"");for(let oe=0;oe<l.mask.length&&O<H.length;oe++){const X=l.mask[oe];X==="#"?(D+=H[O],O++):D+=X}return D},F=E=>{const O=E.replace(/\D/g,"").slice(0,8);return O.length===0?"":O.length<=2?O:O.length<=4?`${O.slice(0,2)}-${O.slice(2)}`:`${O.slice(0,2)}-${O.slice(2,4)}-${O.slice(4)}`},g=()=>{b.value?.focus()},G=()=>{b.value?.blur()};return Pe(()=>{l.autofocus&&g()}),i({focus:g,blur:G}),(E,D)=>(d(),h("div",{class:ee(["input-field",{"has-error":c.error}])},[c.label?(d(),h("label",{key:0,class:"input-label",for:f.value},[ke(o(c.label)+" ",1),c.required?(d(),h("span",As,"*")):L("",!0)],8,ks)):L("",!0),e("div",Ms,[c.icon?(d(),h("div",Os,[e("i",{class:ee(c.icon)},null,2)])):L("",!0),fe(e("input",{id:f.value,ref_key:"inputRef",ref:b,"onUpdate:modelValue":D[0]||(D[0]=O=>V.value=O),type:c.dateMask?"text":c.type,placeholder:c.dateMask?c.placeholder||"DD-MM-YYYY":c.placeholder,disabled:c.disabled,readonly:c.readonly,maxlength:c.dateMask?10:c.maxLength,autocomplete:c.autocomplete,inputmode:c.dateMask?"numeric":c.inputMode,lang:n.value,class:ee(["input",{"input-with-icon-left":c.icon,"input-with-icon-right":c.clearable||c.loading,"input-error":c.error}]),onInput:S,onBlur:u,onFocus:N,onKeypress:w,onKeydown:Je(I,["enter"])},null,42,Ps),[[Ge,V.value]]),c.clearable&&V.value&&!c.disabled&&!c.readonly?(d(),h("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:m},[...D[1]||(D[1]=[e("i",{class:"bx bx-x"},null,-1)])])):L("",!0),c.loading?(d(),h("div",Ts,[...D[2]||(D[2]=[e("div",{class:"spinner-small"},null,-1)])])):L("",!0)]),c.helperText||c.error?(d(),h("div",Vs,[c.error?(d(),h("span",Is,o(c.error),1)):c.helperText?(d(),h("span",Es,o(c.helperText),1)):L("",!0)])):L("",!0),c.showCount&&c.maxLength?(d(),h("div",Cs,o(V.value.length)+" / "+o(c.maxLength),1)):L("",!0)],2))}}),Le=se(Ls,[["__scopeId","data-v-4eb39aee"]]);function Fs(c){if(!c)return{valid:!1,error:"Государственный номер обязателен"};const i=c.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(i)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Ys(c){if(!c)return{valid:!1,error:"Серия техпаспорта обязательна"};const i=c.toUpperCase();return/^[A-Z]{2,3}$/.test(i)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Rs(c){return c?/^\d+$/.test(c)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Bs={class:"step-container"},Us={class:"step-header"},Ws={class:"step-title"},zs={class:"step-description"},js={class:"step-content"},qs={class:"form-section"},Hs={class:"form-section"},Gs={class:"form-section"},Js={class:"form-section"},Ks=["disabled"],Zs={key:0,class:"spinner"},Qs={key:0,class:"alert alert-error"},Xs={key:0,class:"vehicle-info-card"},ea={class:"card-header"},ta={class:"card-content"};const sa={class:"vehicle-info-grid"},aa={key:0,class:"vehicle-info-item"},ia={class:"vehicle-info-label"},oa={class:"vehicle-info-value"},la={key:1,class:"vehicle-info-item"},ra={class:"vehicle-info-label"},na={class:"vehicle-info-value"},ca={key:2,class:"vehicle-info-item"},ua={class:"vehicle-info-label"},da={class:"vehicle-info-value"},pa={key:3,class:"vehicle-info-item"},va={class:"vehicle-info-label"},fa={class:"vehicle-info-value"},ha={key:4,class:"vehicle-info-item"},ma={class:"vehicle-info-label"},_a={class:"vehicle-info-value"},ba={key:1,class:"vehicle-info-empty"},ya=te({__name:"Step2Vehicle",setup(c){const i=pe();Ne();const t=he(),{t:l}=ie(),a=A(()=>i.osgo),p=R({}),n=A(()=>!!(a.value.vehicle?.govNumber&&a.value.vehicle?.techPassportSeries&&a.value.vehicle?.techPassportNumber&&Object.keys(p.value).length===0)),b=A(()=>{if(!a.value.vehicle)return 0;const S=a.value.vehicle;let u=0;return S.techPassportIssueDate&&u++,(S.modelName||S.model)&&u++,(S.createdYear||S.year)&&u++,S.engineNumber&&u++,S.bodyNumber&&u++,u}),f=S=>{if(!a.value.vehicle)return;let u;switch(S){case"govNumber":u=Fs(a.value.vehicle.govNumber);break;case"techPassportSeries":u=Ys(a.value.vehicle.techPassportSeries);break;case"techPassportNumber":u=Rs(a.value.vehicle.techPassportNumber);break}u&&!u.valid?p.value[S]=u.error||"":delete p.value[S]},V=async()=>{if(f("govNumber"),f("techPassportSeries"),f("techPassportNumber"),Object.keys(p.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await i.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",a.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(a.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(S,u)=>{const N=Le;return d(),h("div",Bs,[e("div",Us,[e("h2",Ws,o(s(l)("step2.title")),1),e("p",zs,o(s(l)("step2.description")),1)]),e("div",js,[e("div",qs,[W(N,{modelValue:a.value.vehicle.govNumber,"onUpdate:modelValue":u[0]||(u[0]=w=>a.value.vehicle.govNumber=w),label:s(l)("step2.govNumber"),placeholder:s(l)("step2.govNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:u[1]||(u[1]=w=>f("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Hs,[W(N,{modelValue:a.value.vehicle.techPassportSeries,"onUpdate:modelValue":u[2]||(u[2]=w=>a.value.vehicle.techPassportSeries=w),label:s(l)("step2.techPassportSeries"),placeholder:s(l)("step2.techPassportSeriesPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:u[3]||(u[3]=w=>f("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Gs,[W(N,{modelValue:a.value.vehicle.techPassportNumber,"onUpdate:modelValue":u[4]||(u[4]=w=>a.value.vehicle.techPassportNumber=w),label:s(l)("step2.techPassportNumber"),placeholder:s(l)("step2.techPassportNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:u[5]||(u[5]=w=>f("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Js,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!n.value||s(i).vehicleVerifying,onClick:V},[s(i).vehicleVerifying?(d(),h("span",Zs)):(d(),h(ae,{key:1},[u[6]||(u[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).vehicleVerified?s(l)("step2.verified"):s(l)("step2.verify")),1)],64))],8,Ks)]),s(i).vehicleVerifyError?(d(),h("div",Qs,[u[7]||(u[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(s(i).vehicleVerifyError),1)])):L("",!0),W(ne,{name:"fade"},{default:ce(()=>[s(i).vehicleVerified&&a.value.vehicle?(d(),h("div",Xs,[e("div",ea,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,o(s(l)("step2.vehicleFound")),1)]),e("div",ta,[L("",!0),e("div",sa,[a.value.vehicle?.techPassportIssueDate?(d(),h("div",aa,[e("div",ia,o(s(l)("step2.techPassportIssueDate")),1),e("div",oa,o(s(Ce)(a.value.vehicle.techPassportIssueDate)),1)])):L("",!0),a.value.vehicle?.modelName||a.value.vehicle?.model?(d(),h("div",la,[e("div",ra,o(s(l)("step2.model")),1),e("div",na,o(a.value.vehicle?.modelName||a.value.vehicle?.model||"-"),1)])):L("",!0),a.value.vehicle?.createdYear||a.value.vehicle?.year?(d(),h("div",ca,[e("div",ua,o(s(l)("step2.year")),1),e("div",da,o(a.value.vehicle?.createdYear||a.value.vehicle?.year||"-"),1)])):L("",!0),a.value.vehicle?.engineNumber?(d(),h("div",pa,[e("div",va,o(s(l)("step2.engineNumber")),1),e("div",fa,o(a.value.vehicle.engineNumber),1)])):L("",!0),a.value.vehicle?.bodyNumber?(d(),h("div",ha,[e("div",ma,o(s(l)("step2.bodyNumber")),1),e("div",_a,o(a.value.vehicle.bodyNumber),1)])):L("",!0)]),b.value===0?(d(),h("div",ba,o(s(l)("step2.vehicleNotFound")),1)):L("",!0)])])):L("",!0)]),_:1})])])}}}),ga=se(ya,[["__scopeId","data-v-3ead2593"]]),$a={class:"step-container"},Sa={class:"step-header"},wa={class:"step-title"},Da={class:"step-description"},xa={class:"step-content"},Na={class:"subsection"},ka={class:"subsection-title"},Aa={class:"form-section"},Ma={class:"form-section"},Oa={class:"form-section"},Pa={class:"form-section"},Ta=["disabled"],Va={key:0,class:"spinner"},Ia={key:0,class:"info-card success"},Ea={class:"card-header"},Ca={class:"card-content"},La={class:"info-grid"},Fa={class:"info-item"},Ya={class:"info-label"},Ra={class:"info-value"},Ba={class:"info-item"},Ua={class:"info-label"},Wa={class:"info-value"},za={class:"info-item info-item-wide"},ja={class:"info-label"},qa={class:"info-value"},Ha={class:"info-item"},Ga={class:"info-label"},Ja={class:"info-value"},Ka={class:"info-item"},Za={class:"info-label"},Qa={class:"info-value"},Xa={class:"info-item"},ei={class:"info-label"},ti={class:"info-value"},si={class:"info-item"},ai={class:"info-label"},ii={class:"info-value"},oi={class:"info-item"},li={class:"info-label"},ri={class:"info-value"},ni={class:"info-item"},ci={class:"info-label"},ui={class:"info-value"},di={class:"info-item"},pi={class:"info-label"},vi={class:"info-value"},fi={class:"info-item"},hi={class:"info-label"},mi={class:"info-value"},_i={class:"form-section"},bi={class:"checkbox-label"},yi=["disabled"],gi={key:0,class:"subsection"},$i={class:"subsection-title"},Si={class:"form-section"},wi={class:"form-section"},Di={class:"form-section"},xi={class:"form-section"},Ni=["disabled"],ki={key:0,class:"spinner"},Ai={key:0,class:"info-card success"},Mi={class:"card-header"},Oi={class:"card-content"},Pi={class:"info-grid"},Ti={class:"info-item"},Vi={class:"info-label"},Ii={class:"info-value"},Ei={class:"info-item"},Ci={class:"info-label"},Li={class:"info-value"},Fi={class:"info-item info-item-wide"},Yi={class:"info-label"},Ri={class:"info-value"},Bi={class:"info-item"},Ui={class:"info-label"},Wi={class:"info-value"},zi={class:"info-item"},ji={class:"info-label"},qi={class:"info-value"},Hi={class:"info-item"},Gi={class:"info-label"},Ji={class:"info-value"},Ki={class:"info-item"},Zi={class:"info-label"},Qi={class:"info-value"},Xi={class:"info-item"},eo={class:"info-label"},to={class:"info-value"},so={class:"info-item"},ao={class:"info-label"},io={class:"info-value"},oo={class:"info-item"},lo={class:"info-label"},ro={class:"info-value"},no={class:"info-item"},co={class:"info-label"},uo={class:"info-value"},po=te({__name:"Step3Owner",setup(c){const i=pe(),t=he(),{locale:l,t:a}=ie(),p=A(()=>i.osgo),n=A(()=>i.owner),b=A(()=>i.applicant),f=async()=>{try{await i.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},V=async()=>{try{await i.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(S,u)=>{const N=Le;return d(),h("div",$a,[e("div",Sa,[e("h2",wa,o(s(a)("step3.title")),1),e("p",Da,o(s(a)("step3.description")),1)]),e("div",xa,[e("div",Na,[e("h3",ka,o(s(a)("step3.owner")),1),e("div",Aa,[W(N,{modelValue:n.value.passportSeries,"onUpdate:modelValue":u[0]||(u[0]=w=>n.value.passportSeries=w),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Ma,[W(N,{modelValue:n.value.passportNumber,"onUpdate:modelValue":u[1]||(u[1]=w=>n.value.passportNumber=w),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Oa,[W(N,{modelValue:n.value.birthDate,"onUpdate:modelValue":u[2]||(u[2]=w=>n.value.birthDate=w),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Pa,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).ownerVerifying,onClick:f},[s(i).ownerVerifying?(d(),h("span",Va)):(d(),h(ae,{key:1},[u[7]||(u[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).ownerVerified?s(a)("step3.verified"):s(a)("step3.verifyOwner")),1)],64))],8,Ta)]),W(ne,{name:"fade"},{default:ce(()=>[s(i).ownerVerified&&n.value.id?(d(),h("div",Ia,[e("div",Ea,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a)("step3.ownerFound")),1)]),e("div",Ca,[e("div",La,[e("div",Fa,[e("div",Ya,o(s(a)("step3.passportIssueDate")),1),e("div",Ra,o(n.value.passportIssueDate?s(Ce)(n.value.passportIssueDate):"-"),1)]),e("div",Ba,[e("div",Ua,o(s(a)("step3.pinfl")),1),e("div",Wa,o(n.value.nationalIdentifier||"-"),1)]),e("div",za,[e("div",ja,o(s(a)("step3.issuedBy")),1),e("div",qa,o(n.value.passportIssuedBy||"-"),1)]),e("div",Ha,[e("div",Ga,o(s(a)("step3.lastName")),1),e("div",Ja,o(n.value.lastName||"-"),1)]),e("div",Ka,[e("div",Za,o(s(a)("step3.firstName")),1),e("div",Qa,o(n.value.firstName||"-"),1)]),e("div",Xa,[e("div",ei,o(s(a)("step3.middleName")),1),e("div",ti,o(n.value.middleName||"-"),1)]),e("div",si,[e("div",ai,o(s(a)("step3.gender")),1),e("div",ii,o(n.value.gender?s(Ue)(n.value.gender,s(l).value):"-"),1)]),e("div",oi,[e("div",li,o(s(a)("step3.country")),1),e("div",ri,o(n.value.country?.langValue1||"-"),1)]),e("div",ni,[e("div",ci,o(s(a)("step3.region")),1),e("div",ui,o(n.value.region?.langValue1||"-"),1)]),e("div",di,[e("div",pi,o(s(a)("step3.district")),1),e("div",vi,o(n.value.district?.langValue1||"-"),1)]),e("div",fi,[e("div",hi,o(s(a)("step3.street")),1),e("div",mi,o(n.value.street||"-"),1)])])])])):L("",!0)]),_:1})]),e("div",_i,[e("label",bi,[fe(e("input",{"onUpdate:modelValue":u[3]||(u[3]=w=>p.value.applicantIsOwner=w),type:"checkbox",class:"checkbox",disabled:!s(i).isEditable},null,8,yi),[[Ke,p.value.applicantIsOwner]]),e("span",null,o(s(a)("step3.ownerIsApplicant")),1)])]),W(ne,{name:"slide-down"},{default:ce(()=>[p.value.applicantIsOwner?L("",!0):(d(),h("div",gi,[e("h3",$i,o(s(a)("step3.applicant")),1),e("div",Si,[W(N,{modelValue:b.value.passportSeries,"onUpdate:modelValue":u[4]||(u[4]=w=>b.value.passportSeries=w),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",wi,[W(N,{modelValue:b.value.passportNumber,"onUpdate:modelValue":u[5]||(u[5]=w=>b.value.passportNumber=w),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Di,[W(N,{modelValue:b.value.birthDate,"onUpdate:modelValue":u[6]||(u[6]=w=>b.value.birthDate=w),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",xi,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).applicantVerifying,onClick:V},[s(i).applicantVerifying?(d(),h("span",ki)):(d(),h(ae,{key:1},[u[9]||(u[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).applicantVerified?s(a)("step3.verified"):s(a)("step3.verifyApplicant")),1)],64))],8,Ni)]),W(ne,{name:"fade"},{default:ce(()=>[s(i).applicantVerified&&b.value.id?(d(),h("div",Ai,[e("div",Mi,[u[10]||(u[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a)("step3.applicantFound")),1)]),e("div",Oi,[e("div",Pi,[e("div",Ti,[e("div",Vi,o(s(a)("step3.passportIssueDate")),1),e("div",Ii,o(b.value.passportIssueDate?s(Ce)(b.value.passportIssueDate):"-"),1)]),e("div",Ei,[e("div",Ci,o(s(a)("step3.pinfl")),1),e("div",Li,o(b.value.nationalIdentifier||"-"),1)]),e("div",Fi,[e("div",Yi,o(s(a)("step3.issuedBy")),1),e("div",Ri,o(b.value.passportIssuedBy||"-"),1)]),e("div",Bi,[e("div",Ui,o(s(a)("step3.lastName")),1),e("div",Wi,o(b.value.lastName||"-"),1)]),e("div",zi,[e("div",ji,o(s(a)("step3.firstName")),1),e("div",qi,o(b.value.firstName||"-"),1)]),e("div",Hi,[e("div",Gi,o(s(a)("step3.middleName")),1),e("div",Ji,o(b.value.middleName||"-"),1)]),e("div",Ki,[e("div",Zi,o(s(a)("step3.gender")),1),e("div",Qi,o(b.value.gender?s(Ue)(b.value.gender,s(l).value):"-"),1)]),e("div",Xi,[e("div",eo,o(s(a)("step3.country")),1),e("div",to,o(b.value.country?.langValue1||"-"),1)]),e("div",so,[e("div",ao,o(s(a)("step3.region")),1),e("div",io,o(b.value.region?.langValue1||"-"),1)]),e("div",oo,[e("div",lo,o(s(a)("step3.district")),1),e("div",ro,o(b.value.district?.langValue1||"-"),1)]),e("div",no,[e("div",co,o(s(a)("step3.street")),1),e("div",uo,o(b.value.street||"-"),1)])])])])):L("",!0)]),_:1})]))]),_:1})])])}}}),vo=se(po,[["__scopeId","data-v-62def220"]]),fo={class:"step-container"},ho={class:"step-header"},mo={class:"step-title"},_o={class:"step-description"},bo={class:"step-content"},yo={class:"summary-section"},go={class:"section-title"},$o={class:"summary-card"},So={class:"card-title"},wo={class:"card-content"},Do={class:"info-row"},xo={class:"info-value-full"},No={class:"summary-card"},ko={class:"card-title"},Ao={class:"card-content"},Mo={class:"info-row"},Oo={class:"info-value-full"},Po={class:"summary-card"},To={class:"card-title"},Vo={class:"card-content"},Io={class:"info-row"},Eo={class:"info-value-full"},Co={class:"summary-card"},Lo={class:"card-title"},Fo={class:"card-content"},Yo={class:"info-row"},Ro={class:"info-value-full"},Bo={class:"info-row"},Uo={class:"info-value-full"},Wo={class:"info-row"},zo={class:"info-value-full"},jo={class:"summary-card"},qo={class:"card-title"},Ho={class:"card-content"},Go={class:"info-row"},Jo={class:"info-value-full"},Ko={class:"summary-section"},Zo={class:"section-title"},Qo={class:"form-section"},Xo={class:"form-section"},el={key:0,class:"form-section"},tl={class:"premium-section"},sl={class:"premium-card-large"},al={class:"premium-header"},il={class:"premium-amount-large"},ol=te({__name:"Step5Summary",setup(c){const i=pe(),t=Ne();he(),Oe();const l=A(()=>i.osgo),a=A(()=>i.owner),p=A(()=>i.applicant);A(()=>i.fundData),R(!1);const n=A({get:()=>(l.value.applicantIsOwner?a.value:p.value).phone||"",set:u=>{l.value.applicantIsOwner?(a.value.phone=u,l.value.party=a.value):(p.value.phone=u,l.value.party=p.value)}}),{locale:b,t:f}=ie(),V=()=>l.value.period?t.getLocalizedName(l.value.period,b.value||"uz"):"-",S=()=>l.value.drivedArea?t.getLocalizedName(l.value.drivedArea,b.value||"uz"):"-";return(u,N)=>{const w=Le;return d(),h("div",fo,[e("div",ho,[e("h2",mo,o(s(f)("step5.title")),1),e("p",_o,o(s(f)("step5.description")),1)]),e("div",bo,[e("div",yo,[e("h3",go,[N[2]||(N[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,o(s(f)("step5.policyInfo")),1)]),e("div",$o,[e("div",So,o(s(f)("step3.owner")),1),e("div",wo,[e("div",Do,[e("span",xo,o(a.value.name||"-")+o(a.value.birthDate?` (${a.value.birthDate})`:""),1)])])]),e("div",No,[e("div",ko,o(s(f)("step3.applicant")),1),e("div",Ao,[e("div",Mo,[e("span",Oo,o((l.value.applicantIsOwner?a.value:p.value).name||"-")+o((l.value.applicantIsOwner?a.value:p.value).birthDate?` (${(l.value.applicantIsOwner?a.value:p.value).birthDate})`:""),1)])])]),e("div",Po,[e("div",To,o(s(f)("step5.vehicleInfo")),1),e("div",Vo,[e("div",Io,[e("span",Eo,o(l.value.vehicle?.modelName||l.value.vehicle?.model||"-")+" "+o(l.value.vehicle?.govNumber?` (${l.value.vehicle.govNumber})`:""),1)])])]),e("div",Co,[e("div",Lo,o(s(f)("step5.policyInfo")),1),e("div",Fo,[e("div",Yo,[e("span",Ro,o(V()),1)]),e("div",Bo,[e("span",Uo,o(S()),1)]),e("div",Wo,[e("span",zo,o(l.value.driversLimited?s(f)("step5.driversLimited",{count:l.value.drivers?.length||0}):s(f)("step5.noDriversLimitation")),1)])])]),e("div",jo,[e("div",qo,o(s(f)("step5.compensation")),1),e("div",Ho,[e("div",Go,[e("span",Jo,o(s(Me)(s(Ee))),1)])])])]),e("div",Ko,[e("h3",Zo,[N[3]||(N[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,o(s(f)("step5.contactInfo")),1)]),e("div",Qo,[W(w,{modelValue:n.value,"onUpdate:modelValue":N[0]||(N[0]=I=>n.value=I),label:s(f)("step5.phone"),placeholder:s(f)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Xo,[W(w,{modelValue:l.value.contractStartDate,"onUpdate:modelValue":N[1]||(N[1]=I=>l.value.contractStartDate=I),label:s(f)("step5.startDate"),type:"text","date-mask":"",placeholder:s(f)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),l.value.contractEndDate?(d(),h("div",el,[W(w,{"model-value":l.value.contractEndDate,label:s(f)("step5.endDate"),type:"text","date-mask":"",placeholder:s(f)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):L("",!0)]),e("div",tl,[e("div",sl,[e("div",al,[N[4]||(N[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(f)("step5.premium")),1)]),e("div",il,o(s(Me)(s(i).calculatedPremium)),1)])])])])}}}),ll=se(ol,[["__scopeId","data-v-8e729bee"]]),rl={class:"step-container"},nl={class:"step-header"},cl={class:"step-title"},ul={class:"step-description"},dl={class:"step-content"},pl={class:"premium-section"},vl={class:"premium-card-large"},fl={class:"premium-header"},hl={class:"premium-amount-large"},ml={class:"payment-section"},_l={class:"section-title"},bl={class:"payment-buttons"},yl=["disabled"],gl={key:0,class:"payment-selected-indicator"},$l=["disabled"],Sl={key:0,class:"payment-selected-indicator"},wl=["disabled"],Dl={key:0,class:"payment-selected-indicator"},xl={class:"status-section"},Nl=["disabled"],kl={key:0,class:"ml-1"},Al={key:0,class:"error-message mt-2"},Ml={key:0,class:"success-card"},Ol={class:"success-title"},Pl={class:"success-description"},Tl={class:"policy-details"},Vl={class:"policy-row"},Il={class:"policy-label"},El={class:"policy-value"},Cl={class:"policy-row"},Ll={class:"policy-label"},Fl={class:"policy-value"},Yl=te({__name:"Step6Payment",setup(c){const i=pe(),t=he();Oe();const{t:l,locale:a}=ie(),p=A(()=>i.osgo),n=A(()=>i.fundData);A(()=>(p.value.applicantIsOwner?i.owner:i.applicant).phone||"");const b=R(!1),f=R(null),V=R(0),S=R(null);let u=null;const N=A({get:()=>i.selectedPaymentMethod,set:F=>{i.selectedPaymentMethod=F}}),w=A(()=>{if(!S.value)return"";const F=S.value.toLowerCase(),g=a.value,G=g==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],E=g==="ru"?["ошибка","не получена"]:["xato","olindi"];return G.some(D=>F.includes(D))?"status-success":E.some(D=>F.includes(D))?"status-error":"status-info"}),I=A(()=>w.value==="status-success"?"bx bx-check-circle":w.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),m=F=>{N.value===F?N.value=null:N.value=F,t.isTelegramWebApp.value&&t.hapticImpact("light")},T=async()=>{if(!p.value.id){f.value=l("errors.createApplicationFailed");return}try{b.value=!0,f.value=null,S.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await i.fetchFundData(),n.value?.seria&&n.value?.number?(S.value=l("step5.paymentSuccess"),t.isTelegramWebApp.value&&t.hapticNotification("success")):n.value?S.value=l("step5.paymentProcessing"):S.value=l("step5.paymentNotReceived"),V.value=15,u&&clearInterval(u),u=window.setInterval(()=>{V.value>0?V.value--:u&&(clearInterval(u),u=null)},1e3)}catch(F){console.error("[Step6Payment] Check status error:",F),f.value=F.message||l("errors.paymentFailed"),S.value=l("errors.paymentFailed"),t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{b.value=!1}};return Ze(()=>{u&&clearInterval(u)}),(F,g)=>(d(),h("div",rl,[e("div",nl,[e("h2",cl,o(s(l)("step5.payment")),1),e("p",ul,o(s(l)("step5.paymentDescription")),1)]),e("div",dl,[e("div",pl,[e("div",vl,[e("div",fl,[g[3]||(g[3]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(l)("step5.premium")),1)]),e("div",hl,o(s(Me)(s(i).calculatedPremium)),1)])]),e("div",ml,[e("h3",_l,[g[4]||(g[4]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(s(l)("step5.paymentMethod")),1)]),e("div",bl,[e("button",{type:"button",class:ee(["payment-btn payme",{"payment-btn-selected":N.value==="payme"}]),disabled:b.value,onClick:g[0]||(g[0]=G=>m("payme"))},[g[6]||(g[6]=e("div",{class:"payment-icon"},"💳",-1)),g[7]||(g[7]=e("div",{class:"payment-name"},"Payme",-1)),N.value==="payme"?(d(),h("div",gl,[...g[5]||(g[5]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,yl),e("button",{type:"button",class:ee(["payment-btn click",{"payment-btn-selected":N.value==="click"}]),disabled:b.value,onClick:g[1]||(g[1]=G=>m("click"))},[g[9]||(g[9]=e("div",{class:"payment-icon"},"🔵",-1)),g[10]||(g[10]=e("div",{class:"payment-name"},"Click",-1)),N.value==="click"?(d(),h("div",Sl,[...g[8]||(g[8]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,$l),e("button",{type:"button",class:ee(["payment-btn uzum",{"payment-btn-selected":N.value==="uzum"}]),disabled:b.value,onClick:g[2]||(g[2]=G=>m("uzum"))},[g[12]||(g[12]=e("div",{class:"payment-icon"},"🟣",-1)),g[13]||(g[13]=e("div",{class:"payment-name"},"Uzum",-1)),N.value==="uzum"?(d(),h("div",Dl,[...g[11]||(g[11]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,wl)])]),e("div",xl,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!V.value||b.value||!p.value.id,onClick:T},[g[14]||(g[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,o(s(l)("step5.checkStatus")),1),V.value?(d(),h("span",kl,"("+o(V.value)+")",1)):L("",!0)],8,Nl),W(ne,{name:"fade"},{default:ce(()=>[f.value?(d(),h("div",Al,[g[15]||(g[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(f.value),1)])):L("",!0)]),_:1}),W(ne,{name:"fade"},{default:ce(()=>[S.value?(d(),h("div",{key:0,class:ee(["status-text",w.value])},[e("i",{class:ee(I.value)},null,2),e("span",null,o(S.value),1)],2)):L("",!0)]),_:1})]),W(ne,{name:"fade"},{default:ce(()=>[p.value.id&&n.value&&n.value.seria?(d(),h("div",Ml,[g[16]||(g[16]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Ol,o(s(l)("step5.success")),1),e("p",Pl,o(s(l)("step5.policyIssued")),1),e("div",Tl,[e("div",Vl,[e("span",Il,o(s(l)("step5.policySeries"))+":",1),e("span",El,o(n.value.seria),1)]),e("div",Cl,[e("span",Ll,o(s(l)("step5.policyNumber"))+":",1),e("span",Fl,o(n.value.number),1)])])])):L("",!0)]),_:1})])]))}}),Rl=se(Yl,[["__scopeId","data-v-0cbe2eac"]]),Bl={class:"min-h-screen flex flex-col"},Ul={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},Wl={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},zl={class:"max-w-3xl mx-auto"},jl={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},ql=te({__name:"index",setup(c){const i=pe(),t=Ne(),l=he();return Pe(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),i.initialize(),i.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{i.currentStep>0?i.previousStep():l.close()});const p=ve(()=>i.osgo,()=>{i.saveToSession()},{deep:!0});Re(()=>{p()})}),Re(()=>{i.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),Qe({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,p)=>(d(),h("div",Bl,[e("header",Ul,[W(xt)]),e("main",Wl,[e("div",zl,[W(ne,{name:"fade",mode:"out-in"},{default:ce(()=>[s(i).currentStep===s(C).PARAMS?(d(),xe(Ns,{key:s(C).PARAMS})):s(i).currentStep===s(C).VEHICLE?(d(),xe(ga,{key:s(C).VEHICLE})):s(i).currentStep===s(C).OWNER?(d(),xe(vo,{key:s(C).OWNER})):s(i).currentStep===s(C).SUMMARY?(d(),xe(ll,{key:s(C).SUMMARY})):s(i).currentStep===s(C).PAYMENT?(d(),xe(Rl,{key:s(C).PAYMENT})):L("",!0)]),_:1})])]),e("footer",jl,[W(Ft)])]))}}),er=se(ql,[["__scopeId","data-v-4214c6a6"]]);export{er as default};
