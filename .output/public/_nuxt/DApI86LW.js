import{e as ze,f as Pe,g as Ve,r as Y,S as L,h as P,C as Ye,i as ae,j as Le,k as le,l as de,m as je,n as Ce,c as m,o as f,F as se,p as be,q as s,s as oe,t as o,a as e,v as Ke,b as J,x as Se,y as Ae,d as Ie,z as U,A as _e,B as xe,T as ye,w as $e,D as He,E as qe,G as Je,H as Ge,I as Ze,u as Qe,J as Ne}from"./C1XGuH89.js";import{_ as re}from"./DlAUqK2U.js";import{_ as Xe}from"./DgM-zN9R.js";function et(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Te={exports:{}},tt=Te.exports,Ue;function st(){return Ue||(Ue=1,(function(c,a){(function(t,l){c.exports=l()})(tt,(function(){var t=1e3,l=6e4,i=36e5,g="millisecond",n="second",v="minute",A="hour",E="day",I="week",u="month",R="quarter",$="year",K="date",O="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,N={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(T){var y=["th","st","nd","rd"],h=T%100;return"["+T+(y[(h-20)%10]||y[h]||y[0])+"]"}},D=function(T,y,h){var x=String(T);return!x||x.length>=y?T:""+Array(y+1-x.length).join(h)+T},S={s:D,z:function(T){var y=-T.utcOffset(),h=Math.abs(y),x=Math.floor(h/60),b=h%60;return(y<=0?"+":"-")+D(x,2,"0")+":"+D(b,2,"0")},m:function T(y,h){if(y.date()<h.date())return-T(h,y);var x=12*(h.year()-y.year())+(h.month()-y.month()),b=y.clone().add(x,u),V=h-b<0,C=y.clone().add(x+(V?-1:1),u);return+(-(x+(h-b)/(V?b-C:C-b))||0)},a:function(T){return T<0?Math.ceil(T)||0:Math.floor(T)},p:function(T){return{M:u,y:$,w:I,d:E,D:K,h:A,m:v,s:n,ms:g,Q:R}[T]||String(T||"").toLowerCase().replace(/s$/,"")},u:function(T){return T===void 0}},k="en",w={};w[k]=N;var H="$isDayjsObject",Q=function(T){return T instanceof fe||!(!T||!T[H])},G=function T(y,h,x){var b;if(!y)return k;if(typeof y=="string"){var V=y.toLowerCase();w[V]&&(b=V),h&&(w[V]=h,b=V);var C=y.split("-");if(!b&&C.length>1)return T(C[0])}else{var W=y.name;w[W]=y,b=W}return!x&&b&&(k=b),b||!x&&k},z=function(T,y){if(Q(T))return T.clone();var h=typeof y=="object"?y:{};return h.date=T,h.args=arguments,new fe(h)},B=S;B.l=G,B.i=Q,B.w=function(T,y){return z(T,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var fe=(function(){function T(h){this.$L=G(h.locale,null,!0),this.parse(h),this.$x=this.$x||h.x||{},this[H]=!0}var y=T.prototype;return y.parse=function(h){this.$d=(function(x){var b=x.date,V=x.utc;if(b===null)return new Date(NaN);if(B.u(b))return new Date;if(b instanceof Date)return new Date(b);if(typeof b=="string"&&!/Z$/i.test(b)){var C=b.match(p);if(C){var W=C[2]-1||0,j=(C[7]||"0").substring(0,3);return V?new Date(Date.UTC(C[1],W,C[3]||1,C[4]||0,C[5]||0,C[6]||0,j)):new Date(C[1],W,C[3]||1,C[4]||0,C[5]||0,C[6]||0,j)}}return new Date(b)})(h),this.init()},y.init=function(){var h=this.$d;this.$y=h.getFullYear(),this.$M=h.getMonth(),this.$D=h.getDate(),this.$W=h.getDay(),this.$H=h.getHours(),this.$m=h.getMinutes(),this.$s=h.getSeconds(),this.$ms=h.getMilliseconds()},y.$utils=function(){return B},y.isValid=function(){return this.$d.toString()!==O},y.isSame=function(h,x){var b=z(h);return this.startOf(x)<=b&&b<=this.endOf(x)},y.isAfter=function(h,x){return z(h)<this.startOf(x)},y.isBefore=function(h,x){return this.endOf(x)<z(h)},y.$g=function(h,x,b){return B.u(h)?this[x]:this.set(b,h)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(h,x){var b=this,V=!!B.u(x)||x,C=B.p(h),W=function(ce,X){var ve=B.w(b.$u?Date.UTC(b.$y,X,ce):new Date(b.$y,X,ce),b);return V?ve:ve.endOf(E)},j=function(ce,X){return B.w(b.toDate()[ce].apply(b.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(X)),b)},q=this.$W,Z=this.$M,ee=this.$D,ne="set"+(this.$u?"UTC":"");switch(C){case $:return V?W(1,0):W(31,11);case u:return V?W(1,Z):W(0,Z+1);case I:var pe=this.$locale().weekStart||0,me=(q<pe?q+7:q)-pe;return W(V?ee-me:ee+(6-me),Z);case E:case K:return j(ne+"Hours",0);case A:return j(ne+"Minutes",1);case v:return j(ne+"Seconds",2);case n:return j(ne+"Milliseconds",3);default:return this.clone()}},y.endOf=function(h){return this.startOf(h,!1)},y.$set=function(h,x){var b,V=B.p(h),C="set"+(this.$u?"UTC":""),W=(b={},b[E]=C+"Date",b[K]=C+"Date",b[u]=C+"Month",b[$]=C+"FullYear",b[A]=C+"Hours",b[v]=C+"Minutes",b[n]=C+"Seconds",b[g]=C+"Milliseconds",b)[V],j=V===E?this.$D+(x-this.$W):x;if(V===u||V===$){var q=this.clone().set(K,1);q.$d[W](j),q.init(),this.$d=q.set(K,Math.min(this.$D,q.daysInMonth())).$d}else W&&this.$d[W](j);return this.init(),this},y.set=function(h,x){return this.clone().$set(h,x)},y.get=function(h){return this[B.p(h)]()},y.add=function(h,x){var b,V=this;h=Number(h);var C=B.p(x),W=function(Z){var ee=z(V);return B.w(ee.date(ee.date()+Math.round(Z*h)),V)};if(C===u)return this.set(u,this.$M+h);if(C===$)return this.set($,this.$y+h);if(C===E)return W(1);if(C===I)return W(7);var j=(b={},b[v]=l,b[A]=i,b[n]=t,b)[C]||1,q=this.$d.getTime()+h*j;return B.w(q,this)},y.subtract=function(h,x){return this.add(-1*h,x)},y.format=function(h){var x=this,b=this.$locale();if(!this.isValid())return b.invalidDate||O;var V=h||"YYYY-MM-DDTHH:mm:ssZ",C=B.z(this),W=this.$H,j=this.$m,q=this.$M,Z=b.weekdays,ee=b.months,ne=b.meridiem,pe=function(X,ve,ke,we){return X&&(X[ve]||X(x,V))||ke[ve].slice(0,we)},me=function(X){return B.s(W%12||12,X,"0")},ce=ne||function(X,ve,ke){var we=X<12?"AM":"PM";return ke?we.toLowerCase():we};return V.replace(d,(function(X,ve){return ve||(function(ke){switch(ke){case"YY":return String(x.$y).slice(-2);case"YYYY":return B.s(x.$y,4,"0");case"M":return q+1;case"MM":return B.s(q+1,2,"0");case"MMM":return pe(b.monthsShort,q,ee,3);case"MMMM":return pe(ee,q);case"D":return x.$D;case"DD":return B.s(x.$D,2,"0");case"d":return String(x.$W);case"dd":return pe(b.weekdaysMin,x.$W,Z,2);case"ddd":return pe(b.weekdaysShort,x.$W,Z,3);case"dddd":return Z[x.$W];case"H":return String(W);case"HH":return B.s(W,2,"0");case"h":return me(1);case"hh":return me(2);case"a":return ce(W,j,!0);case"A":return ce(W,j,!1);case"m":return String(j);case"mm":return B.s(j,2,"0");case"s":return String(x.$s);case"ss":return B.s(x.$s,2,"0");case"SSS":return B.s(x.$ms,3,"0");case"Z":return C}return null})(X)||C.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(h,x,b){var V,C=this,W=B.p(x),j=z(h),q=(j.utcOffset()-this.utcOffset())*l,Z=this-j,ee=function(){return B.m(C,j)};switch(W){case $:V=ee()/12;break;case u:V=ee();break;case R:V=ee()/3;break;case I:V=(Z-q)/6048e5;break;case E:V=(Z-q)/864e5;break;case A:V=Z/i;break;case v:V=Z/l;break;case n:V=Z/t;break;default:V=Z}return b?V:B.a(V)},y.daysInMonth=function(){return this.endOf(u).$D},y.$locale=function(){return w[this.$L]},y.locale=function(h,x){if(!h)return this.$L;var b=this.clone(),V=G(h,x,!0);return V&&(b.$L=V),b},y.clone=function(){return B.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},T})(),Oe=fe.prototype;return z.prototype=Oe,[["$ms",g],["$s",n],["$m",v],["$H",A],["$W",E],["$M",u],["$y",$],["$D",K]].forEach((function(T){Oe[T[1]]=function(y){return this.$g(y,T[0],T[1])}})),z.extend=function(T,y){return T.$i||(T(y,fe,z),T.$i=!0),z},z.locale=G,z.isDayjs=Q,z.unix=function(T){return z(1e3*T)},z.en=w[k],z.Ls=w,z.p={},z}))})(Te)),Te.exports}var at=st();const ge=et(at);function Me(c,a="сум"){return c==null||isNaN(c)?`0 ${a}`:`${c.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${a}`}function Re(c){return c?ge(c).format("DD.MM.YYYY"):""}function it(c){return c?c.split(",")[0].trim().split(/\s+/).map(t=>{if(!t)return t;const l=t.charAt(0).toUpperCase(),i=t.slice(1).toLowerCase();return l+i}).join(" "):""}function We(c,a="ru"){if(!c)return"";const t=String(c).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?a==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?a==="uz"?"Ayol":"Женский":String(c)}function ot(c){if(!c)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(c))return c;if(/^\d{2}-\d{2}-\d{4}$/.test(c)){const a=c.split("-");return`${a[2]}-${a[1]}-${a[0]}`}try{return ge(c,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return c}}const he=ze("osgo",()=>{const c=Pe(),a=Ve(),t=Y({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:ge().format("YYYY-MM-DD"),premium:0}),l=Y({passportSeries:"",passportNumber:"",birthDate:""}),i=Y({passportSeries:"",passportNumber:"",birthDate:""}),g=Y(L.PARAMS),n=Y(!1),v=Y(null),A=Y(!1),E=Y(null),I=Y(null),u=Y(null),R=Y(!1),$=Y(null),K=Y(null),O=Y(null),p=Y(null),d=Y(!1),N=Y(!1),D=Y(null),S=Y(!1),k=Y(!1),w=Y(null),H=Y(!1),Q=Y(!1),G=Y(null),z=P(()=>t.value.status==="DRAFT"),B=P(()=>ce(g.value).valid),fe=P(()=>Object.keys(L).length-1),Oe=r=>r<=L.OWNER?r+1:r===L.DRIVERS?-1:r,T=P(()=>Oe(g.value)),y=P(()=>{const r=T.value;return Math.round(r/fe.value*100)}),h=P(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,_=t.value.period.coefficient||0,M=t.value.drivedArea.coefficient||0;let F=3;t.value.driversLimited&&t.value.incidentCoeff&&(F=t.value.incidentCoeff);const De=r*_*F*M,ie=De>5*r?Ye*5*r:Ye*De/100;return Math.round(ie)}),x=P(()=>{const _=(t.value.entriesJournalKt||[]).reduce((M,F)=>M+(F.amount||0),0);return t.value.premium-_}),b=()=>{if(t.value.vehicle?.carType||t.value.period||t.value.drivedArea||t.value.premium>0){t.value.status||(t.value.status="DRAFT"),t.value.contractStartDate||(t.value.contractStartDate=ge().format("YYYY-MM-DD")),t.value.applicantIsOwner===void 0&&(t.value.applicantIsOwner=!0),t.value.driversLimited===void 0&&(t.value.driversLimited=!1),t.value.drivers||(t.value.drivers=[]);return}t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:ge().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},i.value={passportSeries:"",passportNumber:"",birthDate:""},g.value=L.PARAMS,c.isLoaded&&(t.value.discountType=c.getDefaultDiscountType())};ae(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=ge(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ae(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ae(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const _=parseInt(r.slice(0,2)),M=c.findDrivedAreaByRegion(_);M&&(t.value.drivedArea=M)}),ae(()=>[t.value.vehicle?.carType?.id,t.value.vehicle?.carType?.tariffCompany,t.value.period?.id,t.value.period?.coefficient,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea?.id,t.value.drivedArea?.coefficient],(r,_)=>{t.value.premium=h.value},{immediate:!0}),ae(()=>t.value.vehicle?.carType,()=>{t.value.premium=h.value},{deep:!0,immediate:!0}),ae(()=>t.value.period,()=>{t.value.premium=h.value},{deep:!0,immediate:!0}),ae(()=>t.value.drivedArea,()=>{t.value.premium=h.value},{deep:!0,immediate:!0}),ae(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const V=async()=>{if(t.value.vehicle){d.value=!0,D.value=null,N.value=!1;try{const r=await a.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),_=r?.result||r;if(r?.error&&!_)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&_&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,_),_?.carType&&c.isLoaded&&(t.value.vehicle.carType=c.findCarType(_.carType.id)),N.value=!0,console.log("[OsgoStore] Vehicle verified:",_);try{const M=await a.getKaskoVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber});if(M.success&&M.id&&M.data){const F=M.data,De=M.id;let ie=null;if(F.modelId?ie=F.modelId:F.model&&typeof F.model=="object"&&F.model.id?ie=F.model.id:F.model&&typeof F.model=="string"&&(ie=F.model),!ie)try{console.log("[OsgoStore] No model found in vehicle data, fetching default manufacturer and model");const te=await a.getKaskoManufacturers();if(te.success&&te.firstId){const Ee=te.firstId,ue=await a.getKaskoModels(Ee);ue.success&&ue.firstId&&(ie=ue.firstId,console.log("[OsgoStore] Using default model ID:",ie))}}catch(te){console.warn("[OsgoStore] Failed to get default manufacturer/model:",te)}if(ie)try{const te=await a.getKaskoVehicle2(De,ie);te.success&&te.id?(K.value=te.id,console.log("[OsgoStore] Kasko vehicle ID obtained (final from getVehicle2):",te.id)):console.warn("[OsgoStore] getVehicle2 failed, cannot create Kasko contract")}catch(te){console.warn("[OsgoStore] getVehicle2 error, cannot create Kasko contract:",te)}else console.warn("[OsgoStore] No model available for Kasko vehicle, cannot create contract")}}catch(M){console.warn("[OsgoStore] Failed to get Kasko vehicle ID:",M)}}catch(r){throw D.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{d.value=!1}}},C=async()=>{S.value=!0,w.value=null,k.value=!1;try{const r=await a.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(i.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.party={...l.value},Q.value=!0)),k.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id);try{let _=l.value.birthDate;if(_&&_.includes("-")){const F=_.split("-");F.length===3&&F[0].length===4&&(_=`${F[2]}-${F[1]}-${F[0]}`)}const M=await a.getKaskoIndividual({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:_});M.success&&M.id&&(O.value=M.id,console.log("[OsgoStore] Kasko individual ID obtained:",M.id))}catch(_){console.warn("[OsgoStore] Failed to get Kasko individual ID:",_)}}catch(r){throw w.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{S.value=!1}},W=async()=>{H.value=!0,G.value=null,Q.value=!1;try{const r=await a.getIndividualByPassport({passportSeries:i.value.passportSeries?.toUpperCase()||"",passportNumber:i.value.passportNumber,birthDate:i.value.birthDate});if(console.log("[OsgoStore] API result for applicant:",r),r&&(i.value={passportSeries:i.value.passportSeries,passportNumber:i.value.passportNumber,birthDate:i.value.birthDate,...r},t.value.party={...i.value}),Q.value=!0,console.log("[OsgoStore] Applicant after assignment:",i.value),!t.value.applicantIsOwner)try{let _=i.value.birthDate;if(_&&_.includes("-")){const F=_.split("-");F.length===3&&F[0].length===4&&(_=`${F[2]}-${F[1]}-${F[0]}`)}const M=await a.getKaskoIndividual({passportSeries:i.value.passportSeries?.toUpperCase()||"",passportNumber:i.value.passportNumber,birthDate:_});M.success&&M.id&&(O.value=M.id,console.log("[OsgoStore] Kasko applicant ID obtained:",M.id))}catch(_){console.warn("[OsgoStore] Failed to get Kasko applicant ID:",_)}}catch(r){throw G.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{H.value=!1}},j=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const _=ot(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:_});const M=await a.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:_});if(console.log("[OsgoStore] Driver verification result:",M),!M||!M.id)throw new Error("Driver verification failed: invalid response");const F={...r,...M,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",F),F}catch(_){throw console.error("[OsgoStore] Driver verification failed:",_),_}},q=r=>{t.value.drivers||(t.value.drivers=[]);const _={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(_),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},Z=(r,_)=>{t.value.drivers[r]&&(t.value.drivers[r]=_)},ee=r=>{t.value.drivers.splice(r,1)},ne=(r,_,M)=>t.value.drivers.some(F=>F.passportSeries===r&&F.passportNumber===_&&F.birthDate===M),pe=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(ne(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}q({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},me=()=>{ne(i.value.passportSeries,i.value.passportNumber,i.value.birthDate)||q({passportSeries:i.value.passportSeries,passportNumber:i.value.passportNumber,birthDate:i.value.birthDate})},ce=r=>{switch(r){case L.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case L.VEHICLE:return{valid:N.value};case L.OWNER:return{valid:k.value&&(t.value.applicantIsOwner||Q.value)};case L.DRIVERS:return{valid:!0};case L.SUMMARY:const _=t.value.applicantIsOwner?l.value.id:i.value.id;return{valid:!!(l.value.id&&_&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(M=>M.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case L.PAYMENT:return{valid:!!(t.value.id&&$.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:i,currentStep:g,saving:n,saveError:v,fetching:A,fetchError:E,fundData:I,fundError:u,fetchingFundData:R,selectedPaymentMethod:$,kaskoVehicleId:K,kaskoIndividualId:O,kaskoContractStatus:p,vehicleVerifying:d,vehicleVerified:N,vehicleVerifyError:D,ownerVerifying:S,ownerVerified:k,ownerVerifyError:w,applicantVerifying:H,applicantVerified:Q,applicantVerifyError:G,isEditable:z,canProceedToNextStep:B,totalSteps:fe,displayStepNumber:T,progressPercentage:y,calculatedPremium:h,amountPayable:x,initialize:b,verifyVehicle:V,verifyOwner:C,verifyApplicant:W,verifyDriver:j,addDriver:q,updateDriver:Z,removeDriver:ee,hasDriver:ne,addOwnerAsDriver:pe,addApplicantAsDriver:me,validateStepData:ce,nextStep:()=>{g.value===L.OWNER?g.value=L.SUMMARY:g.value<L.PAYMENT&&g.value++},previousStep:()=>{g.value===L.SUMMARY?g.value=L.OWNER:g.value>0&&g.value--},goToStep:r=>{r>=0&&r<fe.value&&(g.value=r)},createPolicy:async()=>{n.value=!0,v.value=null;try{let r=null;try{r=await a.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Fe){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Fe),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const _=t.value.applicantIsOwner?{...l.value}:{...i.value};_.phone&&(_.phone=_.phone.replace(/[+()-]/g,""));const M={...l.value},F=t.value.discountType||c.meta?.beneficiary?.find(({coefficient:Fe})=>Fe===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!ge(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const te={party:_,beneficiary:M,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:F,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Ee={user:r,osgo:te};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:_.id,name:_.name},beneficiary:{id:M.id,name:M.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:F?.id}}});const ue=await a.createOsgoApplication(Ee);if(!ue||typeof ue!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ue),new Error("Failed to create policy: invalid response");return t.value.id=ue,t.value.applicantIsOwner?(l.value.phone=_.phone,t.value.party=l.value):(i.value.phone=_.phone,t.value.party=i.value),console.log("[OsgoStore] Policy created:",ue),ue}catch(r){throw v.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{n.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");n.value=!0,v.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?l.value:i.value,beneficiary:l.value};await a.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw v.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{n.value=!1}},fetchPolicy:async r=>{A.value=!0,E.value=null;try{const _=await a.fetchOsgoEntity(r);if(t.value=_,_.party?.id){const M=await a.fetchIndividualEntity(_.party.id);i.value=M,t.value.party=M}if(_.beneficiary?.id){const M=await a.fetchIndividualEntity(_.beneficiary.id);l.value=M,t.value.beneficiary=M}if(c.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=c.findCarType(t.value.vehicle.carType.id)),c.isLoaded&&t.value.period&&(t.value.period=c.findPeriod(t.value.period.id)),c.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=c.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const M=Math.max(...t.value.drivers.map(F=>F.incidentFrequency?.coefficient||0));t.value.incidentCoeff=M}console.log("[OsgoStore] Policy fetched:",r)}catch(_){throw E.value=_.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",_),_}finally{A.value=!1}},fetchFundData:async()=>{if(t.value.id){R.value=!0,u.value=null;try{const r=await a.getFundPolicy(t.value.id);I.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){u.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{R.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:l.value,applicant:i.value,currentStep:g.value,kaskoVehicleId:K.value,kaskoIndividualId:O.value};sessionStorage.setItem(Le.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Le.OSGO_DRAFT);if(!r)return!1;const _=JSON.parse(r);return t.value=_.osgo,l.value=_.owner,i.value=_.applicant,g.value=_.currentStep||0,_.kaskoVehicleId!==void 0&&(K.value=_.kaskoVehicleId),_.kaskoIndividualId!==void 0&&(O.value=_.kaskoIndividualId),console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Le.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{b(),N.value=!1,k.value=!1,Q.value=!1,I.value=null,v.value=null,E.value=null,K.value=null,O.value=null,p.value=null}}}),lt={class:"language-switcher"},rt=["onClick"],nt=le({__name:"LanguageSwitcher",setup(c){const{locale:a,locales:t}=de();je();const l=P(()=>a.value),i=P(()=>t.value.filter(n=>n.code!==a.value)),g=n=>{a.value=n,typeof window<"u"&&localStorage.setItem("app-language",n),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Ce(()=>{if(typeof window<"u"){const n=localStorage.getItem("app-language");n&&(n==="ru"||n==="uz")&&(a.value=n)}}),(n,v)=>(f(),m("div",lt,[(f(!0),m(se,null,be(s(i),A=>(f(),m("button",{key:A.code,class:oe(["lang-btn",{active:s(l)===A.code}]),onClick:E=>g(A.code)},o(A.code.toUpperCase()),11,rt))),128))]))}}),ct=re(nt,[["__scopeId","data-v-e748ef5d"]]),ut={class:"progress-bar-container"},dt={class:"progress-track"},pt={class:"steps-container"},vt=["onClick"],ft={key:0,class:"step-check"},ht={key:1,class:"step-number"},mt={class:"step-label"},_t=le({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(c){const a=c,{t}=de(),l=P(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),i=v=>v<=2?v:v+1,g=P(()=>(a.currentStep+1)/a.totalSteps*100),n=v=>{console.log("Step clicked:",v)};return(v,A)=>(f(),m("div",ut,[e("div",dt,[e("div",{class:"progress-fill",style:Ke({width:`${g.value}%`})},null,4)]),e("div",pt,[(f(!0),m(se,null,be(l.value,(E,I)=>(f(),m("div",{key:I,class:"step-wrapper",onClick:u=>n(I)},[e("div",{class:oe(["step-circle",{"step-active":i(I)===c.currentStep,"step-completed":i(I)<c.currentStep&&i(I)!==s(L).DRIVERS,"step-pending":i(I)>c.currentStep}])},[i(I)<c.currentStep&&i(I)!==s(L).DRIVERS?(f(),m("span",ft,"✓")):(f(),m("span",ht,o(I+1),1))],2),e("div",mt,o(E),1)],8,vt))),128))])]))}}),gt=re(_t,[["__scopeId","data-v-e165c6c4"]]),bt={class:"fixed-header"},yt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},$t={class:"flex items-center justify-between mb-3"},St={class:"flex items-center gap-3"},kt={class:"text-sm font-bold text-text"},wt=le({__name:"AppHeader",setup(c){const a=he(),{t}=de(),l=P(()=>a.currentStep),i=P(()=>a.totalSteps);return(g,n)=>{const v=ct,A=gt;return f(),m("header",bt,[e("div",yt,[e("div",$t,[e("div",St,[n[1]||(n[1]=e("div",{class:"w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg"},[e("img",{src:Xe,alt:"Temiryo'l Sug'urta Logo"})],-1)),e("div",null,[e("div",kt,o(s(t)("header.appTitle")),1),n[0]||(n[0]=e("div",{class:"text-[10px] text-text-light"}," Temiryo'l Sug'urta ",-1))])]),J(v)]),J(A,{"current-step":l.value,"total-steps":i.value},null,8,["current-step","total-steps"])])])}}}),Dt=re(wt,[["__scopeId","data-v-d8e96631"]]),xt={class:"fixed-footer"},Nt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},At=["disabled"],It={key:1,class:"flex-1 max-w-[160px]"},Pt={class:"flex-1 text-center"},Ot={class:"text-xs text-text-light font-medium"},Tt=["disabled"],Mt={key:0,class:"spinner"},Vt={key:1},Ct=le({__name:"AppFooter",setup(c){const a=he(),t=Se(),l=Ve(),{t:i}=de(),g=Y(!1),n=Y(null),v=Y(null),A=P(()=>a.currentStep),E=P(()=>a.totalSteps),I=P(()=>a.displayStepNumber),u=P(()=>A.value===0),R=P(()=>A.value===L.PAYMENT),$=P(()=>a.canProceedToNextStep),K=P(()=>a.saving||a.fetching||g.value),O=()=>{u.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),a.previousStep())},p=async()=>{if(!$.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(i("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(A.value===L.VEHICLE&&!a.vehicleVerified)await a.verifyVehicle();else if(A.value===L.OWNER)a.ownerVerified||await a.verifyOwner(),!a.osgo.applicantIsOwner&&!a.applicantVerified&&await a.verifyApplicant();else if(A.value===L.SUMMARY)a.osgo.id||(await a.createPolicy(),console.log("[AppFooter] Policy created:",a.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(A.value===L.PAYMENT){if(!a.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const N={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[a.selectedPaymentMethod],D=a.osgo.id,S=a.osgo.party?.phone||"",k=a.calculatedPremium;if(!D||!S||!k){const w="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:D,phone:S,amount:k}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(w));return}try{g.value=!0,n.value=null,v.value=null,await l.sendPaymentLink(N,D,S,k),v.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully");try{const w=a.kaskoVehicleId,H=a.kaskoIndividualId,G=(a.osgo.party?.phone||"").replace(/[+()-]/g,"").replace(/^998/,"998");if(w&&H&&G&&G.startsWith("998"))try{const z=await l.createKaskoContract(w,H,G,"PAYME");z&&z.success===!0?(a.kaskoContractStatus="success",console.log("[AppFooter] Kasko contract created successfully as gift bonus")):(a.kaskoContractStatus="failed",console.warn("[AppFooter] Kasko contract creation returned non-success result:",z))}catch(z){a.kaskoContractStatus="failed",console.error("[AppFooter] Failed to create Kasko contract:",z)}else console.warn("[AppFooter] Kasko IDs or phone not available, skipping Kasko contract creation",{vehicleId:w,individualId:H,formattedPhone:G}),a.kaskoContractStatus="failed"}catch(w){a.kaskoContractStatus="failed",console.error("[AppFooter] Failed to create Kasko contract (outer catch):",w)}t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(w){n.value=w.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",w),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(n.value))}finally{g.value=!1}return}R.value?console.log("[AppFooter] Last step reached"):a.nextStep()}catch(d){console.error("[AppFooter] Error:",d),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(d.message||i("errors.unknown")))}};return(d,N)=>(f(),m("footer",xt,[e("div",Nt,[u.value?(f(),m("div",It)):(f(),m("button",{key:0,type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:K.value,onClick:O},[N[0]||(N[0]=e("i",{class:"bx bx-arrow-back"},null,-1)),e("span",null,o(d.$t("common.previous")),1)],8,At)),e("div",Pt,[e("div",Ot,o(d.$t("common.step",{current:I.value,total:E.value})),1)]),e("button",{type:"button",class:oe(["btn flex-1 max-w-[160px]",{"btn-primary":!R.value||A.value!==s(L).PAYMENT,"btn-success":R.value&&A.value===s(L).PAYMENT}]),disabled:!$.value||K.value,onClick:p},[K.value?(f(),m("span",Mt)):A.value===s(L).SUMMARY&&!s(a).osgo.id?(f(),m("span",Vt,o(d.$t("step5.confirm")),1)):R.value&&A.value===s(L).PAYMENT?(f(),m(se,{key:2},[N[1]||(N[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(d.$t("step5.payment")),1)],64)):(f(),m(se,{key:3},[e("span",null,o(d.$t("common.next")),1),N[2]||(N[2]=e("i",{class:"bx bx-arrow-back"},null,-1))],64))],10,Tt)])]))}}),Et=re(Ct,[["__scopeId","data-v-d820dc0a"]]),Ft={class:"step-container"},Lt={key:0,class:"loading-state"},Yt={key:1,class:"error-state"},Rt={key:2,class:"error-state"},Bt={class:"debug-info"},Ut={key:3},Wt={class:"step-header"},Kt={class:"step-title"},zt={class:"step-description"},jt={class:"step-content"},Ht={class:"form-section"},qt={class:"section-title"},Jt={class:"select-wrapper"},Gt=["disabled"],Zt=["value"],Qt={class:"form-section"},Xt={class:"section-title"},es={class:"select-wrapper"},ts=["disabled"],ss=["value"],as={class:"form-section",style:{display:"none"}},is={class:"section-title"},os={class:"select-wrapper"},ls=["disabled"],rs={value:"false"},ns={value:"true"},cs={key:0,class:"form-section"},us={class:"section-title"},ds={class:"select-wrapper"},ps=["disabled"],vs=["value"],fs={class:"form-section"},hs={class:"section-title"},ms={class:"select-wrapper"},_s=["disabled"],gs=["value"],bs={key:0,class:"premium-card"},ys={class:"premium-card-content"},$s={class:"premium-label"},Ss={class:"premium-amount"},ks=le({__name:"Step1Params",setup(c){const a=he(),t=Pe(),l=Se(),{locale:i,t:g}=de(),n=P(()=>a.osgo),v=()=>{if(!(!t.isLoaded||!(!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id))){if(t.carTypes.length>0&&!n.value.vehicle?.carType?.id){const p=t.carTypes[0];n.value.vehicle?n.value.vehicle.carType=p:n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:"",carType:p}}if(t.periods.length>0&&!n.value.period?.id){const p=t.periods[0];n.value.period=p}if(t.drivedAreas.length>0&&!n.value.drivedArea?.id){const p=t.drivedAreas[0];n.value.drivedArea=p}n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited&&!n.value.incidentCoeff&&t.incidentFrequencies.length>0&&(n.value.incidentCoeff=t.incidentFrequencies[0].coefficient),n.value.premium=a.calculatedPremium,Ae(()=>{a.canProceedToNextStep})}};ae(()=>t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0,O=>{O&&!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id&&Ae(()=>{v()})},{immediate:!0}),Ce(async()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Periods count:",t.periods.length),await Ae();const O=!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id;t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0&&O&&v()});const A=O=>{const p=t.getLocalizedName(O,i.value||"uz");return it(p)},E=P(()=>a.calculatedPremium),I=P({get:()=>{const O=n.value.vehicle?.carType?.id;return!O&&t.isLoaded&&t.carTypes.length>0?t.carTypes[0].id:O||""},set:O=>{if(!a.isEditable)return;const p=t.carTypes.find(d=>d.id===O);p&&(n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=p,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),u=P({get:()=>{const O=n.value.period?.id;return!O&&t.isLoaded&&t.periods.length>0?t.periods[0].id:O||""},set:O=>{if(!a.isEditable)return;const p=t.periods.find(d=>d.id===O);p&&(n.value.period=p,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),R=P({get:()=>(n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited?"true":"false"),set:O=>{a.isEditable&&(n.value.driversLimited=O==="true",n.value.driversLimited||(n.value.incidentCoeff=void 0),l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),$=P({get:()=>n.value.incidentCoeff?.toString()||"",set:O=>{if(!a.isEditable)return;const p=parseFloat(O);isNaN(p)||(n.value.incidentCoeff=p,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),K=P({get:()=>{const O=n.value.drivedArea?.id;return!O&&t.isLoaded&&t.drivedAreas.length>0?t.drivedAreas[0].id:O||""},set:O=>{if(!a.isEditable)return;const p=t.findDrivedArea(O);p&&(n.value.drivedArea=p,l.isTelegramWebApp.value&&l.hapticImpact("light"))}});return ae(()=>[I.value,u.value,K.value,t.isLoaded],([O,p,d,N])=>{if(!N)return;let D=!1;if(O&&!n.value.vehicle?.carType?.id&&t.carTypes.length>0){const S=t.carTypes.find(k=>k.id===O);S&&(n.value.vehicle?n.value.vehicle.carType=S:n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:"",carType:S},D=!0)}if(p&&!n.value.period?.id&&t.periods.length>0){const S=t.periods.find(k=>k.id===p);S&&(n.value.period=S,D=!0)}if(d&&!n.value.drivedArea?.id&&t.drivedAreas.length>0){const S=t.drivedAreas.find(k=>k.id===d);S&&(n.value.drivedArea=S,D=!0)}D&&Ae(()=>{a.calculatedPremium})},{immediate:!0}),(O,p)=>(f(),m("div",Ft,[s(t).fetching?(f(),m("div",Lt,[p[6]||(p[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,o(s(g)("common.loading")),1)])):s(t).error?(f(),m("div",Yt,[p[7]||(p[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,o(s(t).error),1),e("button",{onClick:p[0]||(p[0]=d=>s(t).fetchMeta(!0)),class:"btn-retry"},o(s(g)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(f(),m("div",Rt,[p[10]||(p[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,o(s(g)("common.loading")),1),e("p",Bt,[Ie(" isLoaded: "+o(s(t).isLoaded),1),p[8]||(p[8]=e("br",null,null,-1)),Ie(" carTypes: "+o(s(t).carTypes.length),1),p[9]||(p[9]=e("br",null,null,-1)),Ie(" meta: "+o(s(t).meta?"exists":"null"),1)])])):(f(),m("div",Ut,[e("div",Wt,[e("h2",Kt,o(s(g)("step1.title")),1),e("p",zt,o(s(g)("step1.description")),1)]),e("div",jt,[e("div",Ht,[e("h3",qt,o(s(g)("step1.vehicleType")),1),e("div",Jt,[_e(e("select",{"onUpdate:modelValue":p[1]||(p[1]=d=>I.value=d),class:"input",disabled:!s(a).isEditable},[(f(!0),m(se,null,be(s(t).carTypes,d=>(f(),m("option",{key:d.id,value:d.id},o(A(d)),9,Zt))),128))],8,Gt),[[xe,I.value]]),p[11]||(p[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",Qt,[e("h3",Xt,o(s(g)("step1.period")),1),e("div",es,[_e(e("select",{"onUpdate:modelValue":p[2]||(p[2]=d=>u.value=d),class:"input",disabled:!s(a).isEditable},[(f(!0),m(se,null,be(s(t).periods,d=>(f(),m("option",{key:d.id,value:d.id},o(A(d)),9,ss))),128))],8,ts),[[xe,u.value]]),p[12]||(p[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",as,[e("h3",is,o(s(g)("step1.driversLimited")),1),e("div",os,[_e(e("select",{"onUpdate:modelValue":p[3]||(p[3]=d=>R.value=d),class:"input",disabled:!s(a).isEditable},[e("option",rs,o(s(g)("step1.driversLimitedNo"))+" - "+o(s(g)("step1.driversLimitedNoDesc")),1),e("option",ns,o(s(g)("step1.driversLimitedYes"))+" - "+o(s(g)("step1.driversLimitedYesDesc")),1)],8,ls),[[xe,R.value]]),p[13]||(p[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),J(ye,{name:"slide-down"},{default:$e(()=>[n.value.driversLimited?(f(),m("div",cs,[e("h3",us,o(s(g)("step1.incidentFrequency")),1),e("div",ds,[_e(e("select",{"onUpdate:modelValue":p[4]||(p[4]=d=>$.value=d),class:"input",disabled:!s(a).isEditable},[(f(!0),m(se,null,be(s(t).incidentFrequencies,d=>(f(),m("option",{key:d.id,value:d.coefficient},o(A(d)),9,vs))),128))],8,ps),[[xe,$.value]]),p[14]||(p[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down text-primary"})],-1))])])):U("",!0)]),_:1}),e("div",fs,[e("h3",hs,o(s(g)("step1.usageTerritory")),1),e("div",ms,[_e(e("select",{"onUpdate:modelValue":p[5]||(p[5]=d=>K.value=d),class:"input",disabled:!s(a).isEditable},[(f(!0),m(se,null,be(s(t).drivedAreas,d=>(f(),m("option",{key:d.id,value:d.id},o(A(d)),9,gs))),128))],8,_s),[[xe,K.value]]),p[15]||(p[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),E.value>0?(f(),m("div",bs,[e("div",ys,[e("div",$s,[p[16]||(p[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(g)("step1.premium")),1)]),e("div",Ss,o(s(Me)(E.value)),1)])])):U("",!0)])]))]))}}),ws=re(ks,[["__scopeId","data-v-7ede8f4f"]]),Ds=["for"],xs={key:0,class:"text-error"},Ns={class:"input-wrapper"},As={key:0,class:"input-icon input-icon-left"},Is=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Ps={key:2,class:"input-icon input-icon-right"},Os={key:1,class:"input-message"},Ts={key:0,class:"error-message"},Ms={key:1,class:"helper-text"},Vs={key:2,class:"input-count"},Cs=le({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(c,{expose:a,emit:t}){const l=c,i=t,{locale:g}=de(),n=P(()=>{if(l.type==="date")return g.value==="uz"?"uz-UZ":"ru-RU"}),v=Y(null),A=P(()=>`input-${Math.random().toString(36).substr(2,9)}`),E=P({get:()=>{const S=String(l.modelValue||"");if(l.dateMask&&S){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(S)||/^\d{2}-\d{2}-\d{4}$/.test(S))return S;if(/^\d{4}-\d{2}-\d{2}$/.test(S)){const k=S.split("-");return`${k[2]}-${k[1]}-${k[0]}`}}return S},set:S=>{if(l.uppercase&&(S=S.toUpperCase()),l.dateMask&&S){if(/^\d{4}-\d{2}-\d{2}$/.test(S)){i("update:modelValue",S);return}if(/^\d{2}-\d{2}-\d{4}$/.test(S)){const k=S.split("-");i("update:modelValue",`${k[2]}-${k[1]}-${k[0]}`);return}i("update:modelValue",S);return}i("update:modelValue",S)}}),I=S=>{const k=S.target;let w=k.value;if(l.uppercase&&(w=w.toUpperCase(),k.value!==w&&(k.value=w)),l.dateMask){const H=d(w);k.value!==H&&(k.value=H),i("update:modelValue",H),i("input",H);return}l.mask&&(w=p(w)),i("update:modelValue",w),i("input",w)},u=()=>{if(l.dateMask&&E.value){const S=String(E.value);if(/^\d{2}-\d{2}-\d{4}$/.test(S)){const k=S.split("-"),w=`${k[2]}-${k[1]}-${k[0]}`,H=new Date(w);isNaN(H.getTime())||i("update:modelValue",w)}}i("blur")},R=()=>{i("focus")},$=S=>{},K=()=>{i("enter")},O=()=>{i("update:modelValue",""),v.value?.focus()},p=S=>{if(l.dateMask)return d(S);if(!l.mask)return S;let k="",w=0;const H=S.replace(/\D/g,"");for(let Q=0;Q<l.mask.length&&w<H.length;Q++){const G=l.mask[Q];G==="#"?(k+=H[w],w++):k+=G}return k},d=S=>{const w=S.replace(/\D/g,"").slice(0,8);return w.length===0?"":w.length<=2?w:w.length<=4?`${w.slice(0,2)}-${w.slice(2)}`:`${w.slice(0,2)}-${w.slice(2,4)}-${w.slice(4)}`},N=()=>{v.value?.focus()},D=()=>{v.value?.blur()};return Ce(()=>{l.autofocus&&N()}),a({focus:N,blur:D}),(S,k)=>(f(),m("div",{class:oe(["input-field",{"has-error":c.error}])},[c.label?(f(),m("label",{key:0,class:"input-label",for:A.value},[Ie(o(c.label)+" ",1),c.required?(f(),m("span",xs,"*")):U("",!0)],8,Ds)):U("",!0),e("div",Ns,[c.icon?(f(),m("div",As,[e("i",{class:oe(c.icon)},null,2)])):U("",!0),_e(e("input",{id:A.value,ref_key:"inputRef",ref:v,"onUpdate:modelValue":k[0]||(k[0]=w=>E.value=w),type:c.dateMask?"text":c.type,placeholder:c.dateMask?c.placeholder||"DD-MM-YYYY":c.placeholder,disabled:c.disabled,readonly:c.readonly,maxlength:c.dateMask?10:c.maxLength,autocomplete:c.autocomplete,inputmode:c.dateMask?"numeric":c.inputMode,lang:n.value,class:oe(["input",{"input-with-icon-left":c.icon,"input-with-icon-right":c.clearable||c.loading,"input-error":c.error}]),onInput:I,onBlur:u,onFocus:R,onKeypress:$,onKeydown:qe(K,["enter"])},null,42,Is),[[He,E.value]]),c.clearable&&E.value&&!c.disabled&&!c.readonly?(f(),m("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:O},[...k[1]||(k[1]=[e("i",{class:"bx bx-x"},null,-1)])])):U("",!0),c.loading?(f(),m("div",Ps,[...k[2]||(k[2]=[e("div",{class:"spinner-small"},null,-1)])])):U("",!0)]),c.helperText||c.error?(f(),m("div",Os,[c.error?(f(),m("span",Ts,o(c.error),1)):c.helperText?(f(),m("span",Ms,o(c.helperText),1)):U("",!0)])):U("",!0),c.showCount&&c.maxLength?(f(),m("div",Vs,o(E.value.length)+" / "+o(c.maxLength),1)):U("",!0)],2))}}),Be=re(Cs,[["__scopeId","data-v-4c13948b"]]);function Es(c){if(!c)return{valid:!1,error:"Государственный номер обязателен"};const a=c.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(a)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Fs(c){if(!c)return{valid:!1,error:"Серия техпаспорта обязательна"};const a=c.toUpperCase();return/^[A-Z]{2,3}$/.test(a)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Ls(c){return c?/^\d+$/.test(c)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Ys={class:"step-container"},Rs={class:"step-header"},Bs={class:"step-title"},Us={class:"step-description"},Ws={class:"step-content"},Ks={class:"form-section"},zs={class:"form-section"},js={class:"form-section"},Hs={class:"form-section"},qs=["disabled"],Js={key:0,class:"spinner"},Gs={key:0,class:"alert alert-error"},Zs={key:0,class:"vehicle-info-card"},Qs={class:"card-header"},Xs={class:"card-content"};const ea={class:"vehicle-info-grid"},ta={key:0,class:"vehicle-info-item"},sa={class:"vehicle-info-label"},aa={class:"vehicle-info-value"},ia={key:1,class:"vehicle-info-item"},oa={class:"vehicle-info-label"},la={class:"vehicle-info-value"},ra={key:2,class:"vehicle-info-item"},na={class:"vehicle-info-label"},ca={class:"vehicle-info-value"},ua={key:3,class:"vehicle-info-item"},da={class:"vehicle-info-label"},pa={class:"vehicle-info-value"},va={key:4,class:"vehicle-info-item"},fa={class:"vehicle-info-label"},ha={class:"vehicle-info-value"},ma={key:1,class:"vehicle-info-empty"},_a=le({__name:"Step2Vehicle",setup(c){const a=he();Pe();const t=Se(),{t:l}=de(),i=P(()=>a.osgo),g=Y({}),n=P(()=>!!(i.value.vehicle?.govNumber&&i.value.vehicle?.techPassportSeries&&i.value.vehicle?.techPassportNumber&&Object.keys(g.value).length===0)),v=P(()=>{if(!i.value.vehicle)return 0;const I=i.value.vehicle;let u=0;return I.techPassportIssueDate&&u++,(I.modelName||I.model)&&u++,(I.createdYear||I.year)&&u++,I.engineNumber&&u++,I.bodyNumber&&u++,u}),A=I=>{if(!i.value.vehicle)return;let u;switch(I){case"govNumber":u=Es(i.value.vehicle.govNumber);break;case"techPassportSeries":u=Fs(i.value.vehicle.techPassportSeries);break;case"techPassportNumber":u=Ls(i.value.vehicle.techPassportNumber);break}u&&!u.valid?g.value[I]=u.error||"":delete g.value[I]},E=async()=>{if(A("govNumber"),A("techPassportSeries"),A("techPassportNumber"),Object.keys(g.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await a.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",i.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(i.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(I,u)=>{const R=Be;return f(),m("div",Ys,[e("div",Rs,[e("h2",Bs,o(s(l)("step2.title")),1),e("p",Us,o(s(l)("step2.description")),1)]),e("div",Ws,[e("div",Ks,[J(R,{modelValue:i.value.vehicle.govNumber,"onUpdate:modelValue":u[0]||(u[0]=$=>i.value.vehicle.govNumber=$),label:s(l)("step2.govNumber"),placeholder:s(l)("step2.govNumberPlaceholder"),disabled:!s(a).isEditable,error:g.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:u[1]||(u[1]=$=>A("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",zs,[J(R,{modelValue:i.value.vehicle.techPassportSeries,"onUpdate:modelValue":u[2]||(u[2]=$=>i.value.vehicle.techPassportSeries=$),label:s(l)("step2.techPassportSeries"),placeholder:s(l)("step2.techPassportSeriesPlaceholder"),disabled:!s(a).isEditable,error:g.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:u[3]||(u[3]=$=>A("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",js,[J(R,{modelValue:i.value.vehicle.techPassportNumber,"onUpdate:modelValue":u[4]||(u[4]=$=>i.value.vehicle.techPassportNumber=$),label:s(l)("step2.techPassportNumber"),placeholder:s(l)("step2.techPassportNumberPlaceholder"),disabled:!s(a).isEditable,error:g.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:u[5]||(u[5]=$=>A("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Hs,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!n.value||s(a).vehicleVerifying,onClick:E},[s(a).vehicleVerifying?(f(),m("span",Js)):(f(),m(se,{key:1},[u[6]||(u[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a).vehicleVerified?s(l)("step2.verified"):s(l)("step2.verify")),1)],64))],8,qs)]),s(a).vehicleVerifyError?(f(),m("div",Gs,[u[7]||(u[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(s(a).vehicleVerifyError),1)])):U("",!0),J(ye,{name:"fade"},{default:$e(()=>[s(a).vehicleVerified&&i.value.vehicle?(f(),m("div",Zs,[e("div",Qs,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,o(s(l)("step2.vehicleFound")),1)]),e("div",Xs,[U("",!0),e("div",ea,[i.value.vehicle?.techPassportIssueDate?(f(),m("div",ta,[e("div",sa,o(s(l)("step2.techPassportIssueDate")),1),e("div",aa,o(s(Re)(i.value.vehicle.techPassportIssueDate)),1)])):U("",!0),i.value.vehicle?.modelName||i.value.vehicle?.model?(f(),m("div",ia,[e("div",oa,o(s(l)("step2.model")),1),e("div",la,o(i.value.vehicle?.modelName||i.value.vehicle?.model||"-"),1)])):U("",!0),i.value.vehicle?.createdYear||i.value.vehicle?.year?(f(),m("div",ra,[e("div",na,o(s(l)("step2.year")),1),e("div",ca,o(i.value.vehicle?.createdYear||i.value.vehicle?.year||"-"),1)])):U("",!0),i.value.vehicle?.engineNumber?(f(),m("div",ua,[e("div",da,o(s(l)("step2.engineNumber")),1),e("div",pa,o(i.value.vehicle.engineNumber),1)])):U("",!0),i.value.vehicle?.bodyNumber?(f(),m("div",va,[e("div",fa,o(s(l)("step2.bodyNumber")),1),e("div",ha,o(i.value.vehicle.bodyNumber),1)])):U("",!0)]),v.value===0?(f(),m("div",ma,o(s(l)("step2.vehicleNotFound")),1)):U("",!0)])])):U("",!0)]),_:1})])])}}}),ga=re(_a,[["__scopeId","data-v-28cabcbd"]]),ba={class:"step-container"},ya={class:"step-header"},$a={class:"step-title"},Sa={class:"step-description"},ka={class:"step-content"},wa={class:"subsection"},Da={class:"subsection-title"},xa={class:"form-section"},Na={class:"form-section"},Aa={class:"form-section"},Ia={class:"form-section"},Pa=["disabled"],Oa={key:0,class:"spinner"},Ta={key:0,class:"info-card success"},Ma={class:"card-header"},Va={class:"card-content"},Ca={class:"info-grid"},Ea={class:"info-item"},Fa={class:"info-label"},La={class:"info-value"},Ya={class:"info-item"},Ra={class:"info-label"},Ba={class:"info-value"},Ua={class:"info-item info-item-wide"},Wa={class:"info-label"},Ka={class:"info-value"},za={class:"info-item"},ja={class:"info-label"},Ha={class:"info-value"},qa={class:"info-item"},Ja={class:"info-label"},Ga={class:"info-value"},Za={class:"info-item"},Qa={class:"info-label"},Xa={class:"info-value"},ei={class:"info-item"},ti={class:"info-label"},si={class:"info-value"},ai={class:"info-item"},ii={class:"info-label"},oi={class:"info-value"},li={class:"info-item"},ri={class:"info-label"},ni={class:"info-value"},ci={class:"info-item"},ui={class:"info-label"},di={class:"info-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value"},hi={class:"form-section"},mi={class:"checkbox-label"},_i=["disabled"],gi={key:0,class:"subsection"},bi={class:"subsection-title"},yi={class:"form-section"},$i={class:"form-section"},Si={class:"form-section"},ki={class:"form-section"},wi=["disabled"],Di={key:0,class:"spinner"},xi={key:0,class:"info-card success"},Ni={class:"card-header"},Ai={class:"card-content"},Ii={class:"info-grid"},Pi={class:"info-item"},Oi={class:"info-label"},Ti={class:"info-value"},Mi={class:"info-item"},Vi={class:"info-label"},Ci={class:"info-value"},Ei={class:"info-item info-item-wide"},Fi={class:"info-label"},Li={class:"info-value"},Yi={class:"info-item"},Ri={class:"info-label"},Bi={class:"info-value"},Ui={class:"info-item"},Wi={class:"info-label"},Ki={class:"info-value"},zi={class:"info-item"},ji={class:"info-label"},Hi={class:"info-value"},qi={class:"info-item"},Ji={class:"info-label"},Gi={class:"info-value"},Zi={class:"info-item"},Qi={class:"info-label"},Xi={class:"info-value"},eo={class:"info-item"},to={class:"info-label"},so={class:"info-value"},ao={class:"info-item"},io={class:"info-label"},oo={class:"info-value"},lo={class:"info-item"},ro={class:"info-label"},no={class:"info-value"},co=le({__name:"Step3Owner",setup(c){const a=he(),t=Se(),{locale:l,t:i}=de(),g=P(()=>a.osgo),n=P(()=>a.owner),v=P(()=>a.applicant),A=async()=>{try{await a.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},E=async()=>{try{await a.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(I,u)=>{const R=Be;return f(),m("div",ba,[e("div",ya,[e("h2",$a,o(s(i)("step3.title")),1),e("p",Sa,o(s(i)("step3.description")),1)]),e("div",ka,[e("div",wa,[e("h3",Da,o(s(i)("step3.owner")),1),e("div",xa,[J(R,{modelValue:n.value.passportSeries,"onUpdate:modelValue":u[0]||(u[0]=$=>n.value.passportSeries=$),label:s(i)("step3.passportSeries"),placeholder:s(i)("step3.passportSeriesPlaceholder"),disabled:!s(a).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Na,[J(R,{modelValue:n.value.passportNumber,"onUpdate:modelValue":u[1]||(u[1]=$=>n.value.passportNumber=$),label:s(i)("step3.passportNumber"),placeholder:s(i)("step3.passportNumberPlaceholder"),disabled:!s(a).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Aa,[J(R,{modelValue:n.value.birthDate,"onUpdate:modelValue":u[2]||(u[2]=$=>n.value.birthDate=$),label:s(i)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Ia,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(a).ownerVerifying,onClick:A},[s(a).ownerVerifying?(f(),m("span",Oa)):(f(),m(se,{key:1},[u[7]||(u[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a).ownerVerified?s(i)("step3.verified"):s(i)("step3.verifyOwner")),1)],64))],8,Pa)]),J(ye,{name:"fade"},{default:$e(()=>[s(a).ownerVerified&&n.value.id?(f(),m("div",Ta,[e("div",Ma,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i)("step3.ownerFound")),1)]),e("div",Va,[e("div",Ca,[e("div",Ea,[e("div",Fa,o(s(i)("step3.passportIssueDate")),1),e("div",La,o(n.value.passportIssueDate?s(Re)(n.value.passportIssueDate):"-"),1)]),e("div",Ya,[e("div",Ra,o(s(i)("step3.pinfl")),1),e("div",Ba,o(n.value.nationalIdentifier||"-"),1)]),e("div",Ua,[e("div",Wa,o(s(i)("step3.issuedBy")),1),e("div",Ka,o(n.value.passportIssuedBy||"-"),1)]),e("div",za,[e("div",ja,o(s(i)("step3.lastName")),1),e("div",Ha,o(n.value.lastName||"-"),1)]),e("div",qa,[e("div",Ja,o(s(i)("step3.firstName")),1),e("div",Ga,o(n.value.firstName||"-"),1)]),e("div",Za,[e("div",Qa,o(s(i)("step3.middleName")),1),e("div",Xa,o(n.value.middleName||"-"),1)]),e("div",ei,[e("div",ti,o(s(i)("step3.gender")),1),e("div",si,o(n.value.gender?s(We)(n.value.gender,s(l).value):"-"),1)]),e("div",ai,[e("div",ii,o(s(i)("step3.country")),1),e("div",oi,o(n.value.country?.langValue1||"-"),1)]),e("div",li,[e("div",ri,o(s(i)("step3.region")),1),e("div",ni,o(n.value.region?.langValue1||"-"),1)]),e("div",ci,[e("div",ui,o(s(i)("step3.district")),1),e("div",di,o(n.value.district?.langValue1||"-"),1)]),e("div",pi,[e("div",vi,o(s(i)("step3.street")),1),e("div",fi,o(n.value.street||"-"),1)])])])])):U("",!0)]),_:1})]),e("div",hi,[e("label",mi,[_e(e("input",{"onUpdate:modelValue":u[3]||(u[3]=$=>g.value.applicantIsOwner=$),type:"checkbox",class:"checkbox",disabled:!s(a).isEditable},null,8,_i),[[Je,g.value.applicantIsOwner]]),e("span",null,o(s(i)("step3.ownerIsApplicant")),1)])]),J(ye,{name:"slide-down"},{default:$e(()=>[g.value.applicantIsOwner?U("",!0):(f(),m("div",gi,[e("h3",bi,o(s(i)("step3.applicant")),1),e("div",yi,[J(R,{modelValue:v.value.passportSeries,"onUpdate:modelValue":u[4]||(u[4]=$=>v.value.passportSeries=$),label:s(i)("step3.passportSeries"),placeholder:s(i)("step3.passportSeriesPlaceholder"),disabled:!s(a).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",$i,[J(R,{modelValue:v.value.passportNumber,"onUpdate:modelValue":u[5]||(u[5]=$=>v.value.passportNumber=$),label:s(i)("step3.passportNumber"),placeholder:s(i)("step3.passportNumberPlaceholder"),disabled:!s(a).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Si,[J(R,{modelValue:v.value.birthDate,"onUpdate:modelValue":u[6]||(u[6]=$=>v.value.birthDate=$),label:s(i)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",ki,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(a).applicantVerifying,onClick:E},[s(a).applicantVerifying?(f(),m("span",Di)):(f(),m(se,{key:1},[u[9]||(u[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a).applicantVerified?s(i)("step3.verified"):s(i)("step3.verifyApplicant")),1)],64))],8,wi)]),J(ye,{name:"fade"},{default:$e(()=>[s(a).applicantVerified&&v.value.id?(f(),m("div",xi,[e("div",Ni,[u[10]||(u[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i)("step3.applicantFound")),1)]),e("div",Ai,[e("div",Ii,[e("div",Pi,[e("div",Oi,o(s(i)("step3.passportIssueDate")),1),e("div",Ti,o(v.value.passportIssueDate?s(Re)(v.value.passportIssueDate):"-"),1)]),e("div",Mi,[e("div",Vi,o(s(i)("step3.pinfl")),1),e("div",Ci,o(v.value.nationalIdentifier||"-"),1)]),e("div",Ei,[e("div",Fi,o(s(i)("step3.issuedBy")),1),e("div",Li,o(v.value.passportIssuedBy||"-"),1)]),e("div",Yi,[e("div",Ri,o(s(i)("step3.lastName")),1),e("div",Bi,o(v.value.lastName||"-"),1)]),e("div",Ui,[e("div",Wi,o(s(i)("step3.firstName")),1),e("div",Ki,o(v.value.firstName||"-"),1)]),e("div",zi,[e("div",ji,o(s(i)("step3.middleName")),1),e("div",Hi,o(v.value.middleName||"-"),1)]),e("div",qi,[e("div",Ji,o(s(i)("step3.gender")),1),e("div",Gi,o(v.value.gender?s(We)(v.value.gender,s(l).value):"-"),1)]),e("div",Zi,[e("div",Qi,o(s(i)("step3.country")),1),e("div",Xi,o(v.value.country?.langValue1||"-"),1)]),e("div",eo,[e("div",to,o(s(i)("step3.region")),1),e("div",so,o(v.value.region?.langValue1||"-"),1)]),e("div",ao,[e("div",io,o(s(i)("step3.district")),1),e("div",oo,o(v.value.district?.langValue1||"-"),1)]),e("div",lo,[e("div",ro,o(s(i)("step3.street")),1),e("div",no,o(v.value.street||"-"),1)])])])])):U("",!0)]),_:1})]))]),_:1})])])}}}),uo=re(co,[["__scopeId","data-v-863580b2"]]),po={class:"step-container"},vo={class:"step-header"},fo={class:"step-title"},ho={class:"step-description"},mo={class:"step-content"},_o={class:"summary-section"},go={class:"summary-card"},bo={class:"card-title"},yo={class:"card-content"},$o={class:"info-row"},So={class:"info-value-full"},ko={class:"summary-card"},wo={class:"card-title"},Do={class:"card-content"},xo={class:"info-row"},No={class:"info-value-full"},Ao={class:"summary-card"},Io={class:"card-title"},Po={class:"card-content"},Oo={class:"info-row"},To={class:"info-value-full"},Mo={class:"summary-card"},Vo={class:"card-title"},Co={class:"card-content"},Eo={class:"info-row"},Fo={class:"info-value-full"},Lo={class:"info-row"},Yo={class:"info-value-full"},Ro={class:"info-row"},Bo={class:"info-value-full"},Uo={class:"summary-card"},Wo={class:"card-title"},Ko={class:"card-content"},zo={class:"info-row"},jo={class:"info-value-full"},Ho={class:"summary-section"},qo={class:"form-section phone-input-wrapper"},Jo={key:0,class:"input-label",for:"phone-input"},Go={class:"phone-input-container"},Zo=["value","disabled"],Qo={class:"form-section"},Xo={key:0,class:"form-section"},el={class:"premium-section"},tl={class:"premium-card-large"},sl={class:"premium-header"},al={class:"premium-amount-large"},il=le({__name:"Step5Summary",setup(c){const a=he(),t=Pe();Se(),Ve();const l=P(()=>a.osgo),i=P(()=>a.owner),g=P(()=>a.applicant);P(()=>a.fundData),Y(!1);const n=P({get:()=>(l.value.applicantIsOwner?i.value:g.value).phone||"",set:p=>{const d=p.replace(/\D/g,"");let N="";d.startsWith("998")?N=d.slice(0,12):d.length>0&&(N=`998${d.slice(0,9)}`),l.value.applicantIsOwner?(i.value.phone=N,l.value.party=i.value):(g.value.phone=N,l.value.party=g.value)}}),v=Y("");let A=!1;ae(()=>n.value,p=>{if(!A)if(p){const d=p.replace(/\D/g,"");d.startsWith("998")&&d.length===12?v.value=d.slice(3):d.startsWith("998")&&d.length>12?v.value=d.slice(0,12).slice(3):d.length>=9?v.value=d.slice(-9):d.length>0?v.value=d:v.value=""}else v.value=""},{immediate:!0});const E=p=>{const d=p.target;d.selectionStart;let D=d.value.replace(/\D/g,"");D=D.slice(0,9),A=!0,v.value=D;const S=D.length>0?`998${D}`:"";n.value=S,Ae(()=>{if(A=!1,d&&document.activeElement===d){const k=D.length;d.setSelectionRange(k,k)}})},I=()=>{if(v.value){const p=v.value.replace(/\D/g,"");p.length===9?v.value=`${p.slice(0,2)} ${p.slice(2,5)} ${p.slice(5,7)} ${p.slice(7,9)}`:p.length>0&&(v.value=p)}},u=()=>{v.value&&(v.value=v.value.replace(/\D/g,""))},{locale:R,t:$}=de(),K=()=>l.value.period?t.getLocalizedName(l.value.period,R.value||"uz"):"-",O=()=>l.value.drivedArea?t.getLocalizedName(l.value.drivedArea,R.value||"uz"):"-";return(p,d)=>{const N=Be;return f(),m("div",po,[e("div",vo,[e("h2",fo,o(s($)("step5.title")),1),e("p",ho,o(s($)("step5.description")),1)]),e("div",mo,[e("div",_o,[e("div",go,[e("div",bo,o(s($)("step3.owner")),1),e("div",yo,[e("div",$o,[e("span",So,o(i.value.name||"-")+o(i.value.birthDate?` (${i.value.birthDate})`:""),1)])])]),e("div",ko,[e("div",wo,o(s($)("step3.applicant")),1),e("div",Do,[e("div",xo,[e("span",No,o((l.value.applicantIsOwner?i.value:g.value).name||"-")+o((l.value.applicantIsOwner?i.value:g.value).birthDate?` (${(l.value.applicantIsOwner?i.value:g.value).birthDate})`:""),1)])])]),e("div",Ao,[e("div",Io,o(s($)("step5.vehicleInfo")),1),e("div",Po,[e("div",Oo,[e("span",To,o(l.value.vehicle?.modelName||l.value.vehicle?.model||"-")+" "+o(l.value.vehicle?.govNumber?` (${l.value.vehicle.govNumber})`:""),1)])])]),e("div",Mo,[e("div",Vo,o(s($)("step5.policyInfo")),1),e("div",Co,[e("div",Eo,[e("span",Fo,o(K()),1)]),e("div",Lo,[e("span",Yo,o(O()),1)]),e("div",Ro,[e("span",Bo,o(l.value.driversLimited?s($)("step5.driversLimited",{count:l.value.drivers?.length||0}):s($)("step5.noDriversLimitation")),1)])])]),e("div",Uo,[e("div",Wo,o(s($)("step5.compensation")),1),e("div",Ko,[e("div",zo,[e("span",jo,o(s(Me)(s(Ye))),1)])])])]),e("div",Ho,[e("div",qo,[s($)("step5.phone")?(f(),m("label",Jo,[Ie(o(s($)("step5.phone"))+" ",1),d[1]||(d[1]=e("span",{class:"text-error"},"*",-1))])):U("",!0),e("div",Go,[d[2]||(d[2]=e("div",{class:"phone-prefix"},"+998",-1)),e("input",{id:"phone-input",value:v.value,type:"tel",inputmode:"tel",class:oe(["input phone-input",{"input-error":!1}]),placeholder:"90 123 45 67",disabled:!s(a).isEditable,maxlength:"12",onInput:E,onFocus:u,onBlur:I},null,40,Zo),d[3]||(d[3]=e("div",{class:"input-icon input-icon-left phone-icon"},[e("i",{class:"bx bx-phone"})],-1))])]),e("div",Qo,[J(N,{modelValue:l.value.contractStartDate,"onUpdate:modelValue":d[0]||(d[0]=D=>l.value.contractStartDate=D),label:s($)("step5.startDate"),type:"text","date-mask":"",placeholder:s($)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),l.value.contractEndDate?(f(),m("div",Xo,[J(N,{"model-value":l.value.contractEndDate,label:s($)("step5.endDate"),type:"text","date-mask":"",placeholder:s($)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):U("",!0)]),e("div",el,[e("div",tl,[e("div",sl,[d[4]||(d[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s($)("step5.premium")),1)]),e("div",al,o(s(Me)(s(a).calculatedPremium)),1)])])])])}}}),ol=re(il,[["__scopeId","data-v-0a51e1f3"]]),ll=""+new URL("payme.BECX6KQd.png",import.meta.url).href,rl=""+new URL("click.BT4PMBZo.png",import.meta.url).href,nl=""+new URL("uzum.CC8-JJXH.png",import.meta.url).href,cl={class:"step-container"},ul={class:"step-header"},dl={class:"step-title"},pl={class:"step-description"},vl={class:"step-content"},fl={class:"gift-section"},hl={key:0,class:"confetti-container"},ml={class:"gift-message"},_l={class:"gift-title"},gl={key:0,class:"gift-status success"},bl={key:1,class:"gift-status failed"},yl={href:"https://tys.uz/products/kasko-dostupnoe",target:"_blank",rel:"noopener noreferrer",class:"gift-link-text"},$l={key:0,class:"gift-action"},Sl=["disabled"],kl={key:0,class:"spinner"},wl={class:"premium-section"},Dl={class:"premium-card-large"},xl={class:"premium-header"},Nl={class:"premium-amount-large"},Al={class:"payment-section"},Il={class:"section-title"},Pl={class:"payment-buttons"},Ol=["disabled"],Tl={class:"payment-icon"},Ml=["src"],Vl=["disabled"],Cl={class:"payment-icon"},El=["src"],Fl=["disabled"],Ll={class:"payment-icon"},Yl=["src"],Rl={key:0,class:"success-card"},Bl={class:"success-title"},Ul={class:"success-description"},Wl={class:"policy-details"},Kl={class:"policy-row"},zl={class:"policy-label"},jl={class:"policy-value"},Hl={class:"policy-row"},ql={class:"policy-label"},Jl={class:"policy-value"},Gl=le({__name:"Step6Payment",setup(c){const a=he(),t=Se(),l=Ve(),{t:i,locale:g}=de(),n=P(()=>a.osgo),v=P(()=>a.fundData),A=P(()=>(n.value.applicantIsOwner?a.owner:a.applicant).phone||""),E=Y(!1);Y(null),Y(0);const I=Y(null),u=P({get:()=>a.selectedPaymentMethod,set:N=>{a.selectedPaymentMethod=N}}),R=P(()=>{if(!I.value)return"";const N=I.value.toLowerCase(),D=g.value,S=D==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],k=D==="ru"?["ошибка","не получена"]:["xato","olindi"];return S.some(w=>N.includes(w))?"status-success":k.some(w=>N.includes(w))?"status-error":"status-info"});P(()=>R.value==="status-success"?"bx bx-check-circle":R.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle");const $=Y(!1),K=P(()=>!!(n.value.id&&v.value?.seria&&v.value?.number&&a.kaskoContractStatus!=="success")),O=async()=>{if(!(!K.value||$.value))try{$.value=!0,t.isTelegramWebApp.value&&t.hapticImpact("medium");const N=a.kaskoVehicleId,D=a.kaskoIndividualId,k=(A.value||"").replace(/[+()-]/g,"").replace(/^998/,"998");if(!N||!D||!k||!k.startsWith("998"))throw new Error("Kasko contract data is incomplete");const w=await l.createKaskoContract(N,D,k,"PAYME");if(w&&w.success===!0)a.kaskoContractStatus="success",t.isTelegramWebApp.value&&t.hapticNotification("success");else throw a.kaskoContractStatus="failed",new Error("Kasko contract creation failed")}catch(N){console.error("[Step6Payment] Create Kasko error:",N),a.kaskoContractStatus="failed",t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(N.message||i("errors.kaskoCreateFailed")||"Failed to create Kasko contract"))}finally{$.value=!1}},p=N=>{const D=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE"],S=D[N%D.length],k=`${N*2%100}%`,w=`${N*.1%2}s`,H=`${2+N%3}s`,Q=`${6+N%8}px`,G=`${N*36}deg`;return{"--confetti-color":S,"--confetti-left":k,"--confetti-delay":w,"--confetti-duration":H,"--confetti-size":Q,"--confetti-rotation":G}},d=N=>{u.value===N?u.value=null:u.value=N,t.isTelegramWebApp.value&&t.hapticImpact("light")};return Ge(()=>{}),(N,D)=>(f(),m("div",cl,[e("div",ul,[e("h2",dl,o(s(i)("step5.payment")),1),e("p",pl,o(s(i)("step5.paymentDescription")),1)]),e("div",vl,[e("div",fl,[e("div",{class:oe(["gift-card",{"gift-card-success":s(a).kaskoContractStatus==="success","gift-card-failed":s(a).kaskoContractStatus==="failed"}])},[s(a).kaskoContractStatus==="success"?(f(),m("div",hl,[(f(),m(se,null,be(50,S=>e("div",{class:"confetti",key:S,style:Ke(p(S))},null,4)),64))])):U("",!0),D[5]||(D[5]=e("div",{class:"gift-icon"},[e("i",{class:"bx bx-gift"})],-1)),e("div",ml,[e("h3",_l,o(s(i)("step5.giftMessage")),1),s(a).kaskoContractStatus==="success"?(f(),m("div",gl,[D[3]||(D[3]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i)("step5.kaskoSuccess")),1)])):s(a).kaskoContractStatus==="failed"?(f(),m("div",bl,[D[4]||(D[4]=e("i",{class:"bx bx-x-circle"},null,-1)),e("span",null,o(s(i)("step5.kaskoFailed")),1)])):U("",!0),e("a",yl,o(s(i)("step5.giftLinkText")),1)])],2)]),K.value?(f(),m("div",$l,[e("button",{type:"button",class:"btn btn-kasko",disabled:$.value,onClick:O},[$.value?(f(),m("span",kl)):(f(),m(se,{key:1},[D[6]||(D[6]=e("i",{class:"bx bx-gift"},null,-1)),e("span",null,o(s(i)("step5.createKasko")),1)],64))],8,Sl)])):U("",!0),e("div",wl,[e("div",Dl,[e("div",xl,[D[7]||(D[7]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(i)("step5.premium")),1)]),e("div",Nl,o(s(Me)(s(a).calculatedPremium)),1)])]),e("div",Al,[e("h3",Il,[D[8]||(D[8]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(s(i)("step5.paymentMethod")),1)]),e("div",Pl,[e("button",{type:"button",class:oe(["payment-btn payme",{"payment-btn-selected":u.value==="payme"}]),disabled:E.value,onClick:D[0]||(D[0]=S=>d("payme"))},[e("div",Tl,[e("img",{src:s(ll),alt:"Payme"},null,8,Ml)])],10,Ol),e("button",{type:"button",class:oe(["payment-btn click",{"payment-btn-selected":u.value==="click"}]),disabled:E.value,onClick:D[1]||(D[1]=S=>d("click"))},[e("div",Cl,[e("img",{src:s(rl),alt:"Click"},null,8,El)])],10,Vl),e("button",{type:"button",class:oe(["payment-btn uzum",{"payment-btn-selected":u.value==="uzum"}]),disabled:E.value,onClick:D[2]||(D[2]=S=>d("uzum"))},[e("div",Ll,[e("img",{src:s(nl),alt:"Uzum"},null,8,Yl)])],10,Fl)])]),U("",!0),J(ye,{name:"fade"},{default:$e(()=>[n.value.id&&v.value&&v.value.seria?(f(),m("div",Rl,[D[11]||(D[11]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Bl,o(s(i)("step5.success")),1),e("p",Ul,o(s(i)("step5.policyIssued")),1),e("div",Wl,[e("div",Kl,[e("span",zl,o(s(i)("step5.policySeries"))+":",1),e("span",jl,o(v.value.seria),1)]),e("div",Hl,[e("span",ql,o(s(i)("step5.policyNumber"))+":",1),e("span",Jl,o(v.value.number),1)])])])):U("",!0)]),_:1})])]))}}),Zl=re(Gl,[["__scopeId","data-v-0b5d2c58"]]),Ql={class:"min-h-screen flex flex-col"},Xl={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},er={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},tr={class:"max-w-3xl mx-auto"},sr={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},ar=le({__name:"index",setup(c){const a=he(),t=Pe(),l=Se();return Ce(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),a.loadFromSession()&&console.log("[IndexPage] Restored data from session"),a.initialize(),l.isTelegramWebApp.value&&l.showBackButton(()=>{a.currentStep>0?a.previousStep():l.close()});const g=ae(()=>a.osgo,()=>{a.saveToSession()},{deep:!0});Ze(()=>{g(),a.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())})}),Qe({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(i,g)=>(f(),m("div",Ql,[e("header",Xl,[J(Dt)]),e("main",er,[e("div",tr,[J(ye,{name:"fade",mode:"out-in"},{default:$e(()=>[s(a).currentStep===s(L).PARAMS?(f(),Ne(ws,{key:s(L).PARAMS})):s(a).currentStep===s(L).VEHICLE?(f(),Ne(ga,{key:s(L).VEHICLE})):s(a).currentStep===s(L).OWNER?(f(),Ne(uo,{key:s(L).OWNER})):s(a).currentStep===s(L).SUMMARY?(f(),Ne(ol,{key:s(L).SUMMARY})):s(a).currentStep===s(L).PAYMENT?(f(),Ne(Zl,{key:s(L).PAYMENT})):U("",!0)]),_:1})])]),e("footer",sr,[J(Et)])]))}}),fr=re(ar,[["__scopeId","data-v-ce2fc33a"]]);export{fr as default};
