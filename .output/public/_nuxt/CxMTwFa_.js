import{e as ze,f as Ne,g as Pe,r as F,S as E,h as M,C as Ee,i as ye,j as Ie,k as te,l as ce,m as je,n as Oe,c as f,o as p,F as ae,p as ge,q as s,s as ee,t as i,a as e,v as qe,b as W,x as He,y as fe,z as C,d as ke,A as ve,B as De,T as re,w as ne,D as Ge,E as Je,G as Ke,H as Ze,I as Fe,u as Qe,J as xe}from"./DkoqWFMX.js";import{_ as se}from"./DlAUqK2U.js";import{_ as Xe}from"./DgM-zN9R.js";function et(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ae={exports:{}},tt=Ae.exports,Re;function st(){return Re||(Re=1,(function(n,o){(function(t,l){n.exports=l()})(tt,(function(){var t=1e3,l=6e4,a=36e5,d="millisecond",u="second",h="minute",_="hour",T="day",w="week",c="month",N="quarter",g="year",m="date",k="Invalid Date",Q=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,L=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var y=["th","st","nd","rd"],v=A%100;return"["+A+(y[(v-20)%10]||y[v]||y[0])+"]"}},H=function(A,y,v){var S=String(A);return!S||S.length>=y?A:""+Array(y+1-S.length).join(v)+A},I={s:H,z:function(A){var y=-A.utcOffset(),v=Math.abs(y),S=Math.floor(v/60),b=v%60;return(y<=0?"+":"-")+H(S,2,"0")+":"+H(b,2,"0")},m:function A(y,v){if(y.date()<v.date())return-A(v,y);var S=12*(v.year()-y.year())+(v.month()-y.month()),b=y.clone().add(S,c),V=v-b<0,P=y.clone().add(S+(V?-1:1),c);return+(-(S+(v-b)/(V?b-P:P-b))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:c,y:g,w,d:T,D:m,h:_,m:h,s:u,ms:d,Q:N}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},D="en",O={};O[D]=$;var q="$isDayjsObject",ie=function(A){return A instanceof he||!(!A||!A[q])},X=function A(y,v,S){var b;if(!y)return D;if(typeof y=="string"){var V=y.toLowerCase();O[V]&&(b=V),v&&(O[V]=v,b=V);var P=y.split("-");if(!b&&P.length>1)return A(P[0])}else{var R=y.name;O[R]=y,b=R}return!S&&b&&(D=b),b||!S&&D},j=function(A,y){if(ie(A))return A.clone();var v=typeof y=="object"?y:{};return v.date=A,v.args=arguments,new he(v)},Y=I;Y.l=X,Y.i=ie,Y.w=function(A,y){return j(A,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var he=(function(){function A(v){this.$L=X(v.locale,null,!0),this.parse(v),this.$x=this.$x||v.x||{},this[q]=!0}var y=A.prototype;return y.parse=function(v){this.$d=(function(S){var b=S.date,V=S.utc;if(b===null)return new Date(NaN);if(Y.u(b))return new Date;if(b instanceof Date)return new Date(b);if(typeof b=="string"&&!/Z$/i.test(b)){var P=b.match(Q);if(P){var R=P[2]-1||0,B=(P[7]||"0").substring(0,3);return V?new Date(Date.UTC(P[1],R,P[3]||1,P[4]||0,P[5]||0,P[6]||0,B)):new Date(P[1],R,P[3]||1,P[4]||0,P[5]||0,P[6]||0,B)}}return new Date(b)})(v),this.init()},y.init=function(){var v=this.$d;this.$y=v.getFullYear(),this.$M=v.getMonth(),this.$D=v.getDate(),this.$W=v.getDay(),this.$H=v.getHours(),this.$m=v.getMinutes(),this.$s=v.getSeconds(),this.$ms=v.getMilliseconds()},y.$utils=function(){return Y},y.isValid=function(){return this.$d.toString()!==k},y.isSame=function(v,S){var b=j(v);return this.startOf(S)<=b&&b<=this.endOf(S)},y.isAfter=function(v,S){return j(v)<this.startOf(S)},y.isBefore=function(v,S){return this.endOf(S)<j(v)},y.$g=function(v,S,b){return Y.u(v)?this[S]:this.set(b,v)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(v,S){var b=this,V=!!Y.u(S)||S,P=Y.p(v),R=function(de,K){var le=Y.w(b.$u?Date.UTC(b.$y,K,de):new Date(b.$y,K,de),b);return V?le:le.endOf(T)},B=function(de,K){return Y.w(b.toDate()[de].apply(b.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(K)),b)},z=this.$W,G=this.$M,Z=this.$D,oe="set"+(this.$u?"UTC":"");switch(P){case g:return V?R(1,0):R(31,11);case c:return V?R(1,G):R(0,G+1);case w:var ue=this.$locale().weekStart||0,me=(z<ue?z+7:z)-ue;return R(V?Z-me:Z+(6-me),G);case T:case m:return B(oe+"Hours",0);case _:return B(oe+"Minutes",1);case h:return B(oe+"Seconds",2);case u:return B(oe+"Milliseconds",3);default:return this.clone()}},y.endOf=function(v){return this.startOf(v,!1)},y.$set=function(v,S){var b,V=Y.p(v),P="set"+(this.$u?"UTC":""),R=(b={},b[T]=P+"Date",b[m]=P+"Date",b[c]=P+"Month",b[g]=P+"FullYear",b[_]=P+"Hours",b[h]=P+"Minutes",b[u]=P+"Seconds",b[d]=P+"Milliseconds",b)[V],B=V===T?this.$D+(S-this.$W):S;if(V===c||V===g){var z=this.clone().set(m,1);z.$d[R](B),z.init(),this.$d=z.set(m,Math.min(this.$D,z.daysInMonth())).$d}else R&&this.$d[R](B);return this.init(),this},y.set=function(v,S){return this.clone().$set(v,S)},y.get=function(v){return this[Y.p(v)]()},y.add=function(v,S){var b,V=this;v=Number(v);var P=Y.p(S),R=function(G){var Z=j(V);return Y.w(Z.date(Z.date()+Math.round(G*v)),V)};if(P===c)return this.set(c,this.$M+v);if(P===g)return this.set(g,this.$y+v);if(P===T)return R(1);if(P===w)return R(7);var B=(b={},b[h]=l,b[_]=a,b[u]=t,b)[P]||1,z=this.$d.getTime()+v*B;return Y.w(z,this)},y.subtract=function(v,S){return this.add(-1*v,S)},y.format=function(v){var S=this,b=this.$locale();if(!this.isValid())return b.invalidDate||k;var V=v||"YYYY-MM-DDTHH:mm:ssZ",P=Y.z(this),R=this.$H,B=this.$m,z=this.$M,G=b.weekdays,Z=b.months,oe=b.meridiem,ue=function(K,le,_e,we){return K&&(K[le]||K(S,V))||_e[le].slice(0,we)},me=function(K){return Y.s(R%12||12,K,"0")},de=oe||function(K,le,_e){var we=K<12?"AM":"PM";return _e?we.toLowerCase():we};return V.replace(L,(function(K,le){return le||(function(_e){switch(_e){case"YY":return String(S.$y).slice(-2);case"YYYY":return Y.s(S.$y,4,"0");case"M":return z+1;case"MM":return Y.s(z+1,2,"0");case"MMM":return ue(b.monthsShort,z,Z,3);case"MMMM":return ue(Z,z);case"D":return S.$D;case"DD":return Y.s(S.$D,2,"0");case"d":return String(S.$W);case"dd":return ue(b.weekdaysMin,S.$W,G,2);case"ddd":return ue(b.weekdaysShort,S.$W,G,3);case"dddd":return G[S.$W];case"H":return String(R);case"HH":return Y.s(R,2,"0");case"h":return me(1);case"hh":return me(2);case"a":return de(R,B,!0);case"A":return de(R,B,!1);case"m":return String(B);case"mm":return Y.s(B,2,"0");case"s":return String(S.$s);case"ss":return Y.s(S.$s,2,"0");case"SSS":return Y.s(S.$ms,3,"0");case"Z":return P}return null})(K)||P.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(v,S,b){var V,P=this,R=Y.p(S),B=j(v),z=(B.utcOffset()-this.utcOffset())*l,G=this-B,Z=function(){return Y.m(P,B)};switch(R){case g:V=Z()/12;break;case c:V=Z();break;case N:V=Z()/3;break;case w:V=(G-z)/6048e5;break;case T:V=(G-z)/864e5;break;case _:V=G/a;break;case h:V=G/l;break;case u:V=G/t;break;default:V=G}return b?V:Y.a(V)},y.daysInMonth=function(){return this.endOf(c).$D},y.$locale=function(){return O[this.$L]},y.locale=function(v,S){if(!v)return this.$L;var b=this.clone(),V=X(v,S,!0);return V&&(b.$L=V),b},y.clone=function(){return Y.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},A})(),Se=he.prototype;return j.prototype=Se,[["$ms",d],["$s",u],["$m",h],["$H",_],["$W",T],["$M",c],["$y",g],["$D",m]].forEach((function(A){Se[A[1]]=function(y){return this.$g(y,A[0],A[1])}})),j.extend=function(A,y){return A.$i||(A(y,he,j),A.$i=!0),j},j.locale=X,j.isDayjs=ie,j.unix=function(A){return j(1e3*A)},j.en=O[D],j.Ls=O,j.p={},j}))})(Ae)),Ae.exports}var at=st();const $e=et(at);function Me(n,o="сум"){return n==null||isNaN(n)?`0 ${o}`:`${n.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${o}`}function Ce(n){return n?$e(n).format("DD.MM.YYYY"):""}function Ue(n,o="ru"){if(!n)return"";const t=String(n).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?o==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?o==="uz"?"Ayol":"Женский":String(n)}function it(n){if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;if(/^\d{2}-\d{2}-\d{4}$/.test(n)){const o=n.split("-");return`${o[2]}-${o[1]}-${o[0]}`}try{return $e(n,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return n}}const pe=ze("osgo",()=>{const n=Ne(),o=Pe(),t=F({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),l=F({passportSeries:"",passportNumber:"",birthDate:""}),a=F({passportSeries:"",passportNumber:"",birthDate:""}),d=F(E.PARAMS),u=F(!1),h=F(null),_=F(!1),T=F(null),w=F(null),c=F(null),N=F(!1),g=F(null),m=F(!1),k=F(!1),Q=F(null),L=F(!1),$=F(!1),H=F(null),I=F(!1),D=F(!1),O=F(null),q=M(()=>t.value.status==="DRAFT"),ie=M(()=>oe(d.value).valid),X=M(()=>Object.keys(E).length-1),j=r=>r<=E.OWNER?r+1:r===E.DRIVERS?-1:r,Y=M(()=>j(d.value)),he=M(()=>{const r=Y.value;return Math.round(r/X.value*100)}),Se=M(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,x=t.value.period.coefficient||0,U=t.value.drivedArea.coefficient||0;let J=3;t.value.driversLimited&&t.value.incidentCoeff&&(J=t.value.incidentCoeff);const Ve=r*x*J*U,Ye=Ve>5*r?Ee*5*r:Ee*Ve/100;return Math.round(Ye)}),A=M(()=>{const x=(t.value.entriesJournalKt||[]).reduce((U,J)=>U+(J.amount||0),0);return t.value.premium-x}),y=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},d.value=E.PARAMS,n.isLoaded&&(t.value.discountType=n.getDefaultDiscountType())};ye(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ye(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ye(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const x=parseInt(r.slice(0,2)),U=n.findDrivedAreaByRegion(x);U&&(t.value.drivedArea=U)}),ye(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=Se.value},{deep:!0}),ye(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const v=async()=>{if(t.value.vehicle){m.value=!0,Q.value=null,k.value=!1;try{const r=await o.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),x=r?.result||r;if(r?.error&&!x)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&x&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,x),x?.carType&&n.isLoaded&&(t.value.vehicle.carType=n.findCarType(x.carType.id)),k.value=!0,console.log("[OsgoStore] Vehicle verified:",x)}catch(r){throw Q.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{m.value=!1}}},S=async()=>{L.value=!0,H.value=null,$.value=!1;try{const r=await o.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(a.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.party={...l.value},D.value=!0)),$.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(r){throw H.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{L.value=!1}},b=async()=>{I.value=!0,O.value=null,D.value=!1;try{const r=await o.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",r),r&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...r},t.value.party={...a.value}),D.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(r){throw O.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{I.value=!1}},V=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const x=it(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:x});const U=await o.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:x});if(console.log("[OsgoStore] Driver verification result:",U),!U||!U.id)throw new Error("Driver verification failed: invalid response");const J={...r,...U,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",J),J}catch(x){throw console.error("[OsgoStore] Driver verification failed:",x),x}},P=r=>{t.value.drivers||(t.value.drivers=[]);const x={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(x),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},R=(r,x)=>{t.value.drivers[r]&&(t.value.drivers[r]=x)},B=r=>{t.value.drivers.splice(r,1)},z=(r,x,U)=>t.value.drivers.some(J=>J.passportSeries===r&&J.passportNumber===x&&J.birthDate===U),G=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(z(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}P({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},Z=()=>{z(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||P({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},oe=r=>{switch(r){case E.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case E.VEHICLE:return{valid:k.value};case E.OWNER:return{valid:$.value&&(t.value.applicantIsOwner||D.value)};case E.DRIVERS:return{valid:!0};case E.SUMMARY:const x=t.value.applicantIsOwner?l.value.id:a.value.id;return{valid:!!(l.value.id&&x&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(U=>U.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case E.PAYMENT:return{valid:!!(t.value.id&&g.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:a,currentStep:d,saving:u,saveError:h,fetching:_,fetchError:T,fundData:w,fundError:c,fetchingFundData:N,selectedPaymentMethod:g,vehicleVerifying:m,vehicleVerified:k,vehicleVerifyError:Q,ownerVerifying:L,ownerVerified:$,ownerVerifyError:H,applicantVerifying:I,applicantVerified:D,applicantVerifyError:O,isEditable:q,canProceedToNextStep:ie,totalSteps:X,displayStepNumber:Y,progressPercentage:he,calculatedPremium:Se,amountPayable:A,initialize:y,verifyVehicle:v,verifyOwner:S,verifyApplicant:b,verifyDriver:V,addDriver:P,updateDriver:R,removeDriver:B,hasDriver:z,addOwnerAsDriver:G,addApplicantAsDriver:Z,validateStepData:oe,nextStep:()=>{d.value===E.OWNER?d.value=E.SUMMARY:d.value<E.PAYMENT&&d.value++},previousStep:()=>{d.value===E.SUMMARY?d.value=E.OWNER:d.value>0&&d.value--},goToStep:r=>{r>=0&&r<X.value&&(d.value=r)},createPolicy:async()=>{u.value=!0,h.value=null;try{let r=null;try{r=await o.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Te){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Te),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const x=t.value.applicantIsOwner?{...l.value}:{...a.value};x.phone&&(x.phone=x.phone.replace(/[+()-]/g,""));const U={...l.value},J=t.value.discountType||n.meta?.beneficiary?.find(({coefficient:Te})=>Te===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const We={party:x,beneficiary:U,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:J,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Be={user:r,osgo:We};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:x.id,name:x.name},beneficiary:{id:U.id,name:U.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:J?.id}}});const be=await o.createOsgoApplication(Be);if(!be||typeof be!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",be),new Error("Failed to create policy: invalid response");return t.value.id=be,t.value.applicantIsOwner?(l.value.phone=x.phone,t.value.party=l.value):(a.value.phone=x.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",be),be}catch(r){throw h.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{u.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");u.value=!0,h.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?l.value:a.value,beneficiary:l.value};await o.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw h.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{u.value=!1}},fetchPolicy:async r=>{_.value=!0,T.value=null;try{const x=await o.fetchOsgoEntity(r);if(t.value=x,x.party?.id){const U=await o.fetchIndividualEntity(x.party.id);a.value=U,t.value.party=U}if(x.beneficiary?.id){const U=await o.fetchIndividualEntity(x.beneficiary.id);l.value=U,t.value.beneficiary=U}if(n.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=n.findCarType(t.value.vehicle.carType.id)),n.isLoaded&&t.value.period&&(t.value.period=n.findPeriod(t.value.period.id)),n.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=n.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const U=Math.max(...t.value.drivers.map(J=>J.incidentFrequency?.coefficient||0));t.value.incidentCoeff=U}console.log("[OsgoStore] Policy fetched:",r)}catch(x){throw T.value=x.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",x),x}finally{_.value=!1}},fetchFundData:async()=>{if(t.value.id){N.value=!0,c.value=null;try{const r=await o.getFundPolicy(t.value.id);w.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){c.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{N.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:l.value,applicant:a.value,currentStep:d.value};sessionStorage.setItem(Ie.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Ie.OSGO_DRAFT);if(!r)return!1;const x=JSON.parse(r);return t.value=x.osgo,l.value=x.owner,a.value=x.applicant,d.value=x.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Ie.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{y(),k.value=!1,$.value=!1,D.value=!1,w.value=null,h.value=null,T.value=null}}}),ot={class:"language-switcher"},lt=["onClick"],rt=te({__name:"LanguageSwitcher",setup(n){const{locale:o,locales:t}=ce();je();const l=M(()=>o.value),a=M(()=>t.value.filter(u=>u.code!==o.value)),d=u=>{o.value=u,typeof window<"u"&&localStorage.setItem("app-language",u),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Oe(()=>{if(typeof window<"u"){const u=localStorage.getItem("app-language");u&&(u==="ru"||u==="uz")&&(o.value=u)}}),(u,h)=>(p(),f("div",ot,[(p(!0),f(ae,null,ge(s(a),_=>(p(),f("button",{key:_.code,class:ee(["lang-btn",{active:s(l)===_.code}]),onClick:T=>d(_.code)},i(_.code.toUpperCase()),11,lt))),128))]))}}),nt=se(rt,[["__scopeId","data-v-e748ef5d"]]),ct={class:"progress-bar-container"},ut={class:"progress-track"},dt={class:"steps-container"},pt=["onClick"],vt={key:0,class:"step-check"},ft={key:1,class:"step-number"},ht={class:"step-label"},mt=te({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(n){const o=n,{t}=ce(),l=M(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),a=h=>h<=2?h:h+1,d=M(()=>(o.currentStep+1)/o.totalSteps*100),u=h=>{console.log("Step clicked:",h)};return(h,_)=>(p(),f("div",ct,[e("div",ut,[e("div",{class:"progress-fill",style:qe({width:`${d.value}%`})},null,4)]),e("div",dt,[(p(!0),f(ae,null,ge(l.value,(T,w)=>(p(),f("div",{key:w,class:"step-wrapper",onClick:c=>u(w)},[e("div",{class:ee(["step-circle",{"step-active":a(w)===n.currentStep,"step-completed":a(w)<n.currentStep&&a(w)!==s(E).DRIVERS,"step-pending":a(w)>n.currentStep}])},[a(w)<n.currentStep&&a(w)!==s(E).DRIVERS?(p(),f("span",vt,"✓")):(p(),f("span",ft,i(w+1),1))],2),e("div",ht,i(T),1)],8,pt))),128))])]))}}),_t=se(mt,[["__scopeId","data-v-7805c614"]]),bt={class:"fixed-header"},yt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},gt={class:"flex items-center justify-between mb-3"},$t=te({__name:"AppHeader",setup(n){const o=pe(),t=M(()=>o.currentStep),l=M(()=>o.totalSteps);return(a,d)=>{const u=nt,h=_t;return p(),f("header",bt,[e("div",yt,[e("div",gt,[d[0]||(d[0]=He('<div class="flex items-center gap-3" data-v-67b64b56><div class="w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg" data-v-67b64b56><img src="'+Xe+'" alt="Temiryo&#39;l Sug&#39;urta Logo" data-v-67b64b56></div><div data-v-67b64b56><div class="text-base font-bold text-text" data-v-67b64b56>ОСГОВТС</div><div class="text-xs text-text-light" data-v-67b64b56> Temiryo&#39;l Sug&#39;urta </div></div></div>',1)),W(u)]),W(h,{"current-step":t.value,"total-steps":l.value},null,8,["current-step","total-steps"])])])}}}),St=se($t,[["__scopeId","data-v-67b64b56"]]),wt={class:"fixed-footer"},Dt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},xt=["disabled"],Nt={class:"flex-1 text-center"},kt={class:"text-sm text-text-light font-medium"},At=["disabled"],Mt={key:0,class:"spinner"},Pt={key:0},Ot={key:1},Vt={key:2},Tt={key:3,class:"text-lg bx bx-chevron-right"},It=te({__name:"AppFooter",setup(n){const o=pe(),t=fe(),l=Pe(),{t:a}=ce(),d=F(!1),u=F(null),h=F(null),_=M(()=>o.currentStep),T=M(()=>o.totalSteps),w=M(()=>o.displayStepNumber),c=M(()=>_.value===0),N=M(()=>_.value===E.PAYMENT),g=M(()=>o.canProceedToNextStep),m=M(()=>o.saving||o.fetching||d.value),k=()=>{c.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),o.previousStep())},Q=async()=>{if(!g.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(_.value===E.VEHICLE&&!o.vehicleVerified)await o.verifyVehicle();else if(_.value===E.OWNER)o.ownerVerified||await o.verifyOwner(),!o.osgo.applicantIsOwner&&!o.applicantVerified&&await o.verifyApplicant();else if(_.value===E.SUMMARY)o.osgo.id||(await o.createPolicy(),console.log("[AppFooter] Policy created:",o.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(_.value===E.PAYMENT){if(!o.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const $={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[o.selectedPaymentMethod],H=o.osgo.id,D=(o.osgo.applicantIsOwner?o.owner:o.applicant).phone||"",O=o.calculatedPremium;if(!H||!D||!O){const q="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:H,phone:D,amount:O}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(q));return}try{d.value=!0,u.value=null,h.value=null,await l.sendPaymentLink($,H,D,O),h.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(q){u.value=q.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",q),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(u.value))}finally{d.value=!1}return}N.value?console.log("[AppFooter] Last step reached"):o.nextStep()}catch(L){console.error("[AppFooter] Error:",L),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(L.message||a("errors.unknown")))}};return(L,$)=>(p(),f("footer",wt,[e("div",Dt,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:c.value||m.value,onClick:k},[$[0]||($[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,i(L.$t("common.previous")),1)],8,xt),e("div",Nt,[e("div",kt,i(L.$t("common.step",{current:w.value,total:T.value})),1)]),e("button",{type:"button",class:ee(["btn flex-1 max-w-[160px]",{"btn-primary":!N.value||_.value!==s(E).PAYMENT,"btn-success":N.value&&_.value===s(E).PAYMENT}]),disabled:!g.value||m.value,onClick:Q},[m.value?(p(),f("span",Mt)):(p(),f(ae,{key:1},[_.value===s(E).SUMMARY&&!s(o).osgo.id?(p(),f("span",Pt,i(L.$t("step5.confirm")),1)):N.value&&_.value===s(E).PAYMENT?(p(),f("span",Ot,[$[1]||($[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,i(L.$t("step5.payment")),1)])):(p(),f("span",Vt,i(L.$t("common.next")),1)),!N.value&&_.value!==s(E).SUMMARY?(p(),f("i",Tt)):C("",!0)],64))],10,At)])]))}}),Et=se(It,[["__scopeId","data-v-9a015344"]]),Ct={class:"step-container"},Lt={key:0,class:"loading-state"},Yt={key:1,class:"error-state"},Ft={key:2,class:"error-state"},Rt={class:"debug-info"},Ut={key:3},Wt={class:"step-header"},Bt={class:"step-title"},zt={class:"step-description"},jt={class:"step-content"},qt={class:"form-section"},Ht={class:"section-title"},Gt={class:"select-wrapper"},Jt=["disabled"],Kt={value:"",disabled:""},Zt=["value"],Qt={class:"form-section"},Xt={class:"section-title"},es={class:"select-wrapper"},ts=["disabled"],ss={value:"",disabled:""},as=["value"],is={class:"form-section",style:{display:"none"}},os={class:"section-title"},ls={class:"select-wrapper"},rs=["disabled"],ns={value:"false"},cs={value:"true"},us={key:0,class:"form-section"},ds={class:"section-title"},ps={class:"select-wrapper"},vs=["disabled"],fs={value:"",disabled:""},hs=["value"],ms={class:"form-section"},_s={class:"section-title"},bs={class:"select-wrapper"},ys=["disabled"],gs={value:"",disabled:""},$s=["value"],Ss={key:0,class:"premium-card"},ws={class:"premium-card-content"},Ds={class:"premium-label"},xs={class:"premium-amount"},Ns=te({__name:"Step1Params",setup(n){const o=pe(),t=Ne(),l=fe(),{locale:a,t:d}=ce();Oe(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Car types:",t.carTypes),console.log("[Step1Params] Periods count:",t.periods.length),console.log("[Step1Params] Meta object:",t.meta),u.value.driversLimited===void 0&&(u.value.driversLimited=!1)});const u=M(()=>o.osgo),h=g=>t.getLocalizedName(g,a.value||"uz"),_=M({get:()=>u.value.vehicle?.carType?.id||"",set:g=>{if(!o.isEditable)return;const m=t.carTypes.find(k=>k.id===g);m&&(u.value.vehicle||(u.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),u.value.vehicle.carType=m,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),T=M({get:()=>u.value.period?.id||"",set:g=>{if(!o.isEditable)return;const m=t.periods.find(k=>k.id===g);m&&(u.value.period=m,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),w=M({get:()=>(u.value.driversLimited===void 0&&(u.value.driversLimited=!1),u.value.driversLimited?"true":"false"),set:g=>{o.isEditable&&(u.value.driversLimited=g==="true",u.value.driversLimited||(u.value.incidentCoeff=void 0),l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),c=M({get:()=>u.value.incidentCoeff?.toString()||"",set:g=>{if(!o.isEditable)return;const m=parseFloat(g);isNaN(m)||(u.value.incidentCoeff=m,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),N=M({get:()=>u.value.drivedArea?.id||"",set:g=>{const m=t.findDrivedArea(g);m&&(u.value.drivedArea=m)}});return(g,m)=>(p(),f("div",Ct,[s(t).fetching?(p(),f("div",Lt,[m[6]||(m[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,i(s(d)("common.loading")),1)])):s(t).error?(p(),f("div",Yt,[m[7]||(m[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,i(s(t).error),1),e("button",{onClick:m[0]||(m[0]=k=>s(t).fetchMeta(!0)),class:"btn-retry"},i(s(d)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(p(),f("div",Ft,[m[10]||(m[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,i(s(d)("common.loading")),1),e("p",Rt,[ke(" isLoaded: "+i(s(t).isLoaded),1),m[8]||(m[8]=e("br",null,null,-1)),ke(" carTypes: "+i(s(t).carTypes.length),1),m[9]||(m[9]=e("br",null,null,-1)),ke(" meta: "+i(s(t).meta?"exists":"null"),1)])])):(p(),f("div",Ut,[e("div",Wt,[e("h2",Bt,i(s(d)("step1.title")),1),e("p",zt,i(s(d)("step1.description")),1)]),e("div",jt,[e("div",qt,[e("h3",Ht,i(s(d)("step1.vehicleType")),1),e("div",Gt,[ve(e("select",{"onUpdate:modelValue":m[1]||(m[1]=k=>_.value=k),class:"input",disabled:!s(o).isEditable},[e("option",Kt,i(s(d)("step1.vehicleTypePlaceholder")),1),(p(!0),f(ae,null,ge(s(t).carTypes,k=>(p(),f("option",{key:k.id,value:k.id},i(h(k)),9,Zt))),128))],8,Jt),[[De,_.value]]),m[11]||(m[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",Qt,[e("h3",Xt,i(s(d)("step1.period")),1),e("div",es,[ve(e("select",{"onUpdate:modelValue":m[2]||(m[2]=k=>T.value=k),class:"input",disabled:!s(o).isEditable},[e("option",ss,i(s(d)("step1.periodPlaceholder")),1),(p(!0),f(ae,null,ge(s(t).periods,k=>(p(),f("option",{key:k.id,value:k.id},i(h(k)),9,as))),128))],8,ts),[[De,T.value]]),m[12]||(m[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",is,[e("h3",os,i(s(d)("step1.driversLimited")),1),e("div",ls,[ve(e("select",{"onUpdate:modelValue":m[3]||(m[3]=k=>w.value=k),class:"input",disabled:!s(o).isEditable},[e("option",ns,i(s(d)("step1.driversLimitedNo"))+" - "+i(s(d)("step1.driversLimitedNoDesc")),1),e("option",cs,i(s(d)("step1.driversLimitedYes"))+" - "+i(s(d)("step1.driversLimitedYesDesc")),1)],8,rs),[[De,w.value]]),m[13]||(m[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),W(re,{name:"slide-down"},{default:ne(()=>[u.value.driversLimited?(p(),f("div",us,[e("h3",ds,i(s(d)("step1.incidentFrequency")),1),e("div",ps,[ve(e("select",{"onUpdate:modelValue":m[4]||(m[4]=k=>c.value=k),class:"input",disabled:!s(o).isEditable},[e("option",fs,i(s(d)("step1.incidentFrequencyPlaceholder")),1),(p(!0),f(ae,null,ge(s(t).incidentFrequencies,k=>(p(),f("option",{key:k.id,value:k.coefficient},i(h(k)),9,hs))),128))],8,vs),[[De,c.value]]),m[14]||(m[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])])):C("",!0)]),_:1}),e("div",ms,[e("h3",_s,i(s(d)("step1.usageTerritory")),1),e("div",bs,[ve(e("select",{"onUpdate:modelValue":m[5]||(m[5]=k=>N.value=k),class:"input",disabled:!s(o).isEditable},[e("option",gs,i(s(d)("step1.usageTerritoryPlaceholder")),1),(p(!0),f(ae,null,ge(s(t).drivedAreas,k=>(p(),f("option",{key:k.id,value:k.id},i(h(k)),9,$s))),128))],8,ys),[[De,N.value]]),m[15]||(m[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),s(o).calculatedPremium>0?(p(),f("div",Ss,[e("div",ws,[e("div",Ds,[m[16]||(m[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,i(s(d)("step1.premium")),1)]),e("div",xs,i(s(Me)(s(o).calculatedPremium)),1)])])):C("",!0)])]))]))}}),ks=se(Ns,[["__scopeId","data-v-280ea21b"]]),As=["for"],Ms={key:0,class:"text-error"},Ps={class:"input-wrapper"},Os={key:0,class:"input-icon input-icon-left"},Vs=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Ts={key:2,class:"input-icon input-icon-right"},Is={key:1,class:"input-message"},Es={key:0,class:"error-message"},Cs={key:1,class:"helper-text"},Ls={key:2,class:"input-count"},Ys=te({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(n,{expose:o,emit:t}){const l=n,a=t,{locale:d}=ce(),u=M(()=>{if(l.type==="date")return d.value==="uz"?"uz-UZ":"ru-RU"}),h=F(null),_=M(()=>`input-${Math.random().toString(36).substr(2,9)}`),T=M({get:()=>{const I=String(l.modelValue||"");if(l.dateMask&&I){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(I)||/^\d{2}-\d{2}-\d{4}$/.test(I))return I;if(/^\d{4}-\d{2}-\d{2}$/.test(I)){const D=I.split("-");return`${D[2]}-${D[1]}-${D[0]}`}}return I},set:I=>{if(l.uppercase&&(I=I.toUpperCase()),l.dateMask&&I){if(/^\d{4}-\d{2}-\d{2}$/.test(I)){a("update:modelValue",I);return}if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const D=I.split("-");a("update:modelValue",`${D[2]}-${D[1]}-${D[0]}`);return}a("update:modelValue",I);return}a("update:modelValue",I)}}),w=I=>{const D=I.target;let O=D.value;if(l.uppercase&&(O=O.toUpperCase(),D.value!==O&&(D.value=O)),l.dateMask){const q=L(O);D.value!==q&&(D.value=q),a("update:modelValue",q),a("input",q);return}l.mask&&(O=Q(O)),a("update:modelValue",O),a("input",O)},c=()=>{if(l.dateMask&&T.value){const I=String(T.value);if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const D=I.split("-"),O=`${D[2]}-${D[1]}-${D[0]}`,q=new Date(O);isNaN(q.getTime())||a("update:modelValue",O)}}a("blur")},N=()=>{a("focus")},g=I=>{},m=()=>{a("enter")},k=()=>{a("update:modelValue",""),h.value?.focus()},Q=I=>{if(l.dateMask)return L(I);if(!l.mask)return I;let D="",O=0;const q=I.replace(/\D/g,"");for(let ie=0;ie<l.mask.length&&O<q.length;ie++){const X=l.mask[ie];X==="#"?(D+=q[O],O++):D+=X}return D},L=I=>{const O=I.replace(/\D/g,"").slice(0,8);return O.length===0?"":O.length<=2?O:O.length<=4?`${O.slice(0,2)}-${O.slice(2)}`:`${O.slice(0,2)}-${O.slice(2,4)}-${O.slice(4)}`},$=()=>{h.value?.focus()},H=()=>{h.value?.blur()};return Oe(()=>{l.autofocus&&$()}),o({focus:$,blur:H}),(I,D)=>(p(),f("div",{class:ee(["input-field",{"has-error":n.error}])},[n.label?(p(),f("label",{key:0,class:"input-label",for:_.value},[ke(i(n.label)+" ",1),n.required?(p(),f("span",Ms,"*")):C("",!0)],8,As)):C("",!0),e("div",Ps,[n.icon?(p(),f("div",Os,[e("i",{class:ee(n.icon)},null,2)])):C("",!0),ve(e("input",{id:_.value,ref_key:"inputRef",ref:h,"onUpdate:modelValue":D[0]||(D[0]=O=>T.value=O),type:n.dateMask?"text":n.type,placeholder:n.dateMask?n.placeholder||"DD-MM-YYYY":n.placeholder,disabled:n.disabled,readonly:n.readonly,maxlength:n.dateMask?10:n.maxLength,autocomplete:n.autocomplete,inputmode:n.dateMask?"numeric":n.inputMode,lang:u.value,class:ee(["input",{"input-with-icon-left":n.icon,"input-with-icon-right":n.clearable||n.loading,"input-error":n.error}]),onInput:w,onBlur:c,onFocus:N,onKeypress:g,onKeydown:Je(m,["enter"])},null,42,Vs),[[Ge,T.value]]),n.clearable&&T.value&&!n.disabled&&!n.readonly?(p(),f("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:k},[...D[1]||(D[1]=[e("i",{class:"bx bx-x"},null,-1)])])):C("",!0),n.loading?(p(),f("div",Ts,[...D[2]||(D[2]=[e("div",{class:"spinner-small"},null,-1)])])):C("",!0)]),n.helperText||n.error?(p(),f("div",Is,[n.error?(p(),f("span",Es,i(n.error),1)):n.helperText?(p(),f("span",Cs,i(n.helperText),1)):C("",!0)])):C("",!0),n.showCount&&n.maxLength?(p(),f("div",Ls,i(T.value.length)+" / "+i(n.maxLength),1)):C("",!0)],2))}}),Le=se(Ys,[["__scopeId","data-v-4eb39aee"]]);function Fs(n){if(!n)return{valid:!1,error:"Государственный номер обязателен"};const o=n.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(o)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Rs(n){if(!n)return{valid:!1,error:"Серия техпаспорта обязательна"};const o=n.toUpperCase();return/^[A-Z]{2,3}$/.test(o)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Us(n){return n?/^\d+$/.test(n)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Ws={class:"step-container"},Bs={class:"step-header"},zs={class:"step-title"},js={class:"step-description"},qs={class:"step-content"},Hs={class:"form-section"},Gs={class:"form-section"},Js={class:"form-section"},Ks={class:"form-section"},Zs=["disabled"],Qs={key:0,class:"spinner"},Xs={key:0,class:"alert alert-error"},ea={key:0,class:"vehicle-info-card"},ta={class:"card-header"},sa={class:"card-content"};const aa={class:"vehicle-info-grid"},ia={key:0,class:"vehicle-info-item"},oa={class:"vehicle-info-label"},la={class:"vehicle-info-value"},ra={key:1,class:"vehicle-info-item"},na={class:"vehicle-info-label"},ca={class:"vehicle-info-value"},ua={key:2,class:"vehicle-info-item"},da={class:"vehicle-info-label"},pa={class:"vehicle-info-value"},va={key:3,class:"vehicle-info-item"},fa={class:"vehicle-info-label"},ha={class:"vehicle-info-value"},ma={key:4,class:"vehicle-info-item"},_a={class:"vehicle-info-label"},ba={class:"vehicle-info-value"},ya={key:1,class:"vehicle-info-empty"},ga=te({__name:"Step2Vehicle",setup(n){const o=pe();Ne();const t=fe(),{t:l}=ce(),a=M(()=>o.osgo),d=F({}),u=M(()=>!!(a.value.vehicle?.govNumber&&a.value.vehicle?.techPassportSeries&&a.value.vehicle?.techPassportNumber&&Object.keys(d.value).length===0)),h=M(()=>{if(!a.value.vehicle)return 0;const w=a.value.vehicle;let c=0;return w.techPassportIssueDate&&c++,(w.modelName||w.model)&&c++,(w.createdYear||w.year)&&c++,w.engineNumber&&c++,w.bodyNumber&&c++,c}),_=w=>{if(!a.value.vehicle)return;let c;switch(w){case"govNumber":c=Fs(a.value.vehicle.govNumber);break;case"techPassportSeries":c=Rs(a.value.vehicle.techPassportSeries);break;case"techPassportNumber":c=Us(a.value.vehicle.techPassportNumber);break}c&&!c.valid?d.value[w]=c.error||"":delete d.value[w]},T=async()=>{if(_("govNumber"),_("techPassportSeries"),_("techPassportNumber"),Object.keys(d.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await o.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",a.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(a.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(w,c)=>{const N=Le;return p(),f("div",Ws,[e("div",Bs,[e("h2",zs,i(s(l)("step2.title")),1),e("p",js,i(s(l)("step2.description")),1)]),e("div",qs,[e("div",Hs,[W(N,{modelValue:a.value.vehicle.govNumber,"onUpdate:modelValue":c[0]||(c[0]=g=>a.value.vehicle.govNumber=g),label:s(l)("step2.govNumber"),placeholder:s(l)("step2.govNumberPlaceholder"),disabled:!s(o).isEditable,error:d.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:c[1]||(c[1]=g=>_("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Gs,[W(N,{modelValue:a.value.vehicle.techPassportSeries,"onUpdate:modelValue":c[2]||(c[2]=g=>a.value.vehicle.techPassportSeries=g),label:s(l)("step2.techPassportSeries"),placeholder:s(l)("step2.techPassportSeriesPlaceholder"),disabled:!s(o).isEditable,error:d.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:c[3]||(c[3]=g=>_("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Js,[W(N,{modelValue:a.value.vehicle.techPassportNumber,"onUpdate:modelValue":c[4]||(c[4]=g=>a.value.vehicle.techPassportNumber=g),label:s(l)("step2.techPassportNumber"),placeholder:s(l)("step2.techPassportNumberPlaceholder"),disabled:!s(o).isEditable,error:d.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:c[5]||(c[5]=g=>_("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Ks,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!u.value||s(o).vehicleVerifying,onClick:T},[s(o).vehicleVerifying?(p(),f("span",Qs)):(p(),f(ae,{key:1},[c[6]||(c[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(s(o).vehicleVerified?s(l)("step2.verified"):s(l)("step2.verify")),1)],64))],8,Zs)]),s(o).vehicleVerifyError?(p(),f("div",Xs,[c[7]||(c[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,i(s(o).vehicleVerifyError),1)])):C("",!0),W(re,{name:"fade"},{default:ne(()=>[s(o).vehicleVerified&&a.value.vehicle?(p(),f("div",ea,[e("div",ta,[c[8]||(c[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,i(s(l)("step2.vehicleFound")),1)]),e("div",sa,[C("",!0),e("div",aa,[a.value.vehicle?.techPassportIssueDate?(p(),f("div",ia,[e("div",oa,i(s(l)("step2.techPassportIssueDate")),1),e("div",la,i(s(Ce)(a.value.vehicle.techPassportIssueDate)),1)])):C("",!0),a.value.vehicle?.modelName||a.value.vehicle?.model?(p(),f("div",ra,[e("div",na,i(s(l)("step2.model")),1),e("div",ca,i(a.value.vehicle?.modelName||a.value.vehicle?.model||"-"),1)])):C("",!0),a.value.vehicle?.createdYear||a.value.vehicle?.year?(p(),f("div",ua,[e("div",da,i(s(l)("step2.year")),1),e("div",pa,i(a.value.vehicle?.createdYear||a.value.vehicle?.year||"-"),1)])):C("",!0),a.value.vehicle?.engineNumber?(p(),f("div",va,[e("div",fa,i(s(l)("step2.engineNumber")),1),e("div",ha,i(a.value.vehicle.engineNumber),1)])):C("",!0),a.value.vehicle?.bodyNumber?(p(),f("div",ma,[e("div",_a,i(s(l)("step2.bodyNumber")),1),e("div",ba,i(a.value.vehicle.bodyNumber),1)])):C("",!0)]),h.value===0?(p(),f("div",ya,i(s(l)("step2.vehicleNotFound")),1)):C("",!0)])])):C("",!0)]),_:1})])])}}}),$a=se(ga,[["__scopeId","data-v-3ead2593"]]),Sa={class:"step-container"},wa={class:"step-header"},Da={class:"step-title"},xa={class:"step-description"},Na={class:"step-content"},ka={class:"subsection"},Aa={class:"subsection-title"},Ma={class:"form-section"},Pa={class:"form-section"},Oa={class:"form-section"},Va={class:"form-section"},Ta=["disabled"],Ia={key:0,class:"spinner"},Ea={key:0,class:"info-card success"},Ca={class:"card-header"},La={class:"card-content"},Ya={class:"info-grid"},Fa={class:"info-item"},Ra={class:"info-label"},Ua={class:"info-value"},Wa={class:"info-item"},Ba={class:"info-label"},za={class:"info-value"},ja={class:"info-item info-item-wide"},qa={class:"info-label"},Ha={class:"info-value"},Ga={class:"info-item"},Ja={class:"info-label"},Ka={class:"info-value"},Za={class:"info-item"},Qa={class:"info-label"},Xa={class:"info-value"},ei={class:"info-item"},ti={class:"info-label"},si={class:"info-value"},ai={class:"info-item"},ii={class:"info-label"},oi={class:"info-value"},li={class:"info-item"},ri={class:"info-label"},ni={class:"info-value"},ci={class:"info-item"},ui={class:"info-label"},di={class:"info-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value"},hi={class:"info-item"},mi={class:"info-label"},_i={class:"info-value"},bi={class:"form-section"},yi={class:"checkbox-label"},gi=["disabled"],$i={key:0,class:"subsection"},Si={class:"subsection-title"},wi={class:"form-section"},Di={class:"form-section"},xi={class:"form-section"},Ni={class:"form-section"},ki=["disabled"],Ai={key:0,class:"spinner"},Mi={key:0,class:"info-card success"},Pi={class:"card-header"},Oi={class:"card-content"},Vi={class:"info-grid"},Ti={class:"info-item"},Ii={class:"info-label"},Ei={class:"info-value"},Ci={class:"info-item"},Li={class:"info-label"},Yi={class:"info-value"},Fi={class:"info-item info-item-wide"},Ri={class:"info-label"},Ui={class:"info-value"},Wi={class:"info-item"},Bi={class:"info-label"},zi={class:"info-value"},ji={class:"info-item"},qi={class:"info-label"},Hi={class:"info-value"},Gi={class:"info-item"},Ji={class:"info-label"},Ki={class:"info-value"},Zi={class:"info-item"},Qi={class:"info-label"},Xi={class:"info-value"},eo={class:"info-item"},to={class:"info-label"},so={class:"info-value"},ao={class:"info-item"},io={class:"info-label"},oo={class:"info-value"},lo={class:"info-item"},ro={class:"info-label"},no={class:"info-value"},co={class:"info-item"},uo={class:"info-label"},po={class:"info-value"},vo=te({__name:"Step3Owner",setup(n){const o=pe(),t=fe(),{locale:l,t:a}=ce(),d=M(()=>o.osgo),u=M(()=>o.owner),h=M(()=>o.applicant),_=async()=>{try{await o.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},T=async()=>{try{await o.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(w,c)=>{const N=Le;return p(),f("div",Sa,[e("div",wa,[e("h2",Da,i(s(a)("step3.title")),1),e("p",xa,i(s(a)("step3.description")),1)]),e("div",Na,[e("div",ka,[e("h3",Aa,i(s(a)("step3.owner")),1),e("div",Ma,[W(N,{modelValue:u.value.passportSeries,"onUpdate:modelValue":c[0]||(c[0]=g=>u.value.passportSeries=g),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(o).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Pa,[W(N,{modelValue:u.value.passportNumber,"onUpdate:modelValue":c[1]||(c[1]=g=>u.value.passportNumber=g),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(o).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Oa,[W(N,{modelValue:u.value.birthDate,"onUpdate:modelValue":c[2]||(c[2]=g=>u.value.birthDate=g),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(o).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Va,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(o).ownerVerifying,onClick:_},[s(o).ownerVerifying?(p(),f("span",Ia)):(p(),f(ae,{key:1},[c[7]||(c[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(s(o).ownerVerified?s(a)("step3.verified"):s(a)("step3.verifyOwner")),1)],64))],8,Ta)]),W(re,{name:"fade"},{default:ne(()=>[s(o).ownerVerified&&u.value.id?(p(),f("div",Ea,[e("div",Ca,[c[8]||(c[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(s(a)("step3.ownerFound")),1)]),e("div",La,[e("div",Ya,[e("div",Fa,[e("div",Ra,i(s(a)("step3.passportIssueDate")),1),e("div",Ua,i(u.value.passportIssueDate?s(Ce)(u.value.passportIssueDate):"-"),1)]),e("div",Wa,[e("div",Ba,i(s(a)("step3.pinfl")),1),e("div",za,i(u.value.nationalIdentifier||"-"),1)]),e("div",ja,[e("div",qa,i(s(a)("step3.issuedBy")),1),e("div",Ha,i(u.value.passportIssuedBy||"-"),1)]),e("div",Ga,[e("div",Ja,i(s(a)("step3.lastName")),1),e("div",Ka,i(u.value.lastName||"-"),1)]),e("div",Za,[e("div",Qa,i(s(a)("step3.firstName")),1),e("div",Xa,i(u.value.firstName||"-"),1)]),e("div",ei,[e("div",ti,i(s(a)("step3.middleName")),1),e("div",si,i(u.value.middleName||"-"),1)]),e("div",ai,[e("div",ii,i(s(a)("step3.gender")),1),e("div",oi,i(u.value.gender?s(Ue)(u.value.gender,s(l).value):"-"),1)]),e("div",li,[e("div",ri,i(s(a)("step3.country")),1),e("div",ni,i(u.value.country?.langValue1||"-"),1)]),e("div",ci,[e("div",ui,i(s(a)("step3.region")),1),e("div",di,i(u.value.region?.langValue1||"-"),1)]),e("div",pi,[e("div",vi,i(s(a)("step3.district")),1),e("div",fi,i(u.value.district?.langValue1||"-"),1)]),e("div",hi,[e("div",mi,i(s(a)("step3.street")),1),e("div",_i,i(u.value.street||"-"),1)])])])])):C("",!0)]),_:1})]),e("div",bi,[e("label",yi,[ve(e("input",{"onUpdate:modelValue":c[3]||(c[3]=g=>d.value.applicantIsOwner=g),type:"checkbox",class:"checkbox",disabled:!s(o).isEditable},null,8,gi),[[Ke,d.value.applicantIsOwner]]),e("span",null,i(s(a)("step3.ownerIsApplicant")),1)])]),W(re,{name:"slide-down"},{default:ne(()=>[d.value.applicantIsOwner?C("",!0):(p(),f("div",$i,[e("h3",Si,i(s(a)("step3.applicant")),1),e("div",wi,[W(N,{modelValue:h.value.passportSeries,"onUpdate:modelValue":c[4]||(c[4]=g=>h.value.passportSeries=g),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(o).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Di,[W(N,{modelValue:h.value.passportNumber,"onUpdate:modelValue":c[5]||(c[5]=g=>h.value.passportNumber=g),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(o).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",xi,[W(N,{modelValue:h.value.birthDate,"onUpdate:modelValue":c[6]||(c[6]=g=>h.value.birthDate=g),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(o).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Ni,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(o).applicantVerifying,onClick:T},[s(o).applicantVerifying?(p(),f("span",Ai)):(p(),f(ae,{key:1},[c[9]||(c[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(s(o).applicantVerified?s(a)("step3.verified"):s(a)("step3.verifyApplicant")),1)],64))],8,ki)]),W(re,{name:"fade"},{default:ne(()=>[s(o).applicantVerified&&h.value.id?(p(),f("div",Mi,[e("div",Pi,[c[10]||(c[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(s(a)("step3.applicantFound")),1)]),e("div",Oi,[e("div",Vi,[e("div",Ti,[e("div",Ii,i(s(a)("step3.passportIssueDate")),1),e("div",Ei,i(h.value.passportIssueDate?s(Ce)(h.value.passportIssueDate):"-"),1)]),e("div",Ci,[e("div",Li,i(s(a)("step3.pinfl")),1),e("div",Yi,i(h.value.nationalIdentifier||"-"),1)]),e("div",Fi,[e("div",Ri,i(s(a)("step3.issuedBy")),1),e("div",Ui,i(h.value.passportIssuedBy||"-"),1)]),e("div",Wi,[e("div",Bi,i(s(a)("step3.lastName")),1),e("div",zi,i(h.value.lastName||"-"),1)]),e("div",ji,[e("div",qi,i(s(a)("step3.firstName")),1),e("div",Hi,i(h.value.firstName||"-"),1)]),e("div",Gi,[e("div",Ji,i(s(a)("step3.middleName")),1),e("div",Ki,i(h.value.middleName||"-"),1)]),e("div",Zi,[e("div",Qi,i(s(a)("step3.gender")),1),e("div",Xi,i(h.value.gender?s(Ue)(h.value.gender,s(l).value):"-"),1)]),e("div",eo,[e("div",to,i(s(a)("step3.country")),1),e("div",so,i(h.value.country?.langValue1||"-"),1)]),e("div",ao,[e("div",io,i(s(a)("step3.region")),1),e("div",oo,i(h.value.region?.langValue1||"-"),1)]),e("div",lo,[e("div",ro,i(s(a)("step3.district")),1),e("div",no,i(h.value.district?.langValue1||"-"),1)]),e("div",co,[e("div",uo,i(s(a)("step3.street")),1),e("div",po,i(h.value.street||"-"),1)])])])])):C("",!0)]),_:1})]))]),_:1})])])}}}),fo=se(vo,[["__scopeId","data-v-62def220"]]),ho={class:"step-container"},mo={class:"step-header"},_o={class:"step-title"},bo={class:"step-description"},yo={class:"step-content"},go={class:"summary-section"},$o={class:"section-title"},So={class:"summary-card"},wo={class:"card-title"},Do={class:"card-content"},xo={class:"info-row"},No={class:"info-value-full"},ko={class:"summary-card"},Ao={class:"card-title"},Mo={class:"card-content"},Po={class:"info-row"},Oo={class:"info-value-full"},Vo={class:"summary-card"},To={class:"card-title"},Io={class:"card-content"},Eo={class:"info-row"},Co={class:"info-value-full"},Lo={class:"summary-card"},Yo={class:"card-title"},Fo={class:"card-content"},Ro={class:"info-row"},Uo={class:"info-value-full"},Wo={class:"info-row"},Bo={class:"info-value-full"},zo={class:"info-row"},jo={class:"info-value-full"},qo={class:"summary-card"},Ho={class:"card-title"},Go={class:"card-content"},Jo={class:"info-row"},Ko={class:"info-value-full"},Zo={class:"summary-section"},Qo={class:"section-title"},Xo={class:"form-section"},el={class:"form-section"},tl={key:0,class:"form-section"},sl={class:"premium-section"},al={class:"premium-card-large"},il={class:"premium-header"},ol={class:"premium-amount-large"},ll=te({__name:"Step5Summary",setup(n){const o=pe(),t=Ne();fe(),Pe();const l=M(()=>o.osgo),a=M(()=>o.owner),d=M(()=>o.applicant);M(()=>o.fundData),F(!1);const u=M({get:()=>(l.value.applicantIsOwner?a.value:d.value).phone||"",set:c=>{l.value.applicantIsOwner?(a.value.phone=c,l.value.party=a.value):(d.value.phone=c,l.value.party=d.value)}}),{locale:h,t:_}=ce(),T=()=>l.value.period?t.getLocalizedName(l.value.period,h.value||"uz"):"-",w=()=>l.value.drivedArea?t.getLocalizedName(l.value.drivedArea,h.value||"uz"):"-";return(c,N)=>{const g=Le;return p(),f("div",ho,[e("div",mo,[e("h2",_o,i(s(_)("step5.title")),1),e("p",bo,i(s(_)("step5.description")),1)]),e("div",yo,[e("div",go,[e("h3",$o,[N[2]||(N[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,i(s(_)("step5.policyInfo")),1)]),e("div",So,[e("div",wo,i(s(_)("step3.owner")),1),e("div",Do,[e("div",xo,[e("span",No,i(a.value.name||"-")+i(a.value.birthDate?` (${a.value.birthDate})`:""),1)])])]),e("div",ko,[e("div",Ao,i(s(_)("step3.applicant")),1),e("div",Mo,[e("div",Po,[e("span",Oo,i((l.value.applicantIsOwner?a.value:d.value).name||"-")+i((l.value.applicantIsOwner?a.value:d.value).birthDate?` (${(l.value.applicantIsOwner?a.value:d.value).birthDate})`:""),1)])])]),e("div",Vo,[e("div",To,i(s(_)("step5.vehicleInfo")),1),e("div",Io,[e("div",Eo,[e("span",Co,i(l.value.vehicle?.modelName||l.value.vehicle?.model||"-")+" "+i(l.value.vehicle?.govNumber?` (${l.value.vehicle.govNumber})`:""),1)])])]),e("div",Lo,[e("div",Yo,i(s(_)("step5.policyInfo")),1),e("div",Fo,[e("div",Ro,[e("span",Uo,i(T()),1)]),e("div",Wo,[e("span",Bo,i(w()),1)]),e("div",zo,[e("span",jo,i(l.value.driversLimited?s(_)("step5.driversLimited",{count:l.value.drivers?.length||0}):s(_)("step5.noDriversLimitation")),1)])])]),e("div",qo,[e("div",Ho,i(s(_)("step5.compensation")),1),e("div",Go,[e("div",Jo,[e("span",Ko,i(s(Me)(s(Ee))),1)])])])]),e("div",Zo,[e("h3",Qo,[N[3]||(N[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,i(s(_)("step5.contactInfo")),1)]),e("div",Xo,[W(g,{modelValue:u.value,"onUpdate:modelValue":N[0]||(N[0]=m=>u.value=m),label:s(_)("step5.phone"),placeholder:s(_)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!s(o).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",el,[W(g,{modelValue:l.value.contractStartDate,"onUpdate:modelValue":N[1]||(N[1]=m=>l.value.contractStartDate=m),label:s(_)("step5.startDate"),type:"text","date-mask":"",placeholder:s(_)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(o).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),l.value.contractEndDate?(p(),f("div",tl,[W(g,{"model-value":l.value.contractEndDate,label:s(_)("step5.endDate"),type:"text","date-mask":"",placeholder:s(_)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):C("",!0)]),e("div",sl,[e("div",al,[e("div",il,[N[4]||(N[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,i(s(_)("step5.premium")),1)]),e("div",ol,i(s(Me)(s(o).calculatedPremium)),1)])])])])}}}),rl=se(ll,[["__scopeId","data-v-8e729bee"]]),nl={class:"step-container"},cl={class:"step-header"},ul={class:"step-title"},dl={class:"step-description"},pl={class:"step-content"},vl={class:"premium-section"},fl={class:"premium-card-large"},hl={class:"premium-header"},ml={class:"premium-amount-large"},_l={class:"payment-section"},bl={class:"section-title"},yl={class:"payment-buttons"},gl=["disabled"],$l={key:0,class:"payment-selected-indicator"},Sl=["disabled"],wl={key:0,class:"payment-selected-indicator"},Dl=["disabled"],xl={key:0,class:"payment-selected-indicator"},Nl={class:"status-section"},kl=["disabled"],Al={key:0,class:"ml-1"},Ml={key:0,class:"error-message mt-2"},Pl={key:0,class:"success-card"},Ol={class:"success-title"},Vl={class:"success-description"},Tl={class:"policy-details"},Il={class:"policy-row"},El={class:"policy-label"},Cl={class:"policy-value"},Ll={class:"policy-row"},Yl={class:"policy-label"},Fl={class:"policy-value"},Rl=te({__name:"Step6Payment",setup(n){const o=pe(),t=fe();Pe();const{t:l,locale:a}=ce(),d=M(()=>o.osgo),u=M(()=>o.fundData);M(()=>(d.value.applicantIsOwner?o.owner:o.applicant).phone||"");const h=F(!1),_=F(null),T=F(0),w=F(null);let c=null;const N=M({get:()=>o.selectedPaymentMethod,set:L=>{o.selectedPaymentMethod=L}}),g=M(()=>{if(!w.value)return"";const L=w.value.toLowerCase(),$=a.value,H=$==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],I=$==="ru"?["ошибка","не получена"]:["xato","olindi"];return H.some(D=>L.includes(D))?"status-success":I.some(D=>L.includes(D))?"status-error":"status-info"}),m=M(()=>g.value==="status-success"?"bx bx-check-circle":g.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),k=L=>{N.value===L?N.value=null:N.value=L,t.isTelegramWebApp.value&&t.hapticImpact("light")},Q=async()=>{if(!d.value.id){_.value=l("errors.createApplicationFailed");return}try{h.value=!0,_.value=null,w.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await o.fetchFundData(),u.value?.seria&&u.value?.number?(w.value=l("step5.paymentSuccess"),t.isTelegramWebApp.value&&t.hapticNotification("success")):u.value?w.value=l("step5.paymentProcessing"):w.value=l("step5.paymentNotReceived"),T.value=15,c&&clearInterval(c),c=window.setInterval(()=>{T.value>0?T.value--:c&&(clearInterval(c),c=null)},1e3)}catch(L){console.error("[Step6Payment] Check status error:",L),_.value=L.message||l("errors.paymentFailed"),w.value=l("errors.paymentFailed"),t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{h.value=!1}};return Ze(()=>{c&&clearInterval(c)}),(L,$)=>(p(),f("div",nl,[e("div",cl,[e("h2",ul,i(s(l)("step5.payment")),1),e("p",dl,i(s(l)("step5.paymentDescription")),1)]),e("div",pl,[e("div",vl,[e("div",fl,[e("div",hl,[$[3]||($[3]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,i(s(l)("step5.premium")),1)]),e("div",ml,i(s(Me)(s(o).calculatedPremium)),1)])]),e("div",_l,[e("h3",bl,[$[4]||($[4]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,i(s(l)("step5.paymentMethod")),1)]),e("div",yl,[e("button",{type:"button",class:ee(["payment-btn payme",{"payment-btn-selected":N.value==="payme"}]),disabled:h.value,onClick:$[0]||($[0]=H=>k("payme"))},[$[6]||($[6]=e("div",{class:"payment-icon"},"💳",-1)),$[7]||($[7]=e("div",{class:"payment-name"},"Payme",-1)),N.value==="payme"?(p(),f("div",$l,[...$[5]||($[5]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):C("",!0)],10,gl),e("button",{type:"button",class:ee(["payment-btn click",{"payment-btn-selected":N.value==="click"}]),disabled:h.value,onClick:$[1]||($[1]=H=>k("click"))},[$[9]||($[9]=e("div",{class:"payment-icon"},"🔵",-1)),$[10]||($[10]=e("div",{class:"payment-name"},"Click",-1)),N.value==="click"?(p(),f("div",wl,[...$[8]||($[8]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):C("",!0)],10,Sl),e("button",{type:"button",class:ee(["payment-btn uzum",{"payment-btn-selected":N.value==="uzum"}]),disabled:h.value,onClick:$[2]||($[2]=H=>k("uzum"))},[$[12]||($[12]=e("div",{class:"payment-icon"},"🟣",-1)),$[13]||($[13]=e("div",{class:"payment-name"},"Uzum",-1)),N.value==="uzum"?(p(),f("div",xl,[...$[11]||($[11]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):C("",!0)],10,Dl)])]),e("div",Nl,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!T.value||h.value||!d.value.id,onClick:Q},[$[14]||($[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,i(s(l)("step5.checkStatus")),1),T.value?(p(),f("span",Al,"("+i(T.value)+")",1)):C("",!0)],8,kl),W(re,{name:"fade"},{default:ne(()=>[_.value?(p(),f("div",Ml,[$[15]||($[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,i(_.value),1)])):C("",!0)]),_:1}),W(re,{name:"fade"},{default:ne(()=>[w.value?(p(),f("div",{key:0,class:ee(["status-text",g.value])},[e("i",{class:ee(m.value)},null,2),e("span",null,i(w.value),1)],2)):C("",!0)]),_:1})]),W(re,{name:"fade"},{default:ne(()=>[d.value.id&&u.value&&u.value.seria?(p(),f("div",Pl,[$[16]||($[16]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Ol,i(s(l)("step5.success")),1),e("p",Vl,i(s(l)("step5.policyIssued")),1),e("div",Tl,[e("div",Il,[e("span",El,i(s(l)("step5.policySeries"))+":",1),e("span",Cl,i(u.value.seria),1)]),e("div",Ll,[e("span",Yl,i(s(l)("step5.policyNumber"))+":",1),e("span",Fl,i(u.value.number),1)])])])):C("",!0)]),_:1})])]))}}),Ul=se(Rl,[["__scopeId","data-v-0cbe2eac"]]),Wl={class:"min-h-screen flex flex-col"},Bl={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},zl={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},jl={class:"max-w-3xl mx-auto"},ql={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},Hl=te({__name:"index",setup(n){const o=pe(),t=Ne(),l=fe();return Oe(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),o.initialize(),o.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{o.currentStep>0?o.previousStep():l.close()});const d=ye(()=>o.osgo,()=>{o.saveToSession()},{deep:!0});Fe(()=>{d()})}),Fe(()=>{o.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),Qe({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,d)=>(p(),f("div",Wl,[e("header",Bl,[W(St)]),e("main",zl,[e("div",jl,[W(re,{name:"fade",mode:"out-in"},{default:ne(()=>[s(o).currentStep===s(E).PARAMS?(p(),xe(ks,{key:s(E).PARAMS})):s(o).currentStep===s(E).VEHICLE?(p(),xe($a,{key:s(E).VEHICLE})):s(o).currentStep===s(E).OWNER?(p(),xe(fo,{key:s(E).OWNER})):s(o).currentStep===s(E).SUMMARY?(p(),xe(rl,{key:s(E).SUMMARY})):s(o).currentStep===s(E).PAYMENT?(p(),xe(Ul,{key:s(E).PAYMENT})):C("",!0)]),_:1})])]),e("footer",ql,[W(Et)])]))}}),tr=se(Hl,[["__scopeId","data-v-4214c6a6"]]);export{tr as default};
