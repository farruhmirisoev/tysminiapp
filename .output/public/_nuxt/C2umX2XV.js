import{e as qe,f as Ie,g as Le,r as Y,S as F,h as T,C as We,i as ie,j as Ue,k as oe,l as de,m as He,n as Fe,c as f,o as d,F as ue,p as ke,q as s,s as te,t as l,a as e,v as Ge,b as z,x as Se,y as R,z as Me,d as Ve,A as ge,B as Ae,T as he,w as me,D as Je,E as Ze,G as Qe,H as Xe,I as et,u as tt,J as Oe}from"./BGyPEWeH.js";import{_ as le}from"./DlAUqK2U.js";import{_ as st}from"./DgM-zN9R.js";function at(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Ee={exports:{}},it=Ee.exports,Ke;function ot(){return Ke||(Ke=1,(function(c,a){(function(t,o){c.exports=o()})(it,(function(){var t=1e3,o=6e4,i=36e5,h="millisecond",n="second",y="minute",m="hour",C="day",w="week",u="month",A="quarter",N="year",W="date",O="Invalid Date",v=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,$=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(I){var g=["th","st","nd","rd"],p=I%100;return"["+I+(g[(p-20)%10]||g[p]||g[0])+"]"}},K=function(I,g,p){var D=String(I);return!D||D.length>=g?I:""+Array(g+1-D.length).join(p)+I},x={s:K,z:function(I){var g=-I.utcOffset(),p=Math.abs(g),D=Math.floor(p/60),b=p%60;return(g<=0?"+":"-")+K(D,2,"0")+":"+K(b,2,"0")},m:function I(g,p){if(g.date()<p.date())return-I(p,g);var D=12*(p.year()-g.year())+(p.month()-g.month()),b=g.clone().add(D,u),V=p-b<0,E=g.clone().add(D+(V?-1:1),u);return+(-(D+(p-b)/(V?b-E:E-b))||0)},a:function(I){return I<0?Math.ceil(I)||0:Math.floor(I)},p:function(I){return{M:u,y:N,w,d:C,D:W,h:m,m:y,s:n,ms:h,Q:A}[I]||String(I||"").toLowerCase().replace(/s$/,"")},u:function(I){return I===void 0}},k="en",P={};P[k]=S;var J="$isDayjsObject",Q=function(I){return I instanceof _e||!(!I||!I[J])},se=function I(g,p,D){var b;if(!g)return k;if(typeof g=="string"){var V=g.toLowerCase();P[V]&&(b=V),p&&(P[V]=p,b=V);var E=g.split("-");if(!b&&E.length>1)return I(E[0])}else{var B=g.name;P[B]=g,b=B}return!D&&b&&(k=b),b||!D&&k},H=function(I,g){if(Q(I))return I.clone();var p=typeof g=="object"?g:{};return p.date=I,p.args=arguments,new _e(p)},U=x;U.l=se,U.i=Q,U.w=function(I,g){return H(I,{locale:g.$L,utc:g.$u,x:g.$x,$offset:g.$offset})};var _e=(function(){function I(p){this.$L=se(p.locale,null,!0),this.parse(p),this.$x=this.$x||p.x||{},this[J]=!0}var g=I.prototype;return g.parse=function(p){this.$d=(function(D){var b=D.date,V=D.utc;if(b===null)return new Date(NaN);if(U.u(b))return new Date;if(b instanceof Date)return new Date(b);if(typeof b=="string"&&!/Z$/i.test(b)){var E=b.match(v);if(E){var B=E[2]-1||0,j=(E[7]||"0").substring(0,3);return V?new Date(Date.UTC(E[1],B,E[3]||1,E[4]||0,E[5]||0,E[6]||0,j)):new Date(E[1],B,E[3]||1,E[4]||0,E[5]||0,E[6]||0,j)}}return new Date(b)})(p),this.init()},g.init=function(){var p=this.$d;this.$y=p.getFullYear(),this.$M=p.getMonth(),this.$D=p.getDate(),this.$W=p.getDay(),this.$H=p.getHours(),this.$m=p.getMinutes(),this.$s=p.getSeconds(),this.$ms=p.getMilliseconds()},g.$utils=function(){return U},g.isValid=function(){return this.$d.toString()!==O},g.isSame=function(p,D){var b=H(p);return this.startOf(D)<=b&&b<=this.endOf(D)},g.isAfter=function(p,D){return H(p)<this.startOf(D)},g.isBefore=function(p,D){return this.endOf(D)<H(p)},g.$g=function(p,D,b){return U.u(p)?this[D]:this.set(b,p)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(p,D){var b=this,V=!!U.u(D)||D,E=U.p(p),B=function(ne,Z){var ve=U.w(b.$u?Date.UTC(b.$y,Z,ne):new Date(b.$y,Z,ne),b);return V?ve:ve.endOf(C)},j=function(ne,Z){return U.w(b.toDate()[ne].apply(b.toDate("s"),(V?[0,0,0,0]:[23,59,59,999]).slice(Z)),b)},q=this.$W,G=this.$M,X=this.$D,re="set"+(this.$u?"UTC":"");switch(E){case N:return V?B(1,0):B(31,11);case u:return V?B(1,G):B(0,G+1);case w:var pe=this.$locale().weekStart||0,ye=(q<pe?q+7:q)-pe;return B(V?X-ye:X+(6-ye),G);case C:case W:return j(re+"Hours",0);case m:return j(re+"Minutes",1);case y:return j(re+"Seconds",2);case n:return j(re+"Milliseconds",3);default:return this.clone()}},g.endOf=function(p){return this.startOf(p,!1)},g.$set=function(p,D){var b,V=U.p(p),E="set"+(this.$u?"UTC":""),B=(b={},b[C]=E+"Date",b[W]=E+"Date",b[u]=E+"Month",b[N]=E+"FullYear",b[m]=E+"Hours",b[y]=E+"Minutes",b[n]=E+"Seconds",b[h]=E+"Milliseconds",b)[V],j=V===C?this.$D+(D-this.$W):D;if(V===u||V===N){var q=this.clone().set(W,1);q.$d[B](j),q.init(),this.$d=q.set(W,Math.min(this.$D,q.daysInMonth())).$d}else B&&this.$d[B](j);return this.init(),this},g.set=function(p,D){return this.clone().$set(p,D)},g.get=function(p){return this[U.p(p)]()},g.add=function(p,D){var b,V=this;p=Number(p);var E=U.p(D),B=function(G){var X=H(V);return U.w(X.date(X.date()+Math.round(G*p)),V)};if(E===u)return this.set(u,this.$M+p);if(E===N)return this.set(N,this.$y+p);if(E===C)return B(1);if(E===w)return B(7);var j=(b={},b[y]=o,b[m]=i,b[n]=t,b)[E]||1,q=this.$d.getTime()+p*j;return U.w(q,this)},g.subtract=function(p,D){return this.add(-1*p,D)},g.format=function(p){var D=this,b=this.$locale();if(!this.isValid())return b.invalidDate||O;var V=p||"YYYY-MM-DDTHH:mm:ssZ",E=U.z(this),B=this.$H,j=this.$m,q=this.$M,G=b.weekdays,X=b.months,re=b.meridiem,pe=function(Z,ve,we,De){return Z&&(Z[ve]||Z(D,V))||we[ve].slice(0,De)},ye=function(Z){return U.s(B%12||12,Z,"0")},ne=re||function(Z,ve,we){var De=Z<12?"AM":"PM";return we?De.toLowerCase():De};return V.replace($,(function(Z,ve){return ve||(function(we){switch(we){case"YY":return String(D.$y).slice(-2);case"YYYY":return U.s(D.$y,4,"0");case"M":return q+1;case"MM":return U.s(q+1,2,"0");case"MMM":return pe(b.monthsShort,q,X,3);case"MMMM":return pe(X,q);case"D":return D.$D;case"DD":return U.s(D.$D,2,"0");case"d":return String(D.$W);case"dd":return pe(b.weekdaysMin,D.$W,G,2);case"ddd":return pe(b.weekdaysShort,D.$W,G,3);case"dddd":return G[D.$W];case"H":return String(B);case"HH":return U.s(B,2,"0");case"h":return ye(1);case"hh":return ye(2);case"a":return ne(B,j,!0);case"A":return ne(B,j,!1);case"m":return String(j);case"mm":return U.s(j,2,"0");case"s":return String(D.$s);case"ss":return U.s(D.$s,2,"0");case"SSS":return U.s(D.$ms,3,"0");case"Z":return E}return null})(Z)||E.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(p,D,b){var V,E=this,B=U.p(D),j=H(p),q=(j.utcOffset()-this.utcOffset())*o,G=this-j,X=function(){return U.m(E,j)};switch(B){case N:V=X()/12;break;case u:V=X();break;case A:V=X()/3;break;case w:V=(G-q)/6048e5;break;case C:V=(G-q)/864e5;break;case m:V=G/i;break;case y:V=G/o;break;case n:V=G/t;break;default:V=G}return b?V:U.a(V)},g.daysInMonth=function(){return this.endOf(u).$D},g.$locale=function(){return P[this.$L]},g.locale=function(p,D){if(!p)return this.$L;var b=this.clone(),V=se(p,D,!0);return V&&(b.$L=V),b},g.clone=function(){return U.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},I})(),Te=_e.prototype;return H.prototype=Te,[["$ms",h],["$s",n],["$m",y],["$H",m],["$W",C],["$M",u],["$y",N],["$D",W]].forEach((function(I){Te[I[1]]=function(g){return this.$g(g,I[0],I[1])}})),H.extend=function(I,g){return I.$i||(I(g,_e,H),I.$i=!0),H},H.locale=se,H.isDayjs=Q,H.unix=function(I){return H(1e3*I)},H.en=P[k],H.Ls=P,H.p={},H}))})(Ee)),Ee.exports}var lt=ot();const $e=at(lt);function Ce(c,a="сум"){return c==null||isNaN(c)?`0 ${a}`:`${c.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${a}`}function Be(c){return c?$e(c).format("DD.MM.YYYY"):""}function rt(c){return c?c.split(",")[0].trim().split(/\s+/).map(t=>{if(!t)return t;const o=t.charAt(0).toUpperCase(),i=t.slice(1).toLowerCase();return o+i}).join(" "):""}function je(c,a="ru"){if(!c)return"";const t=String(c).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?a==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?a==="uz"?"Ayol":"Женский":String(c)}function nt(c){if(!c)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(c))return c;if(/^\d{2}-\d{2}-\d{4}$/.test(c)){const a=c.split("-");return`${a[2]}-${a[1]}-${a[0]}`}try{return $e(c,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return c}}const be=qe("osgo",()=>{const c=Ie(),a=Le(),t=Y({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),o=Y({passportSeries:"",passportNumber:"",birthDate:""}),i=Y({passportSeries:"",passportNumber:"",birthDate:""}),h=Y(F.PARAMS),n=Y(!1),y=Y(null),m=Y(!1),C=Y(null),w=Y(null),u=Y(null),A=Y(!1),N=Y(null),W=Y(null),O=Y(null),v=Y(null),$=Y(!1),S=Y(!1),K=Y(null),x=Y(!1),k=Y(!1),P=Y(null),J=Y(!1),Q=Y(!1),se=Y(null),H=T(()=>t.value.status==="DRAFT"),U=T(()=>ne(h.value).valid),_e=T(()=>Object.keys(F).length-1),Te=r=>r<=F.OWNER?r+1:r===F.DRIVERS?-1:r,I=T(()=>Te(h.value)),g=T(()=>{const r=I.value;return Math.round(r/_e.value*100)}),p=T(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,_=t.value.period.coefficient||0,M=t.value.drivedArea.coefficient||0;let L=3;t.value.driversLimited&&t.value.incidentCoeff&&(L=t.value.incidentCoeff);const xe=r*_*L*M,ae=xe>5*r?We*5*r:We*xe/100;return Math.round(ae)}),D=T(()=>{const _=(t.value.entriesJournalKt||[]).reduce((M,L)=>M+(L.amount||0),0);return t.value.premium-_}),b=()=>{if(t.value.vehicle?.carType||t.value.period||t.value.drivedArea||t.value.premium>0){t.value.status||(t.value.status="DRAFT"),t.value.contractStartDate||(t.value.contractStartDate=$e().format("YYYY-MM-DD")),t.value.applicantIsOwner===void 0&&(t.value.applicantIsOwner=!0),t.value.driversLimited===void 0&&(t.value.driversLimited=!1),t.value.drivers||(t.value.drivers=[]);return}t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},o.value={passportSeries:"",passportNumber:"",birthDate:""},i.value={passportSeries:"",passportNumber:"",birthDate:""},h.value=F.PARAMS,c.isLoaded&&(t.value.discountType=c.getDefaultDiscountType())};ie(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ie(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ie(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const _=parseInt(r.slice(0,2)),M=c.findDrivedAreaByRegion(_);M&&(t.value.drivedArea=M)}),ie(()=>[t.value.vehicle?.carType?.id,t.value.vehicle?.carType?.tariffCompany,t.value.period?.id,t.value.period?.coefficient,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea?.id,t.value.drivedArea?.coefficient],(r,_)=>{t.value.premium=p.value},{immediate:!0}),ie(()=>t.value.vehicle?.carType,()=>{t.value.premium=p.value},{deep:!0,immediate:!0}),ie(()=>t.value.period,()=>{t.value.premium=p.value},{deep:!0,immediate:!0}),ie(()=>t.value.drivedArea,()=>{t.value.premium=p.value},{deep:!0,immediate:!0}),ie(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const V=async()=>{if(t.value.vehicle){$.value=!0,K.value=null,S.value=!1;try{const r=await a.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),_=r?.result||r;if(r?.error&&!_)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&_&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,_),_?.carType&&c.isLoaded&&(t.value.vehicle.carType=c.findCarType(_.carType.id)),S.value=!0,console.log("[OsgoStore] Vehicle verified:",_);try{const M=await a.getKaskoVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber});if(M.success&&M.id&&M.data){const L=M.data,xe=M.id;let ae=null;if(L.modelId?ae=L.modelId:L.model&&typeof L.model=="object"&&L.model.id?ae=L.model.id:L.model&&typeof L.model=="string"&&(ae=L.model),!ae)try{console.log("[OsgoStore] No model found in vehicle data, fetching default manufacturer and model");const ee=await a.getKaskoManufacturers();if(ee.success&&ee.firstId){const Ye=ee.firstId,ce=await a.getKaskoModels(Ye);ce.success&&ce.firstId&&(ae=ce.firstId,console.log("[OsgoStore] Using default model ID:",ae))}}catch(ee){console.warn("[OsgoStore] Failed to get default manufacturer/model:",ee)}if(ae)try{const ee=await a.getKaskoVehicle2(xe,ae);ee.success&&ee.id?(W.value=ee.id,console.log("[OsgoStore] Kasko vehicle ID obtained (final from getVehicle2):",ee.id)):console.warn("[OsgoStore] getVehicle2 failed, cannot create Kasko contract")}catch(ee){console.warn("[OsgoStore] getVehicle2 error, cannot create Kasko contract:",ee)}else console.warn("[OsgoStore] No model available for Kasko vehicle, cannot create contract")}}catch(M){console.warn("[OsgoStore] Failed to get Kasko vehicle ID:",M)}}catch(r){throw K.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{$.value=!1}}},E=async()=>{x.value=!0,P.value=null,k.value=!1;try{const r=await a.getIndividualByPassport({passportSeries:o.value.passportSeries?.toUpperCase()||"",passportNumber:o.value.passportNumber,birthDate:o.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(o.value={passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate,...r},t.value.beneficiary={...o.value},t.value.applicantIsOwner&&(i.value={passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate,...r},t.value.party={...o.value},Q.value=!0)),k.value=!0,console.log("[OsgoStore] Owner after assignment:",o.value),console.log("[OsgoStore] Owner has id?",!!o.value.id);try{let _=o.value.birthDate;if(_&&_.includes("-")){const L=_.split("-");L.length===3&&L[0].length===4&&(_=`${L[2]}-${L[1]}-${L[0]}`)}const M=await a.getKaskoIndividual({passportSeries:o.value.passportSeries?.toUpperCase()||"",passportNumber:o.value.passportNumber,birthDate:_});M.success&&M.id&&(O.value=M.id,console.log("[OsgoStore] Kasko individual ID obtained:",M.id))}catch(_){console.warn("[OsgoStore] Failed to get Kasko individual ID:",_)}}catch(r){throw P.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{x.value=!1}},B=async()=>{J.value=!0,se.value=null,Q.value=!1;try{const r=await a.getIndividualByPassport({passportSeries:i.value.passportSeries?.toUpperCase()||"",passportNumber:i.value.passportNumber,birthDate:i.value.birthDate});if(console.log("[OsgoStore] API result for applicant:",r),r&&(i.value={passportSeries:i.value.passportSeries,passportNumber:i.value.passportNumber,birthDate:i.value.birthDate,...r},t.value.party={...i.value}),Q.value=!0,console.log("[OsgoStore] Applicant after assignment:",i.value),!t.value.applicantIsOwner)try{let _=i.value.birthDate;if(_&&_.includes("-")){const L=_.split("-");L.length===3&&L[0].length===4&&(_=`${L[2]}-${L[1]}-${L[0]}`)}const M=await a.getKaskoIndividual({passportSeries:i.value.passportSeries?.toUpperCase()||"",passportNumber:i.value.passportNumber,birthDate:_});M.success&&M.id&&(O.value=M.id,console.log("[OsgoStore] Kasko applicant ID obtained:",M.id))}catch(_){console.warn("[OsgoStore] Failed to get Kasko applicant ID:",_)}}catch(r){throw se.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{J.value=!1}},j=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const _=nt(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:_});const M=await a.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:_});if(console.log("[OsgoStore] Driver verification result:",M),!M||!M.id)throw new Error("Driver verification failed: invalid response");const L={...r,...M,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",L),L}catch(_){throw console.error("[OsgoStore] Driver verification failed:",_),_}},q=r=>{t.value.drivers||(t.value.drivers=[]);const _={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(_),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},G=(r,_)=>{t.value.drivers[r]&&(t.value.drivers[r]=_)},X=r=>{t.value.drivers.splice(r,1)},re=(r,_,M)=>t.value.drivers.some(L=>L.passportSeries===r&&L.passportNumber===_&&L.birthDate===M),pe=()=>{if(!o.value.passportSeries||!o.value.passportNumber||!o.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(re(o.value.passportSeries,o.value.passportNumber,o.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}q({passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},ye=()=>{re(i.value.passportSeries,i.value.passportNumber,i.value.birthDate)||q({passportSeries:i.value.passportSeries,passportNumber:i.value.passportNumber,birthDate:i.value.birthDate})},ne=r=>{switch(r){case F.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case F.VEHICLE:return{valid:S.value};case F.OWNER:return{valid:k.value&&(t.value.applicantIsOwner||Q.value)};case F.DRIVERS:return{valid:!0};case F.SUMMARY:const _=t.value.applicantIsOwner?o.value.id:i.value.id;return{valid:!!(o.value.id&&_&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(M=>M.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case F.PAYMENT:return{valid:!!(t.value.id&&N.value)};default:return{valid:!1}}};return{osgo:t,owner:o,applicant:i,currentStep:h,saving:n,saveError:y,fetching:m,fetchError:C,fundData:w,fundError:u,fetchingFundData:A,selectedPaymentMethod:N,kaskoVehicleId:W,kaskoIndividualId:O,kaskoContractStatus:v,vehicleVerifying:$,vehicleVerified:S,vehicleVerifyError:K,ownerVerifying:x,ownerVerified:k,ownerVerifyError:P,applicantVerifying:J,applicantVerified:Q,applicantVerifyError:se,isEditable:H,canProceedToNextStep:U,totalSteps:_e,displayStepNumber:I,progressPercentage:g,calculatedPremium:p,amountPayable:D,initialize:b,verifyVehicle:V,verifyOwner:E,verifyApplicant:B,verifyDriver:j,addDriver:q,updateDriver:G,removeDriver:X,hasDriver:re,addOwnerAsDriver:pe,addApplicantAsDriver:ye,validateStepData:ne,nextStep:()=>{h.value===F.OWNER?h.value=F.SUMMARY:h.value<F.PAYMENT&&h.value++},previousStep:()=>{h.value===F.SUMMARY?h.value=F.OWNER:h.value>0&&h.value--},goToStep:r=>{r>=0&&r<_e.value&&(h.value=r)},createPolicy:async()=>{n.value=!0,y.value=null;try{let r=null;try{r=await a.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(fe){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",fe),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const _=t.value.applicantIsOwner?{...o.value}:{...i.value};_.phone&&(_.phone=_.phone.replace(/[+()-]/g,""));const M={...o.value},L=t.value.discountType||c.meta?.beneficiary?.find(({coefficient:fe})=>fe===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const ee={party:_,beneficiary:M,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:L,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Ye={user:r,osgo:ee};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:_.id,name:_.name},beneficiary:{id:M.id,name:M.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:L?.id}}});const ce=await a.createOsgoApplication(Ye);if(!ce||typeof ce!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ce),new Error("Failed to create policy: invalid response");t.value.id=ce,t.value.applicantIsOwner?(o.value.phone=_.phone,t.value.party=o.value):(i.value.phone=_.phone,t.value.party=i.value),console.log("[OsgoStore] Policy created:",ce);try{const fe=W.value,Re=O.value,Pe=(t.value.party?.phone||(t.value.applicantIsOwner?o.value.phone:i.value.phone)||"").replace(/[+()-]/g,"").replace(/^998/,"998");if(fe&&Re&&Pe&&Pe.startsWith("998"))try{const Ne=await a.createKaskoContract(fe,Re,Pe,"PAYME");Ne&&Ne.success===!0?(v.value="success",console.log("[OsgoStore] Kasko contract created successfully as gift bonus")):(v.value="failed",console.warn("[OsgoStore] Kasko contract creation returned non-success result:",Ne))}catch(Ne){v.value="failed",console.error("[OsgoStore] Failed to create Kasko contract:",Ne)}else console.warn("[OsgoStore] Kasko IDs or phone not available, skipping Kasko contract creation",{vehicleId:fe,individualId:Re,formattedPhone:Pe}),v.value="failed"}catch(fe){v.value="failed",console.error("[OsgoStore] Failed to create Kasko contract (outer catch):",fe)}return ce}catch(r){throw y.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{n.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");n.value=!0,y.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?o.value:i.value,beneficiary:o.value};await a.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw y.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{n.value=!1}},fetchPolicy:async r=>{m.value=!0,C.value=null;try{const _=await a.fetchOsgoEntity(r);if(t.value=_,_.party?.id){const M=await a.fetchIndividualEntity(_.party.id);i.value=M,t.value.party=M}if(_.beneficiary?.id){const M=await a.fetchIndividualEntity(_.beneficiary.id);o.value=M,t.value.beneficiary=M}if(c.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=c.findCarType(t.value.vehicle.carType.id)),c.isLoaded&&t.value.period&&(t.value.period=c.findPeriod(t.value.period.id)),c.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=c.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const M=Math.max(...t.value.drivers.map(L=>L.incidentFrequency?.coefficient||0));t.value.incidentCoeff=M}console.log("[OsgoStore] Policy fetched:",r)}catch(_){throw C.value=_.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",_),_}finally{m.value=!1}},fetchFundData:async()=>{if(t.value.id){A.value=!0,u.value=null;try{const r=await a.getFundPolicy(t.value.id);w.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){u.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{A.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:o.value,applicant:i.value,currentStep:h.value,kaskoVehicleId:W.value,kaskoIndividualId:O.value};sessionStorage.setItem(Ue.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Ue.OSGO_DRAFT);if(!r)return!1;const _=JSON.parse(r);return t.value=_.osgo,o.value=_.owner,i.value=_.applicant,h.value=_.currentStep||0,_.kaskoVehicleId!==void 0&&(W.value=_.kaskoVehicleId),_.kaskoIndividualId!==void 0&&(O.value=_.kaskoIndividualId),console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Ue.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{b(),S.value=!1,k.value=!1,Q.value=!1,w.value=null,y.value=null,C.value=null,W.value=null,O.value=null,v.value=null}}}),ct={class:"language-switcher"},ut=["onClick"],dt=oe({__name:"LanguageSwitcher",setup(c){const{locale:a,locales:t}=de();He();const o=T(()=>a.value),i=T(()=>t.value.filter(n=>n.code!==a.value)),h=n=>{a.value=n,typeof window<"u"&&localStorage.setItem("app-language",n),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Fe(()=>{if(typeof window<"u"){const n=localStorage.getItem("app-language");n&&(n==="ru"||n==="uz")&&(a.value=n)}}),(n,y)=>(d(),f("div",ct,[(d(!0),f(ue,null,ke(s(i),m=>(d(),f("button",{key:m.code,class:te(["lang-btn",{active:s(o)===m.code}]),onClick:C=>h(m.code)},l(m.code.toUpperCase()),11,ut))),128))]))}}),pt=le(dt,[["__scopeId","data-v-e748ef5d"]]),vt={class:"progress-bar-container"},ft={class:"progress-track"},ht={class:"steps-container"},mt=["onClick"],_t={key:0,class:"step-check"},bt={key:1,class:"step-number"},yt={class:"step-label"},gt=oe({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(c){const a=c,{t}=de(),o=T(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),i=y=>y<=2?y:y+1,h=T(()=>(a.currentStep+1)/a.totalSteps*100),n=y=>{console.log("Step clicked:",y)};return(y,m)=>(d(),f("div",vt,[e("div",ft,[e("div",{class:"progress-fill",style:Ge({width:`${h.value}%`})},null,4)]),e("div",ht,[(d(!0),f(ue,null,ke(o.value,(C,w)=>(d(),f("div",{key:w,class:"step-wrapper",onClick:u=>n(w)},[e("div",{class:te(["step-circle",{"step-active":i(w)===c.currentStep,"step-completed":i(w)<c.currentStep&&i(w)!==s(F).DRIVERS,"step-pending":i(w)>c.currentStep}])},[i(w)<c.currentStep&&i(w)!==s(F).DRIVERS?(d(),f("span",_t,"✓")):(d(),f("span",bt,l(w+1),1))],2),e("div",yt,l(C),1)],8,mt))),128))])]))}}),$t=le(gt,[["__scopeId","data-v-7805c614"]]),St={class:"fixed-header"},wt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},kt={class:"flex items-center justify-between mb-3"},Dt={class:"flex items-center gap-3"},xt={class:"text-base font-bold text-text"},Nt=oe({__name:"AppHeader",setup(c){const a=be(),{t}=de(),o=T(()=>a.currentStep),i=T(()=>a.totalSteps);return(h,n)=>{const y=pt,m=$t;return d(),f("header",St,[e("div",wt,[e("div",kt,[e("div",Dt,[n[1]||(n[1]=e("div",{class:"w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg"},[e("img",{src:st,alt:"Temiryo'l Sug'urta Logo"})],-1)),e("div",null,[e("div",xt,l(s(t)("header.appTitle")),1),n[0]||(n[0]=e("div",{class:"text-xs text-text-light"}," Temiryo'l Sug'urta ",-1))])]),z(y)]),z(m,{"current-step":o.value,"total-steps":i.value},null,8,["current-step","total-steps"])])])}}}),At=le(Nt,[["__scopeId","data-v-60581198"]]),Ot={class:"fixed-footer"},It={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},Tt=["disabled"],Pt={key:1,class:"flex-1 max-w-[160px]"},Mt={class:"flex-1 text-center"},Vt={class:"text-sm text-text-light font-medium"},Et=["disabled"],Ct={key:0,class:"spinner"},Lt={key:0},Ft={key:1},Yt={key:2},Rt={key:3,class:"text-lg bx bx-chevron-right"},Ut=oe({__name:"AppFooter",setup(c){const a=be(),t=Se(),o=Le(),{t:i}=de(),h=Y(!1),n=Y(null),y=Y(null),m=T(()=>a.currentStep),C=T(()=>a.totalSteps),w=T(()=>a.displayStepNumber),u=T(()=>m.value===0),A=T(()=>m.value===F.PAYMENT),N=T(()=>a.canProceedToNextStep),W=T(()=>a.saving||a.fetching||h.value),O=()=>{u.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),a.previousStep())},v=async()=>{if(!N.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(i("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(m.value===F.VEHICLE&&!a.vehicleVerified)await a.verifyVehicle();else if(m.value===F.OWNER)a.ownerVerified||await a.verifyOwner(),!a.osgo.applicantIsOwner&&!a.applicantVerified&&await a.verifyApplicant();else if(m.value===F.SUMMARY)a.osgo.id||(await a.createPolicy(),console.log("[AppFooter] Policy created:",a.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(m.value===F.PAYMENT){if(!a.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const S={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[a.selectedPaymentMethod],K=a.osgo.id,x=a.osgo.party?.phone||"",k=a.calculatedPremium;if(!K||!x||!k){const P="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:K,phone:x,amount:k}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(P));return}try{h.value=!0,n.value=null,y.value=null,await o.sendPaymentLink(S,K,x,k),y.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(P){n.value=P.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",P),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(n.value))}finally{h.value=!1}return}A.value?console.log("[AppFooter] Last step reached"):a.nextStep()}catch($){console.error("[AppFooter] Error:",$),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert($.message||i("errors.unknown")))}};return($,S)=>(d(),f("footer",Ot,[e("div",It,[u.value?(d(),f("div",Pt)):(d(),f("button",{key:0,type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:W.value,onClick:O},[S[0]||(S[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,l($.$t("common.previous")),1)],8,Tt)),e("div",Mt,[e("div",Vt,l($.$t("common.step",{current:w.value,total:C.value})),1)]),e("button",{type:"button",class:te(["btn flex-1 max-w-[160px]",{"btn-primary":!A.value||m.value!==s(F).PAYMENT,"btn-success":A.value&&m.value===s(F).PAYMENT}]),disabled:!N.value||W.value,onClick:v},[W.value?(d(),f("span",Ct)):(d(),f(ue,{key:1},[m.value===s(F).SUMMARY&&!s(a).osgo.id?(d(),f("span",Lt,l($.$t("step5.confirm")),1)):A.value&&m.value===s(F).PAYMENT?(d(),f("span",Ft,[S[1]||(S[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,l($.$t("step5.payment")),1)])):(d(),f("span",Yt,l($.$t("common.next")),1)),!A.value&&m.value!==s(F).SUMMARY?(d(),f("i",Rt)):R("",!0)],64))],10,Et)])]))}}),Wt=le(Ut,[["__scopeId","data-v-803790f7"]]),Bt={class:"step-container"},zt={key:0,class:"loading-state"},Kt={key:1,class:"error-state"},jt={key:2,class:"error-state"},qt={class:"debug-info"},Ht={key:3},Gt={class:"step-header"},Jt={class:"step-title"},Zt={class:"step-description"},Qt={class:"step-content"},Xt={class:"form-section"},es={class:"section-title"},ts={class:"select-wrapper"},ss=["disabled"],as=["value"],is={class:"form-section"},os={class:"section-title"},ls={class:"select-wrapper"},rs=["disabled"],ns=["value"],cs={class:"form-section",style:{display:"none"}},us={class:"section-title"},ds={class:"select-wrapper"},ps=["disabled"],vs={value:"false"},fs={value:"true"},hs={key:0,class:"form-section"},ms={class:"section-title"},_s={class:"select-wrapper"},bs=["disabled"],ys=["value"],gs={class:"form-section"},$s={class:"section-title"},Ss={class:"select-wrapper"},ws=["disabled"],ks=["value"],Ds={key:0,class:"premium-card"},xs={class:"premium-card-content"},Ns={class:"premium-label"},As={class:"premium-amount"},Os=oe({__name:"Step1Params",setup(c){const a=be(),t=Ie(),o=Se(),{locale:i,t:h}=de(),n=T(()=>a.osgo),y=()=>{if(!(!t.isLoaded||!(!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id))){if(t.carTypes.length>0&&!n.value.vehicle?.carType?.id){const v=t.carTypes[0];n.value.vehicle?n.value.vehicle.carType=v:n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:"",carType:v}}if(t.periods.length>0&&!n.value.period?.id){const v=t.periods[0];n.value.period=v}if(t.drivedAreas.length>0&&!n.value.drivedArea?.id){const v=t.drivedAreas[0];n.value.drivedArea=v}n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited&&!n.value.incidentCoeff&&t.incidentFrequencies.length>0&&(n.value.incidentCoeff=t.incidentFrequencies[0].coefficient),n.value.premium=a.calculatedPremium,Me(()=>{a.canProceedToNextStep})}};ie(()=>t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0,O=>{O&&!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id&&Me(()=>{y()})},{immediate:!0}),Fe(async()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Periods count:",t.periods.length),await Me();const O=!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id;t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0&&O&&y()});const m=O=>{const v=t.getLocalizedName(O,i.value||"uz");return rt(v)},C=T(()=>a.calculatedPremium),w=T({get:()=>{const O=n.value.vehicle?.carType?.id;return!O&&t.isLoaded&&t.carTypes.length>0?t.carTypes[0].id:O||""},set:O=>{if(!a.isEditable)return;const v=t.carTypes.find($=>$.id===O);v&&(n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=v,o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),u=T({get:()=>{const O=n.value.period?.id;return!O&&t.isLoaded&&t.periods.length>0?t.periods[0].id:O||""},set:O=>{if(!a.isEditable)return;const v=t.periods.find($=>$.id===O);v&&(n.value.period=v,o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),A=T({get:()=>(n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited?"true":"false"),set:O=>{a.isEditable&&(n.value.driversLimited=O==="true",n.value.driversLimited||(n.value.incidentCoeff=void 0),o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),N=T({get:()=>n.value.incidentCoeff?.toString()||"",set:O=>{if(!a.isEditable)return;const v=parseFloat(O);isNaN(v)||(n.value.incidentCoeff=v,o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),W=T({get:()=>{const O=n.value.drivedArea?.id;return!O&&t.isLoaded&&t.drivedAreas.length>0?t.drivedAreas[0].id:O||""},set:O=>{if(!a.isEditable)return;const v=t.findDrivedArea(O);v&&(n.value.drivedArea=v,o.isTelegramWebApp.value&&o.hapticImpact("light"))}});return ie(()=>[w.value,u.value,W.value,t.isLoaded],([O,v,$,S])=>{if(!S)return;let K=!1;if(O&&!n.value.vehicle?.carType?.id&&t.carTypes.length>0){const x=t.carTypes.find(k=>k.id===O);x&&(n.value.vehicle?n.value.vehicle.carType=x:n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:"",carType:x},K=!0)}if(v&&!n.value.period?.id&&t.periods.length>0){const x=t.periods.find(k=>k.id===v);x&&(n.value.period=x,K=!0)}if($&&!n.value.drivedArea?.id&&t.drivedAreas.length>0){const x=t.drivedAreas.find(k=>k.id===$);x&&(n.value.drivedArea=x,K=!0)}K&&Me(()=>{a.calculatedPremium})},{immediate:!0}),(O,v)=>(d(),f("div",Bt,[s(t).fetching?(d(),f("div",zt,[v[6]||(v[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,l(s(h)("common.loading")),1)])):s(t).error?(d(),f("div",Kt,[v[7]||(v[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,l(s(t).error),1),e("button",{onClick:v[0]||(v[0]=$=>s(t).fetchMeta(!0)),class:"btn-retry"},l(s(h)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(d(),f("div",jt,[v[10]||(v[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,l(s(h)("common.loading")),1),e("p",qt,[Ve(" isLoaded: "+l(s(t).isLoaded),1),v[8]||(v[8]=e("br",null,null,-1)),Ve(" carTypes: "+l(s(t).carTypes.length),1),v[9]||(v[9]=e("br",null,null,-1)),Ve(" meta: "+l(s(t).meta?"exists":"null"),1)])])):(d(),f("div",Ht,[e("div",Gt,[e("h2",Jt,l(s(h)("step1.title")),1),e("p",Zt,l(s(h)("step1.description")),1)]),e("div",Qt,[e("div",Xt,[e("h3",es,l(s(h)("step1.vehicleType")),1),e("div",ts,[ge(e("select",{"onUpdate:modelValue":v[1]||(v[1]=$=>w.value=$),class:"input",disabled:!s(a).isEditable},[(d(!0),f(ue,null,ke(s(t).carTypes,$=>(d(),f("option",{key:$.id,value:$.id},l(m($)),9,as))),128))],8,ss),[[Ae,w.value]]),v[11]||(v[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",is,[e("h3",os,l(s(h)("step1.period")),1),e("div",ls,[ge(e("select",{"onUpdate:modelValue":v[2]||(v[2]=$=>u.value=$),class:"input",disabled:!s(a).isEditable},[(d(!0),f(ue,null,ke(s(t).periods,$=>(d(),f("option",{key:$.id,value:$.id},l(m($)),9,ns))),128))],8,rs),[[Ae,u.value]]),v[12]||(v[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",cs,[e("h3",us,l(s(h)("step1.driversLimited")),1),e("div",ds,[ge(e("select",{"onUpdate:modelValue":v[3]||(v[3]=$=>A.value=$),class:"input",disabled:!s(a).isEditable},[e("option",vs,l(s(h)("step1.driversLimitedNo"))+" - "+l(s(h)("step1.driversLimitedNoDesc")),1),e("option",fs,l(s(h)("step1.driversLimitedYes"))+" - "+l(s(h)("step1.driversLimitedYesDesc")),1)],8,ps),[[Ae,A.value]]),v[13]||(v[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),z(he,{name:"slide-down"},{default:me(()=>[n.value.driversLimited?(d(),f("div",hs,[e("h3",ms,l(s(h)("step1.incidentFrequency")),1),e("div",_s,[ge(e("select",{"onUpdate:modelValue":v[4]||(v[4]=$=>N.value=$),class:"input",disabled:!s(a).isEditable},[(d(!0),f(ue,null,ke(s(t).incidentFrequencies,$=>(d(),f("option",{key:$.id,value:$.coefficient},l(m($)),9,ys))),128))],8,bs),[[Ae,N.value]]),v[14]||(v[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])])):R("",!0)]),_:1}),e("div",gs,[e("h3",$s,l(s(h)("step1.usageTerritory")),1),e("div",Ss,[ge(e("select",{"onUpdate:modelValue":v[5]||(v[5]=$=>W.value=$),class:"input",disabled:!s(a).isEditable},[(d(!0),f(ue,null,ke(s(t).drivedAreas,$=>(d(),f("option",{key:$.id,value:$.id},l(m($)),9,ks))),128))],8,ws),[[Ae,W.value]]),v[15]||(v[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),C.value>0?(d(),f("div",Ds,[e("div",xs,[e("div",Ns,[v[16]||(v[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,l(s(h)("step1.premium")),1)]),e("div",As,l(s(Ce)(C.value)),1)])])):R("",!0)])]))]))}}),Is=le(Os,[["__scopeId","data-v-2e93b1ac"]]),Ts=["for"],Ps={key:0,class:"text-error"},Ms={class:"input-wrapper"},Vs={key:0,class:"input-icon input-icon-left"},Es=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Cs={key:2,class:"input-icon input-icon-right"},Ls={key:1,class:"input-message"},Fs={key:0,class:"error-message"},Ys={key:1,class:"helper-text"},Rs={key:2,class:"input-count"},Us=oe({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(c,{expose:a,emit:t}){const o=c,i=t,{locale:h}=de(),n=T(()=>{if(o.type==="date")return h.value==="uz"?"uz-UZ":"ru-RU"}),y=Y(null),m=T(()=>`input-${Math.random().toString(36).substr(2,9)}`),C=T({get:()=>{const x=String(o.modelValue||"");if(o.dateMask&&x){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(x)||/^\d{2}-\d{2}-\d{4}$/.test(x))return x;if(/^\d{4}-\d{2}-\d{2}$/.test(x)){const k=x.split("-");return`${k[2]}-${k[1]}-${k[0]}`}}return x},set:x=>{if(o.uppercase&&(x=x.toUpperCase()),o.dateMask&&x){if(/^\d{4}-\d{2}-\d{2}$/.test(x)){i("update:modelValue",x);return}if(/^\d{2}-\d{2}-\d{4}$/.test(x)){const k=x.split("-");i("update:modelValue",`${k[2]}-${k[1]}-${k[0]}`);return}i("update:modelValue",x);return}i("update:modelValue",x)}}),w=x=>{const k=x.target;let P=k.value;if(o.uppercase&&(P=P.toUpperCase(),k.value!==P&&(k.value=P)),o.dateMask){const J=$(P);k.value!==J&&(k.value=J),i("update:modelValue",J),i("input",J);return}o.mask&&(P=v(P)),i("update:modelValue",P),i("input",P)},u=()=>{if(o.dateMask&&C.value){const x=String(C.value);if(/^\d{2}-\d{2}-\d{4}$/.test(x)){const k=x.split("-"),P=`${k[2]}-${k[1]}-${k[0]}`,J=new Date(P);isNaN(J.getTime())||i("update:modelValue",P)}}i("blur")},A=()=>{i("focus")},N=x=>{},W=()=>{i("enter")},O=()=>{i("update:modelValue",""),y.value?.focus()},v=x=>{if(o.dateMask)return $(x);if(!o.mask)return x;let k="",P=0;const J=x.replace(/\D/g,"");for(let Q=0;Q<o.mask.length&&P<J.length;Q++){const se=o.mask[Q];se==="#"?(k+=J[P],P++):k+=se}return k},$=x=>{const P=x.replace(/\D/g,"").slice(0,8);return P.length===0?"":P.length<=2?P:P.length<=4?`${P.slice(0,2)}-${P.slice(2)}`:`${P.slice(0,2)}-${P.slice(2,4)}-${P.slice(4)}`},S=()=>{y.value?.focus()},K=()=>{y.value?.blur()};return Fe(()=>{o.autofocus&&S()}),a({focus:S,blur:K}),(x,k)=>(d(),f("div",{class:te(["input-field",{"has-error":c.error}])},[c.label?(d(),f("label",{key:0,class:"input-label",for:m.value},[Ve(l(c.label)+" ",1),c.required?(d(),f("span",Ps,"*")):R("",!0)],8,Ts)):R("",!0),e("div",Ms,[c.icon?(d(),f("div",Vs,[e("i",{class:te(c.icon)},null,2)])):R("",!0),ge(e("input",{id:m.value,ref_key:"inputRef",ref:y,"onUpdate:modelValue":k[0]||(k[0]=P=>C.value=P),type:c.dateMask?"text":c.type,placeholder:c.dateMask?c.placeholder||"DD-MM-YYYY":c.placeholder,disabled:c.disabled,readonly:c.readonly,maxlength:c.dateMask?10:c.maxLength,autocomplete:c.autocomplete,inputmode:c.dateMask?"numeric":c.inputMode,lang:n.value,class:te(["input",{"input-with-icon-left":c.icon,"input-with-icon-right":c.clearable||c.loading,"input-error":c.error}]),onInput:w,onBlur:u,onFocus:A,onKeypress:N,onKeydown:Ze(W,["enter"])},null,42,Es),[[Je,C.value]]),c.clearable&&C.value&&!c.disabled&&!c.readonly?(d(),f("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:O},[...k[1]||(k[1]=[e("i",{class:"bx bx-x"},null,-1)])])):R("",!0),c.loading?(d(),f("div",Cs,[...k[2]||(k[2]=[e("div",{class:"spinner-small"},null,-1)])])):R("",!0)]),c.helperText||c.error?(d(),f("div",Ls,[c.error?(d(),f("span",Fs,l(c.error),1)):c.helperText?(d(),f("span",Ys,l(c.helperText),1)):R("",!0)])):R("",!0),c.showCount&&c.maxLength?(d(),f("div",Rs,l(C.value.length)+" / "+l(c.maxLength),1)):R("",!0)],2))}}),ze=le(Us,[["__scopeId","data-v-4eb39aee"]]);function Ws(c){if(!c)return{valid:!1,error:"Государственный номер обязателен"};const a=c.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(a)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Bs(c){if(!c)return{valid:!1,error:"Серия техпаспорта обязательна"};const a=c.toUpperCase();return/^[A-Z]{2,3}$/.test(a)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function zs(c){return c?/^\d+$/.test(c)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Ks={class:"step-container"},js={class:"step-header"},qs={class:"step-title"},Hs={class:"step-description"},Gs={class:"step-content"},Js={class:"form-section"},Zs={class:"form-section"},Qs={class:"form-section"},Xs={class:"form-section"},ea=["disabled"],ta={key:0,class:"spinner"},sa={key:0,class:"alert alert-error"},aa={key:0,class:"vehicle-info-card"},ia={class:"card-header"},oa={class:"card-content"};const la={class:"vehicle-info-grid"},ra={key:0,class:"vehicle-info-item"},na={class:"vehicle-info-label"},ca={class:"vehicle-info-value"},ua={key:1,class:"vehicle-info-item"},da={class:"vehicle-info-label"},pa={class:"vehicle-info-value"},va={key:2,class:"vehicle-info-item"},fa={class:"vehicle-info-label"},ha={class:"vehicle-info-value"},ma={key:3,class:"vehicle-info-item"},_a={class:"vehicle-info-label"},ba={class:"vehicle-info-value"},ya={key:4,class:"vehicle-info-item"},ga={class:"vehicle-info-label"},$a={class:"vehicle-info-value"},Sa={key:1,class:"vehicle-info-empty"},wa=oe({__name:"Step2Vehicle",setup(c){const a=be();Ie();const t=Se(),{t:o}=de(),i=T(()=>a.osgo),h=Y({}),n=T(()=>!!(i.value.vehicle?.govNumber&&i.value.vehicle?.techPassportSeries&&i.value.vehicle?.techPassportNumber&&Object.keys(h.value).length===0)),y=T(()=>{if(!i.value.vehicle)return 0;const w=i.value.vehicle;let u=0;return w.techPassportIssueDate&&u++,(w.modelName||w.model)&&u++,(w.createdYear||w.year)&&u++,w.engineNumber&&u++,w.bodyNumber&&u++,u}),m=w=>{if(!i.value.vehicle)return;let u;switch(w){case"govNumber":u=Ws(i.value.vehicle.govNumber);break;case"techPassportSeries":u=Bs(i.value.vehicle.techPassportSeries);break;case"techPassportNumber":u=zs(i.value.vehicle.techPassportNumber);break}u&&!u.valid?h.value[w]=u.error||"":delete h.value[w]},C=async()=>{if(m("govNumber"),m("techPassportSeries"),m("techPassportNumber"),Object.keys(h.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await a.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",i.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(i.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(w,u)=>{const A=ze;return d(),f("div",Ks,[e("div",js,[e("h2",qs,l(s(o)("step2.title")),1),e("p",Hs,l(s(o)("step2.description")),1)]),e("div",Gs,[e("div",Js,[z(A,{modelValue:i.value.vehicle.govNumber,"onUpdate:modelValue":u[0]||(u[0]=N=>i.value.vehicle.govNumber=N),label:s(o)("step2.govNumber"),placeholder:s(o)("step2.govNumberPlaceholder"),disabled:!s(a).isEditable,error:h.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:u[1]||(u[1]=N=>m("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Zs,[z(A,{modelValue:i.value.vehicle.techPassportSeries,"onUpdate:modelValue":u[2]||(u[2]=N=>i.value.vehicle.techPassportSeries=N),label:s(o)("step2.techPassportSeries"),placeholder:s(o)("step2.techPassportSeriesPlaceholder"),disabled:!s(a).isEditable,error:h.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:u[3]||(u[3]=N=>m("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Qs,[z(A,{modelValue:i.value.vehicle.techPassportNumber,"onUpdate:modelValue":u[4]||(u[4]=N=>i.value.vehicle.techPassportNumber=N),label:s(o)("step2.techPassportNumber"),placeholder:s(o)("step2.techPassportNumberPlaceholder"),disabled:!s(a).isEditable,error:h.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:u[5]||(u[5]=N=>m("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Xs,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!n.value||s(a).vehicleVerifying,onClick:C},[s(a).vehicleVerifying?(d(),f("span",ta)):(d(),f(ue,{key:1},[u[6]||(u[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(a).vehicleVerified?s(o)("step2.verified"):s(o)("step2.verify")),1)],64))],8,ea)]),s(a).vehicleVerifyError?(d(),f("div",sa,[u[7]||(u[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,l(s(a).vehicleVerifyError),1)])):R("",!0),z(he,{name:"fade"},{default:me(()=>[s(a).vehicleVerified&&i.value.vehicle?(d(),f("div",aa,[e("div",ia,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,l(s(o)("step2.vehicleFound")),1)]),e("div",oa,[R("",!0),e("div",la,[i.value.vehicle?.techPassportIssueDate?(d(),f("div",ra,[e("div",na,l(s(o)("step2.techPassportIssueDate")),1),e("div",ca,l(s(Be)(i.value.vehicle.techPassportIssueDate)),1)])):R("",!0),i.value.vehicle?.modelName||i.value.vehicle?.model?(d(),f("div",ua,[e("div",da,l(s(o)("step2.model")),1),e("div",pa,l(i.value.vehicle?.modelName||i.value.vehicle?.model||"-"),1)])):R("",!0),i.value.vehicle?.createdYear||i.value.vehicle?.year?(d(),f("div",va,[e("div",fa,l(s(o)("step2.year")),1),e("div",ha,l(i.value.vehicle?.createdYear||i.value.vehicle?.year||"-"),1)])):R("",!0),i.value.vehicle?.engineNumber?(d(),f("div",ma,[e("div",_a,l(s(o)("step2.engineNumber")),1),e("div",ba,l(i.value.vehicle.engineNumber),1)])):R("",!0),i.value.vehicle?.bodyNumber?(d(),f("div",ya,[e("div",ga,l(s(o)("step2.bodyNumber")),1),e("div",$a,l(i.value.vehicle.bodyNumber),1)])):R("",!0)]),y.value===0?(d(),f("div",Sa,l(s(o)("step2.vehicleNotFound")),1)):R("",!0)])])):R("",!0)]),_:1})])])}}}),ka=le(wa,[["__scopeId","data-v-3ead2593"]]),Da={class:"step-container"},xa={class:"step-header"},Na={class:"step-title"},Aa={class:"step-description"},Oa={class:"step-content"},Ia={class:"subsection"},Ta={class:"subsection-title"},Pa={class:"form-section"},Ma={class:"form-section"},Va={class:"form-section"},Ea={class:"form-section"},Ca=["disabled"],La={key:0,class:"spinner"},Fa={key:0,class:"info-card success"},Ya={class:"card-header"},Ra={class:"card-content"},Ua={class:"info-grid"},Wa={class:"info-item"},Ba={class:"info-label"},za={class:"info-value"},Ka={class:"info-item"},ja={class:"info-label"},qa={class:"info-value"},Ha={class:"info-item info-item-wide"},Ga={class:"info-label"},Ja={class:"info-value"},Za={class:"info-item"},Qa={class:"info-label"},Xa={class:"info-value"},ei={class:"info-item"},ti={class:"info-label"},si={class:"info-value"},ai={class:"info-item"},ii={class:"info-label"},oi={class:"info-value"},li={class:"info-item"},ri={class:"info-label"},ni={class:"info-value"},ci={class:"info-item"},ui={class:"info-label"},di={class:"info-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value"},hi={class:"info-item"},mi={class:"info-label"},_i={class:"info-value"},bi={class:"info-item"},yi={class:"info-label"},gi={class:"info-value"},$i={class:"form-section"},Si={class:"checkbox-label"},wi=["disabled"],ki={key:0,class:"subsection"},Di={class:"subsection-title"},xi={class:"form-section"},Ni={class:"form-section"},Ai={class:"form-section"},Oi={class:"form-section"},Ii=["disabled"],Ti={key:0,class:"spinner"},Pi={key:0,class:"info-card success"},Mi={class:"card-header"},Vi={class:"card-content"},Ei={class:"info-grid"},Ci={class:"info-item"},Li={class:"info-label"},Fi={class:"info-value"},Yi={class:"info-item"},Ri={class:"info-label"},Ui={class:"info-value"},Wi={class:"info-item info-item-wide"},Bi={class:"info-label"},zi={class:"info-value"},Ki={class:"info-item"},ji={class:"info-label"},qi={class:"info-value"},Hi={class:"info-item"},Gi={class:"info-label"},Ji={class:"info-value"},Zi={class:"info-item"},Qi={class:"info-label"},Xi={class:"info-value"},eo={class:"info-item"},to={class:"info-label"},so={class:"info-value"},ao={class:"info-item"},io={class:"info-label"},oo={class:"info-value"},lo={class:"info-item"},ro={class:"info-label"},no={class:"info-value"},co={class:"info-item"},uo={class:"info-label"},po={class:"info-value"},vo={class:"info-item"},fo={class:"info-label"},ho={class:"info-value"},mo=oe({__name:"Step3Owner",setup(c){const a=be(),t=Se(),{locale:o,t:i}=de(),h=T(()=>a.osgo),n=T(()=>a.owner),y=T(()=>a.applicant),m=async()=>{try{await a.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},C=async()=>{try{await a.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(w,u)=>{const A=ze;return d(),f("div",Da,[e("div",xa,[e("h2",Na,l(s(i)("step3.title")),1),e("p",Aa,l(s(i)("step3.description")),1)]),e("div",Oa,[e("div",Ia,[e("h3",Ta,l(s(i)("step3.owner")),1),e("div",Pa,[z(A,{modelValue:n.value.passportSeries,"onUpdate:modelValue":u[0]||(u[0]=N=>n.value.passportSeries=N),label:s(i)("step3.passportSeries"),placeholder:s(i)("step3.passportSeriesPlaceholder"),disabled:!s(a).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Ma,[z(A,{modelValue:n.value.passportNumber,"onUpdate:modelValue":u[1]||(u[1]=N=>n.value.passportNumber=N),label:s(i)("step3.passportNumber"),placeholder:s(i)("step3.passportNumberPlaceholder"),disabled:!s(a).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Va,[z(A,{modelValue:n.value.birthDate,"onUpdate:modelValue":u[2]||(u[2]=N=>n.value.birthDate=N),label:s(i)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Ea,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(a).ownerVerifying,onClick:m},[s(a).ownerVerifying?(d(),f("span",La)):(d(),f(ue,{key:1},[u[7]||(u[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(a).ownerVerified?s(i)("step3.verified"):s(i)("step3.verifyOwner")),1)],64))],8,Ca)]),z(he,{name:"fade"},{default:me(()=>[s(a).ownerVerified&&n.value.id?(d(),f("div",Fa,[e("div",Ya,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(i)("step3.ownerFound")),1)]),e("div",Ra,[e("div",Ua,[e("div",Wa,[e("div",Ba,l(s(i)("step3.passportIssueDate")),1),e("div",za,l(n.value.passportIssueDate?s(Be)(n.value.passportIssueDate):"-"),1)]),e("div",Ka,[e("div",ja,l(s(i)("step3.pinfl")),1),e("div",qa,l(n.value.nationalIdentifier||"-"),1)]),e("div",Ha,[e("div",Ga,l(s(i)("step3.issuedBy")),1),e("div",Ja,l(n.value.passportIssuedBy||"-"),1)]),e("div",Za,[e("div",Qa,l(s(i)("step3.lastName")),1),e("div",Xa,l(n.value.lastName||"-"),1)]),e("div",ei,[e("div",ti,l(s(i)("step3.firstName")),1),e("div",si,l(n.value.firstName||"-"),1)]),e("div",ai,[e("div",ii,l(s(i)("step3.middleName")),1),e("div",oi,l(n.value.middleName||"-"),1)]),e("div",li,[e("div",ri,l(s(i)("step3.gender")),1),e("div",ni,l(n.value.gender?s(je)(n.value.gender,s(o).value):"-"),1)]),e("div",ci,[e("div",ui,l(s(i)("step3.country")),1),e("div",di,l(n.value.country?.langValue1||"-"),1)]),e("div",pi,[e("div",vi,l(s(i)("step3.region")),1),e("div",fi,l(n.value.region?.langValue1||"-"),1)]),e("div",hi,[e("div",mi,l(s(i)("step3.district")),1),e("div",_i,l(n.value.district?.langValue1||"-"),1)]),e("div",bi,[e("div",yi,l(s(i)("step3.street")),1),e("div",gi,l(n.value.street||"-"),1)])])])])):R("",!0)]),_:1})]),e("div",$i,[e("label",Si,[ge(e("input",{"onUpdate:modelValue":u[3]||(u[3]=N=>h.value.applicantIsOwner=N),type:"checkbox",class:"checkbox",disabled:!s(a).isEditable},null,8,wi),[[Qe,h.value.applicantIsOwner]]),e("span",null,l(s(i)("step3.ownerIsApplicant")),1)])]),z(he,{name:"slide-down"},{default:me(()=>[h.value.applicantIsOwner?R("",!0):(d(),f("div",ki,[e("h3",Di,l(s(i)("step3.applicant")),1),e("div",xi,[z(A,{modelValue:y.value.passportSeries,"onUpdate:modelValue":u[4]||(u[4]=N=>y.value.passportSeries=N),label:s(i)("step3.passportSeries"),placeholder:s(i)("step3.passportSeriesPlaceholder"),disabled:!s(a).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Ni,[z(A,{modelValue:y.value.passportNumber,"onUpdate:modelValue":u[5]||(u[5]=N=>y.value.passportNumber=N),label:s(i)("step3.passportNumber"),placeholder:s(i)("step3.passportNumberPlaceholder"),disabled:!s(a).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Ai,[z(A,{modelValue:y.value.birthDate,"onUpdate:modelValue":u[6]||(u[6]=N=>y.value.birthDate=N),label:s(i)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Oi,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(a).applicantVerifying,onClick:C},[s(a).applicantVerifying?(d(),f("span",Ti)):(d(),f(ue,{key:1},[u[9]||(u[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(a).applicantVerified?s(i)("step3.verified"):s(i)("step3.verifyApplicant")),1)],64))],8,Ii)]),z(he,{name:"fade"},{default:me(()=>[s(a).applicantVerified&&y.value.id?(d(),f("div",Pi,[e("div",Mi,[u[10]||(u[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(i)("step3.applicantFound")),1)]),e("div",Vi,[e("div",Ei,[e("div",Ci,[e("div",Li,l(s(i)("step3.passportIssueDate")),1),e("div",Fi,l(y.value.passportIssueDate?s(Be)(y.value.passportIssueDate):"-"),1)]),e("div",Yi,[e("div",Ri,l(s(i)("step3.pinfl")),1),e("div",Ui,l(y.value.nationalIdentifier||"-"),1)]),e("div",Wi,[e("div",Bi,l(s(i)("step3.issuedBy")),1),e("div",zi,l(y.value.passportIssuedBy||"-"),1)]),e("div",Ki,[e("div",ji,l(s(i)("step3.lastName")),1),e("div",qi,l(y.value.lastName||"-"),1)]),e("div",Hi,[e("div",Gi,l(s(i)("step3.firstName")),1),e("div",Ji,l(y.value.firstName||"-"),1)]),e("div",Zi,[e("div",Qi,l(s(i)("step3.middleName")),1),e("div",Xi,l(y.value.middleName||"-"),1)]),e("div",eo,[e("div",to,l(s(i)("step3.gender")),1),e("div",so,l(y.value.gender?s(je)(y.value.gender,s(o).value):"-"),1)]),e("div",ao,[e("div",io,l(s(i)("step3.country")),1),e("div",oo,l(y.value.country?.langValue1||"-"),1)]),e("div",lo,[e("div",ro,l(s(i)("step3.region")),1),e("div",no,l(y.value.region?.langValue1||"-"),1)]),e("div",co,[e("div",uo,l(s(i)("step3.district")),1),e("div",po,l(y.value.district?.langValue1||"-"),1)]),e("div",vo,[e("div",fo,l(s(i)("step3.street")),1),e("div",ho,l(y.value.street||"-"),1)])])])])):R("",!0)]),_:1})]))]),_:1})])])}}}),_o=le(mo,[["__scopeId","data-v-62def220"]]),bo={class:"step-container"},yo={class:"step-header"},go={class:"step-title"},$o={class:"step-description"},So={class:"step-content"},wo={class:"summary-section"},ko={class:"section-title"},Do={class:"summary-card"},xo={class:"card-title"},No={class:"card-content"},Ao={class:"info-row"},Oo={class:"info-value-full"},Io={class:"summary-card"},To={class:"card-title"},Po={class:"card-content"},Mo={class:"info-row"},Vo={class:"info-value-full"},Eo={class:"summary-card"},Co={class:"card-title"},Lo={class:"card-content"},Fo={class:"info-row"},Yo={class:"info-value-full"},Ro={class:"summary-card"},Uo={class:"card-title"},Wo={class:"card-content"},Bo={class:"info-row"},zo={class:"info-value-full"},Ko={class:"info-row"},jo={class:"info-value-full"},qo={class:"info-row"},Ho={class:"info-value-full"},Go={class:"summary-card"},Jo={class:"card-title"},Zo={class:"card-content"},Qo={class:"info-row"},Xo={class:"info-value-full"},el={class:"summary-section"},tl={class:"section-title"},sl={class:"form-section"},al={class:"form-section"},il={key:0,class:"form-section"},ol={class:"premium-section"},ll={class:"premium-card-large"},rl={class:"premium-header"},nl={class:"premium-amount-large"},cl=oe({__name:"Step5Summary",setup(c){const a=be(),t=Ie();Se(),Le();const o=T(()=>a.osgo),i=T(()=>a.owner),h=T(()=>a.applicant);T(()=>a.fundData),Y(!1);const n=T({get:()=>(o.value.applicantIsOwner?i.value:h.value).phone||"",set:u=>{o.value.applicantIsOwner?(i.value.phone=u,o.value.party=i.value):(h.value.phone=u,o.value.party=h.value)}}),{locale:y,t:m}=de(),C=()=>o.value.period?t.getLocalizedName(o.value.period,y.value||"uz"):"-",w=()=>o.value.drivedArea?t.getLocalizedName(o.value.drivedArea,y.value||"uz"):"-";return(u,A)=>{const N=ze;return d(),f("div",bo,[e("div",yo,[e("h2",go,l(s(m)("step5.title")),1),e("p",$o,l(s(m)("step5.description")),1)]),e("div",So,[e("div",wo,[e("h3",ko,[A[2]||(A[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,l(s(m)("step5.policyInfo")),1)]),e("div",Do,[e("div",xo,l(s(m)("step3.owner")),1),e("div",No,[e("div",Ao,[e("span",Oo,l(i.value.name||"-")+l(i.value.birthDate?` (${i.value.birthDate})`:""),1)])])]),e("div",Io,[e("div",To,l(s(m)("step3.applicant")),1),e("div",Po,[e("div",Mo,[e("span",Vo,l((o.value.applicantIsOwner?i.value:h.value).name||"-")+l((o.value.applicantIsOwner?i.value:h.value).birthDate?` (${(o.value.applicantIsOwner?i.value:h.value).birthDate})`:""),1)])])]),e("div",Eo,[e("div",Co,l(s(m)("step5.vehicleInfo")),1),e("div",Lo,[e("div",Fo,[e("span",Yo,l(o.value.vehicle?.modelName||o.value.vehicle?.model||"-")+" "+l(o.value.vehicle?.govNumber?` (${o.value.vehicle.govNumber})`:""),1)])])]),e("div",Ro,[e("div",Uo,l(s(m)("step5.policyInfo")),1),e("div",Wo,[e("div",Bo,[e("span",zo,l(C()),1)]),e("div",Ko,[e("span",jo,l(w()),1)]),e("div",qo,[e("span",Ho,l(o.value.driversLimited?s(m)("step5.driversLimited",{count:o.value.drivers?.length||0}):s(m)("step5.noDriversLimitation")),1)])])]),e("div",Go,[e("div",Jo,l(s(m)("step5.compensation")),1),e("div",Zo,[e("div",Qo,[e("span",Xo,l(s(Ce)(s(We))),1)])])])]),e("div",el,[e("h3",tl,[A[3]||(A[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,l(s(m)("step5.contactInfo")),1)]),e("div",sl,[z(N,{modelValue:n.value,"onUpdate:modelValue":A[0]||(A[0]=W=>n.value=W),label:s(m)("step5.phone"),placeholder:s(m)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",al,[z(N,{modelValue:o.value.contractStartDate,"onUpdate:modelValue":A[1]||(A[1]=W=>o.value.contractStartDate=W),label:s(m)("step5.startDate"),type:"text","date-mask":"",placeholder:s(m)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(a).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),o.value.contractEndDate?(d(),f("div",il,[z(N,{"model-value":o.value.contractEndDate,label:s(m)("step5.endDate"),type:"text","date-mask":"",placeholder:s(m)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):R("",!0)]),e("div",ol,[e("div",ll,[e("div",rl,[A[4]||(A[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,l(s(m)("step5.premium")),1)]),e("div",nl,l(s(Ce)(s(a).calculatedPremium)),1)])])])])}}}),ul=le(cl,[["__scopeId","data-v-8e729bee"]]),dl={class:"step-container"},pl={class:"step-header"},vl={class:"step-title"},fl={class:"step-description"},hl={class:"step-content"},ml={class:"gift-section"},_l={class:"gift-message"},bl={class:"gift-title"},yl={key:0,class:"gift-status success"},gl={key:1,class:"gift-status failed"},$l={href:"https://tys.uz/products/kasko-dostupnoe",target:"_blank",rel:"noopener noreferrer",class:"gift-link"},Sl={class:"premium-section"},wl={class:"premium-card-large"},kl={class:"premium-header"},Dl={class:"premium-amount-large"},xl={class:"payment-section"},Nl={class:"section-title"},Al={class:"payment-buttons"},Ol=["disabled"],Il={key:0,class:"payment-selected-indicator"},Tl=["disabled"],Pl={key:0,class:"payment-selected-indicator"},Ml=["disabled"],Vl={key:0,class:"payment-selected-indicator"},El={class:"status-section"},Cl=["disabled"],Ll={key:0,class:"ml-1"},Fl={key:0,class:"error-message mt-2"},Yl={key:0,class:"success-card"},Rl={class:"success-title"},Ul={class:"success-description"},Wl={class:"policy-details"},Bl={class:"policy-row"},zl={class:"policy-label"},Kl={class:"policy-value"},jl={class:"policy-row"},ql={class:"policy-label"},Hl={class:"policy-value"},Gl=oe({__name:"Step6Payment",setup(c){const a=be(),t=Se();Le();const{t:o,locale:i}=de(),h=T(()=>a.osgo),n=T(()=>a.fundData);T(()=>(h.value.applicantIsOwner?a.owner:a.applicant).phone||"");const y=Y(!1),m=Y(null),C=Y(0),w=Y(null);let u=null;const A=T({get:()=>a.selectedPaymentMethod,set:$=>{a.selectedPaymentMethod=$}}),N=T(()=>{if(!w.value)return"";const $=w.value.toLowerCase(),S=i.value,K=S==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],x=S==="ru"?["ошибка","не получена"]:["xato","olindi"];return K.some(k=>$.includes(k))?"status-success":x.some(k=>$.includes(k))?"status-error":"status-info"}),W=T(()=>N.value==="status-success"?"bx bx-check-circle":N.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),O=$=>{A.value===$?A.value=null:A.value=$,t.isTelegramWebApp.value&&t.hapticImpact("light")},v=async()=>{if(!h.value.id){m.value=o("errors.createApplicationFailed");return}try{y.value=!0,m.value=null,w.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await a.fetchFundData(),n.value?.seria&&n.value?.number?(w.value=o("step5.paymentSuccess"),t.isTelegramWebApp.value&&t.hapticNotification("success")):n.value?w.value=o("step5.paymentProcessing"):w.value=o("step5.paymentNotReceived"),C.value=15,u&&clearInterval(u),u=window.setInterval(()=>{C.value>0?C.value--:u&&(clearInterval(u),u=null)},1e3)}catch($){console.error("[Step6Payment] Check status error:",$),m.value=$.message||o("errors.paymentFailed"),w.value=o("errors.paymentFailed"),t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{y.value=!1}};return Xe(()=>{u&&clearInterval(u)}),($,S)=>(d(),f("div",dl,[e("div",pl,[e("h2",vl,l(s(o)("step5.payment")),1),e("p",fl,l(s(o)("step5.paymentDescription")),1)]),e("div",hl,[e("div",ml,[e("div",{class:te(["gift-card",{"gift-card-success":s(a).kaskoContractStatus==="success","gift-card-failed":s(a).kaskoContractStatus==="failed"}])},[S[6]||(S[6]=e("div",{class:"gift-icon"},[e("i",{class:"bx bx-gift"})],-1)),e("div",_l,[e("h3",bl,l(s(o)("step5.giftMessage")),1),s(a).kaskoContractStatus==="success"?(d(),f("div",yl,[S[3]||(S[3]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(o)("step5.kaskoSuccess")),1)])):s(a).kaskoContractStatus==="failed"?(d(),f("div",gl,[S[4]||(S[4]=e("i",{class:"bx bx-x-circle"},null,-1)),e("span",null,l(s(o)("step5.kaskoFailed")),1)])):R("",!0),e("a",$l,[S[5]||(S[5]=e("i",{class:"bx bx-link-external"},null,-1)),e("span",null,l(s(o)("step5.giftLinkText")),1)])])],2)]),e("div",Sl,[e("div",wl,[e("div",kl,[S[7]||(S[7]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,l(s(o)("step5.premium")),1)]),e("div",Dl,l(s(Ce)(s(a).calculatedPremium)),1)])]),e("div",xl,[e("h3",Nl,[S[8]||(S[8]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,l(s(o)("step5.paymentMethod")),1)]),e("div",Al,[e("button",{type:"button",class:te(["payment-btn payme",{"payment-btn-selected":A.value==="payme"}]),disabled:y.value,onClick:S[0]||(S[0]=K=>O("payme"))},[S[10]||(S[10]=e("div",{class:"payment-icon"},"💳",-1)),S[11]||(S[11]=e("div",{class:"payment-name"},"Payme",-1)),A.value==="payme"?(d(),f("div",Il,[...S[9]||(S[9]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):R("",!0)],10,Ol),e("button",{type:"button",class:te(["payment-btn click",{"payment-btn-selected":A.value==="click"}]),disabled:y.value,onClick:S[1]||(S[1]=K=>O("click"))},[S[13]||(S[13]=e("div",{class:"payment-icon"},"🔵",-1)),S[14]||(S[14]=e("div",{class:"payment-name"},"Click",-1)),A.value==="click"?(d(),f("div",Pl,[...S[12]||(S[12]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):R("",!0)],10,Tl),e("button",{type:"button",class:te(["payment-btn uzum",{"payment-btn-selected":A.value==="uzum"}]),disabled:y.value,onClick:S[2]||(S[2]=K=>O("uzum"))},[S[16]||(S[16]=e("div",{class:"payment-icon"},"🟣",-1)),S[17]||(S[17]=e("div",{class:"payment-name"},"Uzum",-1)),A.value==="uzum"?(d(),f("div",Vl,[...S[15]||(S[15]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):R("",!0)],10,Ml)])]),e("div",El,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!C.value||y.value||!h.value.id,onClick:v},[S[18]||(S[18]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,l(s(o)("step5.checkStatus")),1),C.value?(d(),f("span",Ll,"("+l(C.value)+")",1)):R("",!0)],8,Cl),z(he,{name:"fade"},{default:me(()=>[m.value?(d(),f("div",Fl,[S[19]||(S[19]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,l(m.value),1)])):R("",!0)]),_:1}),z(he,{name:"fade"},{default:me(()=>[w.value?(d(),f("div",{key:0,class:te(["status-text",N.value])},[e("i",{class:te(W.value)},null,2),e("span",null,l(w.value),1)],2)):R("",!0)]),_:1})]),z(he,{name:"fade"},{default:me(()=>[h.value.id&&n.value&&n.value.seria?(d(),f("div",Yl,[S[20]||(S[20]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Rl,l(s(o)("step5.success")),1),e("p",Ul,l(s(o)("step5.policyIssued")),1),e("div",Wl,[e("div",Bl,[e("span",zl,l(s(o)("step5.policySeries"))+":",1),e("span",Kl,l(n.value.seria),1)]),e("div",jl,[e("span",ql,l(s(o)("step5.policyNumber"))+":",1),e("span",Hl,l(n.value.number),1)])])])):R("",!0)]),_:1})])]))}}),Jl=le(Gl,[["__scopeId","data-v-812641f7"]]),Zl={class:"min-h-screen flex flex-col"},Ql={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},Xl={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},er={class:"max-w-3xl mx-auto"},tr={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},sr=oe({__name:"index",setup(c){const a=be(),t=Ie(),o=Se();return Fe(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),a.loadFromSession()&&console.log("[IndexPage] Restored data from session"),a.initialize(),o.isTelegramWebApp.value&&o.showBackButton(()=>{a.currentStep>0?a.previousStep():o.close()});const h=ie(()=>a.osgo,()=>{a.saveToSession()},{deep:!0});et(()=>{h(),a.saveToSession(),o.isTelegramWebApp.value&&(o.hideBackButton(),o.hideMainButton())})}),tt({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(i,h)=>(d(),f("div",Zl,[e("header",Ql,[z(At)]),e("main",Xl,[e("div",er,[z(he,{name:"fade",mode:"out-in"},{default:me(()=>[s(a).currentStep===s(F).PARAMS?(d(),Oe(Is,{key:s(F).PARAMS})):s(a).currentStep===s(F).VEHICLE?(d(),Oe(ka,{key:s(F).VEHICLE})):s(a).currentStep===s(F).OWNER?(d(),Oe(_o,{key:s(F).OWNER})):s(a).currentStep===s(F).SUMMARY?(d(),Oe(ul,{key:s(F).SUMMARY})):s(a).currentStep===s(F).PAYMENT?(d(),Oe(Jl,{key:s(F).PAYMENT})):R("",!0)]),_:1})])]),e("footer",tr,[z(Wt)])]))}}),fr=le(sr,[["__scopeId","data-v-ce2fc33a"]]);export{fr as default};
