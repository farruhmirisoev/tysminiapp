import{e as Ue,f as we,g as Ne,r as Y,S as W,h as M,C as Ie,i as _e,j as Te,k as X,l as ve,m as Re,n as Ae,c as d,o as u,F as ae,p as me,q as i,s as se,t as r,a as e,v as ze,b as F,x as je,y as pe,z as C,A as Ye,d as ge,T as ie,w as le,B as Ee,D as He,E as re,G as qe,H as Ge,I as Je,J as Ze,K as Fe,u as Ke}from"./Cw3nC2Ka.js";import{_ as ee}from"./DlAUqK2U.js";import{_ as Qe}from"./DgM-zN9R.js";function Xe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xe={exports:{}},et=xe.exports,Be;function tt(){return Be||(Be=1,(function(n,s){(function(t,l){n.exports=l()})(et,(function(){var t=1e3,l=6e4,a=36e5,p="millisecond",f="second",_="minute",k="hour",g="day",m="week",v="month",c="quarter",A="year",S="date",O="Invalid Date",E=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,R={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(N){var $=["th","st","nd","rd"],b=N%100;return"["+N+($[(b-20)%10]||$[b]||$[0])+"]"}},G=function(N,$,b){var w=String(N);return!w||w.length>=$?N:""+Array($+1-w.length).join(b)+N},I={s:G,z:function(N){var $=-N.utcOffset(),b=Math.abs($),w=Math.floor(b/60),y=b%60;return($<=0?"+":"-")+G(w,2,"0")+":"+G(y,2,"0")},m:function N($,b){if($.date()<b.date())return-N(b,$);var w=12*(b.year()-$.year())+(b.month()-$.month()),y=$.clone().add(w,v),P=b-y<0,T=$.clone().add(w+(P?-1:1),v);return+(-(w+(b-y)/(P?y-T:T-y))||0)},a:function(N){return N<0?Math.ceil(N)||0:Math.floor(N)},p:function(N){return{M:v,y:A,w:m,d:g,D:S,h:k,m:_,s:f,ms:p,Q:c}[N]||String(N||"").toLowerCase().replace(/s$/,"")},u:function(N){return N===void 0}},D="en",V={};V[D]=R;var Z="$isDayjsObject",oe=function(N){return N instanceof he||!(!N||!N[Z])},te=function N($,b,w){var y;if(!$)return D;if(typeof $=="string"){var P=$.toLowerCase();V[P]&&(y=P),b&&(V[P]=b,y=P);var T=$.split("-");if(!y&&T.length>1)return N(T[0])}else{var B=$.name;V[B]=$,y=B}return!w&&y&&(D=y),y||!w&&D},j=function(N,$){if(oe(N))return N.clone();var b=typeof $=="object"?$:{};return b.date=N,b.args=arguments,new he(b)},L=I;L.l=te,L.i=oe,L.w=function(N,$){return j(N,{locale:$.$L,utc:$.$u,x:$.$x,$offset:$.$offset})};var he=(function(){function N(b){this.$L=te(b.locale,null,!0),this.parse(b),this.$x=this.$x||b.x||{},this[Z]=!0}var $=N.prototype;return $.parse=function(b){this.$d=(function(w){var y=w.date,P=w.utc;if(y===null)return new Date(NaN);if(L.u(y))return new Date;if(y instanceof Date)return new Date(y);if(typeof y=="string"&&!/Z$/i.test(y)){var T=y.match(E);if(T){var B=T[2]-1||0,U=(T[7]||"0").substring(0,3);return P?new Date(Date.UTC(T[1],B,T[3]||1,T[4]||0,T[5]||0,T[6]||0,U)):new Date(T[1],B,T[3]||1,T[4]||0,T[5]||0,T[6]||0,U)}}return new Date(y)})(b),this.init()},$.init=function(){var b=this.$d;this.$y=b.getFullYear(),this.$M=b.getMonth(),this.$D=b.getDate(),this.$W=b.getDay(),this.$H=b.getHours(),this.$m=b.getMinutes(),this.$s=b.getSeconds(),this.$ms=b.getMilliseconds()},$.$utils=function(){return L},$.isValid=function(){return this.$d.toString()!==O},$.isSame=function(b,w){var y=j(b);return this.startOf(w)<=y&&y<=this.endOf(w)},$.isAfter=function(b,w){return j(b)<this.startOf(w)},$.isBefore=function(b,w){return this.endOf(w)<j(b)},$.$g=function(b,w,y){return L.u(b)?this[w]:this.set(y,b)},$.unix=function(){return Math.floor(this.valueOf()/1e3)},$.valueOf=function(){return this.$d.getTime()},$.startOf=function(b,w){var y=this,P=!!L.u(w)||w,T=L.p(b),B=function(de,J){var ne=L.w(y.$u?Date.UTC(y.$y,J,de):new Date(y.$y,J,de),y);return P?ne:ne.endOf(g)},U=function(de,J){return L.w(y.toDate()[de].apply(y.toDate("s"),(P?[0,0,0,0]:[23,59,59,999]).slice(J)),y)},H=this.$W,q=this.$M,K=this.$D,fe="set"+(this.$u?"UTC":"");switch(T){case A:return P?B(1,0):B(31,11);case v:return P?B(1,q):B(0,q+1);case m:var ue=this.$locale().weekStart||0,be=(H<ue?H+7:H)-ue;return B(P?K-be:K+(6-be),q);case g:case S:return U(fe+"Hours",0);case k:return U(fe+"Minutes",1);case _:return U(fe+"Seconds",2);case f:return U(fe+"Milliseconds",3);default:return this.clone()}},$.endOf=function(b){return this.startOf(b,!1)},$.$set=function(b,w){var y,P=L.p(b),T="set"+(this.$u?"UTC":""),B=(y={},y[g]=T+"Date",y[S]=T+"Date",y[v]=T+"Month",y[A]=T+"FullYear",y[k]=T+"Hours",y[_]=T+"Minutes",y[f]=T+"Seconds",y[p]=T+"Milliseconds",y)[P],U=P===g?this.$D+(w-this.$W):w;if(P===v||P===A){var H=this.clone().set(S,1);H.$d[B](U),H.init(),this.$d=H.set(S,Math.min(this.$D,H.daysInMonth())).$d}else B&&this.$d[B](U);return this.init(),this},$.set=function(b,w){return this.clone().$set(b,w)},$.get=function(b){return this[L.p(b)]()},$.add=function(b,w){var y,P=this;b=Number(b);var T=L.p(w),B=function(q){var K=j(P);return L.w(K.date(K.date()+Math.round(q*b)),P)};if(T===v)return this.set(v,this.$M+b);if(T===A)return this.set(A,this.$y+b);if(T===g)return B(1);if(T===m)return B(7);var U=(y={},y[_]=l,y[k]=a,y[f]=t,y)[T]||1,H=this.$d.getTime()+b*U;return L.w(H,this)},$.subtract=function(b,w){return this.add(-1*b,w)},$.format=function(b){var w=this,y=this.$locale();if(!this.isValid())return y.invalidDate||O;var P=b||"YYYY-MM-DDTHH:mm:ssZ",T=L.z(this),B=this.$H,U=this.$m,H=this.$M,q=y.weekdays,K=y.months,fe=y.meridiem,ue=function(J,ne,ye,Se){return J&&(J[ne]||J(w,P))||ye[ne].slice(0,Se)},be=function(J){return L.s(B%12||12,J,"0")},de=fe||function(J,ne,ye){var Se=J<12?"AM":"PM";return ye?Se.toLowerCase():Se};return P.replace(h,(function(J,ne){return ne||(function(ye){switch(ye){case"YY":return String(w.$y).slice(-2);case"YYYY":return L.s(w.$y,4,"0");case"M":return H+1;case"MM":return L.s(H+1,2,"0");case"MMM":return ue(y.monthsShort,H,K,3);case"MMMM":return ue(K,H);case"D":return w.$D;case"DD":return L.s(w.$D,2,"0");case"d":return String(w.$W);case"dd":return ue(y.weekdaysMin,w.$W,q,2);case"ddd":return ue(y.weekdaysShort,w.$W,q,3);case"dddd":return q[w.$W];case"H":return String(B);case"HH":return L.s(B,2,"0");case"h":return be(1);case"hh":return be(2);case"a":return de(B,U,!0);case"A":return de(B,U,!1);case"m":return String(U);case"mm":return L.s(U,2,"0");case"s":return String(w.$s);case"ss":return L.s(w.$s,2,"0");case"SSS":return L.s(w.$ms,3,"0");case"Z":return T}return null})(J)||T.replace(":","")}))},$.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},$.diff=function(b,w,y){var P,T=this,B=L.p(w),U=j(b),H=(U.utcOffset()-this.utcOffset())*l,q=this-U,K=function(){return L.m(T,U)};switch(B){case A:P=K()/12;break;case v:P=K();break;case c:P=K()/3;break;case m:P=(q-H)/6048e5;break;case g:P=(q-H)/864e5;break;case k:P=q/a;break;case _:P=q/l;break;case f:P=q/t;break;default:P=q}return y?P:L.a(P)},$.daysInMonth=function(){return this.endOf(v).$D},$.$locale=function(){return V[this.$L]},$.locale=function(b,w){if(!b)return this.$L;var y=this.clone(),P=te(b,w,!0);return P&&(y.$L=P),y},$.clone=function(){return L.w(this.$d,this)},$.toDate=function(){return new Date(this.valueOf())},$.toJSON=function(){return this.isValid()?this.toISOString():null},$.toISOString=function(){return this.$d.toISOString()},$.toString=function(){return this.$d.toUTCString()},N})(),$e=he.prototype;return j.prototype=$e,[["$ms",p],["$s",f],["$m",_],["$H",k],["$W",g],["$M",v],["$y",A],["$D",S]].forEach((function(N){$e[N[1]]=function($){return this.$g($,N[0],N[1])}})),j.extend=function(N,$){return N.$i||(N($,he,j),N.$i=!0),j},j.locale=te,j.isDayjs=oe,j.unix=function(N){return j(1e3*N)},j.en=V[D],j.Ls=V,j.p={},j}))})(xe)),xe.exports}var st=tt();const De=Xe(st),ce=Ue("osgo",()=>{const n=we(),s=Ne(),t=Y({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:De().format("YYYY-MM-DD"),premium:0}),l=Y({passportSeries:"",passportNumber:"",birthDate:""}),a=Y({passportSeries:"",passportNumber:"",birthDate:""}),p=Y(W.PARAMS),f=Y(!1),_=Y(null),k=Y(!1),g=Y(null),m=Y(null),v=Y(null),c=Y(!1),A=Y(null),S=Y(!1),O=Y(!1),E=Y(null),h=Y(!1),R=Y(!1),G=Y(null),I=Y(!1),D=Y(!1),V=Y(null),Z=M(()=>t.value.status==="DRAFT"),oe=M(()=>q(p.value).valid),te=M(()=>Object.keys(W).length),j=M(()=>Math.round((p.value+1)/te.value*100)),L=M(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const o=t.value.vehicle.carType.tariffCompany||0,x=t.value.period.coefficient||0,z=t.value.drivedArea.coefficient||0;let Q=3;t.value.driversLimited&&t.value.incidentCoeff&&(Q=t.value.incidentCoeff);const ke=o*x*Q*z,Me=ke>5*o?Ie*5*o:Ie*ke/100;return Math.round(Me)}),he=M(()=>{const x=(t.value.entriesJournalKt||[]).reduce((z,Q)=>z+(Q.amount||0),0);return t.value.premium-x}),$e=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:De().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},p.value=W.PARAMS,n.isLoaded&&(t.value.discountType=n.getDefaultDiscountType())};_e(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let o=De(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?o=o.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(o=o.add(t.value.period.days||0,"days")),t.value.contractEndDate=o.subtract(1,"days").format("YYYY-MM-DD")}),_e(()=>t.value.period,o=>{o&&(t.value.periodType=o.periodType)}),_e(()=>t.value.vehicle?.govNumber,o=>{if(!o||o.length<2)return;const x=parseInt(o.slice(0,2)),z=n.findDrivedAreaByRegion(x);z&&(t.value.drivedArea=z)}),_e(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=L.value},{deep:!0}),_e(()=>t.value.driversLimited,o=>{o||(t.value.incidentCoeff=void 0)});const N=async()=>{if(t.value.vehicle){S.value=!0,E.value=null,O.value=!1;try{const o=await s.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),x=o?.result||o;if(o?.error&&!x)throw new Error(o.error.message||"Failed to verify vehicle");o?.error&&x&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",o.error),Object.assign(t.value.vehicle,x),x?.carType&&n.isLoaded&&(t.value.vehicle.carType=n.findCarType(x.carType.id)),O.value=!0,console.log("[OsgoStore] Vehicle verified:",x)}catch(o){throw E.value=o.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",o),o}finally{S.value=!1}}},$=async()=>{h.value=!0,G.value=null,R.value=!1;try{const o=await s.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",o),console.log("[OsgoStore] Result has id?",!!o?.id),o&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...o},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(a.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...o},t.value.party={...l.value},D.value=!0)),R.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(o){throw G.value=o.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",o),o}finally{h.value=!1}},b=async()=>{I.value=!0,V.value=null,D.value=!1;try{const o=await s.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",o),o&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...o},t.value.party={...a.value}),D.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(o){throw V.value=o.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",o),o}finally{I.value=!1}},w=async o=>{try{const x=await s.getDriver({passportSeries:o.passportSeries?.toUpperCase()||"",passportNumber:o.passportNumber,birthDate:o.birthDate});return{...o,...x}}catch(x){throw console.error("[OsgoStore] Driver verification failed:",x),x}},y=o=>{const x={passportSeries:o?.passportSeries||"",passportNumber:o?.passportNumber||"",birthDate:o?.birthDate||""};t.value.drivers.push(x)},P=(o,x)=>{t.value.drivers[o]&&(t.value.drivers[o]=x)},T=o=>{t.value.drivers.splice(o,1)},B=(o,x,z)=>t.value.drivers.some(Q=>Q.passportSeries===o&&Q.passportNumber===x&&Q.birthDate===z),U=()=>{B(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)||y({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate})},H=()=>{B(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||y({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},q=o=>{switch(o){case W.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case W.VEHICLE:return{valid:O.value};case W.OWNER:return{valid:R.value&&(t.value.applicantIsOwner||D.value)};case W.DRIVERS:return{valid:!t.value.driversLimited||t.value.drivers.length>0};case W.SUMMARY:const x=t.value.applicantIsOwner?l.value.id:a.value.id;return{valid:!!(l.value.id&&x&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(z=>z.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case W.PAYMENT:return{valid:!!(t.value.id&&A.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:a,currentStep:p,saving:f,saveError:_,fetching:k,fetchError:g,fundData:m,fundError:v,fetchingFundData:c,selectedPaymentMethod:A,vehicleVerifying:S,vehicleVerified:O,vehicleVerifyError:E,ownerVerifying:h,ownerVerified:R,ownerVerifyError:G,applicantVerifying:I,applicantVerified:D,applicantVerifyError:V,isEditable:Z,canProceedToNextStep:oe,totalSteps:te,progressPercentage:j,calculatedPremium:L,amountPayable:he,initialize:$e,verifyVehicle:N,verifyOwner:$,verifyApplicant:b,verifyDriver:w,addDriver:y,updateDriver:P,removeDriver:T,hasDriver:B,addOwnerAsDriver:U,addApplicantAsDriver:H,validateStepData:q,nextStep:()=>{p.value<te.value-1&&p.value++},previousStep:()=>{p.value>0&&p.value--},goToStep:o=>{o>=0&&o<te.value&&(p.value=o)},createPolicy:async()=>{f.value=!0,_.value=null;try{let o=null;try{o=await s.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",o)}catch(Pe){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Pe),o={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const x=t.value.applicantIsOwner?{...l.value}:{...a.value};x.phone&&(x.phone=x.phone.replace(/[+()-]/g,""));const z={...l.value},Q=t.value.discountType||n.meta?.beneficiary?.find(({coefficient:Pe})=>Pe===1),ke={party:x,beneficiary:z,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:Q,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Me={user:o,osgo:ke};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:o?.id,login:o?.login},osgo:{party:{id:x.id,name:x.name},beneficiary:{id:z.id,name:z.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:Q?.id}}});const Oe=await s.createOsgoApplication(Me);return t.value.id=Oe,t.value.applicantIsOwner?(l.value.phone=x.phone,t.value.party=l.value):(a.value.phone=x.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",Oe),Oe}catch(o){throw _.value=o.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",o),o}finally{f.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");f.value=!0,_.value=null;try{const o={...t.value,party:t.value.applicantIsOwner?l.value:a.value,beneficiary:l.value};await s.updateOsgoApplication(o),console.log("[OsgoStore] Policy updated")}catch(o){throw _.value=o.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",o),o}finally{f.value=!1}},fetchPolicy:async o=>{k.value=!0,g.value=null;try{const x=await s.fetchOsgoEntity(o);if(t.value=x,x.party?.id){const z=await s.fetchIndividualEntity(x.party.id);a.value=z,t.value.party=z}if(x.beneficiary?.id){const z=await s.fetchIndividualEntity(x.beneficiary.id);l.value=z,t.value.beneficiary=z}if(n.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=n.findCarType(t.value.vehicle.carType.id)),n.isLoaded&&t.value.period&&(t.value.period=n.findPeriod(t.value.period.id)),n.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=n.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const z=Math.max(...t.value.drivers.map(Q=>Q.incidentFrequency?.coefficient||0));t.value.incidentCoeff=z}console.log("[OsgoStore] Policy fetched:",o)}catch(x){throw g.value=x.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",x),x}finally{k.value=!1}},fetchFundData:async()=>{if(t.value.id){c.value=!0,v.value=null;try{const o=await s.getFundPolicy(t.value.id);m.value=o||null,console.log("[OsgoStore] Fund data fetched:",o)}catch(o){v.value=o.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",o)}finally{c.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const o={osgo:t.value,owner:l.value,applicant:a.value,currentStep:p.value};sessionStorage.setItem(Te.OSGO_DRAFT,JSON.stringify(o)),console.log("[OsgoStore] Saved to session")}catch(o){console.error("[OsgoStore] Error saving to session:",o)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const o=sessionStorage.getItem(Te.OSGO_DRAFT);if(!o)return!1;const x=JSON.parse(o);return t.value=x.osgo,l.value=x.owner,a.value=x.applicant,p.value=x.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(o){return console.error("[OsgoStore] Error loading from session:",o),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Te.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{$e(),O.value=!1,R.value=!1,D.value=!1,m.value=null,_.value=null,g.value=null}}}),at={class:"language-switcher"},it=["onClick"],lt=X({__name:"LanguageSwitcher",setup(n){const{locale:s,locales:t}=ve();Re();const l=M(()=>s.value),a=M(()=>t.value.filter(f=>f.code!==s.value)),p=f=>{s.value=f,typeof window<"u"&&localStorage.setItem("app-language",f),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Ae(()=>{if(typeof window<"u"){const f=localStorage.getItem("app-language");f&&(f==="ru"||f==="uz")&&(s.value=f)}}),(f,_)=>(u(),d("div",at,[(u(!0),d(ae,null,me(i(a),k=>(u(),d("button",{key:k.code,class:se(["lang-btn",{active:i(l)===k.code}]),onClick:g=>p(k.code)},r(k.code.toUpperCase()),11,it))),128))]))}}),ot=ee(lt,[["__scopeId","data-v-e748ef5d"]]),nt={class:"progress-bar-container"},rt={class:"progress-track"},ct={class:"steps-container"},ut=["onClick"],dt={key:0,class:"step-check"},vt={key:1,class:"step-number"},pt={class:"step-label"},ft=X({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(n){const s=n,{t}=ve(),l=M(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.drivers"),t("steps.summary"),t("steps.payment")]),a=M(()=>(s.currentStep+1)/s.totalSteps*100),p=f=>{console.log("Step clicked:",f)};return(f,_)=>(u(),d("div",nt,[e("div",rt,[e("div",{class:"progress-fill",style:ze({width:`${a.value}%`})},null,4)]),e("div",ct,[(u(!0),d(ae,null,me(l.value,(k,g)=>(u(),d("div",{key:g,class:"step-wrapper",onClick:m=>p(g)},[e("div",{class:se(["step-circle",{"step-active":g===n.currentStep,"step-completed":g<n.currentStep,"step-pending":g>n.currentStep}])},[g<n.currentStep?(u(),d("span",dt,"✓")):(u(),d("span",vt,r(g+1),1))],2),e("div",pt,r(k),1)],8,ut))),128))])]))}}),mt=ee(ft,[["__scopeId","data-v-b647cd33"]]),ht={class:"fixed-header"},bt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},yt={class:"flex items-center justify-between mb-3"},_t=X({__name:"AppHeader",setup(n){const s=ce(),t=M(()=>s.currentStep),l=M(()=>s.totalSteps);return(a,p)=>{const f=ot,_=mt;return u(),d("header",ht,[e("div",bt,[e("div",yt,[p[0]||(p[0]=je('<div class="flex items-center gap-3" data-v-67b64b56><div class="w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg" data-v-67b64b56><img src="'+Qe+'" alt="Temiryo&#39;l Sug&#39;urta Logo" data-v-67b64b56></div><div data-v-67b64b56><div class="text-base font-bold text-text" data-v-67b64b56>ОСГОВТС</div><div class="text-xs text-text-light" data-v-67b64b56> Temiryo&#39;l Sug&#39;urta </div></div></div>',1)),F(f)]),F(_,{"current-step":t.value,"total-steps":l.value},null,8,["current-step","total-steps"])])])}}}),gt=ee(_t,[["__scopeId","data-v-67b64b56"]]),$t={class:"fixed-footer"},St={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},wt=["disabled"],kt={class:"flex-1 text-center"},xt={class:"text-sm text-text-light font-medium"},Dt=["disabled"],Nt={key:0,class:"spinner"},At={key:0},Vt={key:1},Mt={key:2},Ot={key:3,class:"text-lg bx bx-chevron-right"},Pt=X({__name:"AppFooter",setup(n){const s=ce(),t=pe(),l=Ne(),{t:a}=ve(),p=Y(!1),f=Y(null),_=Y(null),k=M(()=>s.currentStep),g=M(()=>s.totalSteps),m=M(()=>k.value===0),v=M(()=>k.value===g.value-1),c=M(()=>s.canProceedToNextStep),A=M(()=>s.saving||s.fetching||p.value),S=()=>{m.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),s.previousStep())},O=async()=>{if(!c.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(k.value===W.VEHICLE&&!s.vehicleVerified)await s.verifyVehicle();else if(k.value===W.OWNER)s.ownerVerified||await s.verifyOwner(),!s.osgo.applicantIsOwner&&!s.applicantVerified&&await s.verifyApplicant();else if(k.value===W.SUMMARY)s.osgo.id||(await s.createPolicy(),console.log("[AppFooter] Policy created:",s.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(k.value===W.PAYMENT){if(!s.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const h={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[s.selectedPaymentMethod],R=s.osgo.id,I=(s.osgo.applicantIsOwner?s.owner:s.applicant).phone||"",D=s.calculatedPremium;if(!R||!I||!D){const V="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:R,phone:I,amount:D}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(V));return}try{p.value=!0,f.value=null,_.value=null,await l.sendPaymentLink(h,R,I,D),_.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(V){f.value=V.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",V),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(f.value))}finally{p.value=!1}return}v.value?console.log("[AppFooter] Last step reached"):s.nextStep()}catch(E){console.error("[AppFooter] Error:",E),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(E.message||a("errors.unknown")))}};return(E,h)=>(u(),d("footer",$t,[e("div",St,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:m.value||A.value,onClick:S},[h[0]||(h[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,r(E.$t("common.previous")),1)],8,wt),e("div",kt,[e("div",xt,r(E.$t("common.step",{current:k.value+1,total:g.value})),1)]),e("button",{type:"button",class:se(["btn flex-1 max-w-[160px]",{"btn-primary":!v.value||k.value!==i(W).PAYMENT,"btn-success":v.value&&k.value===i(W).PAYMENT}]),disabled:!c.value||A.value,onClick:O},[A.value?(u(),d("span",Nt)):(u(),d(ae,{key:1},[k.value===i(W).SUMMARY&&!i(s).osgo.id?(u(),d("span",At,r(E.$t("step5.confirm")),1)):v.value&&k.value===i(W).PAYMENT?(u(),d("span",Vt,[h[1]||(h[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,r(E.$t("step5.payment")),1)])):(u(),d("span",Mt,r(E.$t("common.next")),1)),!v.value&&k.value!==i(W).SUMMARY?(u(),d("i",Ot)):C("",!0)],64))],10,Dt)])]))}}),Tt=ee(Pt,[["__scopeId","data-v-4fce94ec"]]),It=["disabled"],Ct={key:0,class:"check-icon"},Et={class:"check-content"},Lt={class:"check-title"},Yt={key:0,class:"check-description"},Ft={class:"check-indicator"},Bt={class:"check-circle"},Wt={key:0,class:"check-dot"},Ut=X({__name:"CheckButton",props:{title:{default:""},description:{default:""},icon:{default:""},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["click"],setup(n,{emit:s}){const t=n,l=s,a=()=>{t.disabled||l("click")};return(p,f)=>(u(),d("button",{type:"button",class:se(["check-button",{active:n.active,disabled:n.disabled}]),disabled:n.disabled,onClick:a},[n.icon?(u(),d("div",Ct,r(n.icon),1)):C("",!0),e("div",Et,[e("div",Lt,[Ye(p.$slots,"default",{},()=>[ge(r(n.title),1)])]),n.description||p.$slots.description?(u(),d("div",Yt,[Ye(p.$slots,"description",{},()=>[ge(r(n.description),1)])])):C("",!0)]),e("div",Ft,[e("div",Bt,[n.active?(u(),d("div",Wt)):C("",!0)])])],10,It))}}),Rt=ee(Ut,[["__scopeId","data-v-f6637245"]]);function Le(n,s="сум"){return n==null||isNaN(n)?`0 ${s}`:`${n.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${s}`}function Ce(n){return n?De(n).format("DD.MM.YYYY"):""}function We(n,s="ru"){if(!n)return"";const t=String(n).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?s==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?s==="uz"?"Ayol":"Женский":String(n)}const zt={class:"step-container"},jt={key:0,class:"loading-state"},Ht={key:1,class:"error-state"},qt={key:2,class:"error-state"},Gt={class:"debug-info"},Jt={key:3},Zt={class:"step-content"},Kt={class:"form-section"},Qt={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Xt={class:"form-section"},es={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ts={class:"form-section"},ss={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},as={key:0,class:"form-section"},is={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ls={class:"form-section"},os={class:"select-wrapper"},ns=["disabled"],rs=["value"],cs={key:0,class:"premium-card"},us={class:"premium-card-content"},ds={class:"premium-amount"},vs=X({__name:"Step1Params",setup(n){const s=ce(),t=we(),l=pe(),{locale:a}=ve();Ae(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Car types:",t.carTypes),console.log("[Step1Params] Periods count:",t.periods.length),console.log("[Step1Params] Meta object:",t.meta)});const p=M(()=>s.osgo),f=v=>t.getLocalizedName(v,a.value||"uz"),_=M({get:()=>p.value.drivedArea?.id||"",set:v=>{const c=t.findDrivedArea(v);c&&(p.value.drivedArea=c)}}),k=v=>{s.isEditable&&(p.value.vehicle||(p.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),p.value.vehicle.carType=v,l.isTelegramWebApp.value&&l.hapticImpact("light"))},g=v=>{s.isEditable&&(p.value.period=v,l.isTelegramWebApp.value&&l.hapticImpact("light"))},m=v=>{s.isEditable&&(p.value.incidentCoeff=v.coefficient,l.isTelegramWebApp.value&&l.hapticImpact("light"))};return(v,c)=>{const A=Rt;return u(),d("div",zt,[i(t).fetching?(u(),d("div",jt,[...c[4]||(c[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Загрузка данных...",-1)])])):i(t).error?(u(),d("div",Ht,[c[5]||(c[5]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,r(i(t).error),1),e("button",{onClick:c[0]||(c[0]=S=>i(t).fetchMeta(!0)),class:"btn-retry"}," Попробовать снова ")])):!i(t).isLoaded||i(t).carTypes.length===0?(u(),d("div",qt,[c[8]||(c[8]=e("i",{class:"bx bx-info-circle"},null,-1)),c[9]||(c[9]=e("p",null,"Нет данных. Загрузка...",-1)),e("p",Gt,[ge(" isLoaded: "+r(i(t).isLoaded),1),c[6]||(c[6]=e("br",null,null,-1)),ge(" carTypes: "+r(i(t).carTypes.length),1),c[7]||(c[7]=e("br",null,null,-1)),ge(" meta: "+r(i(t).meta?"exists":"null"),1)])])):(u(),d("div",Jt,[c[18]||(c[18]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Параметры полиса"),e("p",{class:"step-description"}," Выберите тип транспорта, период страхования и параметры использования ")],-1)),e("div",Zt,[e("div",Kt,[c[10]||(c[10]=e("h3",{class:"section-title"},"Тип транспортного средства",-1)),e("div",Qt,[(u(!0),d(ae,null,me(i(t).carTypes,S=>(u(),re(A,{key:S.id,title:f(S),active:p.value.vehicle?.carType?.id===S.id,disabled:!i(s).isEditable,onClick:O=>k(S)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",Xt,[c[11]||(c[11]=e("h3",{class:"section-title"},"Период страхования",-1)),e("div",es,[(u(!0),d(ae,null,me(i(t).periods,S=>(u(),re(A,{key:S.id,title:f(S),active:p.value.period?.id===S.id,disabled:!i(s).isEditable,onClick:O=>g(S)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",ts,[c[12]||(c[12]=e("h3",{class:"section-title"},"Количество водителей",-1)),e("div",ss,[F(A,{title:"Без ограничений",description:"Любое количество водителей",active:!p.value.driversLimited,disabled:!i(s).isEditable,onClick:c[1]||(c[1]=S=>p.value.driversLimited=!1)},null,8,["active","disabled"]),F(A,{title:"Ограниченное",description:"Указанные водители",active:p.value.driversLimited,disabled:!i(s).isEditable,onClick:c[2]||(c[2]=S=>p.value.driversLimited=!0)},null,8,["active","disabled"])])]),F(ie,{name:"slide-down"},{default:le(()=>[p.value.driversLimited?(u(),d("div",as,[c[13]||(c[13]=e("h3",{class:"section-title"},"Частота страховых случаев",-1)),e("div",is,[(u(!0),d(ae,null,me(i(t).incidentFrequencies,S=>(u(),re(A,{key:S.id,title:f(S),active:p.value.incidentCoeff===S.coefficient,disabled:!i(s).isEditable,onClick:O=>m(S)},null,8,["title","active","disabled","onClick"]))),128))])])):C("",!0)]),_:1}),e("div",ls,[c[16]||(c[16]=e("h3",{class:"section-title"},"Территория использования",-1)),e("div",os,[Ee(e("select",{"onUpdate:modelValue":c[3]||(c[3]=S=>_.value=S),class:"input",disabled:!i(s).isEditable},[c[14]||(c[14]=e("option",{value:"",disabled:""}," Выберите территорию ",-1)),(u(!0),d(ae,null,me(i(t).drivedAreas,S=>(u(),d("option",{key:S.id,value:S.id},r(f(S)),9,rs))),128))],8,ns),[[He,_.value]]),c[15]||(c[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),i(s).calculatedPremium>0?(u(),d("div",cs,[e("div",us,[c[17]||(c[17]=e("div",{class:"premium-label"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",ds,r(i(Le)(i(s).calculatedPremium)),1)])])):C("",!0)])]))])}}}),ps=ee(vs,[["__scopeId","data-v-9caa72cf"]]),fs=["for"],ms={key:0,class:"text-error"},hs={class:"input-wrapper"},bs={key:0,class:"input-icon input-icon-left"},ys=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],_s={key:2,class:"input-icon input-icon-right"},gs={key:1,class:"input-message"},$s={key:0,class:"error-message"},Ss={key:1,class:"helper-text"},ws={key:2,class:"input-count"},ks=X({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(n,{expose:s,emit:t}){const l=n,a=t,{locale:p}=ve(),f=M(()=>{if(l.type==="date")return p.value==="uz"?"uz-UZ":"ru-RU"}),_=Y(null),k=M(()=>`input-${Math.random().toString(36).substr(2,9)}`),g=M({get:()=>{const I=String(l.modelValue||"");if(l.dateMask&&I){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(I)||/^\d{2}-\d{2}-\d{4}$/.test(I))return I;if(/^\d{4}-\d{2}-\d{2}$/.test(I)){const D=I.split("-");return`${D[2]}-${D[1]}-${D[0]}`}}return I},set:I=>{if(l.uppercase&&(I=I.toUpperCase()),l.dateMask&&I){if(/^\d{4}-\d{2}-\d{2}$/.test(I)){a("update:modelValue",I);return}if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const D=I.split("-");a("update:modelValue",`${D[2]}-${D[1]}-${D[0]}`);return}a("update:modelValue",I);return}a("update:modelValue",I)}}),m=I=>{const D=I.target;let V=D.value;if(l.uppercase&&(V=V.toUpperCase(),D.value!==V&&(D.value=V)),l.dateMask){const Z=h(V);D.value!==Z&&(D.value=Z),a("update:modelValue",Z),a("input",Z);return}l.mask&&(V=E(V)),a("update:modelValue",V),a("input",V)},v=()=>{if(l.dateMask&&g.value){const I=String(g.value);if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const D=I.split("-"),V=`${D[2]}-${D[1]}-${D[0]}`,Z=new Date(V);isNaN(Z.getTime())||a("update:modelValue",V)}}a("blur")},c=()=>{a("focus")},A=I=>{},S=()=>{a("enter")},O=()=>{a("update:modelValue",""),_.value?.focus()},E=I=>{if(l.dateMask)return h(I);if(!l.mask)return I;let D="",V=0;const Z=I.replace(/\D/g,"");for(let oe=0;oe<l.mask.length&&V<Z.length;oe++){const te=l.mask[oe];te==="#"?(D+=Z[V],V++):D+=te}return D},h=I=>{const V=I.replace(/\D/g,"").slice(0,8);return V.length===0?"":V.length<=2?V:V.length<=4?`${V.slice(0,2)}-${V.slice(2)}`:`${V.slice(0,2)}-${V.slice(2,4)}-${V.slice(4)}`},R=()=>{_.value?.focus()},G=()=>{_.value?.blur()};return Ae(()=>{l.autofocus&&R()}),s({focus:R,blur:G}),(I,D)=>(u(),d("div",{class:se(["input-field",{"has-error":n.error}])},[n.label?(u(),d("label",{key:0,class:"input-label",for:k.value},[ge(r(n.label)+" ",1),n.required?(u(),d("span",ms,"*")):C("",!0)],8,fs)):C("",!0),e("div",hs,[n.icon?(u(),d("div",bs,[e("i",{class:se(n.icon)},null,2)])):C("",!0),Ee(e("input",{id:k.value,ref_key:"inputRef",ref:_,"onUpdate:modelValue":D[0]||(D[0]=V=>g.value=V),type:n.dateMask?"text":n.type,placeholder:n.dateMask?n.placeholder||"DD-MM-YYYY":n.placeholder,disabled:n.disabled,readonly:n.readonly,maxlength:n.dateMask?10:n.maxLength,autocomplete:n.autocomplete,inputmode:n.dateMask?"numeric":n.inputMode,lang:f.value,class:se(["input",{"input-with-icon-left":n.icon,"input-with-icon-right":n.clearable||n.loading,"input-error":n.error}]),onInput:m,onBlur:v,onFocus:c,onKeypress:A,onKeydown:Ge(S,["enter"])},null,42,ys),[[qe,g.value]]),n.clearable&&g.value&&!n.disabled&&!n.readonly?(u(),d("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:O},[...D[1]||(D[1]=[e("i",{class:"bx bx-x"},null,-1)])])):C("",!0),n.loading?(u(),d("div",_s,[...D[2]||(D[2]=[e("div",{class:"spinner-small"},null,-1)])])):C("",!0)]),n.helperText||n.error?(u(),d("div",gs,[n.error?(u(),d("span",$s,r(n.error),1)):n.helperText?(u(),d("span",Ss,r(n.helperText),1)):C("",!0)])):C("",!0),n.showCount&&n.maxLength?(u(),d("div",ws,r(g.value.length)+" / "+r(n.maxLength),1)):C("",!0)],2))}}),Ve=ee(ks,[["__scopeId","data-v-4eb39aee"]]);function xs(n){if(!n)return{valid:!1,error:"Государственный номер обязателен"};const s=n.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(s)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Ds(n){if(!n)return{valid:!1,error:"Серия техпаспорта обязательна"};const s=n.toUpperCase();return/^[A-Z]{2,3}$/.test(s)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Ns(n){return n?/^\d+$/.test(n)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const As={class:"step-container"},Vs={class:"step-content"},Ms={class:"form-section"},Os={class:"form-section"},Ps={class:"form-section"},Ts={class:"form-section"},Is=["disabled"],Cs={key:0,class:"spinner"},Es={key:0,class:"alert alert-error"},Ls={key:0,class:"vehicle-info-card"},Ys={class:"card-content"};const Fs={class:"vehicle-info-grid"},Bs={key:0,class:"vehicle-info-item"},Ws={class:"vehicle-info-value"},Us={key:1,class:"vehicle-info-item"},Rs={class:"vehicle-info-value"},zs={key:2,class:"vehicle-info-item"},js={class:"vehicle-info-value"},Hs={key:3,class:"vehicle-info-item"},qs={class:"vehicle-info-value"},Gs={key:4,class:"vehicle-info-item"},Js={class:"vehicle-info-value"},Zs={key:1,class:"vehicle-info-empty"},Ks=X({__name:"Step2Vehicle",setup(n){const s=ce();we();const t=pe(),l=M(()=>s.osgo),a=Y({}),p=M(()=>!!(l.value.vehicle?.govNumber&&l.value.vehicle?.techPassportSeries&&l.value.vehicle?.techPassportNumber&&Object.keys(a.value).length===0)),f=M(()=>{if(!l.value.vehicle)return 0;const g=l.value.vehicle;let m=0;return g.techPassportIssueDate&&m++,(g.modelName||g.model)&&m++,(g.createdYear||g.year)&&m++,g.engineNumber&&m++,g.bodyNumber&&m++,m}),_=g=>{if(!l.value.vehicle)return;let m;switch(g){case"govNumber":m=xs(l.value.vehicle.govNumber);break;case"techPassportSeries":m=Ds(l.value.vehicle.techPassportSeries);break;case"techPassportNumber":m=Ns(l.value.vehicle.techPassportNumber);break}m&&!m.valid?a.value[g]=m.error||"":delete a.value[g]},k=async()=>{if(_("govNumber"),_("techPassportSeries"),_("techPassportNumber"),Object.keys(a.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await s.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",l.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(l.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(g,m)=>{const v=Ve;return u(),d("div",As,[m[20]||(m[20]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Информация о транспорте"),e("p",{class:"step-description"}," Введите данные транспортного средства для проверки ")],-1)),e("div",Vs,[e("div",Ms,[F(v,{modelValue:l.value.vehicle.govNumber,"onUpdate:modelValue":m[0]||(m[0]=c=>l.value.vehicle.govNumber=c),label:"Государственный номер",placeholder:"01A000AA",disabled:!i(s).isEditable,error:a.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:m[1]||(m[1]=c=>_("govNumber"))},null,8,["modelValue","disabled","error"])]),e("div",Os,[F(v,{modelValue:l.value.vehicle.techPassportSeries,"onUpdate:modelValue":m[2]||(m[2]=c=>l.value.vehicle.techPassportSeries=c),label:"Серия техпаспорта",placeholder:"AAA",disabled:!i(s).isEditable,error:a.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:m[3]||(m[3]=c=>_("techPassportSeries"))},null,8,["modelValue","disabled","error"])]),e("div",Ps,[F(v,{modelValue:l.value.vehicle.techPassportNumber,"onUpdate:modelValue":m[4]||(m[4]=c=>l.value.vehicle.techPassportNumber=c),label:"Номер техпаспорта",placeholder:"1234567",disabled:!i(s).isEditable,error:a.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:m[5]||(m[5]=c=>_("techPassportNumber"))},null,8,["modelValue","disabled","error"])]),e("div",Ts,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!p.value||i(s).vehicleVerifying,onClick:k},[i(s).vehicleVerifying?(u(),d("span",Cs)):(u(),d(ae,{key:1},[m[6]||(m[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,r(i(s).vehicleVerified?"Проверено":"Проверить"),1)],64))],8,Is)]),i(s).vehicleVerifyError?(u(),d("div",Es,[m[7]||(m[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,r(i(s).vehicleVerifyError),1)])):C("",!0),F(ie,{name:"fade"},{default:le(()=>[i(s).vehicleVerified&&l.value.vehicle?(u(),d("div",Ls,[m[19]||(m[19]=e("div",{class:"card-header"},[e("i",{class:"bx bx-check-circle text-success"}),e("span",null,"Транспорт найден")],-1)),e("div",Ys,[C("",!0),e("div",Fs,[l.value.vehicle?.techPassportIssueDate?(u(),d("div",Bs,[m[14]||(m[14]=e("div",{class:"vehicle-info-label"},"Дата выдачи техпаспорта",-1)),e("div",Ws,r(i(Ce)(l.value.vehicle.techPassportIssueDate)),1)])):C("",!0),l.value.vehicle?.modelName||l.value.vehicle?.model?(u(),d("div",Us,[m[15]||(m[15]=e("div",{class:"vehicle-info-label"},"Модель",-1)),e("div",Rs,r(l.value.vehicle?.modelName||l.value.vehicle?.model||"-"),1)])):C("",!0),l.value.vehicle?.createdYear||l.value.vehicle?.year?(u(),d("div",zs,[m[16]||(m[16]=e("div",{class:"vehicle-info-label"},"Год выпуска",-1)),e("div",js,r(l.value.vehicle?.createdYear||l.value.vehicle?.year||"-"),1)])):C("",!0),l.value.vehicle?.engineNumber?(u(),d("div",Hs,[m[17]||(m[17]=e("div",{class:"vehicle-info-label"},"Номер двигателя",-1)),e("div",qs,r(l.value.vehicle.engineNumber),1)])):C("",!0),l.value.vehicle?.bodyNumber?(u(),d("div",Gs,[m[18]||(m[18]=e("div",{class:"vehicle-info-label"},"Номер кузова/шасси",-1)),e("div",Js,r(l.value.vehicle.bodyNumber),1)])):C("",!0)]),f.value===0?(u(),d("div",Zs," Нет данных о транспортном средстве ")):C("",!0)])])):C("",!0)]),_:1})])])}}}),Qs=ee(Ks,[["__scopeId","data-v-7b02d127"]]),Xs={class:"step-container"},ea={class:"step-header"},ta={class:"step-title"},sa={class:"step-description"},aa={class:"step-content"},ia={class:"subsection"},la={class:"subsection-title"},oa={class:"form-section"},na={class:"form-section"},ra={class:"form-section"},ca={class:"form-section"},ua=["disabled"],da={key:0,class:"spinner"},va={key:0,class:"info-card success"},pa={class:"card-header"},fa={class:"card-content"},ma={class:"info-grid"},ha={class:"info-item"},ba={class:"info-label"},ya={class:"info-value"},_a={class:"info-item"},ga={class:"info-label"},$a={class:"info-value"},Sa={class:"info-item info-item-wide"},wa={class:"info-label"},ka={class:"info-value"},xa={class:"info-item"},Da={class:"info-label"},Na={class:"info-value"},Aa={class:"info-item"},Va={class:"info-label"},Ma={class:"info-value"},Oa={class:"info-item"},Pa={class:"info-label"},Ta={class:"info-value"},Ia={class:"info-item"},Ca={class:"info-label"},Ea={class:"info-value"},La={class:"info-item"},Ya={class:"info-label"},Fa={class:"info-value"},Ba={class:"info-item"},Wa={class:"info-label"},Ua={class:"info-value"},Ra={class:"info-item"},za={class:"info-label"},ja={class:"info-value"},Ha={class:"info-item"},qa={class:"info-label"},Ga={class:"info-value"},Ja={class:"form-section"},Za={class:"checkbox-label"},Ka=["disabled"],Qa={key:0,class:"subsection"},Xa={class:"subsection-title"},ei={class:"form-section"},ti={class:"form-section"},si={class:"form-section"},ai={class:"form-section"},ii=["disabled"],li={key:0,class:"spinner"},oi={key:0,class:"info-card success"},ni={class:"card-header"},ri={class:"card-content"},ci={class:"info-grid"},ui={class:"info-item"},di={class:"info-label"},vi={class:"info-value"},pi={class:"info-item"},fi={class:"info-label"},mi={class:"info-value"},hi={class:"info-item info-item-wide"},bi={class:"info-label"},yi={class:"info-value"},_i={class:"info-item"},gi={class:"info-label"},$i={class:"info-value"},Si={class:"info-item"},wi={class:"info-label"},ki={class:"info-value"},xi={class:"info-item"},Di={class:"info-label"},Ni={class:"info-value"},Ai={class:"info-item"},Vi={class:"info-label"},Mi={class:"info-value"},Oi={class:"info-item"},Pi={class:"info-label"},Ti={class:"info-value"},Ii={class:"info-item"},Ci={class:"info-label"},Ei={class:"info-value"},Li={class:"info-item"},Yi={class:"info-label"},Fi={class:"info-value"},Bi={class:"info-item"},Wi={class:"info-label"},Ui={class:"info-value"},Ri=X({__name:"Step3Owner",setup(n){const s=ce(),t=pe(),{locale:l,t:a}=ve(),p=M(()=>s.osgo),f=M(()=>s.owner),_=M(()=>s.applicant),k=async()=>{try{await s.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},g=async()=>{try{await s.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(m,v)=>{const c=Ve;return u(),d("div",Xs,[e("div",ea,[e("h2",ta,r(i(a)("step3.title")),1),e("p",sa,r(i(a)("step3.description")),1)]),e("div",aa,[e("div",ia,[e("h3",la,r(i(a)("step3.owner")),1),e("div",oa,[F(c,{modelValue:f.value.passportSeries,"onUpdate:modelValue":v[0]||(v[0]=A=>f.value.passportSeries=A),label:i(a)("step3.passportSeries"),placeholder:i(a)("step3.passportSeriesPlaceholder"),disabled:!i(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",na,[F(c,{modelValue:f.value.passportNumber,"onUpdate:modelValue":v[1]||(v[1]=A=>f.value.passportNumber=A),label:i(a)("step3.passportNumber"),placeholder:i(a)("step3.passportNumberPlaceholder"),disabled:!i(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ra,[F(c,{modelValue:f.value.birthDate,"onUpdate:modelValue":v[2]||(v[2]=A=>f.value.birthDate=A),label:i(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!i(s).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",ca,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:i(s).ownerVerifying,onClick:k},[i(s).ownerVerifying?(u(),d("span",da)):(u(),d(ae,{key:1},[v[7]||(v[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,r(i(s).ownerVerified?i(a)("step3.verified"):i(a)("step3.verifyOwner")),1)],64))],8,ua)]),F(ie,{name:"fade"},{default:le(()=>[i(s).ownerVerified&&f.value.id?(u(),d("div",va,[e("div",pa,[v[8]||(v[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,r(i(a)("step3.ownerFound")),1)]),e("div",fa,[e("div",ma,[e("div",ha,[e("div",ba,r(i(a)("step3.passportIssueDate")),1),e("div",ya,r(f.value.passportIssueDate?i(Ce)(f.value.passportIssueDate):"-"),1)]),e("div",_a,[e("div",ga,r(i(a)("step3.pinfl")),1),e("div",$a,r(f.value.nationalIdentifier||"-"),1)]),e("div",Sa,[e("div",wa,r(i(a)("step3.issuedBy")),1),e("div",ka,r(f.value.passportIssuedBy||"-"),1)]),e("div",xa,[e("div",Da,r(i(a)("step3.lastName")),1),e("div",Na,r(f.value.lastName||"-"),1)]),e("div",Aa,[e("div",Va,r(i(a)("step3.firstName")),1),e("div",Ma,r(f.value.firstName||"-"),1)]),e("div",Oa,[e("div",Pa,r(i(a)("step3.middleName")),1),e("div",Ta,r(f.value.middleName||"-"),1)]),e("div",Ia,[e("div",Ca,r(i(a)("step3.gender")),1),e("div",Ea,r(f.value.gender?i(We)(f.value.gender,i(l).value):"-"),1)]),e("div",La,[e("div",Ya,r(i(a)("step3.country")),1),e("div",Fa,r(f.value.country?.langValue1||"-"),1)]),e("div",Ba,[e("div",Wa,r(i(a)("step3.region")),1),e("div",Ua,r(f.value.region?.langValue1||"-"),1)]),e("div",Ra,[e("div",za,r(i(a)("step3.district")),1),e("div",ja,r(f.value.district?.langValue1||"-"),1)]),e("div",Ha,[e("div",qa,r(i(a)("step3.street")),1),e("div",Ga,r(f.value.street||"-"),1)])])])])):C("",!0)]),_:1})]),e("div",Ja,[e("label",Za,[Ee(e("input",{"onUpdate:modelValue":v[3]||(v[3]=A=>p.value.applicantIsOwner=A),type:"checkbox",class:"checkbox",disabled:!i(s).isEditable},null,8,Ka),[[Je,p.value.applicantIsOwner]]),e("span",null,r(i(a)("step3.ownerIsApplicant")),1)])]),F(ie,{name:"slide-down"},{default:le(()=>[p.value.applicantIsOwner?C("",!0):(u(),d("div",Qa,[e("h3",Xa,r(i(a)("step3.applicant")),1),e("div",ei,[F(c,{modelValue:_.value.passportSeries,"onUpdate:modelValue":v[4]||(v[4]=A=>_.value.passportSeries=A),label:i(a)("step3.passportSeries"),placeholder:i(a)("step3.passportSeriesPlaceholder"),disabled:!i(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ti,[F(c,{modelValue:_.value.passportNumber,"onUpdate:modelValue":v[5]||(v[5]=A=>_.value.passportNumber=A),label:i(a)("step3.passportNumber"),placeholder:i(a)("step3.passportNumberPlaceholder"),disabled:!i(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",si,[F(c,{modelValue:_.value.birthDate,"onUpdate:modelValue":v[6]||(v[6]=A=>_.value.birthDate=A),label:i(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!i(s).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",ai,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:i(s).applicantVerifying,onClick:g},[i(s).applicantVerifying?(u(),d("span",li)):(u(),d(ae,{key:1},[v[9]||(v[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,r(i(s).applicantVerified?i(a)("step3.verified"):i(a)("step3.verifyApplicant")),1)],64))],8,ii)]),F(ie,{name:"fade"},{default:le(()=>[i(s).applicantVerified&&_.value.id?(u(),d("div",oi,[e("div",ni,[v[10]||(v[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,r(i(a)("step3.applicantFound")),1)]),e("div",ri,[e("div",ci,[e("div",ui,[e("div",di,r(i(a)("step3.passportIssueDate")),1),e("div",vi,r(_.value.passportIssueDate?i(Ce)(_.value.passportIssueDate):"-"),1)]),e("div",pi,[e("div",fi,r(i(a)("step3.pinfl")),1),e("div",mi,r(_.value.nationalIdentifier||"-"),1)]),e("div",hi,[e("div",bi,r(i(a)("step3.issuedBy")),1),e("div",yi,r(_.value.passportIssuedBy||"-"),1)]),e("div",_i,[e("div",gi,r(i(a)("step3.lastName")),1),e("div",$i,r(_.value.lastName||"-"),1)]),e("div",Si,[e("div",wi,r(i(a)("step3.firstName")),1),e("div",ki,r(_.value.firstName||"-"),1)]),e("div",xi,[e("div",Di,r(i(a)("step3.middleName")),1),e("div",Ni,r(_.value.middleName||"-"),1)]),e("div",Ai,[e("div",Vi,r(i(a)("step3.gender")),1),e("div",Mi,r(_.value.gender?i(We)(_.value.gender,i(l).value):"-"),1)]),e("div",Oi,[e("div",Pi,r(i(a)("step3.country")),1),e("div",Ti,r(_.value.country?.langValue1||"-"),1)]),e("div",Ii,[e("div",Ci,r(i(a)("step3.region")),1),e("div",Ei,r(_.value.region?.langValue1||"-"),1)]),e("div",Li,[e("div",Yi,r(i(a)("step3.district")),1),e("div",Fi,r(_.value.district?.langValue1||"-"),1)]),e("div",Bi,[e("div",Wi,r(i(a)("step3.street")),1),e("div",Ui,r(_.value.street||"-"),1)])])])])):C("",!0)]),_:1})]))]),_:1})])])}}}),zi=ee(Ri,[["__scopeId","data-v-62def220"]]),ji={class:"step-container"},Hi={class:"step-content"},qi={key:0,class:"info-card"},Gi={class:"actions-row"},Ji=["disabled"],Zi=["disabled"],Ki=["disabled"],Qi={key:0,class:"empty-state"},Xi={key:1,class:"drivers-list"},el={class:"driver-header"},tl={class:"driver-number"},sl=["onClick"],al={class:"driver-content"},il=["disabled","onClick"],ll={key:0,class:"driver-info"},ol={class:"info-row"},nl={class:"info-value"},rl={key:0,class:"info-row"},cl={class:"info-value"},ul=X({__name:"Step4Drivers",setup(n){const s=ce(),t=pe(),l=M(()=>s.osgo),a=M(()=>s.owner),p=M(()=>s.applicant),f=M(()=>s.hasDriver(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)),_=M(()=>s.hasDriver(p.value.passportSeries,p.value.passportNumber,p.value.birthDate)),k=()=>{s.addDriver(),t.isTelegramWebApp.value&&t.hapticImpact("light")},g=()=>{s.addOwnerAsDriver(),t.isTelegramWebApp.value&&t.hapticImpact("medium")},m=()=>{s.addApplicantAsDriver(),t.isTelegramWebApp.value&&t.hapticImpact("medium")},v=S=>{s.removeDriver(S),t.isTelegramWebApp.value&&t.hapticImpact("light")},c=S=>!!(S.passportSeries&&S.passportNumber&&S.birthDate),A=async S=>{try{const O=l.value.drivers[S],E=await s.verifyDriver(O);s.updateDriver(S,E),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(S,O)=>{const E=Ve;return u(),d("div",ji,[O[10]||(O[10]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Информация о водителях"),e("p",{class:"step-description"}," Добавьте водителей, допущенных к управлению транспортным средством ")],-1)),e("div",Hi,[l.value.driversLimited?(u(),d(ae,{key:1},[e("div",Gi,[e("button",{type:"button",class:"btn btn-primary-outlined",disabled:!i(s).isEditable,onClick:k},[...O[1]||(O[1]=[e("i",{class:"bx bx-plus"},null,-1),e("span",null,"Добавить водителя",-1)])],8,Ji),f.value?C("",!0):(u(),d("button",{key:0,type:"button",class:"btn btn-primary-outlined",disabled:!i(s).isEditable||!i(s).ownerVerified,onClick:g},[...O[2]||(O[2]=[e("i",{class:"bx bx-user"},null,-1),e("span",null,"Владелец - водитель",-1)])],8,Zi)),!l.value.applicantIsOwner&&!_.value?(u(),d("button",{key:1,type:"button",class:"btn btn-primary-outlined",disabled:!i(s).isEditable||!i(s).applicantVerified,onClick:m},[...O[3]||(O[3]=[e("i",{class:"bx bx-user"},null,-1),e("span",null,"Страхователь - водитель",-1)])],8,Ki)):C("",!0)]),l.value.drivers.length===0?(u(),d("div",Qi,[...O[4]||(O[4]=[e("i",{class:"bx bx-user-plus"},null,-1),e("p",null,"Добавьте хотя бы одного водителя",-1)])])):(u(),d("div",Xi,[(u(!0),d(ae,null,me(l.value.drivers,(h,R)=>(u(),d("div",{key:R,class:"driver-card"},[e("div",el,[e("div",tl,[O[5]||(O[5]=e("i",{class:"bx bx-user"},null,-1)),e("span",null,"Водитель "+r(R+1),1)]),i(s).isEditable?(u(),d("button",{key:0,type:"button",class:"btn-icon btn-danger",onClick:G=>v(R)},[...O[6]||(O[6]=[e("i",{class:"bx bx-trash"},null,-1)])],8,sl)):C("",!0)]),e("div",al,[F(E,{modelValue:h.passportSeries,"onUpdate:modelValue":G=>h.passportSeries=G,label:"Серия паспорта",placeholder:"AA",disabled:!i(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),F(E,{modelValue:h.passportNumber,"onUpdate:modelValue":G=>h.passportNumber=G,label:"Номер паспорта",placeholder:"1234567",disabled:!i(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),F(E,{modelValue:h.birthDate,"onUpdate:modelValue":G=>h.birthDate=G,label:"Дата рождения",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!i(s).isEditable,required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!c(h),onClick:G=>A(R)},[O[7]||(O[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,r(h.name?"Проверено":"Проверить"),1)],8,il),F(ie,{name:"fade"},{default:le(()=>[h.name?(u(),d("div",ll,[e("div",ol,[O[8]||(O[8]=e("span",{class:"info-label"},"ФИО:",-1)),e("span",nl,r(h.name),1)]),h.licenseNumber?(u(),d("div",rl,[O[9]||(O[9]=e("span",{class:"info-label"},"Водительское удостоверение:",-1)),e("span",cl,r(h.licenseNumber),1)])):C("",!0)])):C("",!0)]),_:2},1024)])]))),128))]))],64)):(u(),d("div",qi,[...O[0]||(O[0]=[e("i",{class:"bx bx-info-circle"},null,-1),e("div",null,[e("div",{class:"info-title"},"Неограниченное количество водителей"),e("div",{class:"info-text"}," Вы выбрали полис без ограничения по количеству водителей. Добавление водителей не требуется. ")],-1)])]))])])}}}),dl=ee(ul,[["__scopeId","data-v-2c37d9a6"]]),vl={class:"step-container"},pl={class:"step-content"},fl={class:"summary-section"},ml={class:"summary-card"},hl={class:"card-content"},bl={class:"info-row"},yl={class:"info-value-full"},_l={class:"summary-card"},gl={class:"card-content"},$l={class:"info-row"},Sl={class:"info-value-full"},wl={class:"summary-card"},kl={class:"card-content"},xl={class:"info-row"},Dl={class:"info-value-full"},Nl={class:"summary-card"},Al={class:"card-content"},Vl={class:"info-row"},Ml={class:"info-value-full"},Ol={class:"info-row"},Pl={class:"info-value-full"},Tl={class:"info-row"},Il={class:"info-value-full"},Cl={class:"summary-card"},El={class:"card-content"},Ll={class:"info-row"},Yl={class:"info-value-full"},Fl={class:"summary-section"},Bl={class:"form-section"},Wl={class:"form-section"},Ul={key:0,class:"form-section"},Rl={class:"premium-section"},zl={class:"premium-card-large"},jl={class:"premium-amount-large"},Hl=X({__name:"Step5Summary",setup(n){const s=v=>v.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "),t=ce(),l=we();pe(),Ne();const a=M(()=>t.osgo),p=M(()=>t.owner),f=M(()=>t.applicant);M(()=>t.fundData),Y(!1);const _=M({get:()=>(a.value.applicantIsOwner?p.value:f.value).phone||"",set:v=>{a.value.applicantIsOwner?(p.value.phone=v,a.value.party=p.value):(f.value.phone=v,a.value.party=f.value)}}),{locale:k}=ve(),g=()=>a.value.period?l.getLocalizedName(a.value.period,k.value||"uz"):"-",m=()=>a.value.drivedArea?l.getLocalizedName(a.value.drivedArea,k.value||"uz"):"-";return(v,c)=>{const A=Ve;return u(),d("div",vl,[c[10]||(c[10]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Подтверждение"),e("p",{class:"step-description"}," Проверьте данные полиса перед оформлением ")],-1)),e("div",pl,[e("div",fl,[c[7]||(c[7]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-file-blank"}),e("span",null,"Информация о страховке")],-1)),e("div",ml,[c[2]||(c[2]=e("div",{class:"card-title"},"Собственник",-1)),e("div",hl,[e("div",bl,[e("span",yl,r(p.value.name||"-")+r(p.value.birthDate?` (${p.value.birthDate})`:""),1)])])]),e("div",_l,[c[3]||(c[3]=e("div",{class:"card-title"},"Заявитель",-1)),e("div",gl,[e("div",$l,[e("span",Sl,r((a.value.applicantIsOwner?p.value:f.value).name||"-")+r((a.value.applicantIsOwner?p.value:f.value).birthDate?` (${(a.value.applicantIsOwner?p.value:f.value).birthDate})`:""),1)])])]),e("div",wl,[c[4]||(c[4]=e("div",{class:"card-title"},"Транспортное средство",-1)),e("div",kl,[e("div",xl,[e("span",Dl,r(a.value.vehicle?.modelName||a.value.vehicle?.model||"-")+" "+r(a.value.vehicle?.govNumber?` (${a.value.vehicle.govNumber})`:""),1)])])]),e("div",Nl,[c[5]||(c[5]=e("div",{class:"card-title"},"Условия страхования",-1)),e("div",Al,[e("div",Vl,[e("span",Ml,r(g()),1)]),e("div",Ol,[e("span",Pl,r(m()),1)]),e("div",Tl,[e("span",Il,r(a.value.driversLimited?`Ограниченно (${a.value.drivers?.length||0})`:"Не ограничено"),1)])])]),e("div",Cl,[c[6]||(c[6]=e("div",{class:"card-title"},"Страховая сумма",-1)),e("div",El,[e("div",Ll,[e("span",Yl,r(s(i(Ie)))+" сум",1)])])])]),e("div",Fl,[c[8]||(c[8]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-phone"}),e("span",null,"Контактные данные")],-1)),e("div",Bl,[F(A,{modelValue:_.value,"onUpdate:modelValue":c[0]||(c[0]=S=>_.value=S),label:"Номер телефона",placeholder:"+998 90 123 45 67",type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!i(t).isEditable,required:""},null,8,["modelValue","disabled"])]),e("div",Wl,[F(A,{modelValue:a.value.contractStartDate,"onUpdate:modelValue":c[1]||(c[1]=S=>a.value.contractStartDate=S),label:"Дата начала действия полиса",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",icon:"bx bx-calendar",disabled:!i(t).isEditable,required:""},null,8,["modelValue","disabled"])]),a.value.contractEndDate?(u(),d("div",Ul,[F(A,{"model-value":a.value.contractEndDate,label:"Дата окончания действия полиса",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",icon:"bx bx-calendar",disabled:""},null,8,["model-value"])])):C("",!0)]),e("div",Rl,[e("div",zl,[c[9]||(c[9]=e("div",{class:"premium-header"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",jl,r(i(Le)(i(t).calculatedPremium))+" сум ",1)])])])])}}}),ql=ee(Hl,[["__scopeId","data-v-832f148c"]]),Gl={class:"step-container"},Jl={class:"step-content"},Zl={class:"premium-section"},Kl={class:"premium-card-large"},Ql={class:"premium-amount-large"},Xl={class:"payment-section"},eo={class:"payment-buttons"},to=["disabled"],so={key:0,class:"payment-selected-indicator"},ao=["disabled"],io={key:0,class:"payment-selected-indicator"},lo=["disabled"],oo={key:0,class:"payment-selected-indicator"},no={class:"status-section"},ro=["disabled"],co={key:0,class:"ml-1"},uo={key:0,class:"error-message mt-2"},vo={key:0,class:"success-card"},po={class:"policy-details"},fo={class:"policy-row"},mo={class:"policy-value"},ho={class:"policy-row"},bo={class:"policy-value"},yo=X({__name:"Step6Payment",setup(n){const s=ce(),t=pe();Ne();const{t:l}=ve(),a=M(()=>s.osgo),p=M(()=>s.fundData);M(()=>(a.value.applicantIsOwner?s.owner:s.applicant).phone||"");const f=Y(!1),_=Y(null),k=Y(0),g=Y(null);let m=null;const v=M({get:()=>s.selectedPaymentMethod,set:E=>{s.selectedPaymentMethod=E}}),c=M(()=>g.value?g.value.toLowerCase().includes("оплачен")||g.value.toLowerCase().includes("успешно")?"status-success":g.value.toLowerCase().includes("ошибка")||g.value.toLowerCase().includes("не")?"status-error":"status-info":""),A=M(()=>c.value==="status-success"?"bx bx-check-circle":c.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),S=E=>{v.value===E?v.value=null:v.value=E,t.isTelegramWebApp.value&&t.hapticImpact("light")},O=async()=>{if(!a.value.id){_.value="Полис не создан";return}try{f.value=!0,_.value=null,g.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await s.fetchFundData(),p.value?.seria&&p.value?.number?(g.value="Оплата успешно завершена. Полис оформлен.",t.isTelegramWebApp.value&&t.hapticNotification("success")):p.value?g.value="Оплата обрабатывается. Проверьте статус позже.":g.value="Оплата не получена. Проверьте SMS или попробуйте снова.",k.value=15,m&&clearInterval(m),m=window.setInterval(()=>{k.value>0?k.value--:m&&(clearInterval(m),m=null)},1e3)}catch(E){console.error("[Step6Payment] Check status error:",E),_.value=E.message||"Ошибка при проверке статуса оплаты",g.value="Ошибка при проверке статуса. Попробуйте позже.",t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{f.value=!1}};return Ze(()=>{m&&clearInterval(m)}),(E,h)=>(u(),d("div",Gl,[h[21]||(h[21]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Оплата"),e("p",{class:"step-description"}," Выберите способ оплаты для завершения оформления полиса ")],-1)),e("div",Jl,[e("div",Zl,[e("div",Kl,[h[3]||(h[3]=e("div",{class:"premium-header"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",Ql,r(i(Le)(i(s).calculatedPremium))+" сум ",1)])]),e("div",Xl,[h[13]||(h[13]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-credit-card"}),e("span",null,"Выберите способ оплаты")],-1)),e("div",eo,[e("button",{type:"button",class:se(["payment-btn payme",{"payment-btn-selected":v.value==="payme"}]),disabled:f.value,onClick:h[0]||(h[0]=R=>S("payme"))},[h[5]||(h[5]=e("div",{class:"payment-icon"},"💳",-1)),h[6]||(h[6]=e("div",{class:"payment-name"},"Payme",-1)),v.value==="payme"?(u(),d("div",so,[...h[4]||(h[4]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):C("",!0)],10,to),e("button",{type:"button",class:se(["payment-btn click",{"payment-btn-selected":v.value==="click"}]),disabled:f.value,onClick:h[1]||(h[1]=R=>S("click"))},[h[8]||(h[8]=e("div",{class:"payment-icon"},"🔵",-1)),h[9]||(h[9]=e("div",{class:"payment-name"},"Click",-1)),v.value==="click"?(u(),d("div",io,[...h[7]||(h[7]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):C("",!0)],10,ao),e("button",{type:"button",class:se(["payment-btn uzum",{"payment-btn-selected":v.value==="uzum"}]),disabled:f.value,onClick:h[2]||(h[2]=R=>S("uzum"))},[h[11]||(h[11]=e("div",{class:"payment-icon"},"🟣",-1)),h[12]||(h[12]=e("div",{class:"payment-name"},"Uzum",-1)),v.value==="uzum"?(u(),d("div",oo,[...h[10]||(h[10]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):C("",!0)],10,lo)])]),e("div",no,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!k.value||f.value||!a.value.id,onClick:O},[h[14]||(h[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,r(i(l)("step5.checkStatus")),1),k.value?(u(),d("span",co,"("+r(k.value)+")",1)):C("",!0)],8,ro),F(ie,{name:"fade"},{default:le(()=>[_.value?(u(),d("div",uo,[h[15]||(h[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,r(_.value),1)])):C("",!0)]),_:1}),F(ie,{name:"fade"},{default:le(()=>[g.value?(u(),d("div",{key:0,class:se(["status-text",c.value])},[e("i",{class:se(A.value)},null,2),e("span",null,r(g.value),1)],2)):C("",!0)]),_:1})]),F(ie,{name:"fade"},{default:le(()=>[a.value.id&&p.value&&p.value.seria?(u(),d("div",vo,[h[18]||(h[18]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),h[19]||(h[19]=e("h3",{class:"success-title"},"Полис оформлен!",-1)),h[20]||(h[20]=e("p",{class:"success-description"}," Ваш полис ОСГО успешно оформлен и оплачен ",-1)),e("div",po,[e("div",fo,[h[16]||(h[16]=e("span",{class:"policy-label"},"Серия:",-1)),e("span",mo,r(p.value.seria),1)]),e("div",ho,[h[17]||(h[17]=e("span",{class:"policy-label"},"Номер:",-1)),e("span",bo,r(p.value.number),1)])])])):C("",!0)]),_:1})])]))}}),_o=ee(yo,[["__scopeId","data-v-f6910a80"]]),go={class:"min-h-screen flex flex-col"},$o={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},So={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},wo={class:"max-w-3xl mx-auto"},ko={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},xo=X({__name:"index",setup(n){const s=ce(),t=we(),l=pe();return Ae(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),s.initialize(),s.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{s.currentStep>0?s.previousStep():l.close()});const p=_e(()=>s.osgo,()=>{s.saveToSession()},{deep:!0});Fe(()=>{p()})}),Fe(()=>{s.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),Ke({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,p)=>(u(),d("div",go,[e("header",$o,[F(gt)]),e("main",So,[e("div",wo,[F(ie,{name:"fade",mode:"out-in"},{default:le(()=>[i(s).currentStep===i(W).PARAMS?(u(),re(ps,{key:i(W).PARAMS})):i(s).currentStep===i(W).VEHICLE?(u(),re(Qs,{key:i(W).VEHICLE})):i(s).currentStep===i(W).OWNER?(u(),re(zi,{key:i(W).OWNER})):i(s).currentStep===i(W).DRIVERS?(u(),re(dl,{key:i(W).DRIVERS})):i(s).currentStep===i(W).SUMMARY?(u(),re(ql,{key:i(W).SUMMARY})):i(s).currentStep===i(W).PAYMENT?(u(),re(_o,{key:i(W).PAYMENT})):C("",!0)]),_:1})])]),e("footer",ko,[F(Tt)])]))}}),Oo=ee(xo,[["__scopeId","data-v-8561f7bb"]]);export{Oo as default};
