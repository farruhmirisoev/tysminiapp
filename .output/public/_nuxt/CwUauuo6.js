import{e as ze,f as Ne,g as Oe,r as R,S as E,h as A,C as Ee,i as ve,j as Ie,k as te,l as ce,m as je,n as Pe,c as f,o as d,F as ae,p as ge,q as s,s as ee,t as o,a as e,v as qe,b as B,x as He,y as he,z as L,d as ke,A as fe,B as De,T as re,w as ne,D as Ge,E as Je,G as Ke,H as Ze,I as Fe,u as Qe,J as xe}from"./Bgki6tB3.js";import{_ as se}from"./DlAUqK2U.js";import{_ as Xe}from"./DgM-zN9R.js";function et(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ae={exports:{}},tt=Ae.exports,Re;function st(){return Re||(Re=1,(function(n,i){(function(t,l){n.exports=l()})(tt,(function(){var t=1e3,l=6e4,a=36e5,p="millisecond",h="second",u="minute",m="hour",V="day",g="week",c="month",D="quarter",w="year",C="date",y="Invalid Date",T=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(k){var b=["th","st","nd","rd"],v=k%100;return"["+k+(b[(v-20)%10]||b[v]||b[0])+"]"}},G=function(k,b,v){var S=String(k);return!S||S.length>=b?k:""+Array(b+1-S.length).join(v)+k},I={s:G,z:function(k){var b=-k.utcOffset(),v=Math.abs(b),S=Math.floor(v/60),_=v%60;return(b<=0?"+":"-")+G(S,2,"0")+":"+G(_,2,"0")},m:function k(b,v){if(b.date()<v.date())return-k(v,b);var S=12*(v.year()-b.year())+(v.month()-b.month()),_=b.clone().add(S,c),P=v-_<0,M=b.clone().add(S+(P?-1:1),c);return+(-(S+(v-_)/(P?_-M:M-_))||0)},a:function(k){return k<0?Math.ceil(k)||0:Math.floor(k)},p:function(k){return{M:c,y:w,w:g,d:V,D:C,h:m,m:u,s:h,ms:p,Q:D}[k]||String(k||"").toLowerCase().replace(/s$/,"")},u:function(k){return k===void 0}},x="en",O={};O[x]=$;var H="$isDayjsObject",ie=function(k){return k instanceof me||!(!k||!k[H])},X=function k(b,v,S){var _;if(!b)return x;if(typeof b=="string"){var P=b.toLowerCase();O[P]&&(_=P),v&&(O[P]=v,_=P);var M=b.split("-");if(!_&&M.length>1)return k(M[0])}else{var U=b.name;O[U]=b,_=U}return!S&&_&&(x=_),_||!S&&x},q=function(k,b){if(ie(k))return k.clone();var v=typeof b=="object"?b:{};return v.date=k,v.args=arguments,new me(v)},F=I;F.l=X,F.i=ie,F.w=function(k,b){return q(k,{locale:b.$L,utc:b.$u,x:b.$x,$offset:b.$offset})};var me=(function(){function k(v){this.$L=X(v.locale,null,!0),this.parse(v),this.$x=this.$x||v.x||{},this[H]=!0}var b=k.prototype;return b.parse=function(v){this.$d=(function(S){var _=S.date,P=S.utc;if(_===null)return new Date(NaN);if(F.u(_))return new Date;if(_ instanceof Date)return new Date(_);if(typeof _=="string"&&!/Z$/i.test(_)){var M=_.match(T);if(M){var U=M[2]-1||0,z=(M[7]||"0").substring(0,3);return P?new Date(Date.UTC(M[1],U,M[3]||1,M[4]||0,M[5]||0,M[6]||0,z)):new Date(M[1],U,M[3]||1,M[4]||0,M[5]||0,M[6]||0,z)}}return new Date(_)})(v),this.init()},b.init=function(){var v=this.$d;this.$y=v.getFullYear(),this.$M=v.getMonth(),this.$D=v.getDate(),this.$W=v.getDay(),this.$H=v.getHours(),this.$m=v.getMinutes(),this.$s=v.getSeconds(),this.$ms=v.getMilliseconds()},b.$utils=function(){return F},b.isValid=function(){return this.$d.toString()!==y},b.isSame=function(v,S){var _=q(v);return this.startOf(S)<=_&&_<=this.endOf(S)},b.isAfter=function(v,S){return q(v)<this.startOf(S)},b.isBefore=function(v,S){return this.endOf(S)<q(v)},b.$g=function(v,S,_){return F.u(v)?this[S]:this.set(_,v)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(v,S){var _=this,P=!!F.u(S)||S,M=F.p(v),U=function(de,Z){var le=F.w(_.$u?Date.UTC(_.$y,Z,de):new Date(_.$y,Z,de),_);return P?le:le.endOf(V)},z=function(de,Z){return F.w(_.toDate()[de].apply(_.toDate("s"),(P?[0,0,0,0]:[23,59,59,999]).slice(Z)),_)},j=this.$W,J=this.$M,Q=this.$D,oe="set"+(this.$u?"UTC":"");switch(M){case w:return P?U(1,0):U(31,11);case c:return P?U(1,J):U(0,J+1);case g:var ue=this.$locale().weekStart||0,_e=(j<ue?j+7:j)-ue;return U(P?Q-_e:Q+(6-_e),J);case V:case C:return z(oe+"Hours",0);case m:return z(oe+"Minutes",1);case u:return z(oe+"Seconds",2);case h:return z(oe+"Milliseconds",3);default:return this.clone()}},b.endOf=function(v){return this.startOf(v,!1)},b.$set=function(v,S){var _,P=F.p(v),M="set"+(this.$u?"UTC":""),U=(_={},_[V]=M+"Date",_[C]=M+"Date",_[c]=M+"Month",_[w]=M+"FullYear",_[m]=M+"Hours",_[u]=M+"Minutes",_[h]=M+"Seconds",_[p]=M+"Milliseconds",_)[P],z=P===V?this.$D+(S-this.$W):S;if(P===c||P===w){var j=this.clone().set(C,1);j.$d[U](z),j.init(),this.$d=j.set(C,Math.min(this.$D,j.daysInMonth())).$d}else U&&this.$d[U](z);return this.init(),this},b.set=function(v,S){return this.clone().$set(v,S)},b.get=function(v){return this[F.p(v)]()},b.add=function(v,S){var _,P=this;v=Number(v);var M=F.p(S),U=function(J){var Q=q(P);return F.w(Q.date(Q.date()+Math.round(J*v)),P)};if(M===c)return this.set(c,this.$M+v);if(M===w)return this.set(w,this.$y+v);if(M===V)return U(1);if(M===g)return U(7);var z=(_={},_[u]=l,_[m]=a,_[h]=t,_)[M]||1,j=this.$d.getTime()+v*z;return F.w(j,this)},b.subtract=function(v,S){return this.add(-1*v,S)},b.format=function(v){var S=this,_=this.$locale();if(!this.isValid())return _.invalidDate||y;var P=v||"YYYY-MM-DDTHH:mm:ssZ",M=F.z(this),U=this.$H,z=this.$m,j=this.$M,J=_.weekdays,Q=_.months,oe=_.meridiem,ue=function(Z,le,be,we){return Z&&(Z[le]||Z(S,P))||be[le].slice(0,we)},_e=function(Z){return F.s(U%12||12,Z,"0")},de=oe||function(Z,le,be){var we=Z<12?"AM":"PM";return be?we.toLowerCase():we};return P.replace(Y,(function(Z,le){return le||(function(be){switch(be){case"YY":return String(S.$y).slice(-2);case"YYYY":return F.s(S.$y,4,"0");case"M":return j+1;case"MM":return F.s(j+1,2,"0");case"MMM":return ue(_.monthsShort,j,Q,3);case"MMMM":return ue(Q,j);case"D":return S.$D;case"DD":return F.s(S.$D,2,"0");case"d":return String(S.$W);case"dd":return ue(_.weekdaysMin,S.$W,J,2);case"ddd":return ue(_.weekdaysShort,S.$W,J,3);case"dddd":return J[S.$W];case"H":return String(U);case"HH":return F.s(U,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return de(U,z,!0);case"A":return de(U,z,!1);case"m":return String(z);case"mm":return F.s(z,2,"0");case"s":return String(S.$s);case"ss":return F.s(S.$s,2,"0");case"SSS":return F.s(S.$ms,3,"0");case"Z":return M}return null})(Z)||M.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(v,S,_){var P,M=this,U=F.p(S),z=q(v),j=(z.utcOffset()-this.utcOffset())*l,J=this-z,Q=function(){return F.m(M,z)};switch(U){case w:P=Q()/12;break;case c:P=Q();break;case D:P=Q()/3;break;case g:P=(J-j)/6048e5;break;case V:P=(J-j)/864e5;break;case m:P=J/a;break;case u:P=J/l;break;case h:P=J/t;break;default:P=J}return _?P:F.a(P)},b.daysInMonth=function(){return this.endOf(c).$D},b.$locale=function(){return O[this.$L]},b.locale=function(v,S){if(!v)return this.$L;var _=this.clone(),P=X(v,S,!0);return P&&(_.$L=P),_},b.clone=function(){return F.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},k})(),Se=me.prototype;return q.prototype=Se,[["$ms",p],["$s",h],["$m",u],["$H",m],["$W",V],["$M",c],["$y",w],["$D",C]].forEach((function(k){Se[k[1]]=function(b){return this.$g(b,k[0],k[1])}})),q.extend=function(k,b){return k.$i||(k(b,me,q),k.$i=!0),q},q.locale=X,q.isDayjs=ie,q.unix=function(k){return q(1e3*k)},q.en=O[x],q.Ls=O,q.p={},q}))})(Ae)),Ae.exports}var at=st();const $e=et(at);function Me(n,i="сум"){return n==null||isNaN(n)?`0 ${i}`:`${n.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${i}`}function Ce(n){return n?$e(n).format("DD.MM.YYYY"):""}function Ue(n,i="ru"){if(!n)return"";const t=String(n).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?i==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?i==="uz"?"Ayol":"Женский":String(n)}function it(n){if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;if(/^\d{2}-\d{2}-\d{4}$/.test(n)){const i=n.split("-");return`${i[2]}-${i[1]}-${i[0]}`}try{return $e(n,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return n}}const pe=ze("osgo",()=>{const n=Ne(),i=Oe(),t=R({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),l=R({passportSeries:"",passportNumber:"",birthDate:""}),a=R({passportSeries:"",passportNumber:"",birthDate:""}),p=R(E.PARAMS),h=R(!1),u=R(null),m=R(!1),V=R(null),g=R(null),c=R(null),D=R(!1),w=R(null),C=R(!1),y=R(!1),T=R(null),Y=R(!1),$=R(!1),G=R(null),I=R(!1),x=R(!1),O=R(null),H=A(()=>t.value.status==="DRAFT"),ie=A(()=>oe(p.value).valid),X=A(()=>Object.keys(E).length-1),q=r=>r<=E.OWNER?r+1:r===E.DRIVERS?-1:r,F=A(()=>q(p.value)),me=A(()=>{const r=F.value;return Math.round(r/X.value*100)}),Se=A(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,N=t.value.period.coefficient||0,W=t.value.drivedArea.coefficient||0;let K=3;t.value.driversLimited&&t.value.incidentCoeff&&(K=t.value.incidentCoeff);const Ve=r*N*K*W,Ye=Ve>5*r?Ee*5*r:Ee*Ve/100;return Math.round(Ye)}),k=A(()=>{const N=(t.value.entriesJournalKt||[]).reduce((W,K)=>W+(K.amount||0),0);return t.value.premium-N}),b=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},p.value=E.PARAMS,n.isLoaded&&(t.value.discountType=n.getDefaultDiscountType())};ve(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ve(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ve(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const N=parseInt(r.slice(0,2)),W=n.findDrivedAreaByRegion(N);W&&(t.value.drivedArea=W)}),ve(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=Se.value},{deep:!0}),ve(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const v=async()=>{if(t.value.vehicle){C.value=!0,T.value=null,y.value=!1;try{const r=await i.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),N=r?.result||r;if(r?.error&&!N)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&N&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,N),N?.carType&&n.isLoaded&&(t.value.vehicle.carType=n.findCarType(N.carType.id)),y.value=!0,console.log("[OsgoStore] Vehicle verified:",N)}catch(r){throw T.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{C.value=!1}}},S=async()=>{Y.value=!0,G.value=null,$.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(a.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.party={...l.value},x.value=!0)),$.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(r){throw G.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{Y.value=!1}},_=async()=>{I.value=!0,O.value=null,x.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",r),r&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...r},t.value.party={...a.value}),x.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(r){throw O.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{I.value=!1}},P=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const N=it(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:N});const W=await i.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:N});if(console.log("[OsgoStore] Driver verification result:",W),!W||!W.id)throw new Error("Driver verification failed: invalid response");const K={...r,...W,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",K),K}catch(N){throw console.error("[OsgoStore] Driver verification failed:",N),N}},M=r=>{t.value.drivers||(t.value.drivers=[]);const N={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(N),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},U=(r,N)=>{t.value.drivers[r]&&(t.value.drivers[r]=N)},z=r=>{t.value.drivers.splice(r,1)},j=(r,N,W)=>t.value.drivers.some(K=>K.passportSeries===r&&K.passportNumber===N&&K.birthDate===W),J=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(j(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}M({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},Q=()=>{j(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||M({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},oe=r=>{switch(r){case E.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case E.VEHICLE:return{valid:y.value};case E.OWNER:return{valid:$.value&&(t.value.applicantIsOwner||x.value)};case E.DRIVERS:return{valid:!0};case E.SUMMARY:const N=t.value.applicantIsOwner?l.value.id:a.value.id;return{valid:!!(l.value.id&&N&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(W=>W.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case E.PAYMENT:return{valid:!!(t.value.id&&w.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:a,currentStep:p,saving:h,saveError:u,fetching:m,fetchError:V,fundData:g,fundError:c,fetchingFundData:D,selectedPaymentMethod:w,vehicleVerifying:C,vehicleVerified:y,vehicleVerifyError:T,ownerVerifying:Y,ownerVerified:$,ownerVerifyError:G,applicantVerifying:I,applicantVerified:x,applicantVerifyError:O,isEditable:H,canProceedToNextStep:ie,totalSteps:X,displayStepNumber:F,progressPercentage:me,calculatedPremium:Se,amountPayable:k,initialize:b,verifyVehicle:v,verifyOwner:S,verifyApplicant:_,verifyDriver:P,addDriver:M,updateDriver:U,removeDriver:z,hasDriver:j,addOwnerAsDriver:J,addApplicantAsDriver:Q,validateStepData:oe,nextStep:()=>{p.value===E.OWNER?p.value=E.SUMMARY:p.value<E.PAYMENT&&p.value++},previousStep:()=>{p.value===E.SUMMARY?p.value=E.OWNER:p.value>0&&p.value--},goToStep:r=>{r>=0&&r<X.value&&(p.value=r)},createPolicy:async()=>{h.value=!0,u.value=null;try{let r=null;try{r=await i.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Te){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Te),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const N=t.value.applicantIsOwner?{...l.value}:{...a.value};N.phone&&(N.phone=N.phone.replace(/[+()-]/g,""));const W={...l.value},K=t.value.discountType||n.meta?.beneficiary?.find(({coefficient:Te})=>Te===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const We={party:N,beneficiary:W,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:K,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Be={user:r,osgo:We};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:N.id,name:N.name},beneficiary:{id:W.id,name:W.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:K?.id}}});const ye=await i.createOsgoApplication(Be);if(!ye||typeof ye!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ye),new Error("Failed to create policy: invalid response");return t.value.id=ye,t.value.applicantIsOwner?(l.value.phone=N.phone,t.value.party=l.value):(a.value.phone=N.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",ye),ye}catch(r){throw u.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{h.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");h.value=!0,u.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?l.value:a.value,beneficiary:l.value};await i.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw u.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{h.value=!1}},fetchPolicy:async r=>{m.value=!0,V.value=null;try{const N=await i.fetchOsgoEntity(r);if(t.value=N,N.party?.id){const W=await i.fetchIndividualEntity(N.party.id);a.value=W,t.value.party=W}if(N.beneficiary?.id){const W=await i.fetchIndividualEntity(N.beneficiary.id);l.value=W,t.value.beneficiary=W}if(n.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=n.findCarType(t.value.vehicle.carType.id)),n.isLoaded&&t.value.period&&(t.value.period=n.findPeriod(t.value.period.id)),n.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=n.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const W=Math.max(...t.value.drivers.map(K=>K.incidentFrequency?.coefficient||0));t.value.incidentCoeff=W}console.log("[OsgoStore] Policy fetched:",r)}catch(N){throw V.value=N.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",N),N}finally{m.value=!1}},fetchFundData:async()=>{if(t.value.id){D.value=!0,c.value=null;try{const r=await i.getFundPolicy(t.value.id);g.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){c.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{D.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:l.value,applicant:a.value,currentStep:p.value};sessionStorage.setItem(Ie.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Ie.OSGO_DRAFT);if(!r)return!1;const N=JSON.parse(r);return t.value=N.osgo,l.value=N.owner,a.value=N.applicant,p.value=N.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Ie.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{b(),y.value=!1,$.value=!1,x.value=!1,g.value=null,u.value=null,V.value=null}}}),ot={class:"language-switcher"},lt=["onClick"],rt=te({__name:"LanguageSwitcher",setup(n){const{locale:i,locales:t}=ce();je();const l=A(()=>i.value),a=A(()=>t.value.filter(h=>h.code!==i.value)),p=h=>{i.value=h,typeof window<"u"&&localStorage.setItem("app-language",h),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Pe(()=>{if(typeof window<"u"){const h=localStorage.getItem("app-language");h&&(h==="ru"||h==="uz")&&(i.value=h)}}),(h,u)=>(d(),f("div",ot,[(d(!0),f(ae,null,ge(s(a),m=>(d(),f("button",{key:m.code,class:ee(["lang-btn",{active:s(l)===m.code}]),onClick:V=>p(m.code)},o(m.code.toUpperCase()),11,lt))),128))]))}}),nt=se(rt,[["__scopeId","data-v-e748ef5d"]]),ct={class:"progress-bar-container"},ut={class:"progress-track"},dt={class:"steps-container"},pt=["onClick"],vt={key:0,class:"step-check"},ft={key:1,class:"step-number"},ht={class:"step-label"},mt=te({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(n){const i=n,{t}=ce(),l=A(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),a=u=>u<=2?u:u+1,p=A(()=>(i.currentStep+1)/i.totalSteps*100),h=u=>{console.log("Step clicked:",u)};return(u,m)=>(d(),f("div",ct,[e("div",ut,[e("div",{class:"progress-fill",style:qe({width:`${p.value}%`})},null,4)]),e("div",dt,[(d(!0),f(ae,null,ge(l.value,(V,g)=>(d(),f("div",{key:g,class:"step-wrapper",onClick:c=>h(g)},[e("div",{class:ee(["step-circle",{"step-active":a(g)===n.currentStep,"step-completed":a(g)<n.currentStep&&a(g)!==s(E).DRIVERS,"step-pending":a(g)>n.currentStep}])},[a(g)<n.currentStep&&a(g)!==s(E).DRIVERS?(d(),f("span",vt,"✓")):(d(),f("span",ft,o(g+1),1))],2),e("div",ht,o(V),1)],8,pt))),128))])]))}}),_t=se(mt,[["__scopeId","data-v-7805c614"]]),bt={class:"fixed-header"},yt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},gt={class:"flex items-center justify-between mb-3"},$t=te({__name:"AppHeader",setup(n){const i=pe(),t=A(()=>i.currentStep),l=A(()=>i.totalSteps);return(a,p)=>{const h=nt,u=_t;return d(),f("header",bt,[e("div",yt,[e("div",gt,[p[0]||(p[0]=He('<div class="flex items-center gap-3" data-v-67b64b56><div class="w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg" data-v-67b64b56><img src="'+Xe+'" alt="Temiryo&#39;l Sug&#39;urta Logo" data-v-67b64b56></div><div data-v-67b64b56><div class="text-base font-bold text-text" data-v-67b64b56>ОСГОВТС</div><div class="text-xs text-text-light" data-v-67b64b56> Temiryo&#39;l Sug&#39;urta </div></div></div>',1)),B(h)]),B(u,{"current-step":t.value,"total-steps":l.value},null,8,["current-step","total-steps"])])])}}}),St=se($t,[["__scopeId","data-v-67b64b56"]]),wt={class:"fixed-footer"},Dt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},xt=["disabled"],Nt={class:"flex-1 text-center"},kt={class:"text-sm text-text-light font-medium"},At=["disabled"],Mt={key:0,class:"spinner"},Ot={key:0},Pt={key:1},Vt={key:2},Tt={key:3,class:"text-lg bx bx-chevron-right"},It=te({__name:"AppFooter",setup(n){const i=pe(),t=he(),l=Oe(),{t:a}=ce(),p=R(!1),h=R(null),u=R(null),m=A(()=>i.currentStep),V=A(()=>i.totalSteps),g=A(()=>i.displayStepNumber),c=A(()=>m.value===0),D=A(()=>m.value===E.PAYMENT),w=A(()=>i.canProceedToNextStep),C=A(()=>i.saving||i.fetching||p.value),y=()=>{c.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),i.previousStep())},T=async()=>{if(!w.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(m.value===E.VEHICLE&&!i.vehicleVerified)await i.verifyVehicle();else if(m.value===E.OWNER)i.ownerVerified||await i.verifyOwner(),!i.osgo.applicantIsOwner&&!i.applicantVerified&&await i.verifyApplicant();else if(m.value===E.SUMMARY)i.osgo.id||(await i.createPolicy(),console.log("[AppFooter] Policy created:",i.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(m.value===E.PAYMENT){if(!i.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const $={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[i.selectedPaymentMethod],G=i.osgo.id,x=(i.osgo.applicantIsOwner?i.owner:i.applicant).phone||"",O=i.calculatedPremium;if(!G||!x||!O){const H="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:G,phone:x,amount:O}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(H));return}try{p.value=!0,h.value=null,u.value=null,await l.sendPaymentLink($,G,x,O),u.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(H){h.value=H.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",H),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(h.value))}finally{p.value=!1}return}D.value?console.log("[AppFooter] Last step reached"):i.nextStep()}catch(Y){console.error("[AppFooter] Error:",Y),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(Y.message||a("errors.unknown")))}};return(Y,$)=>(d(),f("footer",wt,[e("div",Dt,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:c.value||C.value,onClick:y},[$[0]||($[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,o(Y.$t("common.previous")),1)],8,xt),e("div",Nt,[e("div",kt,o(Y.$t("common.step",{current:g.value,total:V.value})),1)]),e("button",{type:"button",class:ee(["btn flex-1 max-w-[160px]",{"btn-primary":!D.value||m.value!==s(E).PAYMENT,"btn-success":D.value&&m.value===s(E).PAYMENT}]),disabled:!w.value||C.value,onClick:T},[C.value?(d(),f("span",Mt)):(d(),f(ae,{key:1},[m.value===s(E).SUMMARY&&!s(i).osgo.id?(d(),f("span",Ot,o(Y.$t("step5.confirm")),1)):D.value&&m.value===s(E).PAYMENT?(d(),f("span",Pt,[$[1]||($[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(Y.$t("step5.payment")),1)])):(d(),f("span",Vt,o(Y.$t("common.next")),1)),!D.value&&m.value!==s(E).SUMMARY?(d(),f("i",Tt)):L("",!0)],64))],10,At)])]))}}),Et=se(It,[["__scopeId","data-v-9a015344"]]),Ct={class:"step-container"},Lt={key:0,class:"loading-state"},Yt={key:1,class:"error-state"},Ft={key:2,class:"error-state"},Rt={class:"debug-info"},Ut={key:3},Wt={class:"step-header"},Bt={class:"step-title"},zt={class:"step-description"},jt={class:"step-content"},qt={class:"form-section"},Ht={class:"section-title"},Gt={class:"select-wrapper"},Jt=["disabled"],Kt=["value"],Zt={class:"form-section"},Qt={class:"section-title"},Xt={class:"select-wrapper"},es=["disabled"],ts=["value"],ss={class:"form-section",style:{display:"none"}},as={class:"section-title"},is={class:"select-wrapper"},os=["disabled"],ls={value:"false"},rs={value:"true"},ns={key:0,class:"form-section"},cs={class:"section-title"},us={class:"select-wrapper"},ds=["disabled"],ps=["value"],vs={class:"form-section"},fs={class:"section-title"},hs={class:"select-wrapper"},ms=["disabled"],_s=["value"],bs={key:0,class:"premium-card"},ys={class:"premium-card-content"},gs={class:"premium-label"},$s={class:"premium-amount"},Ss=te({__name:"Step1Params",setup(n){const i=pe(),t=Ne(),l=he(),{locale:a,t:p}=ce(),h=()=>{t.isLoaded&&(!u.value.vehicle?.carType?.id&&t.carTypes.length>0&&(V.value=t.carTypes[0].id),!u.value.period?.id&&t.periods.length>0&&(g.value=t.periods[0].id),!u.value.drivedArea?.id&&t.drivedAreas.length>0&&(w.value=t.drivedAreas[0].id),u.value.driversLimited===void 0&&(c.value="false"),u.value.driversLimited&&!u.value.incidentCoeff&&t.incidentFrequencies.length>0&&(D.value=t.incidentFrequencies[0].coefficient.toString()))};ve(()=>t.isLoaded,C=>{C&&setTimeout(()=>{h()},0)},{immediate:!0}),Pe(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Car types:",t.carTypes),console.log("[Step1Params] Periods count:",t.periods.length),console.log("[Step1Params] Meta object:",t.meta),h()});const u=A(()=>i.osgo),m=C=>t.getLocalizedName(C,a.value||"uz"),V=A({get:()=>u.value.vehicle?.carType?.id||"",set:C=>{if(!i.isEditable)return;const y=t.carTypes.find(T=>T.id===C);y&&(u.value.vehicle||(u.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),u.value.vehicle.carType=y,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),g=A({get:()=>u.value.period?.id||"",set:C=>{if(!i.isEditable)return;const y=t.periods.find(T=>T.id===C);y&&(u.value.period=y,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),c=A({get:()=>(u.value.driversLimited===void 0&&(u.value.driversLimited=!1),u.value.driversLimited?"true":"false"),set:C=>{i.isEditable&&(u.value.driversLimited=C==="true",u.value.driversLimited||(u.value.incidentCoeff=void 0),l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),D=A({get:()=>u.value.incidentCoeff?.toString()||"",set:C=>{if(!i.isEditable)return;const y=parseFloat(C);isNaN(y)||(u.value.incidentCoeff=y,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),w=A({get:()=>u.value.drivedArea?.id||"",set:C=>{const y=t.findDrivedArea(C);y&&(u.value.drivedArea=y)}});return(C,y)=>(d(),f("div",Ct,[s(t).fetching?(d(),f("div",Lt,[y[6]||(y[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,o(s(p)("common.loading")),1)])):s(t).error?(d(),f("div",Yt,[y[7]||(y[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,o(s(t).error),1),e("button",{onClick:y[0]||(y[0]=T=>s(t).fetchMeta(!0)),class:"btn-retry"},o(s(p)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(d(),f("div",Ft,[y[10]||(y[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,o(s(p)("common.loading")),1),e("p",Rt,[ke(" isLoaded: "+o(s(t).isLoaded),1),y[8]||(y[8]=e("br",null,null,-1)),ke(" carTypes: "+o(s(t).carTypes.length),1),y[9]||(y[9]=e("br",null,null,-1)),ke(" meta: "+o(s(t).meta?"exists":"null"),1)])])):(d(),f("div",Ut,[e("div",Wt,[e("h2",Bt,o(s(p)("step1.title")),1),e("p",zt,o(s(p)("step1.description")),1)]),e("div",jt,[e("div",qt,[e("h3",Ht,o(s(p)("step1.vehicleType")),1),e("div",Gt,[fe(e("select",{"onUpdate:modelValue":y[1]||(y[1]=T=>V.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).carTypes,T=>(d(),f("option",{key:T.id,value:T.id},o(m(T)),9,Kt))),128))],8,Jt),[[De,V.value]]),y[11]||(y[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",Zt,[e("h3",Qt,o(s(p)("step1.period")),1),e("div",Xt,[fe(e("select",{"onUpdate:modelValue":y[2]||(y[2]=T=>g.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).periods,T=>(d(),f("option",{key:T.id,value:T.id},o(m(T)),9,ts))),128))],8,es),[[De,g.value]]),y[12]||(y[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",ss,[e("h3",as,o(s(p)("step1.driversLimited")),1),e("div",is,[fe(e("select",{"onUpdate:modelValue":y[3]||(y[3]=T=>c.value=T),class:"input",disabled:!s(i).isEditable},[e("option",ls,o(s(p)("step1.driversLimitedNo"))+" - "+o(s(p)("step1.driversLimitedNoDesc")),1),e("option",rs,o(s(p)("step1.driversLimitedYes"))+" - "+o(s(p)("step1.driversLimitedYesDesc")),1)],8,os),[[De,c.value]]),y[13]||(y[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),B(re,{name:"slide-down"},{default:ne(()=>[u.value.driversLimited?(d(),f("div",ns,[e("h3",cs,o(s(p)("step1.incidentFrequency")),1),e("div",us,[fe(e("select",{"onUpdate:modelValue":y[4]||(y[4]=T=>D.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).incidentFrequencies,T=>(d(),f("option",{key:T.id,value:T.coefficient},o(m(T)),9,ps))),128))],8,ds),[[De,D.value]]),y[14]||(y[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])])):L("",!0)]),_:1}),e("div",vs,[e("h3",fs,o(s(p)("step1.usageTerritory")),1),e("div",hs,[fe(e("select",{"onUpdate:modelValue":y[5]||(y[5]=T=>w.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).drivedAreas,T=>(d(),f("option",{key:T.id,value:T.id},o(m(T)),9,_s))),128))],8,ms),[[De,w.value]]),y[15]||(y[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),s(i).calculatedPremium>0?(d(),f("div",bs,[e("div",ys,[e("div",gs,[y[16]||(y[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(p)("step1.premium")),1)]),e("div",$s,o(s(Me)(s(i).calculatedPremium)),1)])])):L("",!0)])]))]))}}),ws=se(Ss,[["__scopeId","data-v-dd7fd0cf"]]),Ds=["for"],xs={key:0,class:"text-error"},Ns={class:"input-wrapper"},ks={key:0,class:"input-icon input-icon-left"},As=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Ms={key:2,class:"input-icon input-icon-right"},Os={key:1,class:"input-message"},Ps={key:0,class:"error-message"},Vs={key:1,class:"helper-text"},Ts={key:2,class:"input-count"},Is=te({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(n,{expose:i,emit:t}){const l=n,a=t,{locale:p}=ce(),h=A(()=>{if(l.type==="date")return p.value==="uz"?"uz-UZ":"ru-RU"}),u=R(null),m=A(()=>`input-${Math.random().toString(36).substr(2,9)}`),V=A({get:()=>{const I=String(l.modelValue||"");if(l.dateMask&&I){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(I)||/^\d{2}-\d{2}-\d{4}$/.test(I))return I;if(/^\d{4}-\d{2}-\d{2}$/.test(I)){const x=I.split("-");return`${x[2]}-${x[1]}-${x[0]}`}}return I},set:I=>{if(l.uppercase&&(I=I.toUpperCase()),l.dateMask&&I){if(/^\d{4}-\d{2}-\d{2}$/.test(I)){a("update:modelValue",I);return}if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const x=I.split("-");a("update:modelValue",`${x[2]}-${x[1]}-${x[0]}`);return}a("update:modelValue",I);return}a("update:modelValue",I)}}),g=I=>{const x=I.target;let O=x.value;if(l.uppercase&&(O=O.toUpperCase(),x.value!==O&&(x.value=O)),l.dateMask){const H=Y(O);x.value!==H&&(x.value=H),a("update:modelValue",H),a("input",H);return}l.mask&&(O=T(O)),a("update:modelValue",O),a("input",O)},c=()=>{if(l.dateMask&&V.value){const I=String(V.value);if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const x=I.split("-"),O=`${x[2]}-${x[1]}-${x[0]}`,H=new Date(O);isNaN(H.getTime())||a("update:modelValue",O)}}a("blur")},D=()=>{a("focus")},w=I=>{},C=()=>{a("enter")},y=()=>{a("update:modelValue",""),u.value?.focus()},T=I=>{if(l.dateMask)return Y(I);if(!l.mask)return I;let x="",O=0;const H=I.replace(/\D/g,"");for(let ie=0;ie<l.mask.length&&O<H.length;ie++){const X=l.mask[ie];X==="#"?(x+=H[O],O++):x+=X}return x},Y=I=>{const O=I.replace(/\D/g,"").slice(0,8);return O.length===0?"":O.length<=2?O:O.length<=4?`${O.slice(0,2)}-${O.slice(2)}`:`${O.slice(0,2)}-${O.slice(2,4)}-${O.slice(4)}`},$=()=>{u.value?.focus()},G=()=>{u.value?.blur()};return Pe(()=>{l.autofocus&&$()}),i({focus:$,blur:G}),(I,x)=>(d(),f("div",{class:ee(["input-field",{"has-error":n.error}])},[n.label?(d(),f("label",{key:0,class:"input-label",for:m.value},[ke(o(n.label)+" ",1),n.required?(d(),f("span",xs,"*")):L("",!0)],8,Ds)):L("",!0),e("div",Ns,[n.icon?(d(),f("div",ks,[e("i",{class:ee(n.icon)},null,2)])):L("",!0),fe(e("input",{id:m.value,ref_key:"inputRef",ref:u,"onUpdate:modelValue":x[0]||(x[0]=O=>V.value=O),type:n.dateMask?"text":n.type,placeholder:n.dateMask?n.placeholder||"DD-MM-YYYY":n.placeholder,disabled:n.disabled,readonly:n.readonly,maxlength:n.dateMask?10:n.maxLength,autocomplete:n.autocomplete,inputmode:n.dateMask?"numeric":n.inputMode,lang:h.value,class:ee(["input",{"input-with-icon-left":n.icon,"input-with-icon-right":n.clearable||n.loading,"input-error":n.error}]),onInput:g,onBlur:c,onFocus:D,onKeypress:w,onKeydown:Je(C,["enter"])},null,42,As),[[Ge,V.value]]),n.clearable&&V.value&&!n.disabled&&!n.readonly?(d(),f("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:y},[...x[1]||(x[1]=[e("i",{class:"bx bx-x"},null,-1)])])):L("",!0),n.loading?(d(),f("div",Ms,[...x[2]||(x[2]=[e("div",{class:"spinner-small"},null,-1)])])):L("",!0)]),n.helperText||n.error?(d(),f("div",Os,[n.error?(d(),f("span",Ps,o(n.error),1)):n.helperText?(d(),f("span",Vs,o(n.helperText),1)):L("",!0)])):L("",!0),n.showCount&&n.maxLength?(d(),f("div",Ts,o(V.value.length)+" / "+o(n.maxLength),1)):L("",!0)],2))}}),Le=se(Is,[["__scopeId","data-v-4eb39aee"]]);function Es(n){if(!n)return{valid:!1,error:"Государственный номер обязателен"};const i=n.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(i)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Cs(n){if(!n)return{valid:!1,error:"Серия техпаспорта обязательна"};const i=n.toUpperCase();return/^[A-Z]{2,3}$/.test(i)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Ls(n){return n?/^\d+$/.test(n)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Ys={class:"step-container"},Fs={class:"step-header"},Rs={class:"step-title"},Us={class:"step-description"},Ws={class:"step-content"},Bs={class:"form-section"},zs={class:"form-section"},js={class:"form-section"},qs={class:"form-section"},Hs=["disabled"],Gs={key:0,class:"spinner"},Js={key:0,class:"alert alert-error"},Ks={key:0,class:"vehicle-info-card"},Zs={class:"card-header"},Qs={class:"card-content"};const Xs={class:"vehicle-info-grid"},ea={key:0,class:"vehicle-info-item"},ta={class:"vehicle-info-label"},sa={class:"vehicle-info-value"},aa={key:1,class:"vehicle-info-item"},ia={class:"vehicle-info-label"},oa={class:"vehicle-info-value"},la={key:2,class:"vehicle-info-item"},ra={class:"vehicle-info-label"},na={class:"vehicle-info-value"},ca={key:3,class:"vehicle-info-item"},ua={class:"vehicle-info-label"},da={class:"vehicle-info-value"},pa={key:4,class:"vehicle-info-item"},va={class:"vehicle-info-label"},fa={class:"vehicle-info-value"},ha={key:1,class:"vehicle-info-empty"},ma=te({__name:"Step2Vehicle",setup(n){const i=pe();Ne();const t=he(),{t:l}=ce(),a=A(()=>i.osgo),p=R({}),h=A(()=>!!(a.value.vehicle?.govNumber&&a.value.vehicle?.techPassportSeries&&a.value.vehicle?.techPassportNumber&&Object.keys(p.value).length===0)),u=A(()=>{if(!a.value.vehicle)return 0;const g=a.value.vehicle;let c=0;return g.techPassportIssueDate&&c++,(g.modelName||g.model)&&c++,(g.createdYear||g.year)&&c++,g.engineNumber&&c++,g.bodyNumber&&c++,c}),m=g=>{if(!a.value.vehicle)return;let c;switch(g){case"govNumber":c=Es(a.value.vehicle.govNumber);break;case"techPassportSeries":c=Cs(a.value.vehicle.techPassportSeries);break;case"techPassportNumber":c=Ls(a.value.vehicle.techPassportNumber);break}c&&!c.valid?p.value[g]=c.error||"":delete p.value[g]},V=async()=>{if(m("govNumber"),m("techPassportSeries"),m("techPassportNumber"),Object.keys(p.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await i.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",a.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(a.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(g,c)=>{const D=Le;return d(),f("div",Ys,[e("div",Fs,[e("h2",Rs,o(s(l)("step2.title")),1),e("p",Us,o(s(l)("step2.description")),1)]),e("div",Ws,[e("div",Bs,[B(D,{modelValue:a.value.vehicle.govNumber,"onUpdate:modelValue":c[0]||(c[0]=w=>a.value.vehicle.govNumber=w),label:s(l)("step2.govNumber"),placeholder:s(l)("step2.govNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:c[1]||(c[1]=w=>m("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",zs,[B(D,{modelValue:a.value.vehicle.techPassportSeries,"onUpdate:modelValue":c[2]||(c[2]=w=>a.value.vehicle.techPassportSeries=w),label:s(l)("step2.techPassportSeries"),placeholder:s(l)("step2.techPassportSeriesPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:c[3]||(c[3]=w=>m("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",js,[B(D,{modelValue:a.value.vehicle.techPassportNumber,"onUpdate:modelValue":c[4]||(c[4]=w=>a.value.vehicle.techPassportNumber=w),label:s(l)("step2.techPassportNumber"),placeholder:s(l)("step2.techPassportNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:c[5]||(c[5]=w=>m("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",qs,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!h.value||s(i).vehicleVerifying,onClick:V},[s(i).vehicleVerifying?(d(),f("span",Gs)):(d(),f(ae,{key:1},[c[6]||(c[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).vehicleVerified?s(l)("step2.verified"):s(l)("step2.verify")),1)],64))],8,Hs)]),s(i).vehicleVerifyError?(d(),f("div",Js,[c[7]||(c[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(s(i).vehicleVerifyError),1)])):L("",!0),B(re,{name:"fade"},{default:ne(()=>[s(i).vehicleVerified&&a.value.vehicle?(d(),f("div",Ks,[e("div",Zs,[c[8]||(c[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,o(s(l)("step2.vehicleFound")),1)]),e("div",Qs,[L("",!0),e("div",Xs,[a.value.vehicle?.techPassportIssueDate?(d(),f("div",ea,[e("div",ta,o(s(l)("step2.techPassportIssueDate")),1),e("div",sa,o(s(Ce)(a.value.vehicle.techPassportIssueDate)),1)])):L("",!0),a.value.vehicle?.modelName||a.value.vehicle?.model?(d(),f("div",aa,[e("div",ia,o(s(l)("step2.model")),1),e("div",oa,o(a.value.vehicle?.modelName||a.value.vehicle?.model||"-"),1)])):L("",!0),a.value.vehicle?.createdYear||a.value.vehicle?.year?(d(),f("div",la,[e("div",ra,o(s(l)("step2.year")),1),e("div",na,o(a.value.vehicle?.createdYear||a.value.vehicle?.year||"-"),1)])):L("",!0),a.value.vehicle?.engineNumber?(d(),f("div",ca,[e("div",ua,o(s(l)("step2.engineNumber")),1),e("div",da,o(a.value.vehicle.engineNumber),1)])):L("",!0),a.value.vehicle?.bodyNumber?(d(),f("div",pa,[e("div",va,o(s(l)("step2.bodyNumber")),1),e("div",fa,o(a.value.vehicle.bodyNumber),1)])):L("",!0)]),u.value===0?(d(),f("div",ha,o(s(l)("step2.vehicleNotFound")),1)):L("",!0)])])):L("",!0)]),_:1})])])}}}),_a=se(ma,[["__scopeId","data-v-3ead2593"]]),ba={class:"step-container"},ya={class:"step-header"},ga={class:"step-title"},$a={class:"step-description"},Sa={class:"step-content"},wa={class:"subsection"},Da={class:"subsection-title"},xa={class:"form-section"},Na={class:"form-section"},ka={class:"form-section"},Aa={class:"form-section"},Ma=["disabled"],Oa={key:0,class:"spinner"},Pa={key:0,class:"info-card success"},Va={class:"card-header"},Ta={class:"card-content"},Ia={class:"info-grid"},Ea={class:"info-item"},Ca={class:"info-label"},La={class:"info-value"},Ya={class:"info-item"},Fa={class:"info-label"},Ra={class:"info-value"},Ua={class:"info-item info-item-wide"},Wa={class:"info-label"},Ba={class:"info-value"},za={class:"info-item"},ja={class:"info-label"},qa={class:"info-value"},Ha={class:"info-item"},Ga={class:"info-label"},Ja={class:"info-value"},Ka={class:"info-item"},Za={class:"info-label"},Qa={class:"info-value"},Xa={class:"info-item"},ei={class:"info-label"},ti={class:"info-value"},si={class:"info-item"},ai={class:"info-label"},ii={class:"info-value"},oi={class:"info-item"},li={class:"info-label"},ri={class:"info-value"},ni={class:"info-item"},ci={class:"info-label"},ui={class:"info-value"},di={class:"info-item"},pi={class:"info-label"},vi={class:"info-value"},fi={class:"form-section"},hi={class:"checkbox-label"},mi=["disabled"],_i={key:0,class:"subsection"},bi={class:"subsection-title"},yi={class:"form-section"},gi={class:"form-section"},$i={class:"form-section"},Si={class:"form-section"},wi=["disabled"],Di={key:0,class:"spinner"},xi={key:0,class:"info-card success"},Ni={class:"card-header"},ki={class:"card-content"},Ai={class:"info-grid"},Mi={class:"info-item"},Oi={class:"info-label"},Pi={class:"info-value"},Vi={class:"info-item"},Ti={class:"info-label"},Ii={class:"info-value"},Ei={class:"info-item info-item-wide"},Ci={class:"info-label"},Li={class:"info-value"},Yi={class:"info-item"},Fi={class:"info-label"},Ri={class:"info-value"},Ui={class:"info-item"},Wi={class:"info-label"},Bi={class:"info-value"},zi={class:"info-item"},ji={class:"info-label"},qi={class:"info-value"},Hi={class:"info-item"},Gi={class:"info-label"},Ji={class:"info-value"},Ki={class:"info-item"},Zi={class:"info-label"},Qi={class:"info-value"},Xi={class:"info-item"},eo={class:"info-label"},to={class:"info-value"},so={class:"info-item"},ao={class:"info-label"},io={class:"info-value"},oo={class:"info-item"},lo={class:"info-label"},ro={class:"info-value"},no=te({__name:"Step3Owner",setup(n){const i=pe(),t=he(),{locale:l,t:a}=ce(),p=A(()=>i.osgo),h=A(()=>i.owner),u=A(()=>i.applicant),m=async()=>{try{await i.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},V=async()=>{try{await i.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(g,c)=>{const D=Le;return d(),f("div",ba,[e("div",ya,[e("h2",ga,o(s(a)("step3.title")),1),e("p",$a,o(s(a)("step3.description")),1)]),e("div",Sa,[e("div",wa,[e("h3",Da,o(s(a)("step3.owner")),1),e("div",xa,[B(D,{modelValue:h.value.passportSeries,"onUpdate:modelValue":c[0]||(c[0]=w=>h.value.passportSeries=w),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Na,[B(D,{modelValue:h.value.passportNumber,"onUpdate:modelValue":c[1]||(c[1]=w=>h.value.passportNumber=w),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ka,[B(D,{modelValue:h.value.birthDate,"onUpdate:modelValue":c[2]||(c[2]=w=>h.value.birthDate=w),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Aa,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).ownerVerifying,onClick:m},[s(i).ownerVerifying?(d(),f("span",Oa)):(d(),f(ae,{key:1},[c[7]||(c[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).ownerVerified?s(a)("step3.verified"):s(a)("step3.verifyOwner")),1)],64))],8,Ma)]),B(re,{name:"fade"},{default:ne(()=>[s(i).ownerVerified&&h.value.id?(d(),f("div",Pa,[e("div",Va,[c[8]||(c[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a)("step3.ownerFound")),1)]),e("div",Ta,[e("div",Ia,[e("div",Ea,[e("div",Ca,o(s(a)("step3.passportIssueDate")),1),e("div",La,o(h.value.passportIssueDate?s(Ce)(h.value.passportIssueDate):"-"),1)]),e("div",Ya,[e("div",Fa,o(s(a)("step3.pinfl")),1),e("div",Ra,o(h.value.nationalIdentifier||"-"),1)]),e("div",Ua,[e("div",Wa,o(s(a)("step3.issuedBy")),1),e("div",Ba,o(h.value.passportIssuedBy||"-"),1)]),e("div",za,[e("div",ja,o(s(a)("step3.lastName")),1),e("div",qa,o(h.value.lastName||"-"),1)]),e("div",Ha,[e("div",Ga,o(s(a)("step3.firstName")),1),e("div",Ja,o(h.value.firstName||"-"),1)]),e("div",Ka,[e("div",Za,o(s(a)("step3.middleName")),1),e("div",Qa,o(h.value.middleName||"-"),1)]),e("div",Xa,[e("div",ei,o(s(a)("step3.gender")),1),e("div",ti,o(h.value.gender?s(Ue)(h.value.gender,s(l).value):"-"),1)]),e("div",si,[e("div",ai,o(s(a)("step3.country")),1),e("div",ii,o(h.value.country?.langValue1||"-"),1)]),e("div",oi,[e("div",li,o(s(a)("step3.region")),1),e("div",ri,o(h.value.region?.langValue1||"-"),1)]),e("div",ni,[e("div",ci,o(s(a)("step3.district")),1),e("div",ui,o(h.value.district?.langValue1||"-"),1)]),e("div",di,[e("div",pi,o(s(a)("step3.street")),1),e("div",vi,o(h.value.street||"-"),1)])])])])):L("",!0)]),_:1})]),e("div",fi,[e("label",hi,[fe(e("input",{"onUpdate:modelValue":c[3]||(c[3]=w=>p.value.applicantIsOwner=w),type:"checkbox",class:"checkbox",disabled:!s(i).isEditable},null,8,mi),[[Ke,p.value.applicantIsOwner]]),e("span",null,o(s(a)("step3.ownerIsApplicant")),1)])]),B(re,{name:"slide-down"},{default:ne(()=>[p.value.applicantIsOwner?L("",!0):(d(),f("div",_i,[e("h3",bi,o(s(a)("step3.applicant")),1),e("div",yi,[B(D,{modelValue:u.value.passportSeries,"onUpdate:modelValue":c[4]||(c[4]=w=>u.value.passportSeries=w),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",gi,[B(D,{modelValue:u.value.passportNumber,"onUpdate:modelValue":c[5]||(c[5]=w=>u.value.passportNumber=w),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",$i,[B(D,{modelValue:u.value.birthDate,"onUpdate:modelValue":c[6]||(c[6]=w=>u.value.birthDate=w),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Si,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).applicantVerifying,onClick:V},[s(i).applicantVerifying?(d(),f("span",Di)):(d(),f(ae,{key:1},[c[9]||(c[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).applicantVerified?s(a)("step3.verified"):s(a)("step3.verifyApplicant")),1)],64))],8,wi)]),B(re,{name:"fade"},{default:ne(()=>[s(i).applicantVerified&&u.value.id?(d(),f("div",xi,[e("div",Ni,[c[10]||(c[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a)("step3.applicantFound")),1)]),e("div",ki,[e("div",Ai,[e("div",Mi,[e("div",Oi,o(s(a)("step3.passportIssueDate")),1),e("div",Pi,o(u.value.passportIssueDate?s(Ce)(u.value.passportIssueDate):"-"),1)]),e("div",Vi,[e("div",Ti,o(s(a)("step3.pinfl")),1),e("div",Ii,o(u.value.nationalIdentifier||"-"),1)]),e("div",Ei,[e("div",Ci,o(s(a)("step3.issuedBy")),1),e("div",Li,o(u.value.passportIssuedBy||"-"),1)]),e("div",Yi,[e("div",Fi,o(s(a)("step3.lastName")),1),e("div",Ri,o(u.value.lastName||"-"),1)]),e("div",Ui,[e("div",Wi,o(s(a)("step3.firstName")),1),e("div",Bi,o(u.value.firstName||"-"),1)]),e("div",zi,[e("div",ji,o(s(a)("step3.middleName")),1),e("div",qi,o(u.value.middleName||"-"),1)]),e("div",Hi,[e("div",Gi,o(s(a)("step3.gender")),1),e("div",Ji,o(u.value.gender?s(Ue)(u.value.gender,s(l).value):"-"),1)]),e("div",Ki,[e("div",Zi,o(s(a)("step3.country")),1),e("div",Qi,o(u.value.country?.langValue1||"-"),1)]),e("div",Xi,[e("div",eo,o(s(a)("step3.region")),1),e("div",to,o(u.value.region?.langValue1||"-"),1)]),e("div",so,[e("div",ao,o(s(a)("step3.district")),1),e("div",io,o(u.value.district?.langValue1||"-"),1)]),e("div",oo,[e("div",lo,o(s(a)("step3.street")),1),e("div",ro,o(u.value.street||"-"),1)])])])])):L("",!0)]),_:1})]))]),_:1})])])}}}),co=se(no,[["__scopeId","data-v-62def220"]]),uo={class:"step-container"},po={class:"step-header"},vo={class:"step-title"},fo={class:"step-description"},ho={class:"step-content"},mo={class:"summary-section"},_o={class:"section-title"},bo={class:"summary-card"},yo={class:"card-title"},go={class:"card-content"},$o={class:"info-row"},So={class:"info-value-full"},wo={class:"summary-card"},Do={class:"card-title"},xo={class:"card-content"},No={class:"info-row"},ko={class:"info-value-full"},Ao={class:"summary-card"},Mo={class:"card-title"},Oo={class:"card-content"},Po={class:"info-row"},Vo={class:"info-value-full"},To={class:"summary-card"},Io={class:"card-title"},Eo={class:"card-content"},Co={class:"info-row"},Lo={class:"info-value-full"},Yo={class:"info-row"},Fo={class:"info-value-full"},Ro={class:"info-row"},Uo={class:"info-value-full"},Wo={class:"summary-card"},Bo={class:"card-title"},zo={class:"card-content"},jo={class:"info-row"},qo={class:"info-value-full"},Ho={class:"summary-section"},Go={class:"section-title"},Jo={class:"form-section"},Ko={class:"form-section"},Zo={key:0,class:"form-section"},Qo={class:"premium-section"},Xo={class:"premium-card-large"},el={class:"premium-header"},tl={class:"premium-amount-large"},sl=te({__name:"Step5Summary",setup(n){const i=pe(),t=Ne();he(),Oe();const l=A(()=>i.osgo),a=A(()=>i.owner),p=A(()=>i.applicant);A(()=>i.fundData),R(!1);const h=A({get:()=>(l.value.applicantIsOwner?a.value:p.value).phone||"",set:c=>{l.value.applicantIsOwner?(a.value.phone=c,l.value.party=a.value):(p.value.phone=c,l.value.party=p.value)}}),{locale:u,t:m}=ce(),V=()=>l.value.period?t.getLocalizedName(l.value.period,u.value||"uz"):"-",g=()=>l.value.drivedArea?t.getLocalizedName(l.value.drivedArea,u.value||"uz"):"-";return(c,D)=>{const w=Le;return d(),f("div",uo,[e("div",po,[e("h2",vo,o(s(m)("step5.title")),1),e("p",fo,o(s(m)("step5.description")),1)]),e("div",ho,[e("div",mo,[e("h3",_o,[D[2]||(D[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,o(s(m)("step5.policyInfo")),1)]),e("div",bo,[e("div",yo,o(s(m)("step3.owner")),1),e("div",go,[e("div",$o,[e("span",So,o(a.value.name||"-")+o(a.value.birthDate?` (${a.value.birthDate})`:""),1)])])]),e("div",wo,[e("div",Do,o(s(m)("step3.applicant")),1),e("div",xo,[e("div",No,[e("span",ko,o((l.value.applicantIsOwner?a.value:p.value).name||"-")+o((l.value.applicantIsOwner?a.value:p.value).birthDate?` (${(l.value.applicantIsOwner?a.value:p.value).birthDate})`:""),1)])])]),e("div",Ao,[e("div",Mo,o(s(m)("step5.vehicleInfo")),1),e("div",Oo,[e("div",Po,[e("span",Vo,o(l.value.vehicle?.modelName||l.value.vehicle?.model||"-")+" "+o(l.value.vehicle?.govNumber?` (${l.value.vehicle.govNumber})`:""),1)])])]),e("div",To,[e("div",Io,o(s(m)("step5.policyInfo")),1),e("div",Eo,[e("div",Co,[e("span",Lo,o(V()),1)]),e("div",Yo,[e("span",Fo,o(g()),1)]),e("div",Ro,[e("span",Uo,o(l.value.driversLimited?s(m)("step5.driversLimited",{count:l.value.drivers?.length||0}):s(m)("step5.noDriversLimitation")),1)])])]),e("div",Wo,[e("div",Bo,o(s(m)("step5.compensation")),1),e("div",zo,[e("div",jo,[e("span",qo,o(s(Me)(s(Ee))),1)])])])]),e("div",Ho,[e("h3",Go,[D[3]||(D[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,o(s(m)("step5.contactInfo")),1)]),e("div",Jo,[B(w,{modelValue:h.value,"onUpdate:modelValue":D[0]||(D[0]=C=>h.value=C),label:s(m)("step5.phone"),placeholder:s(m)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Ko,[B(w,{modelValue:l.value.contractStartDate,"onUpdate:modelValue":D[1]||(D[1]=C=>l.value.contractStartDate=C),label:s(m)("step5.startDate"),type:"text","date-mask":"",placeholder:s(m)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),l.value.contractEndDate?(d(),f("div",Zo,[B(w,{"model-value":l.value.contractEndDate,label:s(m)("step5.endDate"),type:"text","date-mask":"",placeholder:s(m)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):L("",!0)]),e("div",Qo,[e("div",Xo,[e("div",el,[D[4]||(D[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(m)("step5.premium")),1)]),e("div",tl,o(s(Me)(s(i).calculatedPremium)),1)])])])])}}}),al=se(sl,[["__scopeId","data-v-8e729bee"]]),il={class:"step-container"},ol={class:"step-header"},ll={class:"step-title"},rl={class:"step-description"},nl={class:"step-content"},cl={class:"premium-section"},ul={class:"premium-card-large"},dl={class:"premium-header"},pl={class:"premium-amount-large"},vl={class:"payment-section"},fl={class:"section-title"},hl={class:"payment-buttons"},ml=["disabled"],_l={key:0,class:"payment-selected-indicator"},bl=["disabled"],yl={key:0,class:"payment-selected-indicator"},gl=["disabled"],$l={key:0,class:"payment-selected-indicator"},Sl={class:"status-section"},wl=["disabled"],Dl={key:0,class:"ml-1"},xl={key:0,class:"error-message mt-2"},Nl={key:0,class:"success-card"},kl={class:"success-title"},Al={class:"success-description"},Ml={class:"policy-details"},Ol={class:"policy-row"},Pl={class:"policy-label"},Vl={class:"policy-value"},Tl={class:"policy-row"},Il={class:"policy-label"},El={class:"policy-value"},Cl=te({__name:"Step6Payment",setup(n){const i=pe(),t=he();Oe();const{t:l,locale:a}=ce(),p=A(()=>i.osgo),h=A(()=>i.fundData);A(()=>(p.value.applicantIsOwner?i.owner:i.applicant).phone||"");const u=R(!1),m=R(null),V=R(0),g=R(null);let c=null;const D=A({get:()=>i.selectedPaymentMethod,set:Y=>{i.selectedPaymentMethod=Y}}),w=A(()=>{if(!g.value)return"";const Y=g.value.toLowerCase(),$=a.value,G=$==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],I=$==="ru"?["ошибка","не получена"]:["xato","olindi"];return G.some(x=>Y.includes(x))?"status-success":I.some(x=>Y.includes(x))?"status-error":"status-info"}),C=A(()=>w.value==="status-success"?"bx bx-check-circle":w.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),y=Y=>{D.value===Y?D.value=null:D.value=Y,t.isTelegramWebApp.value&&t.hapticImpact("light")},T=async()=>{if(!p.value.id){m.value=l("errors.createApplicationFailed");return}try{u.value=!0,m.value=null,g.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await i.fetchFundData(),h.value?.seria&&h.value?.number?(g.value=l("step5.paymentSuccess"),t.isTelegramWebApp.value&&t.hapticNotification("success")):h.value?g.value=l("step5.paymentProcessing"):g.value=l("step5.paymentNotReceived"),V.value=15,c&&clearInterval(c),c=window.setInterval(()=>{V.value>0?V.value--:c&&(clearInterval(c),c=null)},1e3)}catch(Y){console.error("[Step6Payment] Check status error:",Y),m.value=Y.message||l("errors.paymentFailed"),g.value=l("errors.paymentFailed"),t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{u.value=!1}};return Ze(()=>{c&&clearInterval(c)}),(Y,$)=>(d(),f("div",il,[e("div",ol,[e("h2",ll,o(s(l)("step5.payment")),1),e("p",rl,o(s(l)("step5.paymentDescription")),1)]),e("div",nl,[e("div",cl,[e("div",ul,[e("div",dl,[$[3]||($[3]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(l)("step5.premium")),1)]),e("div",pl,o(s(Me)(s(i).calculatedPremium)),1)])]),e("div",vl,[e("h3",fl,[$[4]||($[4]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(s(l)("step5.paymentMethod")),1)]),e("div",hl,[e("button",{type:"button",class:ee(["payment-btn payme",{"payment-btn-selected":D.value==="payme"}]),disabled:u.value,onClick:$[0]||($[0]=G=>y("payme"))},[$[6]||($[6]=e("div",{class:"payment-icon"},"💳",-1)),$[7]||($[7]=e("div",{class:"payment-name"},"Payme",-1)),D.value==="payme"?(d(),f("div",_l,[...$[5]||($[5]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,ml),e("button",{type:"button",class:ee(["payment-btn click",{"payment-btn-selected":D.value==="click"}]),disabled:u.value,onClick:$[1]||($[1]=G=>y("click"))},[$[9]||($[9]=e("div",{class:"payment-icon"},"🔵",-1)),$[10]||($[10]=e("div",{class:"payment-name"},"Click",-1)),D.value==="click"?(d(),f("div",yl,[...$[8]||($[8]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,bl),e("button",{type:"button",class:ee(["payment-btn uzum",{"payment-btn-selected":D.value==="uzum"}]),disabled:u.value,onClick:$[2]||($[2]=G=>y("uzum"))},[$[12]||($[12]=e("div",{class:"payment-icon"},"🟣",-1)),$[13]||($[13]=e("div",{class:"payment-name"},"Uzum",-1)),D.value==="uzum"?(d(),f("div",$l,[...$[11]||($[11]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,gl)])]),e("div",Sl,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!V.value||u.value||!p.value.id,onClick:T},[$[14]||($[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,o(s(l)("step5.checkStatus")),1),V.value?(d(),f("span",Dl,"("+o(V.value)+")",1)):L("",!0)],8,wl),B(re,{name:"fade"},{default:ne(()=>[m.value?(d(),f("div",xl,[$[15]||($[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(m.value),1)])):L("",!0)]),_:1}),B(re,{name:"fade"},{default:ne(()=>[g.value?(d(),f("div",{key:0,class:ee(["status-text",w.value])},[e("i",{class:ee(C.value)},null,2),e("span",null,o(g.value),1)],2)):L("",!0)]),_:1})]),B(re,{name:"fade"},{default:ne(()=>[p.value.id&&h.value&&h.value.seria?(d(),f("div",Nl,[$[16]||($[16]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",kl,o(s(l)("step5.success")),1),e("p",Al,o(s(l)("step5.policyIssued")),1),e("div",Ml,[e("div",Ol,[e("span",Pl,o(s(l)("step5.policySeries"))+":",1),e("span",Vl,o(h.value.seria),1)]),e("div",Tl,[e("span",Il,o(s(l)("step5.policyNumber"))+":",1),e("span",El,o(h.value.number),1)])])])):L("",!0)]),_:1})])]))}}),Ll=se(Cl,[["__scopeId","data-v-0cbe2eac"]]),Yl={class:"min-h-screen flex flex-col"},Fl={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},Rl={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},Ul={class:"max-w-3xl mx-auto"},Wl={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},Bl=te({__name:"index",setup(n){const i=pe(),t=Ne(),l=he();return Pe(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),i.initialize(),i.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{i.currentStep>0?i.previousStep():l.close()});const p=ve(()=>i.osgo,()=>{i.saveToSession()},{deep:!0});Fe(()=>{p()})}),Fe(()=>{i.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),Qe({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,p)=>(d(),f("div",Yl,[e("header",Fl,[B(St)]),e("main",Rl,[e("div",Ul,[B(re,{name:"fade",mode:"out-in"},{default:ne(()=>[s(i).currentStep===s(E).PARAMS?(d(),xe(ws,{key:s(E).PARAMS})):s(i).currentStep===s(E).VEHICLE?(d(),xe(_a,{key:s(E).VEHICLE})):s(i).currentStep===s(E).OWNER?(d(),xe(co,{key:s(E).OWNER})):s(i).currentStep===s(E).SUMMARY?(d(),xe(al,{key:s(E).SUMMARY})):s(i).currentStep===s(E).PAYMENT?(d(),xe(Ll,{key:s(E).PAYMENT})):L("",!0)]),_:1})])]),e("footer",Wl,[B(Et)])]))}}),Zl=se(Bl,[["__scopeId","data-v-4214c6a6"]]);export{Zl as default};
