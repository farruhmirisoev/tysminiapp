import{e as je,f as we,g as Ae,r as L,S as U,h as I,C as Pe,i as ge,j as Te,k as ee,l as ce,m as He,n as Ve,c as d,o as c,F as X,p as pe,q as a,s as ae,t as o,a as e,v as qe,b as F,x as Ge,y as fe,z as N,A as Fe,d as Se,T as le,w as oe,B as Ee,D as Je,E as re,G as Ze,H as Ke,I as Qe,J as Xe,K as Be,u as et}from"./CjysRVbt.js";import{_ as te}from"./DlAUqK2U.js";import{_ as tt}from"./DgM-zN9R.js";function st(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ne={exports:{}},at=Ne.exports,We;function it(){return We||(We=1,(function(n,s){(function(t,l){n.exports=l()})(at,(function(){var t=1e3,l=6e4,i=36e5,h="millisecond",v="second",_="minute",k="hour",g="day",m="week",f="month",u="quarter",O="year",V="date",H="Invalid Date",R=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,C={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var $=["th","st","nd","rd"],b=M%100;return"["+M+($[(b-20)%10]||$[b]||$[0])+"]"}},E=function(M,$,b){var D=String(M);return!D||D.length>=$?M:""+Array($+1-D.length).join(b)+M},x={s:E,z:function(M){var $=-M.utcOffset(),b=Math.abs($),D=Math.floor(b/60),y=b%60;return($<=0?"+":"-")+E(D,2,"0")+":"+E(y,2,"0")},m:function M($,b){if($.date()<b.date())return-M(b,$);var D=12*(b.year()-$.year())+(b.month()-$.month()),y=$.clone().add(D,f),T=b-y<0,P=$.clone().add(D+(T?-1:1),f);return+(-(D+(b-y)/(T?y-P:P-y))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:f,y:O,w:m,d:g,D:V,h:k,m:_,s:v,ms:h,Q:u}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},p="en",w={};w[p]=C;var B="$isDayjsObject",ie=function(M){return M instanceof me||!(!M||!M[B])},se=function M($,b,D){var y;if(!$)return p;if(typeof $=="string"){var T=$.toLowerCase();w[T]&&(y=T),b&&(w[T]=b,y=T);var P=$.split("-");if(!y&&P.length>1)return M(P[0])}else{var W=$.name;w[W]=$,y=W}return!D&&y&&(p=y),y||!D&&p},q=function(M,$){if(ie(M))return M.clone();var b=typeof $=="object"?$:{};return b.date=M,b.args=arguments,new me(b)},Y=x;Y.l=se,Y.i=ie,Y.w=function(M,$){return q(M,{locale:$.$L,utc:$.$u,x:$.$x,$offset:$.$offset})};var me=(function(){function M(b){this.$L=se(b.locale,null,!0),this.parse(b),this.$x=this.$x||b.x||{},this[B]=!0}var $=M.prototype;return $.parse=function(b){this.$d=(function(D){var y=D.date,T=D.utc;if(y===null)return new Date(NaN);if(Y.u(y))return new Date;if(y instanceof Date)return new Date(y);if(typeof y=="string"&&!/Z$/i.test(y)){var P=y.match(R);if(P){var W=P[2]-1||0,j=(P[7]||"0").substring(0,3);return T?new Date(Date.UTC(P[1],W,P[3]||1,P[4]||0,P[5]||0,P[6]||0,j)):new Date(P[1],W,P[3]||1,P[4]||0,P[5]||0,P[6]||0,j)}}return new Date(y)})(b),this.init()},$.init=function(){var b=this.$d;this.$y=b.getFullYear(),this.$M=b.getMonth(),this.$D=b.getDate(),this.$W=b.getDay(),this.$H=b.getHours(),this.$m=b.getMinutes(),this.$s=b.getSeconds(),this.$ms=b.getMilliseconds()},$.$utils=function(){return Y},$.isValid=function(){return this.$d.toString()!==H},$.isSame=function(b,D){var y=q(b);return this.startOf(D)<=y&&y<=this.endOf(D)},$.isAfter=function(b,D){return q(b)<this.startOf(D)},$.isBefore=function(b,D){return this.endOf(D)<q(b)},$.$g=function(b,D,y){return Y.u(b)?this[D]:this.set(y,b)},$.unix=function(){return Math.floor(this.valueOf()/1e3)},$.valueOf=function(){return this.$d.getTime()},$.startOf=function(b,D){var y=this,T=!!Y.u(D)||D,P=Y.p(b),W=function(ve,K){var ne=Y.w(y.$u?Date.UTC(y.$y,K,ve):new Date(y.$y,K,ve),y);return T?ne:ne.endOf(g)},j=function(ve,K){return Y.w(y.toDate()[ve].apply(y.toDate("s"),(T?[0,0,0,0]:[23,59,59,999]).slice(K)),y)},G=this.$W,J=this.$M,Q=this.$D,he="set"+(this.$u?"UTC":"");switch(P){case O:return T?W(1,0):W(31,11);case f:return T?W(1,J):W(0,J+1);case m:var ue=this.$locale().weekStart||0,be=(G<ue?G+7:G)-ue;return W(T?Q-be:Q+(6-be),J);case g:case V:return j(he+"Hours",0);case k:return j(he+"Minutes",1);case _:return j(he+"Seconds",2);case v:return j(he+"Milliseconds",3);default:return this.clone()}},$.endOf=function(b){return this.startOf(b,!1)},$.$set=function(b,D){var y,T=Y.p(b),P="set"+(this.$u?"UTC":""),W=(y={},y[g]=P+"Date",y[V]=P+"Date",y[f]=P+"Month",y[O]=P+"FullYear",y[k]=P+"Hours",y[_]=P+"Minutes",y[v]=P+"Seconds",y[h]=P+"Milliseconds",y)[T],j=T===g?this.$D+(D-this.$W):D;if(T===f||T===O){var G=this.clone().set(V,1);G.$d[W](j),G.init(),this.$d=G.set(V,Math.min(this.$D,G.daysInMonth())).$d}else W&&this.$d[W](j);return this.init(),this},$.set=function(b,D){return this.clone().$set(b,D)},$.get=function(b){return this[Y.p(b)]()},$.add=function(b,D){var y,T=this;b=Number(b);var P=Y.p(D),W=function(J){var Q=q(T);return Y.w(Q.date(Q.date()+Math.round(J*b)),T)};if(P===f)return this.set(f,this.$M+b);if(P===O)return this.set(O,this.$y+b);if(P===g)return W(1);if(P===m)return W(7);var j=(y={},y[_]=l,y[k]=i,y[v]=t,y)[P]||1,G=this.$d.getTime()+b*j;return Y.w(G,this)},$.subtract=function(b,D){return this.add(-1*b,D)},$.format=function(b){var D=this,y=this.$locale();if(!this.isValid())return y.invalidDate||H;var T=b||"YYYY-MM-DDTHH:mm:ssZ",P=Y.z(this),W=this.$H,j=this.$m,G=this.$M,J=y.weekdays,Q=y.months,he=y.meridiem,ue=function(K,ne,_e,ke){return K&&(K[ne]||K(D,T))||_e[ne].slice(0,ke)},be=function(K){return Y.s(W%12||12,K,"0")},ve=he||function(K,ne,_e){var ke=K<12?"AM":"PM";return _e?ke.toLowerCase():ke};return T.replace(S,(function(K,ne){return ne||(function(_e){switch(_e){case"YY":return String(D.$y).slice(-2);case"YYYY":return Y.s(D.$y,4,"0");case"M":return G+1;case"MM":return Y.s(G+1,2,"0");case"MMM":return ue(y.monthsShort,G,Q,3);case"MMMM":return ue(Q,G);case"D":return D.$D;case"DD":return Y.s(D.$D,2,"0");case"d":return String(D.$W);case"dd":return ue(y.weekdaysMin,D.$W,J,2);case"ddd":return ue(y.weekdaysShort,D.$W,J,3);case"dddd":return J[D.$W];case"H":return String(W);case"HH":return Y.s(W,2,"0");case"h":return be(1);case"hh":return be(2);case"a":return ve(W,j,!0);case"A":return ve(W,j,!1);case"m":return String(j);case"mm":return Y.s(j,2,"0");case"s":return String(D.$s);case"ss":return Y.s(D.$s,2,"0");case"SSS":return Y.s(D.$ms,3,"0");case"Z":return P}return null})(K)||P.replace(":","")}))},$.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},$.diff=function(b,D,y){var T,P=this,W=Y.p(D),j=q(b),G=(j.utcOffset()-this.utcOffset())*l,J=this-j,Q=function(){return Y.m(P,j)};switch(W){case O:T=Q()/12;break;case f:T=Q();break;case u:T=Q()/3;break;case m:T=(J-G)/6048e5;break;case g:T=(J-G)/864e5;break;case k:T=J/i;break;case _:T=J/l;break;case v:T=J/t;break;default:T=J}return y?T:Y.a(T)},$.daysInMonth=function(){return this.endOf(f).$D},$.$locale=function(){return w[this.$L]},$.locale=function(b,D){if(!b)return this.$L;var y=this.clone(),T=se(b,D,!0);return T&&(y.$L=T),y},$.clone=function(){return Y.w(this.$d,this)},$.toDate=function(){return new Date(this.valueOf())},$.toJSON=function(){return this.isValid()?this.toISOString():null},$.toISOString=function(){return this.$d.toISOString()},$.toString=function(){return this.$d.toUTCString()},M})(),De=me.prototype;return q.prototype=De,[["$ms",h],["$s",v],["$m",_],["$H",k],["$W",g],["$M",f],["$y",O],["$D",V]].forEach((function(M){De[M[1]]=function($){return this.$g($,M[0],M[1])}})),q.extend=function(M,$){return M.$i||(M($,me,q),M.$i=!0),q},q.locale=se,q.isDayjs=ie,q.unix=function(M){return q(1e3*M)},q.en=w[p],q.Ls=w,q.p={},q}))})(Ne)),Ne.exports}var lt=it();const $e=st(lt);function Ye(n,s="сум"){return n==null||isNaN(n)?`0 ${s}`:`${n.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${s}`}function xe(n){return n?$e(n).format("DD.MM.YYYY"):""}function Ue(n,s="ru"){return n?s==="uz"&&n.nameUz?n.nameUz:n.name||n.nameUz||"":""}function Ce(n,s="ru"){if(!n)return"";const t=String(n).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?s==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?s==="uz"?"Ayol":"Женский":String(n)}function ot(n){if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;if(/^\d{2}-\d{2}-\d{4}$/.test(n)){const s=n.split("-");return`${s[2]}-${s[1]}-${s[0]}`}try{return $e(n,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return n}}const de=je("osgo",()=>{const n=we(),s=Ae(),t=L({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),l=L({passportSeries:"",passportNumber:"",birthDate:""}),i=L({passportSeries:"",passportNumber:"",birthDate:""}),h=L(U.PARAMS),v=L(!1),_=L(null),k=L(!1),g=L(null),m=L(null),f=L(null),u=L(!1),O=L(null),V=L(!1),H=L(!1),R=L(null),S=L(!1),C=L(!1),E=L(null),x=L(!1),p=L(!1),w=L(null),B=I(()=>t.value.status==="DRAFT"),ie=I(()=>J(h.value).valid),se=I(()=>Object.keys(U).length),q=I(()=>Math.round((h.value+1)/se.value*100)),Y=I(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,A=t.value.period.coefficient||0,z=t.value.drivedArea.coefficient||0;let Z=3;t.value.driversLimited&&t.value.incidentCoeff&&(Z=t.value.incidentCoeff);const Oe=r*A*Z*z,Le=Oe>5*r?Pe*5*r:Pe*Oe/100;return Math.round(Le)}),me=I(()=>{const A=(t.value.entriesJournalKt||[]).reduce((z,Z)=>z+(Z.amount||0),0);return t.value.premium-A}),De=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},i.value={passportSeries:"",passportNumber:"",birthDate:""},h.value=U.PARAMS,n.isLoaded&&(t.value.discountType=n.getDefaultDiscountType())};ge(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ge(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ge(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const A=parseInt(r.slice(0,2)),z=n.findDrivedAreaByRegion(A);z&&(t.value.drivedArea=z)}),ge(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=Y.value},{deep:!0}),ge(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const M=async()=>{if(t.value.vehicle){V.value=!0,R.value=null,H.value=!1;try{const r=await s.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),A=r?.result||r;if(r?.error&&!A)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&A&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,A),A?.carType&&n.isLoaded&&(t.value.vehicle.carType=n.findCarType(A.carType.id)),H.value=!0,console.log("[OsgoStore] Vehicle verified:",A)}catch(r){throw R.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{V.value=!1}}},$=async()=>{S.value=!0,E.value=null,C.value=!1;try{const r=await s.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(i.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.party={...l.value},p.value=!0)),C.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(r){throw E.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{S.value=!1}},b=async()=>{x.value=!0,w.value=null,p.value=!1;try{const r=await s.getIndividualByPassport({passportSeries:i.value.passportSeries?.toUpperCase()||"",passportNumber:i.value.passportNumber,birthDate:i.value.birthDate});console.log("[OsgoStore] API result for applicant:",r),r&&(i.value={passportSeries:i.value.passportSeries,passportNumber:i.value.passportNumber,birthDate:i.value.birthDate,...r},t.value.party={...i.value}),p.value=!0,console.log("[OsgoStore] Applicant after assignment:",i.value)}catch(r){throw w.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{x.value=!1}},D=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const A=ot(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:A});const z=await s.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:A});if(console.log("[OsgoStore] Driver verification result:",z),!z||!z.id)throw new Error("Driver verification failed: invalid response");const Z={...r,...z,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",Z),Z}catch(A){throw console.error("[OsgoStore] Driver verification failed:",A),A}},y=r=>{t.value.drivers||(t.value.drivers=[]);const A={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(A),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},T=(r,A)=>{t.value.drivers[r]&&(t.value.drivers[r]=A)},P=r=>{t.value.drivers.splice(r,1)},W=(r,A,z)=>t.value.drivers.some(Z=>Z.passportSeries===r&&Z.passportNumber===A&&Z.birthDate===z),j=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(W(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}y({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},G=()=>{W(i.value.passportSeries,i.value.passportNumber,i.value.birthDate)||y({passportSeries:i.value.passportSeries,passportNumber:i.value.passportNumber,birthDate:i.value.birthDate})},J=r=>{switch(r){case U.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case U.VEHICLE:return{valid:H.value};case U.OWNER:return{valid:C.value&&(t.value.applicantIsOwner||p.value)};case U.DRIVERS:return{valid:!t.value.driversLimited||t.value.drivers.length>0};case U.SUMMARY:const A=t.value.applicantIsOwner?l.value.id:i.value.id;return{valid:!!(l.value.id&&A&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(z=>z.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case U.PAYMENT:return{valid:!!(t.value.id&&O.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:i,currentStep:h,saving:v,saveError:_,fetching:k,fetchError:g,fundData:m,fundError:f,fetchingFundData:u,selectedPaymentMethod:O,vehicleVerifying:V,vehicleVerified:H,vehicleVerifyError:R,ownerVerifying:S,ownerVerified:C,ownerVerifyError:E,applicantVerifying:x,applicantVerified:p,applicantVerifyError:w,isEditable:B,canProceedToNextStep:ie,totalSteps:se,progressPercentage:q,calculatedPremium:Y,amountPayable:me,initialize:De,verifyVehicle:M,verifyOwner:$,verifyApplicant:b,verifyDriver:D,addDriver:y,updateDriver:T,removeDriver:P,hasDriver:W,addOwnerAsDriver:j,addApplicantAsDriver:G,validateStepData:J,nextStep:()=>{h.value<se.value-1&&h.value++},previousStep:()=>{h.value>0&&h.value--},goToStep:r=>{r>=0&&r<se.value&&(h.value=r)},createPolicy:async()=>{v.value=!0,_.value=null;try{let r=null;try{r=await s.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Ie){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Ie),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const A=t.value.applicantIsOwner?{...l.value}:{...i.value};A.phone&&(A.phone=A.phone.replace(/[+()-]/g,""));const z={...l.value},Z=t.value.discountType||n.meta?.beneficiary?.find(({coefficient:Ie})=>Ie===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const Re={party:A,beneficiary:z,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:Z,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},ze={user:r,osgo:Re};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:A.id,name:A.name},beneficiary:{id:z.id,name:z.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:Z?.id}}});const ye=await s.createOsgoApplication(ze);if(!ye||typeof ye!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ye),new Error("Failed to create policy: invalid response");return t.value.id=ye,t.value.applicantIsOwner?(l.value.phone=A.phone,t.value.party=l.value):(i.value.phone=A.phone,t.value.party=i.value),console.log("[OsgoStore] Policy created:",ye),ye}catch(r){throw _.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{v.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");v.value=!0,_.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?l.value:i.value,beneficiary:l.value};await s.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw _.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{v.value=!1}},fetchPolicy:async r=>{k.value=!0,g.value=null;try{const A=await s.fetchOsgoEntity(r);if(t.value=A,A.party?.id){const z=await s.fetchIndividualEntity(A.party.id);i.value=z,t.value.party=z}if(A.beneficiary?.id){const z=await s.fetchIndividualEntity(A.beneficiary.id);l.value=z,t.value.beneficiary=z}if(n.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=n.findCarType(t.value.vehicle.carType.id)),n.isLoaded&&t.value.period&&(t.value.period=n.findPeriod(t.value.period.id)),n.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=n.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const z=Math.max(...t.value.drivers.map(Z=>Z.incidentFrequency?.coefficient||0));t.value.incidentCoeff=z}console.log("[OsgoStore] Policy fetched:",r)}catch(A){throw g.value=A.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",A),A}finally{k.value=!1}},fetchFundData:async()=>{if(t.value.id){u.value=!0,f.value=null;try{const r=await s.getFundPolicy(t.value.id);m.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){f.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{u.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:l.value,applicant:i.value,currentStep:h.value};sessionStorage.setItem(Te.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Te.OSGO_DRAFT);if(!r)return!1;const A=JSON.parse(r);return t.value=A.osgo,l.value=A.owner,i.value=A.applicant,h.value=A.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Te.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{De(),H.value=!1,C.value=!1,p.value=!1,m.value=null,_.value=null,g.value=null}}}),nt={class:"language-switcher"},rt=["onClick"],ct=ee({__name:"LanguageSwitcher",setup(n){const{locale:s,locales:t}=ce();He();const l=I(()=>s.value),i=I(()=>t.value.filter(v=>v.code!==s.value)),h=v=>{s.value=v,typeof window<"u"&&localStorage.setItem("app-language",v),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Ve(()=>{if(typeof window<"u"){const v=localStorage.getItem("app-language");v&&(v==="ru"||v==="uz")&&(s.value=v)}}),(v,_)=>(c(),d("div",nt,[(c(!0),d(X,null,pe(a(i),k=>(c(),d("button",{key:k.code,class:ae(["lang-btn",{active:a(l)===k.code}]),onClick:g=>h(k.code)},o(k.code.toUpperCase()),11,rt))),128))]))}}),dt=te(ct,[["__scopeId","data-v-e748ef5d"]]),ut={class:"progress-bar-container"},vt={class:"progress-track"},pt={class:"steps-container"},ft=["onClick"],ht={key:0,class:"step-check"},mt={key:1,class:"step-number"},bt={class:"step-label"},_t=ee({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(n){const s=n,{t}=ce(),l=I(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.drivers"),t("steps.summary"),t("steps.payment")]),i=I(()=>(s.currentStep+1)/s.totalSteps*100),h=v=>{console.log("Step clicked:",v)};return(v,_)=>(c(),d("div",ut,[e("div",vt,[e("div",{class:"progress-fill",style:qe({width:`${i.value}%`})},null,4)]),e("div",pt,[(c(!0),d(X,null,pe(l.value,(k,g)=>(c(),d("div",{key:g,class:"step-wrapper",onClick:m=>h(g)},[e("div",{class:ae(["step-circle",{"step-active":g===n.currentStep,"step-completed":g<n.currentStep,"step-pending":g>n.currentStep}])},[g<n.currentStep?(c(),d("span",ht,"✓")):(c(),d("span",mt,o(g+1),1))],2),e("div",bt,o(k),1)],8,ft))),128))])]))}}),yt=te(_t,[["__scopeId","data-v-b647cd33"]]),gt={class:"fixed-header"},$t={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},St={class:"flex items-center justify-between mb-3"},wt=ee({__name:"AppHeader",setup(n){const s=de(),t=I(()=>s.currentStep),l=I(()=>s.totalSteps);return(i,h)=>{const v=dt,_=yt;return c(),d("header",gt,[e("div",$t,[e("div",St,[h[0]||(h[0]=Ge('<div class="flex items-center gap-3" data-v-67b64b56><div class="w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg" data-v-67b64b56><img src="'+tt+'" alt="Temiryo&#39;l Sug&#39;urta Logo" data-v-67b64b56></div><div data-v-67b64b56><div class="text-base font-bold text-text" data-v-67b64b56>ОСГОВТС</div><div class="text-xs text-text-light" data-v-67b64b56> Temiryo&#39;l Sug&#39;urta </div></div></div>',1)),F(v)]),F(_,{"current-step":t.value,"total-steps":l.value},null,8,["current-step","total-steps"])])])}}}),Dt=te(wt,[["__scopeId","data-v-67b64b56"]]),kt={class:"fixed-footer"},xt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},Nt=["disabled"],At={class:"flex-1 text-center"},Vt={class:"text-sm text-text-light font-medium"},Mt=["disabled"],Ot={key:0,class:"spinner"},It={key:0},Tt={key:1},Pt={key:2},Ct={key:3,class:"text-lg bx bx-chevron-right"},Et=ee({__name:"AppFooter",setup(n){const s=de(),t=fe(),l=Ae(),{t:i}=ce(),h=L(!1),v=L(null),_=L(null),k=I(()=>s.currentStep),g=I(()=>s.totalSteps),m=I(()=>k.value===0),f=I(()=>k.value===g.value-1),u=I(()=>s.canProceedToNextStep),O=I(()=>s.saving||s.fetching||h.value),V=()=>{m.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),s.previousStep())},H=async()=>{if(!u.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(i("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(k.value===U.VEHICLE&&!s.vehicleVerified)await s.verifyVehicle();else if(k.value===U.OWNER)s.ownerVerified||await s.verifyOwner(),!s.osgo.applicantIsOwner&&!s.applicantVerified&&await s.verifyApplicant();else if(k.value===U.SUMMARY)s.osgo.id||(await s.createPolicy(),console.log("[AppFooter] Policy created:",s.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(k.value===U.PAYMENT){if(!s.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const S={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[s.selectedPaymentMethod],C=s.osgo.id,x=(s.osgo.applicantIsOwner?s.owner:s.applicant).phone||"",p=s.calculatedPremium;if(!C||!x||!p){const w="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:C,phone:x,amount:p}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(w));return}try{h.value=!0,v.value=null,_.value=null,await l.sendPaymentLink(S,C,x,p),_.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(w){v.value=w.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",w),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(v.value))}finally{h.value=!1}return}f.value?console.log("[AppFooter] Last step reached"):s.nextStep()}catch(R){console.error("[AppFooter] Error:",R),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(R.message||i("errors.unknown")))}};return(R,S)=>(c(),d("footer",kt,[e("div",xt,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:m.value||O.value,onClick:V},[S[0]||(S[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,o(R.$t("common.previous")),1)],8,Nt),e("div",At,[e("div",Vt,o(R.$t("common.step",{current:k.value+1,total:g.value})),1)]),e("button",{type:"button",class:ae(["btn flex-1 max-w-[160px]",{"btn-primary":!f.value||k.value!==a(U).PAYMENT,"btn-success":f.value&&k.value===a(U).PAYMENT}]),disabled:!u.value||O.value,onClick:H},[O.value?(c(),d("span",Ot)):(c(),d(X,{key:1},[k.value===a(U).SUMMARY&&!a(s).osgo.id?(c(),d("span",It,o(R.$t("step5.confirm")),1)):f.value&&k.value===a(U).PAYMENT?(c(),d("span",Tt,[S[1]||(S[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(R.$t("step5.payment")),1)])):(c(),d("span",Pt,o(R.$t("common.next")),1)),!f.value&&k.value!==a(U).SUMMARY?(c(),d("i",Ct)):N("",!0)],64))],10,Mt)])]))}}),Yt=te(Et,[["__scopeId","data-v-4fce94ec"]]),Lt=["disabled"],Ft={key:0,class:"check-icon"},Bt={class:"check-content"},Wt={class:"check-title"},Ut={key:0,class:"check-description"},Rt={class:"check-indicator"},zt={class:"check-circle"},jt={key:0,class:"check-dot"},Ht=ee({__name:"CheckButton",props:{title:{default:""},description:{default:""},icon:{default:""},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["click"],setup(n,{emit:s}){const t=n,l=s,i=()=>{t.disabled||l("click")};return(h,v)=>(c(),d("button",{type:"button",class:ae(["check-button",{active:n.active,disabled:n.disabled}]),disabled:n.disabled,onClick:i},[n.icon?(c(),d("div",Ft,o(n.icon),1)):N("",!0),e("div",Bt,[e("div",Wt,[Fe(h.$slots,"default",{},()=>[Se(o(n.title),1)])]),n.description||h.$slots.description?(c(),d("div",Ut,[Fe(h.$slots,"description",{},()=>[Se(o(n.description),1)])])):N("",!0)]),e("div",Rt,[e("div",zt,[n.active?(c(),d("div",jt)):N("",!0)])])],10,Lt))}}),qt=te(Ht,[["__scopeId","data-v-f6637245"]]),Gt={class:"step-container"},Jt={key:0,class:"loading-state"},Zt={key:1,class:"error-state"},Kt={key:2,class:"error-state"},Qt={class:"debug-info"},Xt={key:3},es={class:"step-content"},ts={class:"form-section"},ss={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},as={class:"form-section"},is={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ls={class:"form-section"},os={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ns={key:0,class:"form-section"},rs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},cs={class:"form-section"},ds={class:"select-wrapper"},us=["disabled"],vs=["value"],ps={key:0,class:"premium-card"},fs={class:"premium-card-content"},hs={class:"premium-amount"},ms=ee({__name:"Step1Params",setup(n){const s=de(),t=we(),l=fe(),{locale:i}=ce();Ve(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Car types:",t.carTypes),console.log("[Step1Params] Periods count:",t.periods.length),console.log("[Step1Params] Meta object:",t.meta)});const h=I(()=>s.osgo),v=f=>t.getLocalizedName(f,i.value||"uz"),_=I({get:()=>h.value.drivedArea?.id||"",set:f=>{const u=t.findDrivedArea(f);u&&(h.value.drivedArea=u)}}),k=f=>{s.isEditable&&(h.value.vehicle||(h.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),h.value.vehicle.carType=f,l.isTelegramWebApp.value&&l.hapticImpact("light"))},g=f=>{s.isEditable&&(h.value.period=f,l.isTelegramWebApp.value&&l.hapticImpact("light"))},m=f=>{s.isEditable&&(h.value.incidentCoeff=f.coefficient,l.isTelegramWebApp.value&&l.hapticImpact("light"))};return(f,u)=>{const O=qt;return c(),d("div",Gt,[a(t).fetching?(c(),d("div",Jt,[...u[4]||(u[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Загрузка данных...",-1)])])):a(t).error?(c(),d("div",Zt,[u[5]||(u[5]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,o(a(t).error),1),e("button",{onClick:u[0]||(u[0]=V=>a(t).fetchMeta(!0)),class:"btn-retry"}," Попробовать снова ")])):!a(t).isLoaded||a(t).carTypes.length===0?(c(),d("div",Kt,[u[8]||(u[8]=e("i",{class:"bx bx-info-circle"},null,-1)),u[9]||(u[9]=e("p",null,"Нет данных. Загрузка...",-1)),e("p",Qt,[Se(" isLoaded: "+o(a(t).isLoaded),1),u[6]||(u[6]=e("br",null,null,-1)),Se(" carTypes: "+o(a(t).carTypes.length),1),u[7]||(u[7]=e("br",null,null,-1)),Se(" meta: "+o(a(t).meta?"exists":"null"),1)])])):(c(),d("div",Xt,[u[18]||(u[18]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Параметры полиса"),e("p",{class:"step-description"}," Выберите тип транспорта, период страхования и параметры использования ")],-1)),e("div",es,[e("div",ts,[u[10]||(u[10]=e("h3",{class:"section-title"},"Тип транспортного средства",-1)),e("div",ss,[(c(!0),d(X,null,pe(a(t).carTypes,V=>(c(),re(O,{key:V.id,title:v(V),active:h.value.vehicle?.carType?.id===V.id,disabled:!a(s).isEditable,onClick:H=>k(V)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",as,[u[11]||(u[11]=e("h3",{class:"section-title"},"Период страхования",-1)),e("div",is,[(c(!0),d(X,null,pe(a(t).periods,V=>(c(),re(O,{key:V.id,title:v(V),active:h.value.period?.id===V.id,disabled:!a(s).isEditable,onClick:H=>g(V)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",ls,[u[12]||(u[12]=e("h3",{class:"section-title"},"Количество водителей",-1)),e("div",os,[F(O,{title:"Без ограничений",description:"Любое количество водителей",active:!h.value.driversLimited,disabled:!a(s).isEditable,onClick:u[1]||(u[1]=V=>h.value.driversLimited=!1)},null,8,["active","disabled"]),F(O,{title:"Ограниченное",description:"Указанные водители",active:h.value.driversLimited,disabled:!a(s).isEditable,onClick:u[2]||(u[2]=V=>h.value.driversLimited=!0)},null,8,["active","disabled"])])]),F(le,{name:"slide-down"},{default:oe(()=>[h.value.driversLimited?(c(),d("div",ns,[u[13]||(u[13]=e("h3",{class:"section-title"},"Частота страховых случаев",-1)),e("div",rs,[(c(!0),d(X,null,pe(a(t).incidentFrequencies,V=>(c(),re(O,{key:V.id,title:v(V),active:h.value.incidentCoeff===V.coefficient,disabled:!a(s).isEditable,onClick:H=>m(V)},null,8,["title","active","disabled","onClick"]))),128))])])):N("",!0)]),_:1}),e("div",cs,[u[16]||(u[16]=e("h3",{class:"section-title"},"Территория использования",-1)),e("div",ds,[Ee(e("select",{"onUpdate:modelValue":u[3]||(u[3]=V=>_.value=V),class:"input",disabled:!a(s).isEditable},[u[14]||(u[14]=e("option",{value:"",disabled:""}," Выберите территорию ",-1)),(c(!0),d(X,null,pe(a(t).drivedAreas,V=>(c(),d("option",{key:V.id,value:V.id},o(v(V)),9,vs))),128))],8,us),[[Je,_.value]]),u[15]||(u[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),a(s).calculatedPremium>0?(c(),d("div",ps,[e("div",fs,[u[17]||(u[17]=e("div",{class:"premium-label"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",hs,o(a(Ye)(a(s).calculatedPremium)),1)])])):N("",!0)])]))])}}}),bs=te(ms,[["__scopeId","data-v-9caa72cf"]]),_s=["for"],ys={key:0,class:"text-error"},gs={class:"input-wrapper"},$s={key:0,class:"input-icon input-icon-left"},Ss=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],ws={key:2,class:"input-icon input-icon-right"},Ds={key:1,class:"input-message"},ks={key:0,class:"error-message"},xs={key:1,class:"helper-text"},Ns={key:2,class:"input-count"},As=ee({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(n,{expose:s,emit:t}){const l=n,i=t,{locale:h}=ce(),v=I(()=>{if(l.type==="date")return h.value==="uz"?"uz-UZ":"ru-RU"}),_=L(null),k=I(()=>`input-${Math.random().toString(36).substr(2,9)}`),g=I({get:()=>{const x=String(l.modelValue||"");if(l.dateMask&&x){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(x)||/^\d{2}-\d{2}-\d{4}$/.test(x))return x;if(/^\d{4}-\d{2}-\d{2}$/.test(x)){const p=x.split("-");return`${p[2]}-${p[1]}-${p[0]}`}}return x},set:x=>{if(l.uppercase&&(x=x.toUpperCase()),l.dateMask&&x){if(/^\d{4}-\d{2}-\d{2}$/.test(x)){i("update:modelValue",x);return}if(/^\d{2}-\d{2}-\d{4}$/.test(x)){const p=x.split("-");i("update:modelValue",`${p[2]}-${p[1]}-${p[0]}`);return}i("update:modelValue",x);return}i("update:modelValue",x)}}),m=x=>{const p=x.target;let w=p.value;if(l.uppercase&&(w=w.toUpperCase(),p.value!==w&&(p.value=w)),l.dateMask){const B=S(w);p.value!==B&&(p.value=B),i("update:modelValue",B),i("input",B);return}l.mask&&(w=R(w)),i("update:modelValue",w),i("input",w)},f=()=>{if(l.dateMask&&g.value){const x=String(g.value);if(/^\d{2}-\d{2}-\d{4}$/.test(x)){const p=x.split("-"),w=`${p[2]}-${p[1]}-${p[0]}`,B=new Date(w);isNaN(B.getTime())||i("update:modelValue",w)}}i("blur")},u=()=>{i("focus")},O=x=>{},V=()=>{i("enter")},H=()=>{i("update:modelValue",""),_.value?.focus()},R=x=>{if(l.dateMask)return S(x);if(!l.mask)return x;let p="",w=0;const B=x.replace(/\D/g,"");for(let ie=0;ie<l.mask.length&&w<B.length;ie++){const se=l.mask[ie];se==="#"?(p+=B[w],w++):p+=se}return p},S=x=>{const w=x.replace(/\D/g,"").slice(0,8);return w.length===0?"":w.length<=2?w:w.length<=4?`${w.slice(0,2)}-${w.slice(2)}`:`${w.slice(0,2)}-${w.slice(2,4)}-${w.slice(4)}`},C=()=>{_.value?.focus()},E=()=>{_.value?.blur()};return Ve(()=>{l.autofocus&&C()}),s({focus:C,blur:E}),(x,p)=>(c(),d("div",{class:ae(["input-field",{"has-error":n.error}])},[n.label?(c(),d("label",{key:0,class:"input-label",for:k.value},[Se(o(n.label)+" ",1),n.required?(c(),d("span",ys,"*")):N("",!0)],8,_s)):N("",!0),e("div",gs,[n.icon?(c(),d("div",$s,[e("i",{class:ae(n.icon)},null,2)])):N("",!0),Ee(e("input",{id:k.value,ref_key:"inputRef",ref:_,"onUpdate:modelValue":p[0]||(p[0]=w=>g.value=w),type:n.dateMask?"text":n.type,placeholder:n.dateMask?n.placeholder||"DD-MM-YYYY":n.placeholder,disabled:n.disabled,readonly:n.readonly,maxlength:n.dateMask?10:n.maxLength,autocomplete:n.autocomplete,inputmode:n.dateMask?"numeric":n.inputMode,lang:v.value,class:ae(["input",{"input-with-icon-left":n.icon,"input-with-icon-right":n.clearable||n.loading,"input-error":n.error}]),onInput:m,onBlur:f,onFocus:u,onKeypress:O,onKeydown:Ke(V,["enter"])},null,42,Ss),[[Ze,g.value]]),n.clearable&&g.value&&!n.disabled&&!n.readonly?(c(),d("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:H},[...p[1]||(p[1]=[e("i",{class:"bx bx-x"},null,-1)])])):N("",!0),n.loading?(c(),d("div",ws,[...p[2]||(p[2]=[e("div",{class:"spinner-small"},null,-1)])])):N("",!0)]),n.helperText||n.error?(c(),d("div",Ds,[n.error?(c(),d("span",ks,o(n.error),1)):n.helperText?(c(),d("span",xs,o(n.helperText),1)):N("",!0)])):N("",!0),n.showCount&&n.maxLength?(c(),d("div",Ns,o(g.value.length)+" / "+o(n.maxLength),1)):N("",!0)],2))}}),Me=te(As,[["__scopeId","data-v-4eb39aee"]]);function Vs(n){if(!n)return{valid:!1,error:"Государственный номер обязателен"};const s=n.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(s)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Ms(n){if(!n)return{valid:!1,error:"Серия техпаспорта обязательна"};const s=n.toUpperCase();return/^[A-Z]{2,3}$/.test(s)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Os(n){return n?/^\d+$/.test(n)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Is={class:"step-container"},Ts={class:"step-content"},Ps={class:"form-section"},Cs={class:"form-section"},Es={class:"form-section"},Ys={class:"form-section"},Ls=["disabled"],Fs={key:0,class:"spinner"},Bs={key:0,class:"alert alert-error"},Ws={key:0,class:"vehicle-info-card"},Us={class:"card-content"};const Rs={class:"vehicle-info-grid"},zs={key:0,class:"vehicle-info-item"},js={class:"vehicle-info-value"},Hs={key:1,class:"vehicle-info-item"},qs={class:"vehicle-info-value"},Gs={key:2,class:"vehicle-info-item"},Js={class:"vehicle-info-value"},Zs={key:3,class:"vehicle-info-item"},Ks={class:"vehicle-info-value"},Qs={key:4,class:"vehicle-info-item"},Xs={class:"vehicle-info-value"},ea={key:1,class:"vehicle-info-empty"},ta=ee({__name:"Step2Vehicle",setup(n){const s=de();we();const t=fe(),l=I(()=>s.osgo),i=L({}),h=I(()=>!!(l.value.vehicle?.govNumber&&l.value.vehicle?.techPassportSeries&&l.value.vehicle?.techPassportNumber&&Object.keys(i.value).length===0)),v=I(()=>{if(!l.value.vehicle)return 0;const g=l.value.vehicle;let m=0;return g.techPassportIssueDate&&m++,(g.modelName||g.model)&&m++,(g.createdYear||g.year)&&m++,g.engineNumber&&m++,g.bodyNumber&&m++,m}),_=g=>{if(!l.value.vehicle)return;let m;switch(g){case"govNumber":m=Vs(l.value.vehicle.govNumber);break;case"techPassportSeries":m=Ms(l.value.vehicle.techPassportSeries);break;case"techPassportNumber":m=Os(l.value.vehicle.techPassportNumber);break}m&&!m.valid?i.value[g]=m.error||"":delete i.value[g]},k=async()=>{if(_("govNumber"),_("techPassportSeries"),_("techPassportNumber"),Object.keys(i.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await s.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",l.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(l.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(g,m)=>{const f=Me;return c(),d("div",Is,[m[20]||(m[20]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Информация о транспорте"),e("p",{class:"step-description"}," Введите данные транспортного средства для проверки ")],-1)),e("div",Ts,[e("div",Ps,[F(f,{modelValue:l.value.vehicle.govNumber,"onUpdate:modelValue":m[0]||(m[0]=u=>l.value.vehicle.govNumber=u),label:"Государственный номер",placeholder:"01A000AA",disabled:!a(s).isEditable,error:i.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:m[1]||(m[1]=u=>_("govNumber"))},null,8,["modelValue","disabled","error"])]),e("div",Cs,[F(f,{modelValue:l.value.vehicle.techPassportSeries,"onUpdate:modelValue":m[2]||(m[2]=u=>l.value.vehicle.techPassportSeries=u),label:"Серия техпаспорта",placeholder:"AAA",disabled:!a(s).isEditable,error:i.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:m[3]||(m[3]=u=>_("techPassportSeries"))},null,8,["modelValue","disabled","error"])]),e("div",Es,[F(f,{modelValue:l.value.vehicle.techPassportNumber,"onUpdate:modelValue":m[4]||(m[4]=u=>l.value.vehicle.techPassportNumber=u),label:"Номер техпаспорта",placeholder:"1234567",disabled:!a(s).isEditable,error:i.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:m[5]||(m[5]=u=>_("techPassportNumber"))},null,8,["modelValue","disabled","error"])]),e("div",Ys,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!h.value||a(s).vehicleVerifying,onClick:k},[a(s).vehicleVerifying?(c(),d("span",Fs)):(c(),d(X,{key:1},[m[6]||(m[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(a(s).vehicleVerified?"Проверено":"Проверить"),1)],64))],8,Ls)]),a(s).vehicleVerifyError?(c(),d("div",Bs,[m[7]||(m[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(a(s).vehicleVerifyError),1)])):N("",!0),F(le,{name:"fade"},{default:oe(()=>[a(s).vehicleVerified&&l.value.vehicle?(c(),d("div",Ws,[m[19]||(m[19]=e("div",{class:"card-header"},[e("i",{class:"bx bx-check-circle text-success"}),e("span",null,"Транспорт найден")],-1)),e("div",Us,[N("",!0),e("div",Rs,[l.value.vehicle?.techPassportIssueDate?(c(),d("div",zs,[m[14]||(m[14]=e("div",{class:"vehicle-info-label"},"Дата выдачи техпаспорта",-1)),e("div",js,o(a(xe)(l.value.vehicle.techPassportIssueDate)),1)])):N("",!0),l.value.vehicle?.modelName||l.value.vehicle?.model?(c(),d("div",Hs,[m[15]||(m[15]=e("div",{class:"vehicle-info-label"},"Модель",-1)),e("div",qs,o(l.value.vehicle?.modelName||l.value.vehicle?.model||"-"),1)])):N("",!0),l.value.vehicle?.createdYear||l.value.vehicle?.year?(c(),d("div",Gs,[m[16]||(m[16]=e("div",{class:"vehicle-info-label"},"Год выпуска",-1)),e("div",Js,o(l.value.vehicle?.createdYear||l.value.vehicle?.year||"-"),1)])):N("",!0),l.value.vehicle?.engineNumber?(c(),d("div",Zs,[m[17]||(m[17]=e("div",{class:"vehicle-info-label"},"Номер двигателя",-1)),e("div",Ks,o(l.value.vehicle.engineNumber),1)])):N("",!0),l.value.vehicle?.bodyNumber?(c(),d("div",Qs,[m[18]||(m[18]=e("div",{class:"vehicle-info-label"},"Номер кузова/шасси",-1)),e("div",Xs,o(l.value.vehicle.bodyNumber),1)])):N("",!0)]),v.value===0?(c(),d("div",ea," Нет данных о транспортном средстве ")):N("",!0)])])):N("",!0)]),_:1})])])}}}),sa=te(ta,[["__scopeId","data-v-7b02d127"]]),aa={class:"step-container"},ia={class:"step-header"},la={class:"step-title"},oa={class:"step-description"},na={class:"step-content"},ra={class:"subsection"},ca={class:"subsection-title"},da={class:"form-section"},ua={class:"form-section"},va={class:"form-section"},pa={class:"form-section"},fa=["disabled"],ha={key:0,class:"spinner"},ma={key:0,class:"info-card success"},ba={class:"card-header"},_a={class:"card-content"},ya={class:"info-grid"},ga={class:"info-item"},$a={class:"info-label"},Sa={class:"info-value"},wa={class:"info-item"},Da={class:"info-label"},ka={class:"info-value"},xa={class:"info-item info-item-wide"},Na={class:"info-label"},Aa={class:"info-value"},Va={class:"info-item"},Ma={class:"info-label"},Oa={class:"info-value"},Ia={class:"info-item"},Ta={class:"info-label"},Pa={class:"info-value"},Ca={class:"info-item"},Ea={class:"info-label"},Ya={class:"info-value"},La={class:"info-item"},Fa={class:"info-label"},Ba={class:"info-value"},Wa={class:"info-item"},Ua={class:"info-label"},Ra={class:"info-value"},za={class:"info-item"},ja={class:"info-label"},Ha={class:"info-value"},qa={class:"info-item"},Ga={class:"info-label"},Ja={class:"info-value"},Za={class:"info-item"},Ka={class:"info-label"},Qa={class:"info-value"},Xa={class:"form-section"},ei={class:"checkbox-label"},ti=["disabled"],si={key:0,class:"subsection"},ai={class:"subsection-title"},ii={class:"form-section"},li={class:"form-section"},oi={class:"form-section"},ni={class:"form-section"},ri=["disabled"],ci={key:0,class:"spinner"},di={key:0,class:"info-card success"},ui={class:"card-header"},vi={class:"card-content"},pi={class:"info-grid"},fi={class:"info-item"},hi={class:"info-label"},mi={class:"info-value"},bi={class:"info-item"},_i={class:"info-label"},yi={class:"info-value"},gi={class:"info-item info-item-wide"},$i={class:"info-label"},Si={class:"info-value"},wi={class:"info-item"},Di={class:"info-label"},ki={class:"info-value"},xi={class:"info-item"},Ni={class:"info-label"},Ai={class:"info-value"},Vi={class:"info-item"},Mi={class:"info-label"},Oi={class:"info-value"},Ii={class:"info-item"},Ti={class:"info-label"},Pi={class:"info-value"},Ci={class:"info-item"},Ei={class:"info-label"},Yi={class:"info-value"},Li={class:"info-item"},Fi={class:"info-label"},Bi={class:"info-value"},Wi={class:"info-item"},Ui={class:"info-label"},Ri={class:"info-value"},zi={class:"info-item"},ji={class:"info-label"},Hi={class:"info-value"},qi=ee({__name:"Step3Owner",setup(n){const s=de(),t=fe(),{locale:l,t:i}=ce(),h=I(()=>s.osgo),v=I(()=>s.owner),_=I(()=>s.applicant),k=async()=>{try{await s.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},g=async()=>{try{await s.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(m,f)=>{const u=Me;return c(),d("div",aa,[e("div",ia,[e("h2",la,o(a(i)("step3.title")),1),e("p",oa,o(a(i)("step3.description")),1)]),e("div",na,[e("div",ra,[e("h3",ca,o(a(i)("step3.owner")),1),e("div",da,[F(u,{modelValue:v.value.passportSeries,"onUpdate:modelValue":f[0]||(f[0]=O=>v.value.passportSeries=O),label:a(i)("step3.passportSeries"),placeholder:a(i)("step3.passportSeriesPlaceholder"),disabled:!a(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ua,[F(u,{modelValue:v.value.passportNumber,"onUpdate:modelValue":f[1]||(f[1]=O=>v.value.passportNumber=O),label:a(i)("step3.passportNumber"),placeholder:a(i)("step3.passportNumberPlaceholder"),disabled:!a(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",va,[F(u,{modelValue:v.value.birthDate,"onUpdate:modelValue":f[2]||(f[2]=O=>v.value.birthDate=O),label:a(i)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!a(s).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",pa,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:a(s).ownerVerifying,onClick:k},[a(s).ownerVerifying?(c(),d("span",ha)):(c(),d(X,{key:1},[f[7]||(f[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(a(s).ownerVerified?a(i)("step3.verified"):a(i)("step3.verifyOwner")),1)],64))],8,fa)]),F(le,{name:"fade"},{default:oe(()=>[a(s).ownerVerified&&v.value.id?(c(),d("div",ma,[e("div",ba,[f[8]||(f[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(a(i)("step3.ownerFound")),1)]),e("div",_a,[e("div",ya,[e("div",ga,[e("div",$a,o(a(i)("step3.passportIssueDate")),1),e("div",Sa,o(v.value.passportIssueDate?a(xe)(v.value.passportIssueDate):"-"),1)]),e("div",wa,[e("div",Da,o(a(i)("step3.pinfl")),1),e("div",ka,o(v.value.nationalIdentifier||"-"),1)]),e("div",xa,[e("div",Na,o(a(i)("step3.issuedBy")),1),e("div",Aa,o(v.value.passportIssuedBy||"-"),1)]),e("div",Va,[e("div",Ma,o(a(i)("step3.lastName")),1),e("div",Oa,o(v.value.lastName||"-"),1)]),e("div",Ia,[e("div",Ta,o(a(i)("step3.firstName")),1),e("div",Pa,o(v.value.firstName||"-"),1)]),e("div",Ca,[e("div",Ea,o(a(i)("step3.middleName")),1),e("div",Ya,o(v.value.middleName||"-"),1)]),e("div",La,[e("div",Fa,o(a(i)("step3.gender")),1),e("div",Ba,o(v.value.gender?a(Ce)(v.value.gender,a(l).value):"-"),1)]),e("div",Wa,[e("div",Ua,o(a(i)("step3.country")),1),e("div",Ra,o(v.value.country?.langValue1||"-"),1)]),e("div",za,[e("div",ja,o(a(i)("step3.region")),1),e("div",Ha,o(v.value.region?.langValue1||"-"),1)]),e("div",qa,[e("div",Ga,o(a(i)("step3.district")),1),e("div",Ja,o(v.value.district?.langValue1||"-"),1)]),e("div",Za,[e("div",Ka,o(a(i)("step3.street")),1),e("div",Qa,o(v.value.street||"-"),1)])])])])):N("",!0)]),_:1})]),e("div",Xa,[e("label",ei,[Ee(e("input",{"onUpdate:modelValue":f[3]||(f[3]=O=>h.value.applicantIsOwner=O),type:"checkbox",class:"checkbox",disabled:!a(s).isEditable},null,8,ti),[[Qe,h.value.applicantIsOwner]]),e("span",null,o(a(i)("step3.ownerIsApplicant")),1)])]),F(le,{name:"slide-down"},{default:oe(()=>[h.value.applicantIsOwner?N("",!0):(c(),d("div",si,[e("h3",ai,o(a(i)("step3.applicant")),1),e("div",ii,[F(u,{modelValue:_.value.passportSeries,"onUpdate:modelValue":f[4]||(f[4]=O=>_.value.passportSeries=O),label:a(i)("step3.passportSeries"),placeholder:a(i)("step3.passportSeriesPlaceholder"),disabled:!a(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",li,[F(u,{modelValue:_.value.passportNumber,"onUpdate:modelValue":f[5]||(f[5]=O=>_.value.passportNumber=O),label:a(i)("step3.passportNumber"),placeholder:a(i)("step3.passportNumberPlaceholder"),disabled:!a(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",oi,[F(u,{modelValue:_.value.birthDate,"onUpdate:modelValue":f[6]||(f[6]=O=>_.value.birthDate=O),label:a(i)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!a(s).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",ni,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:a(s).applicantVerifying,onClick:g},[a(s).applicantVerifying?(c(),d("span",ci)):(c(),d(X,{key:1},[f[9]||(f[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(a(s).applicantVerified?a(i)("step3.verified"):a(i)("step3.verifyApplicant")),1)],64))],8,ri)]),F(le,{name:"fade"},{default:oe(()=>[a(s).applicantVerified&&_.value.id?(c(),d("div",di,[e("div",ui,[f[10]||(f[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(a(i)("step3.applicantFound")),1)]),e("div",vi,[e("div",pi,[e("div",fi,[e("div",hi,o(a(i)("step3.passportIssueDate")),1),e("div",mi,o(_.value.passportIssueDate?a(xe)(_.value.passportIssueDate):"-"),1)]),e("div",bi,[e("div",_i,o(a(i)("step3.pinfl")),1),e("div",yi,o(_.value.nationalIdentifier||"-"),1)]),e("div",gi,[e("div",$i,o(a(i)("step3.issuedBy")),1),e("div",Si,o(_.value.passportIssuedBy||"-"),1)]),e("div",wi,[e("div",Di,o(a(i)("step3.lastName")),1),e("div",ki,o(_.value.lastName||"-"),1)]),e("div",xi,[e("div",Ni,o(a(i)("step3.firstName")),1),e("div",Ai,o(_.value.firstName||"-"),1)]),e("div",Vi,[e("div",Mi,o(a(i)("step3.middleName")),1),e("div",Oi,o(_.value.middleName||"-"),1)]),e("div",Ii,[e("div",Ti,o(a(i)("step3.gender")),1),e("div",Pi,o(_.value.gender?a(Ce)(_.value.gender,a(l).value):"-"),1)]),e("div",Ci,[e("div",Ei,o(a(i)("step3.country")),1),e("div",Yi,o(_.value.country?.langValue1||"-"),1)]),e("div",Li,[e("div",Fi,o(a(i)("step3.region")),1),e("div",Bi,o(_.value.region?.langValue1||"-"),1)]),e("div",Wi,[e("div",Ui,o(a(i)("step3.district")),1),e("div",Ri,o(_.value.district?.langValue1||"-"),1)]),e("div",zi,[e("div",ji,o(a(i)("step3.street")),1),e("div",Hi,o(_.value.street||"-"),1)])])])])):N("",!0)]),_:1})]))]),_:1})])])}}}),Gi=te(qi,[["__scopeId","data-v-62def220"]]),Ji={class:"step-container"},Zi={class:"step-content"},Ki={key:0,class:"info-card"},Qi={class:"actions-row"},Xi=["disabled"],el=["disabled"],tl=["disabled"],sl={key:0,class:"empty-state"},al={key:1,class:"drivers-list"},il={class:"driver-header"},ll={class:"driver-number"},ol=["onClick"],nl={class:"driver-content"},rl=["disabled","onClick"],cl={key:0,class:"driver-info"},dl={class:"driver-info-grid"},ul={key:0,class:"info-item"},vl={class:"info-label"},pl={class:"info-value"},fl={key:1,class:"info-item"},hl={class:"info-label"},ml={class:"info-value"},bl={key:2,class:"info-item info-item-wide"},_l={class:"info-label"},yl={class:"info-value"},gl={key:3,class:"info-item"},$l={class:"info-label"},Sl={class:"info-value"},wl={key:4,class:"info-item"},Dl={class:"info-label"},kl={class:"info-value"},xl={key:5,class:"info-item"},Nl={class:"info-label"},Al={class:"info-value"},Vl={key:6,class:"info-item"},Ml={class:"info-label"},Ol={class:"info-value"},Il={key:7,class:"info-item info-item-full"},Tl={class:"info-label"},Pl={class:"info-value"},Cl={key:8,class:"info-item"},El={class:"info-label"},Yl={class:"info-value"},Ll={key:9,class:"info-item"},Fl={class:"info-label"},Bl={class:"info-value"},Wl={key:10,class:"info-item"},Ul={class:"info-label"},Rl={class:"info-value"},zl={key:11,class:"info-item"},jl={class:"info-label"},Hl=["value","onChange"],ql={value:""},Gl=["value"],Jl={key:1,class:"info-value"},Zl=ee({__name:"Step4Drivers",setup(n){const s=de(),t=we(),l=fe(),{t:i,locale:h}=ce(),v=I(()=>s.osgo),_=I(()=>s.owner),k=I(()=>s.applicant),g=I(()=>s.hasDriver(_.value.passportSeries,_.value.passportNumber,_.value.birthDate)),m=I(()=>s.hasDriver(k.value.passportSeries,k.value.passportNumber,k.value.birthDate)),f=()=>{if(s.isEditable)try{s.addDriver(),l.isTelegramWebApp.value&&l.hapticImpact("light"),console.log("[Step4Drivers] Driver added, total drivers:",v.value.drivers.length)}catch(C){console.error("[Step4Drivers] Error adding driver:",C),l.isTelegramWebApp.value&&l.showAlert("Ошибка при добавлении водителя")}},u=()=>{if(!s.isEditable||!s.ownerVerified){l.isTelegramWebApp.value&&l.showAlert("Сначала необходимо проверить данные владельца");return}if(!_.value.passportSeries||!_.value.passportNumber||!_.value.birthDate){l.isTelegramWebApp.value&&l.showAlert("Данные владельца не заполнены");return}try{s.addOwnerAsDriver(),l.isTelegramWebApp.value&&l.hapticImpact("medium"),console.log("[Step4Drivers] Owner added as driver, total drivers:",v.value.drivers.length)}catch(C){console.error("[Step4Drivers] Error adding owner as driver:",C),l.isTelegramWebApp.value&&l.showAlert("Ошибка при добавлении владельца как водителя")}},O=()=>{s.addApplicantAsDriver(),l.isTelegramWebApp.value&&l.hapticImpact("medium")},V=C=>{s.removeDriver(C),l.isTelegramWebApp.value&&l.hapticImpact("light")},H=C=>!!(C.passportSeries&&C.passportNumber&&C.birthDate),R=async C=>{const E=v.value.drivers[C];if(H(E))try{const x=await s.verifyDriver(E);if(!x||!x.id)throw new Error("Driver not found or verification failed");s.updateDriver(C,x),l.isTelegramWebApp.value&&(l.hapticNotification("success"),l.showAlert("Водитель успешно проверен"))}catch(x){console.error("[Step4Drivers] Driver verification error:",x),l.isTelegramWebApp.value&&(l.hapticNotification("error"),l.showAlert(x?.message||"Ошибка при проверке водителя"))}},S=(C,E)=>{const p=E.target.value,w=v.value.drivers[C];if(w){if(p){const B=t.relatives.find(ie=>ie.id===p);w.relative=B||null}else w.relative=null;s.updateDriver(C,w)}};return(C,E)=>{const x=Me;return c(),d("div",Ji,[E[8]||(E[8]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Информация о водителях"),e("p",{class:"step-description"}," Добавьте водителей, допущенных к управлению транспортным средством ")],-1)),e("div",Zi,[v.value.driversLimited?(c(),d(X,{key:1},[e("div",Qi,[e("button",{type:"button",class:"btn btn-primary-outlined",disabled:!a(s).isEditable,onClick:f},[...E[1]||(E[1]=[e("i",{class:"bx bx-plus"},null,-1),e("span",null,"Добавить водителя",-1)])],8,Xi),g.value?N("",!0):(c(),d("button",{key:0,type:"button",class:"btn btn-primary-outlined",disabled:!a(s).isEditable||!a(s).ownerVerified,onClick:u},[...E[2]||(E[2]=[e("i",{class:"bx bx-user"},null,-1),e("span",null,"Владелец - водитель",-1)])],8,el)),!v.value.applicantIsOwner&&!m.value?(c(),d("button",{key:1,type:"button",class:"btn btn-primary-outlined",disabled:!a(s).isEditable||!a(s).applicantVerified,onClick:O},[...E[3]||(E[3]=[e("i",{class:"bx bx-user"},null,-1),e("span",null,"Страхователь - водитель",-1)])],8,tl)):N("",!0)]),v.value.drivers.length===0?(c(),d("div",sl,[...E[4]||(E[4]=[e("i",{class:"bx bx-user-plus"},null,-1),e("p",null,"Добавьте хотя бы одного водителя",-1)])])):(c(),d("div",al,[(c(!0),d(X,null,pe(v.value.drivers,(p,w)=>(c(),d("div",{key:w,class:"driver-card"},[e("div",il,[e("div",ll,[E[5]||(E[5]=e("i",{class:"bx bx-user"},null,-1)),e("span",null,"Водитель "+o(w+1),1)]),a(s).isEditable?(c(),d("button",{key:0,type:"button",class:"btn-icon btn-danger",onClick:B=>V(w)},[...E[6]||(E[6]=[e("i",{class:"bx bx-trash"},null,-1)])],8,ol)):N("",!0)]),e("div",nl,[F(x,{modelValue:p.passportSeries,"onUpdate:modelValue":B=>p.passportSeries=B,label:"Серия паспорта",placeholder:"AA",disabled:!a(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),F(x,{modelValue:p.passportNumber,"onUpdate:modelValue":B=>p.passportNumber=B,label:"Номер паспорта",placeholder:"1234567",disabled:!a(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),F(x,{modelValue:p.birthDate,"onUpdate:modelValue":B=>p.birthDate=B,label:"Дата рождения",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!a(s).isEditable,required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!H(p),onClick:B=>R(w)},[E[7]||(E[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(p.name?"Проверено":"Проверить"),1)],8,rl),F(le,{name:"fade"},{default:oe(()=>[p.id?(c(),d("div",cl,[e("div",dl,[p.passportIssueDate?(c(),d("div",ul,[e("div",vl,o(a(i)("step3.passportIssueDate")),1),e("div",pl,o(a(xe)(p.passportIssueDate)),1)])):N("",!0),p.pinfl?(c(),d("div",fl,[e("div",hl,o(a(i)("step3.pinfl")),1),e("div",ml,o(p.pinfl),1)])):N("",!0),p.passportIssuedBy?(c(),d("div",bl,[e("div",_l,o(a(i)("step3.issuedBy")),1),e("div",yl,o(p.passportIssuedBy),1)])):N("",!0),p.lastName?(c(),d("div",gl,[e("div",$l,o(a(i)("step3.lastName")),1),e("div",Sl,o(p.lastName),1)])):N("",!0),p.firstName?(c(),d("div",wl,[e("div",Dl,o(a(i)("step3.firstName")),1),e("div",kl,o(p.firstName),1)])):N("",!0),p.middleName?(c(),d("div",xl,[e("div",Nl,o(a(i)("step3.middleName")),1),e("div",Al,o(p.middleName),1)])):N("",!0),p.gender?(c(),d("div",Vl,[e("div",Ml,o(a(i)("step3.gender")),1),e("div",Ol,o(a(Ce)(p.gender,a(h).value)),1)])):N("",!0),p.address?(c(),d("div",Il,[e("div",Tl,o(a(i)("step3.address")),1),e("div",Pl,o(p.address),1)])):N("",!0),p.licenseSeries?(c(),d("div",Cl,[e("div",El,o(a(i)("step4.licenseSeries")),1),e("div",Yl,o(p.licenseSeries),1)])):N("",!0),p.licenseNumber?(c(),d("div",Ll,[e("div",Fl,o(a(i)("step4.licenseNumber")),1),e("div",Bl,o(p.licenseNumber),1)])):N("",!0),p.licenseDate?(c(),d("div",Wl,[e("div",Ul,o(a(i)("step4.licenseDate")),1),e("div",Rl,o(a(xe)(p.licenseDate)),1)])):N("",!0),a(t).relatives.length>0?(c(),d("div",zl,[e("div",jl,o(a(i)("step4.relationship")),1),a(s).isEditable?(c(),d("select",{key:0,value:p.relative?.id||"",class:"info-select",onChange:B=>S(w,B)},[e("option",ql,o(a(i)("step4.selectRelationship")),1),(c(!0),d(X,null,pe(a(t).relatives,B=>(c(),d("option",{key:B.id,value:B.id},o(a(Ue)(B)),9,Gl))),128))],40,Hl)):(c(),d("div",Jl,o(p.relative?a(Ue)(p.relative):"-"),1))])):N("",!0)])])):N("",!0)]),_:2},1024)])]))),128))]))],64)):(c(),d("div",Ki,[...E[0]||(E[0]=[e("i",{class:"bx bx-info-circle"},null,-1),e("div",null,[e("div",{class:"info-title"},"Неограниченное количество водителей"),e("div",{class:"info-text"}," Вы выбрали полис без ограничения по количеству водителей. Добавление водителей не требуется. ")],-1)])]))])])}}}),Kl=te(Zl,[["__scopeId","data-v-d2bd1c0c"]]),Ql={class:"step-container"},Xl={class:"step-content"},eo={class:"summary-section"},to={class:"summary-card"},so={class:"card-content"},ao={class:"info-row"},io={class:"info-value-full"},lo={class:"summary-card"},oo={class:"card-content"},no={class:"info-row"},ro={class:"info-value-full"},co={class:"summary-card"},uo={class:"card-content"},vo={class:"info-row"},po={class:"info-value-full"},fo={class:"summary-card"},ho={class:"card-content"},mo={class:"info-row"},bo={class:"info-value-full"},_o={class:"info-row"},yo={class:"info-value-full"},go={class:"info-row"},$o={class:"info-value-full"},So={class:"summary-card"},wo={class:"card-content"},Do={class:"info-row"},ko={class:"info-value-full"},xo={class:"summary-section"},No={class:"form-section"},Ao={class:"form-section"},Vo={key:0,class:"form-section"},Mo={class:"premium-section"},Oo={class:"premium-card-large"},Io={class:"premium-amount-large"},To=ee({__name:"Step5Summary",setup(n){const s=f=>f.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "),t=de(),l=we();fe(),Ae();const i=I(()=>t.osgo),h=I(()=>t.owner),v=I(()=>t.applicant);I(()=>t.fundData),L(!1);const _=I({get:()=>(i.value.applicantIsOwner?h.value:v.value).phone||"",set:f=>{i.value.applicantIsOwner?(h.value.phone=f,i.value.party=h.value):(v.value.phone=f,i.value.party=v.value)}}),{locale:k}=ce(),g=()=>i.value.period?l.getLocalizedName(i.value.period,k.value||"uz"):"-",m=()=>i.value.drivedArea?l.getLocalizedName(i.value.drivedArea,k.value||"uz"):"-";return(f,u)=>{const O=Me;return c(),d("div",Ql,[u[10]||(u[10]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Подтверждение"),e("p",{class:"step-description"}," Проверьте данные полиса перед оформлением ")],-1)),e("div",Xl,[e("div",eo,[u[7]||(u[7]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-file-blank"}),e("span",null,"Информация о страховке")],-1)),e("div",to,[u[2]||(u[2]=e("div",{class:"card-title"},"Собственник",-1)),e("div",so,[e("div",ao,[e("span",io,o(h.value.name||"-")+o(h.value.birthDate?` (${h.value.birthDate})`:""),1)])])]),e("div",lo,[u[3]||(u[3]=e("div",{class:"card-title"},"Заявитель",-1)),e("div",oo,[e("div",no,[e("span",ro,o((i.value.applicantIsOwner?h.value:v.value).name||"-")+o((i.value.applicantIsOwner?h.value:v.value).birthDate?` (${(i.value.applicantIsOwner?h.value:v.value).birthDate})`:""),1)])])]),e("div",co,[u[4]||(u[4]=e("div",{class:"card-title"},"Транспортное средство",-1)),e("div",uo,[e("div",vo,[e("span",po,o(i.value.vehicle?.modelName||i.value.vehicle?.model||"-")+" "+o(i.value.vehicle?.govNumber?` (${i.value.vehicle.govNumber})`:""),1)])])]),e("div",fo,[u[5]||(u[5]=e("div",{class:"card-title"},"Условия страхования",-1)),e("div",ho,[e("div",mo,[e("span",bo,o(g()),1)]),e("div",_o,[e("span",yo,o(m()),1)]),e("div",go,[e("span",$o,o(i.value.driversLimited?`Ограниченно (${i.value.drivers?.length||0})`:"Не ограничено"),1)])])]),e("div",So,[u[6]||(u[6]=e("div",{class:"card-title"},"Страховая сумма",-1)),e("div",wo,[e("div",Do,[e("span",ko,o(s(a(Pe)))+" сум",1)])])])]),e("div",xo,[u[8]||(u[8]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-phone"}),e("span",null,"Контактные данные")],-1)),e("div",No,[F(O,{modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=V=>_.value=V),label:"Номер телефона",placeholder:"+998 90 123 45 67",type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!a(t).isEditable,required:""},null,8,["modelValue","disabled"])]),e("div",Ao,[F(O,{modelValue:i.value.contractStartDate,"onUpdate:modelValue":u[1]||(u[1]=V=>i.value.contractStartDate=V),label:"Дата начала действия полиса",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",icon:"bx bx-calendar",disabled:!a(t).isEditable,required:""},null,8,["modelValue","disabled"])]),i.value.contractEndDate?(c(),d("div",Vo,[F(O,{"model-value":i.value.contractEndDate,label:"Дата окончания действия полиса",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",icon:"bx bx-calendar",disabled:""},null,8,["model-value"])])):N("",!0)]),e("div",Mo,[e("div",Oo,[u[9]||(u[9]=e("div",{class:"premium-header"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",Io,o(a(Ye)(a(t).calculatedPremium))+" сум ",1)])])])])}}}),Po=te(To,[["__scopeId","data-v-832f148c"]]),Co={class:"step-container"},Eo={class:"step-content"},Yo={class:"premium-section"},Lo={class:"premium-card-large"},Fo={class:"premium-amount-large"},Bo={class:"payment-section"},Wo={class:"payment-buttons"},Uo=["disabled"],Ro={key:0,class:"payment-selected-indicator"},zo=["disabled"],jo={key:0,class:"payment-selected-indicator"},Ho=["disabled"],qo={key:0,class:"payment-selected-indicator"},Go={class:"status-section"},Jo=["disabled"],Zo={key:0,class:"ml-1"},Ko={key:0,class:"error-message mt-2"},Qo={key:0,class:"success-card"},Xo={class:"policy-details"},en={class:"policy-row"},tn={class:"policy-value"},sn={class:"policy-row"},an={class:"policy-value"},ln=ee({__name:"Step6Payment",setup(n){const s=de(),t=fe();Ae();const{t:l}=ce(),i=I(()=>s.osgo),h=I(()=>s.fundData);I(()=>(i.value.applicantIsOwner?s.owner:s.applicant).phone||"");const v=L(!1),_=L(null),k=L(0),g=L(null);let m=null;const f=I({get:()=>s.selectedPaymentMethod,set:R=>{s.selectedPaymentMethod=R}}),u=I(()=>g.value?g.value.toLowerCase().includes("оплачен")||g.value.toLowerCase().includes("успешно")?"status-success":g.value.toLowerCase().includes("ошибка")||g.value.toLowerCase().includes("не")?"status-error":"status-info":""),O=I(()=>u.value==="status-success"?"bx bx-check-circle":u.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),V=R=>{f.value===R?f.value=null:f.value=R,t.isTelegramWebApp.value&&t.hapticImpact("light")},H=async()=>{if(!i.value.id){_.value="Полис не создан";return}try{v.value=!0,_.value=null,g.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await s.fetchFundData(),h.value?.seria&&h.value?.number?(g.value="Оплата успешно завершена. Полис оформлен.",t.isTelegramWebApp.value&&t.hapticNotification("success")):h.value?g.value="Оплата обрабатывается. Проверьте статус позже.":g.value="Оплата не получена. Проверьте SMS или попробуйте снова.",k.value=15,m&&clearInterval(m),m=window.setInterval(()=>{k.value>0?k.value--:m&&(clearInterval(m),m=null)},1e3)}catch(R){console.error("[Step6Payment] Check status error:",R),_.value=R.message||"Ошибка при проверке статуса оплаты",g.value="Ошибка при проверке статуса. Попробуйте позже.",t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{v.value=!1}};return Xe(()=>{m&&clearInterval(m)}),(R,S)=>(c(),d("div",Co,[S[21]||(S[21]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Оплата"),e("p",{class:"step-description"}," Выберите способ оплаты для завершения оформления полиса ")],-1)),e("div",Eo,[e("div",Yo,[e("div",Lo,[S[3]||(S[3]=e("div",{class:"premium-header"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",Fo,o(a(Ye)(a(s).calculatedPremium))+" сум ",1)])]),e("div",Bo,[S[13]||(S[13]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-credit-card"}),e("span",null,"Выберите способ оплаты")],-1)),e("div",Wo,[e("button",{type:"button",class:ae(["payment-btn payme",{"payment-btn-selected":f.value==="payme"}]),disabled:v.value,onClick:S[0]||(S[0]=C=>V("payme"))},[S[5]||(S[5]=e("div",{class:"payment-icon"},"💳",-1)),S[6]||(S[6]=e("div",{class:"payment-name"},"Payme",-1)),f.value==="payme"?(c(),d("div",Ro,[...S[4]||(S[4]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):N("",!0)],10,Uo),e("button",{type:"button",class:ae(["payment-btn click",{"payment-btn-selected":f.value==="click"}]),disabled:v.value,onClick:S[1]||(S[1]=C=>V("click"))},[S[8]||(S[8]=e("div",{class:"payment-icon"},"🔵",-1)),S[9]||(S[9]=e("div",{class:"payment-name"},"Click",-1)),f.value==="click"?(c(),d("div",jo,[...S[7]||(S[7]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):N("",!0)],10,zo),e("button",{type:"button",class:ae(["payment-btn uzum",{"payment-btn-selected":f.value==="uzum"}]),disabled:v.value,onClick:S[2]||(S[2]=C=>V("uzum"))},[S[11]||(S[11]=e("div",{class:"payment-icon"},"🟣",-1)),S[12]||(S[12]=e("div",{class:"payment-name"},"Uzum",-1)),f.value==="uzum"?(c(),d("div",qo,[...S[10]||(S[10]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):N("",!0)],10,Ho)])]),e("div",Go,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!k.value||v.value||!i.value.id,onClick:H},[S[14]||(S[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,o(a(l)("step5.checkStatus")),1),k.value?(c(),d("span",Zo,"("+o(k.value)+")",1)):N("",!0)],8,Jo),F(le,{name:"fade"},{default:oe(()=>[_.value?(c(),d("div",Ko,[S[15]||(S[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(_.value),1)])):N("",!0)]),_:1}),F(le,{name:"fade"},{default:oe(()=>[g.value?(c(),d("div",{key:0,class:ae(["status-text",u.value])},[e("i",{class:ae(O.value)},null,2),e("span",null,o(g.value),1)],2)):N("",!0)]),_:1})]),F(le,{name:"fade"},{default:oe(()=>[i.value.id&&h.value&&h.value.seria?(c(),d("div",Qo,[S[18]||(S[18]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),S[19]||(S[19]=e("h3",{class:"success-title"},"Полис оформлен!",-1)),S[20]||(S[20]=e("p",{class:"success-description"}," Ваш полис ОСГО успешно оформлен и оплачен ",-1)),e("div",Xo,[e("div",en,[S[16]||(S[16]=e("span",{class:"policy-label"},"Серия:",-1)),e("span",tn,o(h.value.seria),1)]),e("div",sn,[S[17]||(S[17]=e("span",{class:"policy-label"},"Номер:",-1)),e("span",an,o(h.value.number),1)])])])):N("",!0)]),_:1})])]))}}),on=te(ln,[["__scopeId","data-v-f6910a80"]]),nn={class:"min-h-screen flex flex-col"},rn={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},cn={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},dn={class:"max-w-3xl mx-auto"},un={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},vn=ee({__name:"index",setup(n){const s=de(),t=we(),l=fe();return Ve(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),s.initialize(),s.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{s.currentStep>0?s.previousStep():l.close()});const h=ge(()=>s.osgo,()=>{s.saveToSession()},{deep:!0});Be(()=>{h()})}),Be(()=>{s.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),et({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(i,h)=>(c(),d("div",nn,[e("header",rn,[F(Dt)]),e("main",cn,[e("div",dn,[F(le,{name:"fade",mode:"out-in"},{default:oe(()=>[a(s).currentStep===a(U).PARAMS?(c(),re(bs,{key:a(U).PARAMS})):a(s).currentStep===a(U).VEHICLE?(c(),re(sa,{key:a(U).VEHICLE})):a(s).currentStep===a(U).OWNER?(c(),re(Gi,{key:a(U).OWNER})):a(s).currentStep===a(U).DRIVERS?(c(),re(Kl,{key:a(U).DRIVERS})):a(s).currentStep===a(U).SUMMARY?(c(),re(Po,{key:a(U).SUMMARY})):a(s).currentStep===a(U).PAYMENT?(c(),re(on,{key:a(U).PAYMENT})):N("",!0)]),_:1})])]),e("footer",un,[F(Yt)])]))}}),_n=te(vn,[["__scopeId","data-v-8561f7bb"]]);export{_n as default};
