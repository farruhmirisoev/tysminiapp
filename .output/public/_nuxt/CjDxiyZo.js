import{e as je,f as Ne,g as Pe,r as R,S as C,h as T,C as Ce,i as pe,j as Ee,k as te,l as ie,m as qe,n as Oe,c as f,o as d,F as ae,p as ge,q as s,s as ee,t as l,a as e,v as He,b as z,x as he,y as F,z as ke,d as Ae,A as fe,B as De,T as ne,w as ce,D as Ge,E as Je,G as Ke,H as Ze,I as Re,u as Qe,J as xe}from"./BrSiU3tJ.js";import{_ as se}from"./DlAUqK2U.js";import{_ as Xe}from"./DgM-zN9R.js";function et(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Te={exports:{}},tt=Te.exports,Ue;function st(){return Ue||(Ue=1,(function(c,i){(function(t,o){c.exports=o()})(tt,(function(){var t=1e3,o=6e4,a=36e5,p="millisecond",n="second",b="minute",h="hour",E="day",$="week",u="month",k="quarter",D="year",w="date",m="Invalid Date",M=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,L=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var y=["th","st","nd","rd"],v=A%100;return"["+A+(y[(v-20)%10]||y[v]||y[0])+"]"}},B=function(A,y,v){var S=String(A);return!S||S.length>=y?A:""+Array(y+1-S.length).join(v)+A},P={s:B,z:function(A){var y=-A.utcOffset(),v=Math.abs(y),S=Math.floor(v/60),_=v%60;return(y<=0?"+":"-")+B(S,2,"0")+":"+B(_,2,"0")},m:function A(y,v){if(y.date()<v.date())return-A(v,y);var S=12*(v.year()-y.year())+(v.month()-y.month()),_=y.clone().add(S,u),I=v-_<0,O=y.clone().add(S+(I?-1:1),u);return+(-(S+(v-_)/(I?_-O:O-_))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:u,y:D,w:$,d:E,D:w,h,m:b,s:n,ms:p,Q:k}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},x="en",V={};V[x]=g;var G="$isDayjsObject",oe=function(A){return A instanceof me||!(!A||!A[G])},X=function A(y,v,S){var _;if(!y)return x;if(typeof y=="string"){var I=y.toLowerCase();V[I]&&(_=I),v&&(V[I]=v,_=I);var O=y.split("-");if(!_&&O.length>1)return A(O[0])}else{var U=y.name;V[U]=y,_=U}return!S&&_&&(x=_),_||!S&&x},H=function(A,y){if(oe(A))return A.clone();var v=typeof y=="object"?y:{};return v.date=A,v.args=arguments,new me(v)},Y=P;Y.l=X,Y.i=oe,Y.w=function(A,y){return H(A,{locale:y.$L,utc:y.$u,x:y.$x,$offset:y.$offset})};var me=(function(){function A(v){this.$L=X(v.locale,null,!0),this.parse(v),this.$x=this.$x||v.x||{},this[G]=!0}var y=A.prototype;return y.parse=function(v){this.$d=(function(S){var _=S.date,I=S.utc;if(_===null)return new Date(NaN);if(Y.u(_))return new Date;if(_ instanceof Date)return new Date(_);if(typeof _=="string"&&!/Z$/i.test(_)){var O=_.match(M);if(O){var U=O[2]-1||0,j=(O[7]||"0").substring(0,3);return I?new Date(Date.UTC(O[1],U,O[3]||1,O[4]||0,O[5]||0,O[6]||0,j)):new Date(O[1],U,O[3]||1,O[4]||0,O[5]||0,O[6]||0,j)}}return new Date(_)})(v),this.init()},y.init=function(){var v=this.$d;this.$y=v.getFullYear(),this.$M=v.getMonth(),this.$D=v.getDate(),this.$W=v.getDay(),this.$H=v.getHours(),this.$m=v.getMinutes(),this.$s=v.getSeconds(),this.$ms=v.getMilliseconds()},y.$utils=function(){return Y},y.isValid=function(){return this.$d.toString()!==m},y.isSame=function(v,S){var _=H(v);return this.startOf(S)<=_&&_<=this.endOf(S)},y.isAfter=function(v,S){return H(v)<this.startOf(S)},y.isBefore=function(v,S){return this.endOf(S)<H(v)},y.$g=function(v,S,_){return Y.u(v)?this[S]:this.set(_,v)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(v,S){var _=this,I=!!Y.u(S)||S,O=Y.p(v),U=function(de,Z){var re=Y.w(_.$u?Date.UTC(_.$y,Z,de):new Date(_.$y,Z,de),_);return I?re:re.endOf(E)},j=function(de,Z){return Y.w(_.toDate()[de].apply(_.toDate("s"),(I?[0,0,0,0]:[23,59,59,999]).slice(Z)),_)},q=this.$W,J=this.$M,Q=this.$D,le="set"+(this.$u?"UTC":"");switch(O){case D:return I?U(1,0):U(31,11);case u:return I?U(1,J):U(0,J+1);case $:var ue=this.$locale().weekStart||0,_e=(q<ue?q+7:q)-ue;return U(I?Q-_e:Q+(6-_e),J);case E:case w:return j(le+"Hours",0);case h:return j(le+"Minutes",1);case b:return j(le+"Seconds",2);case n:return j(le+"Milliseconds",3);default:return this.clone()}},y.endOf=function(v){return this.startOf(v,!1)},y.$set=function(v,S){var _,I=Y.p(v),O="set"+(this.$u?"UTC":""),U=(_={},_[E]=O+"Date",_[w]=O+"Date",_[u]=O+"Month",_[D]=O+"FullYear",_[h]=O+"Hours",_[b]=O+"Minutes",_[n]=O+"Seconds",_[p]=O+"Milliseconds",_)[I],j=I===E?this.$D+(S-this.$W):S;if(I===u||I===D){var q=this.clone().set(w,1);q.$d[U](j),q.init(),this.$d=q.set(w,Math.min(this.$D,q.daysInMonth())).$d}else U&&this.$d[U](j);return this.init(),this},y.set=function(v,S){return this.clone().$set(v,S)},y.get=function(v){return this[Y.p(v)]()},y.add=function(v,S){var _,I=this;v=Number(v);var O=Y.p(S),U=function(J){var Q=H(I);return Y.w(Q.date(Q.date()+Math.round(J*v)),I)};if(O===u)return this.set(u,this.$M+v);if(O===D)return this.set(D,this.$y+v);if(O===E)return U(1);if(O===$)return U(7);var j=(_={},_[b]=o,_[h]=a,_[n]=t,_)[O]||1,q=this.$d.getTime()+v*j;return Y.w(q,this)},y.subtract=function(v,S){return this.add(-1*v,S)},y.format=function(v){var S=this,_=this.$locale();if(!this.isValid())return _.invalidDate||m;var I=v||"YYYY-MM-DDTHH:mm:ssZ",O=Y.z(this),U=this.$H,j=this.$m,q=this.$M,J=_.weekdays,Q=_.months,le=_.meridiem,ue=function(Z,re,be,we){return Z&&(Z[re]||Z(S,I))||be[re].slice(0,we)},_e=function(Z){return Y.s(U%12||12,Z,"0")},de=le||function(Z,re,be){var we=Z<12?"AM":"PM";return be?we.toLowerCase():we};return I.replace(L,(function(Z,re){return re||(function(be){switch(be){case"YY":return String(S.$y).slice(-2);case"YYYY":return Y.s(S.$y,4,"0");case"M":return q+1;case"MM":return Y.s(q+1,2,"0");case"MMM":return ue(_.monthsShort,q,Q,3);case"MMMM":return ue(Q,q);case"D":return S.$D;case"DD":return Y.s(S.$D,2,"0");case"d":return String(S.$W);case"dd":return ue(_.weekdaysMin,S.$W,J,2);case"ddd":return ue(_.weekdaysShort,S.$W,J,3);case"dddd":return J[S.$W];case"H":return String(U);case"HH":return Y.s(U,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return de(U,j,!0);case"A":return de(U,j,!1);case"m":return String(j);case"mm":return Y.s(j,2,"0");case"s":return String(S.$s);case"ss":return Y.s(S.$s,2,"0");case"SSS":return Y.s(S.$ms,3,"0");case"Z":return O}return null})(Z)||O.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(v,S,_){var I,O=this,U=Y.p(S),j=H(v),q=(j.utcOffset()-this.utcOffset())*o,J=this-j,Q=function(){return Y.m(O,j)};switch(U){case D:I=Q()/12;break;case u:I=Q();break;case k:I=Q()/3;break;case $:I=(J-q)/6048e5;break;case E:I=(J-q)/864e5;break;case h:I=J/a;break;case b:I=J/o;break;case n:I=J/t;break;default:I=J}return _?I:Y.a(I)},y.daysInMonth=function(){return this.endOf(u).$D},y.$locale=function(){return V[this.$L]},y.locale=function(v,S){if(!v)return this.$L;var _=this.clone(),I=X(v,S,!0);return I&&(_.$L=I),_},y.clone=function(){return Y.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},A})(),Se=me.prototype;return H.prototype=Se,[["$ms",p],["$s",n],["$m",b],["$H",h],["$W",E],["$M",u],["$y",D],["$D",w]].forEach((function(A){Se[A[1]]=function(y){return this.$g(y,A[0],A[1])}})),H.extend=function(A,y){return A.$i||(A(y,me,H),A.$i=!0),H},H.locale=X,H.isDayjs=oe,H.unix=function(A){return H(1e3*A)},H.en=V[x],H.Ls=V,H.p={},H}))})(Te)),Te.exports}var at=st();const $e=et(at);function Me(c,i="сум"){return c==null||isNaN(c)?`0 ${i}`:`${c.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${i}`}function Le(c){return c?$e(c).format("DD.MM.YYYY"):""}function it(c){return c?c.split(",")[0].trim().split(/\s+/).map(t=>{if(!t)return t;const o=t.charAt(0).toUpperCase(),a=t.slice(1).toLowerCase();return o+a}).join(" "):""}function Be(c,i="ru"){if(!c)return"";const t=String(c).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?i==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?i==="uz"?"Ayol":"Женский":String(c)}function ot(c){if(!c)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(c))return c;if(/^\d{2}-\d{2}-\d{4}$/.test(c)){const i=c.split("-");return`${i[2]}-${i[1]}-${i[0]}`}try{return $e(c,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return c}}const ve=je("osgo",()=>{const c=Ne(),i=Pe(),t=R({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),o=R({passportSeries:"",passportNumber:"",birthDate:""}),a=R({passportSeries:"",passportNumber:"",birthDate:""}),p=R(C.PARAMS),n=R(!1),b=R(null),h=R(!1),E=R(null),$=R(null),u=R(null),k=R(!1),D=R(null),w=R(!1),m=R(!1),M=R(null),L=R(!1),g=R(!1),B=R(null),P=R(!1),x=R(!1),V=R(null),G=T(()=>t.value.status==="DRAFT"),oe=T(()=>le(p.value).valid),X=T(()=>Object.keys(C).length-1),H=r=>r<=C.OWNER?r+1:r===C.DRIVERS?-1:r,Y=T(()=>H(p.value)),me=T(()=>{const r=Y.value;return Math.round(r/X.value*100)}),Se=T(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,N=t.value.period.coefficient||0,W=t.value.drivedArea.coefficient||0;let K=3;t.value.driversLimited&&t.value.incidentCoeff&&(K=t.value.incidentCoeff);const Ve=r*N*K*W,Ye=Ve>5*r?Ce*5*r:Ce*Ve/100;return Math.round(Ye)}),A=T(()=>{const N=(t.value.entriesJournalKt||[]).reduce((W,K)=>W+(K.amount||0),0);return t.value.premium-N}),y=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},o.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},p.value=C.PARAMS,c.isLoaded&&(t.value.discountType=c.getDefaultDiscountType())};pe(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),pe(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),pe(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const N=parseInt(r.slice(0,2)),W=c.findDrivedAreaByRegion(N);W&&(t.value.drivedArea=W)}),pe(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=Se.value},{deep:!0}),pe(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const v=async()=>{if(t.value.vehicle){w.value=!0,M.value=null,m.value=!1;try{const r=await i.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),N=r?.result||r;if(r?.error&&!N)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&N&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,N),N?.carType&&c.isLoaded&&(t.value.vehicle.carType=c.findCarType(N.carType.id)),m.value=!0,console.log("[OsgoStore] Vehicle verified:",N)}catch(r){throw M.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{w.value=!1}}},S=async()=>{L.value=!0,B.value=null,g.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:o.value.passportSeries?.toUpperCase()||"",passportNumber:o.value.passportNumber,birthDate:o.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(o.value={passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate,...r},t.value.beneficiary={...o.value},t.value.applicantIsOwner&&(a.value={passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate,...r},t.value.party={...o.value},x.value=!0)),g.value=!0,console.log("[OsgoStore] Owner after assignment:",o.value),console.log("[OsgoStore] Owner has id?",!!o.value.id)}catch(r){throw B.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{L.value=!1}},_=async()=>{P.value=!0,V.value=null,x.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",r),r&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...r},t.value.party={...a.value}),x.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(r){throw V.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{P.value=!1}},I=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const N=ot(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:N});const W=await i.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:N});if(console.log("[OsgoStore] Driver verification result:",W),!W||!W.id)throw new Error("Driver verification failed: invalid response");const K={...r,...W,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",K),K}catch(N){throw console.error("[OsgoStore] Driver verification failed:",N),N}},O=r=>{t.value.drivers||(t.value.drivers=[]);const N={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(N),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},U=(r,N)=>{t.value.drivers[r]&&(t.value.drivers[r]=N)},j=r=>{t.value.drivers.splice(r,1)},q=(r,N,W)=>t.value.drivers.some(K=>K.passportSeries===r&&K.passportNumber===N&&K.birthDate===W),J=()=>{if(!o.value.passportSeries||!o.value.passportNumber||!o.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(q(o.value.passportSeries,o.value.passportNumber,o.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}O({passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},Q=()=>{q(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||O({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},le=r=>{switch(r){case C.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case C.VEHICLE:return{valid:m.value};case C.OWNER:return{valid:g.value&&(t.value.applicantIsOwner||x.value)};case C.DRIVERS:return{valid:!0};case C.SUMMARY:const N=t.value.applicantIsOwner?o.value.id:a.value.id;return{valid:!!(o.value.id&&N&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(W=>W.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case C.PAYMENT:return{valid:!!(t.value.id&&D.value)};default:return{valid:!1}}};return{osgo:t,owner:o,applicant:a,currentStep:p,saving:n,saveError:b,fetching:h,fetchError:E,fundData:$,fundError:u,fetchingFundData:k,selectedPaymentMethod:D,vehicleVerifying:w,vehicleVerified:m,vehicleVerifyError:M,ownerVerifying:L,ownerVerified:g,ownerVerifyError:B,applicantVerifying:P,applicantVerified:x,applicantVerifyError:V,isEditable:G,canProceedToNextStep:oe,totalSteps:X,displayStepNumber:Y,progressPercentage:me,calculatedPremium:Se,amountPayable:A,initialize:y,verifyVehicle:v,verifyOwner:S,verifyApplicant:_,verifyDriver:I,addDriver:O,updateDriver:U,removeDriver:j,hasDriver:q,addOwnerAsDriver:J,addApplicantAsDriver:Q,validateStepData:le,nextStep:()=>{p.value===C.OWNER?p.value=C.SUMMARY:p.value<C.PAYMENT&&p.value++},previousStep:()=>{p.value===C.SUMMARY?p.value=C.OWNER:p.value>0&&p.value--},goToStep:r=>{r>=0&&r<X.value&&(p.value=r)},createPolicy:async()=>{n.value=!0,b.value=null;try{let r=null;try{r=await i.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Ie){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Ie),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const N=t.value.applicantIsOwner?{...o.value}:{...a.value};N.phone&&(N.phone=N.phone.replace(/[+()-]/g,""));const W={...o.value},K=t.value.discountType||c.meta?.beneficiary?.find(({coefficient:Ie})=>Ie===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const We={party:N,beneficiary:W,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:K,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},ze={user:r,osgo:We};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:N.id,name:N.name},beneficiary:{id:W.id,name:W.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:K?.id}}});const ye=await i.createOsgoApplication(ze);if(!ye||typeof ye!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ye),new Error("Failed to create policy: invalid response");return t.value.id=ye,t.value.applicantIsOwner?(o.value.phone=N.phone,t.value.party=o.value):(a.value.phone=N.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",ye),ye}catch(r){throw b.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{n.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");n.value=!0,b.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?o.value:a.value,beneficiary:o.value};await i.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw b.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{n.value=!1}},fetchPolicy:async r=>{h.value=!0,E.value=null;try{const N=await i.fetchOsgoEntity(r);if(t.value=N,N.party?.id){const W=await i.fetchIndividualEntity(N.party.id);a.value=W,t.value.party=W}if(N.beneficiary?.id){const W=await i.fetchIndividualEntity(N.beneficiary.id);o.value=W,t.value.beneficiary=W}if(c.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=c.findCarType(t.value.vehicle.carType.id)),c.isLoaded&&t.value.period&&(t.value.period=c.findPeriod(t.value.period.id)),c.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=c.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const W=Math.max(...t.value.drivers.map(K=>K.incidentFrequency?.coefficient||0));t.value.incidentCoeff=W}console.log("[OsgoStore] Policy fetched:",r)}catch(N){throw E.value=N.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",N),N}finally{h.value=!1}},fetchFundData:async()=>{if(t.value.id){k.value=!0,u.value=null;try{const r=await i.getFundPolicy(t.value.id);$.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){u.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{k.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:o.value,applicant:a.value,currentStep:p.value};sessionStorage.setItem(Ee.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Ee.OSGO_DRAFT);if(!r)return!1;const N=JSON.parse(r);return t.value=N.osgo,o.value=N.owner,a.value=N.applicant,p.value=N.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Ee.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{y(),m.value=!1,g.value=!1,x.value=!1,$.value=null,b.value=null,E.value=null}}}),lt={class:"language-switcher"},rt=["onClick"],nt=te({__name:"LanguageSwitcher",setup(c){const{locale:i,locales:t}=ie();qe();const o=T(()=>i.value),a=T(()=>t.value.filter(n=>n.code!==i.value)),p=n=>{i.value=n,typeof window<"u"&&localStorage.setItem("app-language",n),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Oe(()=>{if(typeof window<"u"){const n=localStorage.getItem("app-language");n&&(n==="ru"||n==="uz")&&(i.value=n)}}),(n,b)=>(d(),f("div",lt,[(d(!0),f(ae,null,ge(s(a),h=>(d(),f("button",{key:h.code,class:ee(["lang-btn",{active:s(o)===h.code}]),onClick:E=>p(h.code)},l(h.code.toUpperCase()),11,rt))),128))]))}}),ct=se(nt,[["__scopeId","data-v-e748ef5d"]]),ut={class:"progress-bar-container"},dt={class:"progress-track"},pt={class:"steps-container"},vt=["onClick"],ft={key:0,class:"step-check"},ht={key:1,class:"step-number"},mt={class:"step-label"},_t=te({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(c){const i=c,{t}=ie(),o=T(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),a=b=>b<=2?b:b+1,p=T(()=>(i.currentStep+1)/i.totalSteps*100),n=b=>{console.log("Step clicked:",b)};return(b,h)=>(d(),f("div",ut,[e("div",dt,[e("div",{class:"progress-fill",style:He({width:`${p.value}%`})},null,4)]),e("div",pt,[(d(!0),f(ae,null,ge(o.value,(E,$)=>(d(),f("div",{key:$,class:"step-wrapper",onClick:u=>n($)},[e("div",{class:ee(["step-circle",{"step-active":a($)===c.currentStep,"step-completed":a($)<c.currentStep&&a($)!==s(C).DRIVERS,"step-pending":a($)>c.currentStep}])},[a($)<c.currentStep&&a($)!==s(C).DRIVERS?(d(),f("span",ft,"✓")):(d(),f("span",ht,l($+1),1))],2),e("div",mt,l(E),1)],8,vt))),128))])]))}}),bt=se(_t,[["__scopeId","data-v-7805c614"]]),yt={class:"fixed-header"},gt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},$t={class:"flex items-center justify-between mb-3"},St={class:"flex items-center gap-3"},wt={class:"text-base font-bold text-text"},Dt=te({__name:"AppHeader",setup(c){const i=ve(),{t}=ie(),o=T(()=>i.currentStep),a=T(()=>i.totalSteps);return(p,n)=>{const b=ct,h=bt;return d(),f("header",yt,[e("div",gt,[e("div",$t,[e("div",St,[n[1]||(n[1]=e("div",{class:"w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg"},[e("img",{src:Xe,alt:"Temiryo'l Sug'urta Logo"})],-1)),e("div",null,[e("div",wt,l(s(t)("header.appTitle")),1),n[0]||(n[0]=e("div",{class:"text-xs text-text-light"}," Temiryo'l Sug'urta ",-1))])]),z(b)]),z(h,{"current-step":o.value,"total-steps":a.value},null,8,["current-step","total-steps"])])])}}}),xt=se(Dt,[["__scopeId","data-v-60581198"]]),Nt={class:"fixed-footer"},kt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},At=["disabled"],Tt={key:1,class:"flex-1 max-w-[160px]"},Mt={class:"flex-1 text-center"},Pt={class:"text-sm text-text-light font-medium"},Ot=["disabled"],Vt={key:0,class:"spinner"},It={key:0},Et={key:1},Ct={key:2},Lt={key:3,class:"text-lg bx bx-chevron-right"},Ft=te({__name:"AppFooter",setup(c){const i=ve(),t=he(),o=Pe(),{t:a}=ie(),p=R(!1),n=R(null),b=R(null),h=T(()=>i.currentStep),E=T(()=>i.totalSteps),$=T(()=>i.displayStepNumber),u=T(()=>h.value===0),k=T(()=>h.value===C.PAYMENT),D=T(()=>i.canProceedToNextStep),w=T(()=>i.saving||i.fetching||p.value),m=()=>{u.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),i.previousStep())},M=async()=>{if(!D.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(h.value===C.VEHICLE&&!i.vehicleVerified)await i.verifyVehicle();else if(h.value===C.OWNER)i.ownerVerified||await i.verifyOwner(),!i.osgo.applicantIsOwner&&!i.applicantVerified&&await i.verifyApplicant();else if(h.value===C.SUMMARY)i.osgo.id||(await i.createPolicy(),console.log("[AppFooter] Policy created:",i.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(h.value===C.PAYMENT){if(!i.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const g={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[i.selectedPaymentMethod],B=i.osgo.id,x=(i.osgo.applicantIsOwner?i.owner:i.applicant).phone||"",V=i.calculatedPremium;if(!B||!x||!V){const G="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:B,phone:x,amount:V}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(G));return}try{p.value=!0,n.value=null,b.value=null,await o.sendPaymentLink(g,B,x,V),b.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(G){n.value=G.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",G),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(n.value))}finally{p.value=!1}return}k.value?console.log("[AppFooter] Last step reached"):i.nextStep()}catch(L){console.error("[AppFooter] Error:",L),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(L.message||a("errors.unknown")))}};return(L,g)=>(d(),f("footer",Nt,[e("div",kt,[u.value?(d(),f("div",Tt)):(d(),f("button",{key:0,type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:w.value,onClick:m},[g[0]||(g[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,l(L.$t("common.previous")),1)],8,At)),e("div",Mt,[e("div",Pt,l(L.$t("common.step",{current:$.value,total:E.value})),1)]),e("button",{type:"button",class:ee(["btn flex-1 max-w-[160px]",{"btn-primary":!k.value||h.value!==s(C).PAYMENT,"btn-success":k.value&&h.value===s(C).PAYMENT}]),disabled:!D.value||w.value,onClick:M},[w.value?(d(),f("span",Vt)):(d(),f(ae,{key:1},[h.value===s(C).SUMMARY&&!s(i).osgo.id?(d(),f("span",It,l(L.$t("step5.confirm")),1)):k.value&&h.value===s(C).PAYMENT?(d(),f("span",Et,[g[1]||(g[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,l(L.$t("step5.payment")),1)])):(d(),f("span",Ct,l(L.$t("common.next")),1)),!k.value&&h.value!==s(C).SUMMARY?(d(),f("i",Lt)):F("",!0)],64))],10,Ot)])]))}}),Yt=se(Ft,[["__scopeId","data-v-f2291e8a"]]),Rt={class:"step-container"},Ut={key:0,class:"loading-state"},Bt={key:1,class:"error-state"},Wt={key:2,class:"error-state"},zt={class:"debug-info"},jt={key:3},qt={class:"step-header"},Ht={class:"step-title"},Gt={class:"step-description"},Jt={class:"step-content"},Kt={class:"form-section"},Zt={class:"section-title"},Qt={class:"select-wrapper"},Xt=["disabled"],es=["value"],ts={class:"form-section"},ss={class:"section-title"},as={class:"select-wrapper"},is=["disabled"],os=["value"],ls={class:"form-section",style:{display:"none"}},rs={class:"section-title"},ns={class:"select-wrapper"},cs=["disabled"],us={value:"false"},ds={value:"true"},ps={key:0,class:"form-section"},vs={class:"section-title"},fs={class:"select-wrapper"},hs=["disabled"],ms=["value"],_s={class:"form-section"},bs={class:"section-title"},ys={class:"select-wrapper"},gs=["disabled"],$s=["value"],Ss={key:0,class:"premium-card"},ws={class:"premium-card-content"},Ds={class:"premium-label"},xs={class:"premium-amount"},Ns=te({__name:"Step1Params",setup(c){const i=ve(),t=Ne(),o=he(),{locale:a,t:p}=ie(),n=T(()=>i.osgo),b=()=>{if(!(!t.isLoaded||!(!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id))){if(t.carTypes.length>0&&!n.value.vehicle?.carType?.id){const m=t.carTypes[0];n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=m}t.periods.length>0&&!n.value.period?.id&&(n.value.period=t.periods[0]),t.drivedAreas.length>0&&!n.value.drivedArea?.id&&(n.value.drivedArea=t.drivedAreas[0]),n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited&&!n.value.incidentCoeff&&t.incidentFrequencies.length>0&&(n.value.incidentCoeff=t.incidentFrequencies[0].coefficient),ke(()=>{i.calculatedPremium})}};pe(()=>t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0,w=>{w&&!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id&&ke(()=>{b()})},{immediate:!0}),Oe(async()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Periods count:",t.periods.length),await ke();const w=!n.value.vehicle?.carType?.id&&!n.value.period?.id&&!n.value.drivedArea?.id;t.isLoaded&&t.carTypes.length>0&&t.periods.length>0&&t.drivedAreas.length>0&&w&&b()});const h=w=>{const m=t.getLocalizedName(w,a.value||"uz");return it(m)},E=T({get:()=>{const w=n.value.vehicle?.carType?.id;return!w&&t.isLoaded&&t.carTypes.length>0?t.carTypes[0].id:w||""},set:w=>{if(!i.isEditable)return;const m=t.carTypes.find(M=>M.id===w);m&&(n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=m,o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),$=T({get:()=>{const w=n.value.period?.id;return!w&&t.isLoaded&&t.periods.length>0?t.periods[0].id:w||""},set:w=>{if(!i.isEditable)return;const m=t.periods.find(M=>M.id===w);m&&(n.value.period=m,o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),u=T({get:()=>(n.value.driversLimited===void 0&&(n.value.driversLimited=!1),n.value.driversLimited?"true":"false"),set:w=>{i.isEditable&&(n.value.driversLimited=w==="true",n.value.driversLimited||(n.value.incidentCoeff=void 0),o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),k=T({get:()=>n.value.incidentCoeff?.toString()||"",set:w=>{if(!i.isEditable)return;const m=parseFloat(w);isNaN(m)||(n.value.incidentCoeff=m,o.isTelegramWebApp.value&&o.hapticImpact("light"))}}),D=T({get:()=>{const w=n.value.drivedArea?.id;return!w&&t.isLoaded&&t.drivedAreas.length>0?t.drivedAreas[0].id:w||""},set:w=>{if(!i.isEditable)return;const m=t.findDrivedArea(w);m&&(n.value.drivedArea=m,o.isTelegramWebApp.value&&o.hapticImpact("light"))}});return pe(()=>[E.value,$.value,D.value,t.isLoaded],([w,m,M,L])=>{if(!L)return;let g=!1;if(w&&!n.value.vehicle?.carType?.id&&t.carTypes.length>0){const B=t.carTypes.find(P=>P.id===w);B&&(n.value.vehicle||(n.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),n.value.vehicle.carType=B,g=!0)}if(m&&!n.value.period?.id&&t.periods.length>0){const B=t.periods.find(P=>P.id===m);B&&(n.value.period=B,g=!0)}if(M&&!n.value.drivedArea?.id&&t.drivedAreas.length>0){const B=t.drivedAreas.find(P=>P.id===M);B&&(n.value.drivedArea=B,g=!0)}g&&ke(()=>{i.calculatedPremium})},{immediate:!0}),(w,m)=>(d(),f("div",Rt,[s(t).fetching?(d(),f("div",Ut,[m[6]||(m[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,l(s(p)("common.loading")),1)])):s(t).error?(d(),f("div",Bt,[m[7]||(m[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,l(s(t).error),1),e("button",{onClick:m[0]||(m[0]=M=>s(t).fetchMeta(!0)),class:"btn-retry"},l(s(p)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(d(),f("div",Wt,[m[10]||(m[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,l(s(p)("common.loading")),1),e("p",zt,[Ae(" isLoaded: "+l(s(t).isLoaded),1),m[8]||(m[8]=e("br",null,null,-1)),Ae(" carTypes: "+l(s(t).carTypes.length),1),m[9]||(m[9]=e("br",null,null,-1)),Ae(" meta: "+l(s(t).meta?"exists":"null"),1)])])):(d(),f("div",jt,[e("div",qt,[e("h2",Ht,l(s(p)("step1.title")),1),e("p",Gt,l(s(p)("step1.description")),1)]),e("div",Jt,[e("div",Kt,[e("h3",Zt,l(s(p)("step1.vehicleType")),1),e("div",Qt,[fe(e("select",{"onUpdate:modelValue":m[1]||(m[1]=M=>E.value=M),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).carTypes,M=>(d(),f("option",{key:M.id,value:M.id},l(h(M)),9,es))),128))],8,Xt),[[De,E.value]]),m[11]||(m[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",ts,[e("h3",ss,l(s(p)("step1.period")),1),e("div",as,[fe(e("select",{"onUpdate:modelValue":m[2]||(m[2]=M=>$.value=M),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).periods,M=>(d(),f("option",{key:M.id,value:M.id},l(h(M)),9,os))),128))],8,is),[[De,$.value]]),m[12]||(m[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",ls,[e("h3",rs,l(s(p)("step1.driversLimited")),1),e("div",ns,[fe(e("select",{"onUpdate:modelValue":m[3]||(m[3]=M=>u.value=M),class:"input",disabled:!s(i).isEditable},[e("option",us,l(s(p)("step1.driversLimitedNo"))+" - "+l(s(p)("step1.driversLimitedNoDesc")),1),e("option",ds,l(s(p)("step1.driversLimitedYes"))+" - "+l(s(p)("step1.driversLimitedYesDesc")),1)],8,cs),[[De,u.value]]),m[13]||(m[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),z(ne,{name:"slide-down"},{default:ce(()=>[n.value.driversLimited?(d(),f("div",ps,[e("h3",vs,l(s(p)("step1.incidentFrequency")),1),e("div",fs,[fe(e("select",{"onUpdate:modelValue":m[4]||(m[4]=M=>k.value=M),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).incidentFrequencies,M=>(d(),f("option",{key:M.id,value:M.coefficient},l(h(M)),9,ms))),128))],8,hs),[[De,k.value]]),m[14]||(m[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])])):F("",!0)]),_:1}),e("div",_s,[e("h3",bs,l(s(p)("step1.usageTerritory")),1),e("div",ys,[fe(e("select",{"onUpdate:modelValue":m[5]||(m[5]=M=>D.value=M),class:"input",disabled:!s(i).isEditable},[(d(!0),f(ae,null,ge(s(t).drivedAreas,M=>(d(),f("option",{key:M.id,value:M.id},l(h(M)),9,$s))),128))],8,gs),[[De,D.value]]),m[15]||(m[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),s(i).calculatedPremium>0?(d(),f("div",Ss,[e("div",ws,[e("div",Ds,[m[16]||(m[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,l(s(p)("step1.premium")),1)]),e("div",xs,l(s(Me)(s(i).calculatedPremium)),1)])])):F("",!0)])]))]))}}),ks=se(Ns,[["__scopeId","data-v-df5d5ef9"]]),As=["for"],Ts={key:0,class:"text-error"},Ms={class:"input-wrapper"},Ps={key:0,class:"input-icon input-icon-left"},Os=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Vs={key:2,class:"input-icon input-icon-right"},Is={key:1,class:"input-message"},Es={key:0,class:"error-message"},Cs={key:1,class:"helper-text"},Ls={key:2,class:"input-count"},Fs=te({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(c,{expose:i,emit:t}){const o=c,a=t,{locale:p}=ie(),n=T(()=>{if(o.type==="date")return p.value==="uz"?"uz-UZ":"ru-RU"}),b=R(null),h=T(()=>`input-${Math.random().toString(36).substr(2,9)}`),E=T({get:()=>{const P=String(o.modelValue||"");if(o.dateMask&&P){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(P)||/^\d{2}-\d{2}-\d{4}$/.test(P))return P;if(/^\d{4}-\d{2}-\d{2}$/.test(P)){const x=P.split("-");return`${x[2]}-${x[1]}-${x[0]}`}}return P},set:P=>{if(o.uppercase&&(P=P.toUpperCase()),o.dateMask&&P){if(/^\d{4}-\d{2}-\d{2}$/.test(P)){a("update:modelValue",P);return}if(/^\d{2}-\d{2}-\d{4}$/.test(P)){const x=P.split("-");a("update:modelValue",`${x[2]}-${x[1]}-${x[0]}`);return}a("update:modelValue",P);return}a("update:modelValue",P)}}),$=P=>{const x=P.target;let V=x.value;if(o.uppercase&&(V=V.toUpperCase(),x.value!==V&&(x.value=V)),o.dateMask){const G=L(V);x.value!==G&&(x.value=G),a("update:modelValue",G),a("input",G);return}o.mask&&(V=M(V)),a("update:modelValue",V),a("input",V)},u=()=>{if(o.dateMask&&E.value){const P=String(E.value);if(/^\d{2}-\d{2}-\d{4}$/.test(P)){const x=P.split("-"),V=`${x[2]}-${x[1]}-${x[0]}`,G=new Date(V);isNaN(G.getTime())||a("update:modelValue",V)}}a("blur")},k=()=>{a("focus")},D=P=>{},w=()=>{a("enter")},m=()=>{a("update:modelValue",""),b.value?.focus()},M=P=>{if(o.dateMask)return L(P);if(!o.mask)return P;let x="",V=0;const G=P.replace(/\D/g,"");for(let oe=0;oe<o.mask.length&&V<G.length;oe++){const X=o.mask[oe];X==="#"?(x+=G[V],V++):x+=X}return x},L=P=>{const V=P.replace(/\D/g,"").slice(0,8);return V.length===0?"":V.length<=2?V:V.length<=4?`${V.slice(0,2)}-${V.slice(2)}`:`${V.slice(0,2)}-${V.slice(2,4)}-${V.slice(4)}`},g=()=>{b.value?.focus()},B=()=>{b.value?.blur()};return Oe(()=>{o.autofocus&&g()}),i({focus:g,blur:B}),(P,x)=>(d(),f("div",{class:ee(["input-field",{"has-error":c.error}])},[c.label?(d(),f("label",{key:0,class:"input-label",for:h.value},[Ae(l(c.label)+" ",1),c.required?(d(),f("span",Ts,"*")):F("",!0)],8,As)):F("",!0),e("div",Ms,[c.icon?(d(),f("div",Ps,[e("i",{class:ee(c.icon)},null,2)])):F("",!0),fe(e("input",{id:h.value,ref_key:"inputRef",ref:b,"onUpdate:modelValue":x[0]||(x[0]=V=>E.value=V),type:c.dateMask?"text":c.type,placeholder:c.dateMask?c.placeholder||"DD-MM-YYYY":c.placeholder,disabled:c.disabled,readonly:c.readonly,maxlength:c.dateMask?10:c.maxLength,autocomplete:c.autocomplete,inputmode:c.dateMask?"numeric":c.inputMode,lang:n.value,class:ee(["input",{"input-with-icon-left":c.icon,"input-with-icon-right":c.clearable||c.loading,"input-error":c.error}]),onInput:$,onBlur:u,onFocus:k,onKeypress:D,onKeydown:Je(w,["enter"])},null,42,Os),[[Ge,E.value]]),c.clearable&&E.value&&!c.disabled&&!c.readonly?(d(),f("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:m},[...x[1]||(x[1]=[e("i",{class:"bx bx-x"},null,-1)])])):F("",!0),c.loading?(d(),f("div",Vs,[...x[2]||(x[2]=[e("div",{class:"spinner-small"},null,-1)])])):F("",!0)]),c.helperText||c.error?(d(),f("div",Is,[c.error?(d(),f("span",Es,l(c.error),1)):c.helperText?(d(),f("span",Cs,l(c.helperText),1)):F("",!0)])):F("",!0),c.showCount&&c.maxLength?(d(),f("div",Ls,l(E.value.length)+" / "+l(c.maxLength),1)):F("",!0)],2))}}),Fe=se(Fs,[["__scopeId","data-v-4eb39aee"]]);function Ys(c){if(!c)return{valid:!1,error:"Государственный номер обязателен"};const i=c.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(i)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Rs(c){if(!c)return{valid:!1,error:"Серия техпаспорта обязательна"};const i=c.toUpperCase();return/^[A-Z]{2,3}$/.test(i)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Us(c){return c?/^\d+$/.test(c)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Bs={class:"step-container"},Ws={class:"step-header"},zs={class:"step-title"},js={class:"step-description"},qs={class:"step-content"},Hs={class:"form-section"},Gs={class:"form-section"},Js={class:"form-section"},Ks={class:"form-section"},Zs=["disabled"],Qs={key:0,class:"spinner"},Xs={key:0,class:"alert alert-error"},ea={key:0,class:"vehicle-info-card"},ta={class:"card-header"},sa={class:"card-content"};const aa={class:"vehicle-info-grid"},ia={key:0,class:"vehicle-info-item"},oa={class:"vehicle-info-label"},la={class:"vehicle-info-value"},ra={key:1,class:"vehicle-info-item"},na={class:"vehicle-info-label"},ca={class:"vehicle-info-value"},ua={key:2,class:"vehicle-info-item"},da={class:"vehicle-info-label"},pa={class:"vehicle-info-value"},va={key:3,class:"vehicle-info-item"},fa={class:"vehicle-info-label"},ha={class:"vehicle-info-value"},ma={key:4,class:"vehicle-info-item"},_a={class:"vehicle-info-label"},ba={class:"vehicle-info-value"},ya={key:1,class:"vehicle-info-empty"},ga=te({__name:"Step2Vehicle",setup(c){const i=ve();Ne();const t=he(),{t:o}=ie(),a=T(()=>i.osgo),p=R({}),n=T(()=>!!(a.value.vehicle?.govNumber&&a.value.vehicle?.techPassportSeries&&a.value.vehicle?.techPassportNumber&&Object.keys(p.value).length===0)),b=T(()=>{if(!a.value.vehicle)return 0;const $=a.value.vehicle;let u=0;return $.techPassportIssueDate&&u++,($.modelName||$.model)&&u++,($.createdYear||$.year)&&u++,$.engineNumber&&u++,$.bodyNumber&&u++,u}),h=$=>{if(!a.value.vehicle)return;let u;switch($){case"govNumber":u=Ys(a.value.vehicle.govNumber);break;case"techPassportSeries":u=Rs(a.value.vehicle.techPassportSeries);break;case"techPassportNumber":u=Us(a.value.vehicle.techPassportNumber);break}u&&!u.valid?p.value[$]=u.error||"":delete p.value[$]},E=async()=>{if(h("govNumber"),h("techPassportSeries"),h("techPassportNumber"),Object.keys(p.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await i.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",a.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(a.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return($,u)=>{const k=Fe;return d(),f("div",Bs,[e("div",Ws,[e("h2",zs,l(s(o)("step2.title")),1),e("p",js,l(s(o)("step2.description")),1)]),e("div",qs,[e("div",Hs,[z(k,{modelValue:a.value.vehicle.govNumber,"onUpdate:modelValue":u[0]||(u[0]=D=>a.value.vehicle.govNumber=D),label:s(o)("step2.govNumber"),placeholder:s(o)("step2.govNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:u[1]||(u[1]=D=>h("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Gs,[z(k,{modelValue:a.value.vehicle.techPassportSeries,"onUpdate:modelValue":u[2]||(u[2]=D=>a.value.vehicle.techPassportSeries=D),label:s(o)("step2.techPassportSeries"),placeholder:s(o)("step2.techPassportSeriesPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:u[3]||(u[3]=D=>h("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Js,[z(k,{modelValue:a.value.vehicle.techPassportNumber,"onUpdate:modelValue":u[4]||(u[4]=D=>a.value.vehicle.techPassportNumber=D),label:s(o)("step2.techPassportNumber"),placeholder:s(o)("step2.techPassportNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:u[5]||(u[5]=D=>h("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Ks,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!n.value||s(i).vehicleVerifying,onClick:E},[s(i).vehicleVerifying?(d(),f("span",Qs)):(d(),f(ae,{key:1},[u[6]||(u[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(i).vehicleVerified?s(o)("step2.verified"):s(o)("step2.verify")),1)],64))],8,Zs)]),s(i).vehicleVerifyError?(d(),f("div",Xs,[u[7]||(u[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,l(s(i).vehicleVerifyError),1)])):F("",!0),z(ne,{name:"fade"},{default:ce(()=>[s(i).vehicleVerified&&a.value.vehicle?(d(),f("div",ea,[e("div",ta,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,l(s(o)("step2.vehicleFound")),1)]),e("div",sa,[F("",!0),e("div",aa,[a.value.vehicle?.techPassportIssueDate?(d(),f("div",ia,[e("div",oa,l(s(o)("step2.techPassportIssueDate")),1),e("div",la,l(s(Le)(a.value.vehicle.techPassportIssueDate)),1)])):F("",!0),a.value.vehicle?.modelName||a.value.vehicle?.model?(d(),f("div",ra,[e("div",na,l(s(o)("step2.model")),1),e("div",ca,l(a.value.vehicle?.modelName||a.value.vehicle?.model||"-"),1)])):F("",!0),a.value.vehicle?.createdYear||a.value.vehicle?.year?(d(),f("div",ua,[e("div",da,l(s(o)("step2.year")),1),e("div",pa,l(a.value.vehicle?.createdYear||a.value.vehicle?.year||"-"),1)])):F("",!0),a.value.vehicle?.engineNumber?(d(),f("div",va,[e("div",fa,l(s(o)("step2.engineNumber")),1),e("div",ha,l(a.value.vehicle.engineNumber),1)])):F("",!0),a.value.vehicle?.bodyNumber?(d(),f("div",ma,[e("div",_a,l(s(o)("step2.bodyNumber")),1),e("div",ba,l(a.value.vehicle.bodyNumber),1)])):F("",!0)]),b.value===0?(d(),f("div",ya,l(s(o)("step2.vehicleNotFound")),1)):F("",!0)])])):F("",!0)]),_:1})])])}}}),$a=se(ga,[["__scopeId","data-v-3ead2593"]]),Sa={class:"step-container"},wa={class:"step-header"},Da={class:"step-title"},xa={class:"step-description"},Na={class:"step-content"},ka={class:"subsection"},Aa={class:"subsection-title"},Ta={class:"form-section"},Ma={class:"form-section"},Pa={class:"form-section"},Oa={class:"form-section"},Va=["disabled"],Ia={key:0,class:"spinner"},Ea={key:0,class:"info-card success"},Ca={class:"card-header"},La={class:"card-content"},Fa={class:"info-grid"},Ya={class:"info-item"},Ra={class:"info-label"},Ua={class:"info-value"},Ba={class:"info-item"},Wa={class:"info-label"},za={class:"info-value"},ja={class:"info-item info-item-wide"},qa={class:"info-label"},Ha={class:"info-value"},Ga={class:"info-item"},Ja={class:"info-label"},Ka={class:"info-value"},Za={class:"info-item"},Qa={class:"info-label"},Xa={class:"info-value"},ei={class:"info-item"},ti={class:"info-label"},si={class:"info-value"},ai={class:"info-item"},ii={class:"info-label"},oi={class:"info-value"},li={class:"info-item"},ri={class:"info-label"},ni={class:"info-value"},ci={class:"info-item"},ui={class:"info-label"},di={class:"info-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value"},hi={class:"info-item"},mi={class:"info-label"},_i={class:"info-value"},bi={class:"form-section"},yi={class:"checkbox-label"},gi=["disabled"],$i={key:0,class:"subsection"},Si={class:"subsection-title"},wi={class:"form-section"},Di={class:"form-section"},xi={class:"form-section"},Ni={class:"form-section"},ki=["disabled"],Ai={key:0,class:"spinner"},Ti={key:0,class:"info-card success"},Mi={class:"card-header"},Pi={class:"card-content"},Oi={class:"info-grid"},Vi={class:"info-item"},Ii={class:"info-label"},Ei={class:"info-value"},Ci={class:"info-item"},Li={class:"info-label"},Fi={class:"info-value"},Yi={class:"info-item info-item-wide"},Ri={class:"info-label"},Ui={class:"info-value"},Bi={class:"info-item"},Wi={class:"info-label"},zi={class:"info-value"},ji={class:"info-item"},qi={class:"info-label"},Hi={class:"info-value"},Gi={class:"info-item"},Ji={class:"info-label"},Ki={class:"info-value"},Zi={class:"info-item"},Qi={class:"info-label"},Xi={class:"info-value"},eo={class:"info-item"},to={class:"info-label"},so={class:"info-value"},ao={class:"info-item"},io={class:"info-label"},oo={class:"info-value"},lo={class:"info-item"},ro={class:"info-label"},no={class:"info-value"},co={class:"info-item"},uo={class:"info-label"},po={class:"info-value"},vo=te({__name:"Step3Owner",setup(c){const i=ve(),t=he(),{locale:o,t:a}=ie(),p=T(()=>i.osgo),n=T(()=>i.owner),b=T(()=>i.applicant),h=async()=>{try{await i.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},E=async()=>{try{await i.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return($,u)=>{const k=Fe;return d(),f("div",Sa,[e("div",wa,[e("h2",Da,l(s(a)("step3.title")),1),e("p",xa,l(s(a)("step3.description")),1)]),e("div",Na,[e("div",ka,[e("h3",Aa,l(s(a)("step3.owner")),1),e("div",Ta,[z(k,{modelValue:n.value.passportSeries,"onUpdate:modelValue":u[0]||(u[0]=D=>n.value.passportSeries=D),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Ma,[z(k,{modelValue:n.value.passportNumber,"onUpdate:modelValue":u[1]||(u[1]=D=>n.value.passportNumber=D),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Pa,[z(k,{modelValue:n.value.birthDate,"onUpdate:modelValue":u[2]||(u[2]=D=>n.value.birthDate=D),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Oa,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).ownerVerifying,onClick:h},[s(i).ownerVerifying?(d(),f("span",Ia)):(d(),f(ae,{key:1},[u[7]||(u[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(i).ownerVerified?s(a)("step3.verified"):s(a)("step3.verifyOwner")),1)],64))],8,Va)]),z(ne,{name:"fade"},{default:ce(()=>[s(i).ownerVerified&&n.value.id?(d(),f("div",Ea,[e("div",Ca,[u[8]||(u[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(a)("step3.ownerFound")),1)]),e("div",La,[e("div",Fa,[e("div",Ya,[e("div",Ra,l(s(a)("step3.passportIssueDate")),1),e("div",Ua,l(n.value.passportIssueDate?s(Le)(n.value.passportIssueDate):"-"),1)]),e("div",Ba,[e("div",Wa,l(s(a)("step3.pinfl")),1),e("div",za,l(n.value.nationalIdentifier||"-"),1)]),e("div",ja,[e("div",qa,l(s(a)("step3.issuedBy")),1),e("div",Ha,l(n.value.passportIssuedBy||"-"),1)]),e("div",Ga,[e("div",Ja,l(s(a)("step3.lastName")),1),e("div",Ka,l(n.value.lastName||"-"),1)]),e("div",Za,[e("div",Qa,l(s(a)("step3.firstName")),1),e("div",Xa,l(n.value.firstName||"-"),1)]),e("div",ei,[e("div",ti,l(s(a)("step3.middleName")),1),e("div",si,l(n.value.middleName||"-"),1)]),e("div",ai,[e("div",ii,l(s(a)("step3.gender")),1),e("div",oi,l(n.value.gender?s(Be)(n.value.gender,s(o).value):"-"),1)]),e("div",li,[e("div",ri,l(s(a)("step3.country")),1),e("div",ni,l(n.value.country?.langValue1||"-"),1)]),e("div",ci,[e("div",ui,l(s(a)("step3.region")),1),e("div",di,l(n.value.region?.langValue1||"-"),1)]),e("div",pi,[e("div",vi,l(s(a)("step3.district")),1),e("div",fi,l(n.value.district?.langValue1||"-"),1)]),e("div",hi,[e("div",mi,l(s(a)("step3.street")),1),e("div",_i,l(n.value.street||"-"),1)])])])])):F("",!0)]),_:1})]),e("div",bi,[e("label",yi,[fe(e("input",{"onUpdate:modelValue":u[3]||(u[3]=D=>p.value.applicantIsOwner=D),type:"checkbox",class:"checkbox",disabled:!s(i).isEditable},null,8,gi),[[Ke,p.value.applicantIsOwner]]),e("span",null,l(s(a)("step3.ownerIsApplicant")),1)])]),z(ne,{name:"slide-down"},{default:ce(()=>[p.value.applicantIsOwner?F("",!0):(d(),f("div",$i,[e("h3",Si,l(s(a)("step3.applicant")),1),e("div",wi,[z(k,{modelValue:b.value.passportSeries,"onUpdate:modelValue":u[4]||(u[4]=D=>b.value.passportSeries=D),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Di,[z(k,{modelValue:b.value.passportNumber,"onUpdate:modelValue":u[5]||(u[5]=D=>b.value.passportNumber=D),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",xi,[z(k,{modelValue:b.value.birthDate,"onUpdate:modelValue":u[6]||(u[6]=D=>b.value.birthDate=D),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Ni,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).applicantVerifying,onClick:E},[s(i).applicantVerifying?(d(),f("span",Ai)):(d(),f(ae,{key:1},[u[9]||(u[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(i).applicantVerified?s(a)("step3.verified"):s(a)("step3.verifyApplicant")),1)],64))],8,ki)]),z(ne,{name:"fade"},{default:ce(()=>[s(i).applicantVerified&&b.value.id?(d(),f("div",Ti,[e("div",Mi,[u[10]||(u[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,l(s(a)("step3.applicantFound")),1)]),e("div",Pi,[e("div",Oi,[e("div",Vi,[e("div",Ii,l(s(a)("step3.passportIssueDate")),1),e("div",Ei,l(b.value.passportIssueDate?s(Le)(b.value.passportIssueDate):"-"),1)]),e("div",Ci,[e("div",Li,l(s(a)("step3.pinfl")),1),e("div",Fi,l(b.value.nationalIdentifier||"-"),1)]),e("div",Yi,[e("div",Ri,l(s(a)("step3.issuedBy")),1),e("div",Ui,l(b.value.passportIssuedBy||"-"),1)]),e("div",Bi,[e("div",Wi,l(s(a)("step3.lastName")),1),e("div",zi,l(b.value.lastName||"-"),1)]),e("div",ji,[e("div",qi,l(s(a)("step3.firstName")),1),e("div",Hi,l(b.value.firstName||"-"),1)]),e("div",Gi,[e("div",Ji,l(s(a)("step3.middleName")),1),e("div",Ki,l(b.value.middleName||"-"),1)]),e("div",Zi,[e("div",Qi,l(s(a)("step3.gender")),1),e("div",Xi,l(b.value.gender?s(Be)(b.value.gender,s(o).value):"-"),1)]),e("div",eo,[e("div",to,l(s(a)("step3.country")),1),e("div",so,l(b.value.country?.langValue1||"-"),1)]),e("div",ao,[e("div",io,l(s(a)("step3.region")),1),e("div",oo,l(b.value.region?.langValue1||"-"),1)]),e("div",lo,[e("div",ro,l(s(a)("step3.district")),1),e("div",no,l(b.value.district?.langValue1||"-"),1)]),e("div",co,[e("div",uo,l(s(a)("step3.street")),1),e("div",po,l(b.value.street||"-"),1)])])])])):F("",!0)]),_:1})]))]),_:1})])])}}}),fo=se(vo,[["__scopeId","data-v-62def220"]]),ho={class:"step-container"},mo={class:"step-header"},_o={class:"step-title"},bo={class:"step-description"},yo={class:"step-content"},go={class:"summary-section"},$o={class:"section-title"},So={class:"summary-card"},wo={class:"card-title"},Do={class:"card-content"},xo={class:"info-row"},No={class:"info-value-full"},ko={class:"summary-card"},Ao={class:"card-title"},To={class:"card-content"},Mo={class:"info-row"},Po={class:"info-value-full"},Oo={class:"summary-card"},Vo={class:"card-title"},Io={class:"card-content"},Eo={class:"info-row"},Co={class:"info-value-full"},Lo={class:"summary-card"},Fo={class:"card-title"},Yo={class:"card-content"},Ro={class:"info-row"},Uo={class:"info-value-full"},Bo={class:"info-row"},Wo={class:"info-value-full"},zo={class:"info-row"},jo={class:"info-value-full"},qo={class:"summary-card"},Ho={class:"card-title"},Go={class:"card-content"},Jo={class:"info-row"},Ko={class:"info-value-full"},Zo={class:"summary-section"},Qo={class:"section-title"},Xo={class:"form-section"},el={class:"form-section"},tl={key:0,class:"form-section"},sl={class:"premium-section"},al={class:"premium-card-large"},il={class:"premium-header"},ol={class:"premium-amount-large"},ll=te({__name:"Step5Summary",setup(c){const i=ve(),t=Ne();he(),Pe();const o=T(()=>i.osgo),a=T(()=>i.owner),p=T(()=>i.applicant);T(()=>i.fundData),R(!1);const n=T({get:()=>(o.value.applicantIsOwner?a.value:p.value).phone||"",set:u=>{o.value.applicantIsOwner?(a.value.phone=u,o.value.party=a.value):(p.value.phone=u,o.value.party=p.value)}}),{locale:b,t:h}=ie(),E=()=>o.value.period?t.getLocalizedName(o.value.period,b.value||"uz"):"-",$=()=>o.value.drivedArea?t.getLocalizedName(o.value.drivedArea,b.value||"uz"):"-";return(u,k)=>{const D=Fe;return d(),f("div",ho,[e("div",mo,[e("h2",_o,l(s(h)("step5.title")),1),e("p",bo,l(s(h)("step5.description")),1)]),e("div",yo,[e("div",go,[e("h3",$o,[k[2]||(k[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,l(s(h)("step5.policyInfo")),1)]),e("div",So,[e("div",wo,l(s(h)("step3.owner")),1),e("div",Do,[e("div",xo,[e("span",No,l(a.value.name||"-")+l(a.value.birthDate?` (${a.value.birthDate})`:""),1)])])]),e("div",ko,[e("div",Ao,l(s(h)("step3.applicant")),1),e("div",To,[e("div",Mo,[e("span",Po,l((o.value.applicantIsOwner?a.value:p.value).name||"-")+l((o.value.applicantIsOwner?a.value:p.value).birthDate?` (${(o.value.applicantIsOwner?a.value:p.value).birthDate})`:""),1)])])]),e("div",Oo,[e("div",Vo,l(s(h)("step5.vehicleInfo")),1),e("div",Io,[e("div",Eo,[e("span",Co,l(o.value.vehicle?.modelName||o.value.vehicle?.model||"-")+" "+l(o.value.vehicle?.govNumber?` (${o.value.vehicle.govNumber})`:""),1)])])]),e("div",Lo,[e("div",Fo,l(s(h)("step5.policyInfo")),1),e("div",Yo,[e("div",Ro,[e("span",Uo,l(E()),1)]),e("div",Bo,[e("span",Wo,l($()),1)]),e("div",zo,[e("span",jo,l(o.value.driversLimited?s(h)("step5.driversLimited",{count:o.value.drivers?.length||0}):s(h)("step5.noDriversLimitation")),1)])])]),e("div",qo,[e("div",Ho,l(s(h)("step5.compensation")),1),e("div",Go,[e("div",Jo,[e("span",Ko,l(s(Me)(s(Ce))),1)])])])]),e("div",Zo,[e("h3",Qo,[k[3]||(k[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,l(s(h)("step5.contactInfo")),1)]),e("div",Xo,[z(D,{modelValue:n.value,"onUpdate:modelValue":k[0]||(k[0]=w=>n.value=w),label:s(h)("step5.phone"),placeholder:s(h)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",el,[z(D,{modelValue:o.value.contractStartDate,"onUpdate:modelValue":k[1]||(k[1]=w=>o.value.contractStartDate=w),label:s(h)("step5.startDate"),type:"text","date-mask":"",placeholder:s(h)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),o.value.contractEndDate?(d(),f("div",tl,[z(D,{"model-value":o.value.contractEndDate,label:s(h)("step5.endDate"),type:"text","date-mask":"",placeholder:s(h)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):F("",!0)]),e("div",sl,[e("div",al,[e("div",il,[k[4]||(k[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,l(s(h)("step5.premium")),1)]),e("div",ol,l(s(Me)(s(i).calculatedPremium)),1)])])])])}}}),rl=se(ll,[["__scopeId","data-v-8e729bee"]]),nl={class:"step-container"},cl={class:"step-header"},ul={class:"step-title"},dl={class:"step-description"},pl={class:"step-content"},vl={class:"premium-section"},fl={class:"premium-card-large"},hl={class:"premium-header"},ml={class:"premium-amount-large"},_l={class:"payment-section"},bl={class:"section-title"},yl={class:"payment-buttons"},gl=["disabled"],$l={key:0,class:"payment-selected-indicator"},Sl=["disabled"],wl={key:0,class:"payment-selected-indicator"},Dl=["disabled"],xl={key:0,class:"payment-selected-indicator"},Nl={class:"status-section"},kl=["disabled"],Al={key:0,class:"ml-1"},Tl={key:0,class:"error-message mt-2"},Ml={key:0,class:"success-card"},Pl={class:"success-title"},Ol={class:"success-description"},Vl={class:"policy-details"},Il={class:"policy-row"},El={class:"policy-label"},Cl={class:"policy-value"},Ll={class:"policy-row"},Fl={class:"policy-label"},Yl={class:"policy-value"},Rl=te({__name:"Step6Payment",setup(c){const i=ve(),t=he();Pe();const{t:o,locale:a}=ie(),p=T(()=>i.osgo),n=T(()=>i.fundData);T(()=>(p.value.applicantIsOwner?i.owner:i.applicant).phone||"");const b=R(!1),h=R(null),E=R(0),$=R(null);let u=null;const k=T({get:()=>i.selectedPaymentMethod,set:L=>{i.selectedPaymentMethod=L}}),D=T(()=>{if(!$.value)return"";const L=$.value.toLowerCase(),g=a.value,B=g==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],P=g==="ru"?["ошибка","не получена"]:["xato","olindi"];return B.some(x=>L.includes(x))?"status-success":P.some(x=>L.includes(x))?"status-error":"status-info"}),w=T(()=>D.value==="status-success"?"bx bx-check-circle":D.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),m=L=>{k.value===L?k.value=null:k.value=L,t.isTelegramWebApp.value&&t.hapticImpact("light")},M=async()=>{if(!p.value.id){h.value=o("errors.createApplicationFailed");return}try{b.value=!0,h.value=null,$.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await i.fetchFundData(),n.value?.seria&&n.value?.number?($.value=o("step5.paymentSuccess"),t.isTelegramWebApp.value&&t.hapticNotification("success")):n.value?$.value=o("step5.paymentProcessing"):$.value=o("step5.paymentNotReceived"),E.value=15,u&&clearInterval(u),u=window.setInterval(()=>{E.value>0?E.value--:u&&(clearInterval(u),u=null)},1e3)}catch(L){console.error("[Step6Payment] Check status error:",L),h.value=L.message||o("errors.paymentFailed"),$.value=o("errors.paymentFailed"),t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{b.value=!1}};return Ze(()=>{u&&clearInterval(u)}),(L,g)=>(d(),f("div",nl,[e("div",cl,[e("h2",ul,l(s(o)("step5.payment")),1),e("p",dl,l(s(o)("step5.paymentDescription")),1)]),e("div",pl,[e("div",vl,[e("div",fl,[e("div",hl,[g[3]||(g[3]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,l(s(o)("step5.premium")),1)]),e("div",ml,l(s(Me)(s(i).calculatedPremium)),1)])]),e("div",_l,[e("h3",bl,[g[4]||(g[4]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,l(s(o)("step5.paymentMethod")),1)]),e("div",yl,[e("button",{type:"button",class:ee(["payment-btn payme",{"payment-btn-selected":k.value==="payme"}]),disabled:b.value,onClick:g[0]||(g[0]=B=>m("payme"))},[g[6]||(g[6]=e("div",{class:"payment-icon"},"💳",-1)),g[7]||(g[7]=e("div",{class:"payment-name"},"Payme",-1)),k.value==="payme"?(d(),f("div",$l,[...g[5]||(g[5]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):F("",!0)],10,gl),e("button",{type:"button",class:ee(["payment-btn click",{"payment-btn-selected":k.value==="click"}]),disabled:b.value,onClick:g[1]||(g[1]=B=>m("click"))},[g[9]||(g[9]=e("div",{class:"payment-icon"},"🔵",-1)),g[10]||(g[10]=e("div",{class:"payment-name"},"Click",-1)),k.value==="click"?(d(),f("div",wl,[...g[8]||(g[8]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):F("",!0)],10,Sl),e("button",{type:"button",class:ee(["payment-btn uzum",{"payment-btn-selected":k.value==="uzum"}]),disabled:b.value,onClick:g[2]||(g[2]=B=>m("uzum"))},[g[12]||(g[12]=e("div",{class:"payment-icon"},"🟣",-1)),g[13]||(g[13]=e("div",{class:"payment-name"},"Uzum",-1)),k.value==="uzum"?(d(),f("div",xl,[...g[11]||(g[11]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):F("",!0)],10,Dl)])]),e("div",Nl,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!E.value||b.value||!p.value.id,onClick:M},[g[14]||(g[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,l(s(o)("step5.checkStatus")),1),E.value?(d(),f("span",Al,"("+l(E.value)+")",1)):F("",!0)],8,kl),z(ne,{name:"fade"},{default:ce(()=>[h.value?(d(),f("div",Tl,[g[15]||(g[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,l(h.value),1)])):F("",!0)]),_:1}),z(ne,{name:"fade"},{default:ce(()=>[$.value?(d(),f("div",{key:0,class:ee(["status-text",D.value])},[e("i",{class:ee(w.value)},null,2),e("span",null,l($.value),1)],2)):F("",!0)]),_:1})]),z(ne,{name:"fade"},{default:ce(()=>[p.value.id&&n.value&&n.value.seria?(d(),f("div",Ml,[g[16]||(g[16]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Pl,l(s(o)("step5.success")),1),e("p",Ol,l(s(o)("step5.policyIssued")),1),e("div",Vl,[e("div",Il,[e("span",El,l(s(o)("step5.policySeries"))+":",1),e("span",Cl,l(n.value.seria),1)]),e("div",Ll,[e("span",Fl,l(s(o)("step5.policyNumber"))+":",1),e("span",Yl,l(n.value.number),1)])])])):F("",!0)]),_:1})])]))}}),Ul=se(Rl,[["__scopeId","data-v-0cbe2eac"]]),Bl={class:"min-h-screen flex flex-col"},Wl={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},zl={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},jl={class:"max-w-3xl mx-auto"},ql={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},Hl=te({__name:"index",setup(c){const i=ve(),t=Ne(),o=he();return Oe(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),i.initialize(),i.loadFromSession()&&console.log("[IndexPage] Restored data from session"),o.isTelegramWebApp.value&&o.showBackButton(()=>{i.currentStep>0?i.previousStep():o.close()});const p=pe(()=>i.osgo,()=>{i.saveToSession()},{deep:!0});Re(()=>{p()})}),Re(()=>{i.saveToSession(),o.isTelegramWebApp.value&&(o.hideBackButton(),o.hideMainButton())}),Qe({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,p)=>(d(),f("div",Bl,[e("header",Wl,[z(xt)]),e("main",zl,[e("div",jl,[z(ne,{name:"fade",mode:"out-in"},{default:ce(()=>[s(i).currentStep===s(C).PARAMS?(d(),xe(ks,{key:s(C).PARAMS})):s(i).currentStep===s(C).VEHICLE?(d(),xe($a,{key:s(C).VEHICLE})):s(i).currentStep===s(C).OWNER?(d(),xe(fo,{key:s(C).OWNER})):s(i).currentStep===s(C).SUMMARY?(d(),xe(rl,{key:s(C).SUMMARY})):s(i).currentStep===s(C).PAYMENT?(d(),xe(Ul,{key:s(C).PAYMENT})):F("",!0)]),_:1})])]),e("footer",ql,[z(Yt)])]))}}),tr=se(Hl,[["__scopeId","data-v-4214c6a6"]]);export{tr as default};
