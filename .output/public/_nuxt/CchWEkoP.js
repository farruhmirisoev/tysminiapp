import{e as ze,f as Ne,g as Oe,r as R,S as E,h as A,C as Ee,i as ve,j as Ie,k as te,l as ie,m as je,n as Pe,c as m,o as d,F as ae,p as ge,q as s,s as ee,t as o,a as e,v as qe,b as B,x as he,y as L,d as ke,z as fe,A as De,T as ne,w as ce,B as He,D as Ge,E as Ke,G as Ze,H as Fe,u as Je,I as xe}from"./D8p3k9zX.js";import{_ as se}from"./DlAUqK2U.js";import{_ as Qe}from"./DgM-zN9R.js";function Xe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Ae={exports:{}},et=Ae.exports,Re;function tt(){return Re||(Re=1,(function(n,i){(function(t,l){n.exports=l()})(et,(function(){var t=1e3,l=6e4,a=36e5,p="millisecond",v="second",u="minute",h="hour",V="day",g="week",c="month",D="quarter",w="year",C="date",y="Invalid Date",T=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(k){var b=["th","st","nd","rd"],f=k%100;return"["+k+(b[(f-20)%10]||b[f]||b[0])+"]"}},G=function(k,b,f){var S=String(k);return!S||S.length>=b?k:""+Array(b+1-S.length).join(f)+k},I={s:G,z:function(k){var b=-k.utcOffset(),f=Math.abs(b),S=Math.floor(f/60),_=f%60;return(b<=0?"+":"-")+G(S,2,"0")+":"+G(_,2,"0")},m:function k(b,f){if(b.date()<f.date())return-k(f,b);var S=12*(f.year()-b.year())+(f.month()-b.month()),_=b.clone().add(S,c),P=f-_<0,M=b.clone().add(S+(P?-1:1),c);return+(-(S+(f-_)/(P?_-M:M-_))||0)},a:function(k){return k<0?Math.ceil(k)||0:Math.floor(k)},p:function(k){return{M:c,y:w,w:g,d:V,D:C,h,m:u,s:v,ms:p,Q:D}[k]||String(k||"").toLowerCase().replace(/s$/,"")},u:function(k){return k===void 0}},x="en",O={};O[x]=$;var H="$isDayjsObject",oe=function(k){return k instanceof me||!(!k||!k[H])},X=function k(b,f,S){var _;if(!b)return x;if(typeof b=="string"){var P=b.toLowerCase();O[P]&&(_=P),f&&(O[P]=f,_=P);var M=b.split("-");if(!_&&M.length>1)return k(M[0])}else{var U=b.name;O[U]=b,_=U}return!S&&_&&(x=_),_||!S&&x},q=function(k,b){if(oe(k))return k.clone();var f=typeof b=="object"?b:{};return f.date=k,f.args=arguments,new me(f)},F=I;F.l=X,F.i=oe,F.w=function(k,b){return q(k,{locale:b.$L,utc:b.$u,x:b.$x,$offset:b.$offset})};var me=(function(){function k(f){this.$L=X(f.locale,null,!0),this.parse(f),this.$x=this.$x||f.x||{},this[H]=!0}var b=k.prototype;return b.parse=function(f){this.$d=(function(S){var _=S.date,P=S.utc;if(_===null)return new Date(NaN);if(F.u(_))return new Date;if(_ instanceof Date)return new Date(_);if(typeof _=="string"&&!/Z$/i.test(_)){var M=_.match(T);if(M){var U=M[2]-1||0,z=(M[7]||"0").substring(0,3);return P?new Date(Date.UTC(M[1],U,M[3]||1,M[4]||0,M[5]||0,M[6]||0,z)):new Date(M[1],U,M[3]||1,M[4]||0,M[5]||0,M[6]||0,z)}}return new Date(_)})(f),this.init()},b.init=function(){var f=this.$d;this.$y=f.getFullYear(),this.$M=f.getMonth(),this.$D=f.getDate(),this.$W=f.getDay(),this.$H=f.getHours(),this.$m=f.getMinutes(),this.$s=f.getSeconds(),this.$ms=f.getMilliseconds()},b.$utils=function(){return F},b.isValid=function(){return this.$d.toString()!==y},b.isSame=function(f,S){var _=q(f);return this.startOf(S)<=_&&_<=this.endOf(S)},b.isAfter=function(f,S){return q(f)<this.startOf(S)},b.isBefore=function(f,S){return this.endOf(S)<q(f)},b.$g=function(f,S,_){return F.u(f)?this[S]:this.set(_,f)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(f,S){var _=this,P=!!F.u(S)||S,M=F.p(f),U=function(de,J){var re=F.w(_.$u?Date.UTC(_.$y,J,de):new Date(_.$y,J,de),_);return P?re:re.endOf(V)},z=function(de,J){return F.w(_.toDate()[de].apply(_.toDate("s"),(P?[0,0,0,0]:[23,59,59,999]).slice(J)),_)},j=this.$W,K=this.$M,Q=this.$D,le="set"+(this.$u?"UTC":"");switch(M){case w:return P?U(1,0):U(31,11);case c:return P?U(1,K):U(0,K+1);case g:var ue=this.$locale().weekStart||0,_e=(j<ue?j+7:j)-ue;return U(P?Q-_e:Q+(6-_e),K);case V:case C:return z(le+"Hours",0);case h:return z(le+"Minutes",1);case u:return z(le+"Seconds",2);case v:return z(le+"Milliseconds",3);default:return this.clone()}},b.endOf=function(f){return this.startOf(f,!1)},b.$set=function(f,S){var _,P=F.p(f),M="set"+(this.$u?"UTC":""),U=(_={},_[V]=M+"Date",_[C]=M+"Date",_[c]=M+"Month",_[w]=M+"FullYear",_[h]=M+"Hours",_[u]=M+"Minutes",_[v]=M+"Seconds",_[p]=M+"Milliseconds",_)[P],z=P===V?this.$D+(S-this.$W):S;if(P===c||P===w){var j=this.clone().set(C,1);j.$d[U](z),j.init(),this.$d=j.set(C,Math.min(this.$D,j.daysInMonth())).$d}else U&&this.$d[U](z);return this.init(),this},b.set=function(f,S){return this.clone().$set(f,S)},b.get=function(f){return this[F.p(f)]()},b.add=function(f,S){var _,P=this;f=Number(f);var M=F.p(S),U=function(K){var Q=q(P);return F.w(Q.date(Q.date()+Math.round(K*f)),P)};if(M===c)return this.set(c,this.$M+f);if(M===w)return this.set(w,this.$y+f);if(M===V)return U(1);if(M===g)return U(7);var z=(_={},_[u]=l,_[h]=a,_[v]=t,_)[M]||1,j=this.$d.getTime()+f*z;return F.w(j,this)},b.subtract=function(f,S){return this.add(-1*f,S)},b.format=function(f){var S=this,_=this.$locale();if(!this.isValid())return _.invalidDate||y;var P=f||"YYYY-MM-DDTHH:mm:ssZ",M=F.z(this),U=this.$H,z=this.$m,j=this.$M,K=_.weekdays,Q=_.months,le=_.meridiem,ue=function(J,re,be,we){return J&&(J[re]||J(S,P))||be[re].slice(0,we)},_e=function(J){return F.s(U%12||12,J,"0")},de=le||function(J,re,be){var we=J<12?"AM":"PM";return be?we.toLowerCase():we};return P.replace(Y,(function(J,re){return re||(function(be){switch(be){case"YY":return String(S.$y).slice(-2);case"YYYY":return F.s(S.$y,4,"0");case"M":return j+1;case"MM":return F.s(j+1,2,"0");case"MMM":return ue(_.monthsShort,j,Q,3);case"MMMM":return ue(Q,j);case"D":return S.$D;case"DD":return F.s(S.$D,2,"0");case"d":return String(S.$W);case"dd":return ue(_.weekdaysMin,S.$W,K,2);case"ddd":return ue(_.weekdaysShort,S.$W,K,3);case"dddd":return K[S.$W];case"H":return String(U);case"HH":return F.s(U,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return de(U,z,!0);case"A":return de(U,z,!1);case"m":return String(z);case"mm":return F.s(z,2,"0");case"s":return String(S.$s);case"ss":return F.s(S.$s,2,"0");case"SSS":return F.s(S.$ms,3,"0");case"Z":return M}return null})(J)||M.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(f,S,_){var P,M=this,U=F.p(S),z=q(f),j=(z.utcOffset()-this.utcOffset())*l,K=this-z,Q=function(){return F.m(M,z)};switch(U){case w:P=Q()/12;break;case c:P=Q();break;case D:P=Q()/3;break;case g:P=(K-j)/6048e5;break;case V:P=(K-j)/864e5;break;case h:P=K/a;break;case u:P=K/l;break;case v:P=K/t;break;default:P=K}return _?P:F.a(P)},b.daysInMonth=function(){return this.endOf(c).$D},b.$locale=function(){return O[this.$L]},b.locale=function(f,S){if(!f)return this.$L;var _=this.clone(),P=X(f,S,!0);return P&&(_.$L=P),_},b.clone=function(){return F.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},k})(),Se=me.prototype;return q.prototype=Se,[["$ms",p],["$s",v],["$m",u],["$H",h],["$W",V],["$M",c],["$y",w],["$D",C]].forEach((function(k){Se[k[1]]=function(b){return this.$g(b,k[0],k[1])}})),q.extend=function(k,b){return k.$i||(k(b,me,q),k.$i=!0),q},q.locale=X,q.isDayjs=oe,q.unix=function(k){return q(1e3*k)},q.en=O[x],q.Ls=O,q.p={},q}))})(Ae)),Ae.exports}var st=tt();const $e=Xe(st);function Me(n,i="сум"){return n==null||isNaN(n)?`0 ${i}`:`${n.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${i}`}function Ce(n){return n?$e(n).format("DD.MM.YYYY"):""}function Ue(n,i="ru"){if(!n)return"";const t=String(n).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?i==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?i==="uz"?"Ayol":"Женский":String(n)}function at(n){if(!n)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;if(/^\d{2}-\d{2}-\d{4}$/.test(n)){const i=n.split("-");return`${i[2]}-${i[1]}-${i[0]}`}try{return $e(n,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return n}}const pe=ze("osgo",()=>{const n=Ne(),i=Oe(),t=R({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),l=R({passportSeries:"",passportNumber:"",birthDate:""}),a=R({passportSeries:"",passportNumber:"",birthDate:""}),p=R(E.PARAMS),v=R(!1),u=R(null),h=R(!1),V=R(null),g=R(null),c=R(null),D=R(!1),w=R(null),C=R(!1),y=R(!1),T=R(null),Y=R(!1),$=R(!1),G=R(null),I=R(!1),x=R(!1),O=R(null),H=A(()=>t.value.status==="DRAFT"),oe=A(()=>le(p.value).valid),X=A(()=>Object.keys(E).length-1),q=r=>r<=E.OWNER?r+1:r===E.DRIVERS?-1:r,F=A(()=>q(p.value)),me=A(()=>{const r=F.value;return Math.round(r/X.value*100)}),Se=A(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const r=t.value.vehicle.carType.tariffCompany||0,N=t.value.period.coefficient||0,W=t.value.drivedArea.coefficient||0;let Z=3;t.value.driversLimited&&t.value.incidentCoeff&&(Z=t.value.incidentCoeff);const Ve=r*N*Z*W,Ye=Ve>5*r?Ee*5*r:Ee*Ve/100;return Math.round(Ye)}),k=A(()=>{const N=(t.value.entriesJournalKt||[]).reduce((W,Z)=>W+(Z.amount||0),0);return t.value.premium-N}),b=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},p.value=E.PARAMS,n.isLoaded&&(t.value.discountType=n.getDefaultDiscountType())};ve(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let r=$e(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?r=r.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(r=r.add(t.value.period.days||0,"days")),t.value.contractEndDate=r.subtract(1,"days").format("YYYY-MM-DD")}),ve(()=>t.value.period,r=>{r&&(t.value.periodType=r.periodType)}),ve(()=>t.value.vehicle?.govNumber,r=>{if(!r||r.length<2)return;const N=parseInt(r.slice(0,2)),W=n.findDrivedAreaByRegion(N);W&&(t.value.drivedArea=W)}),ve(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=Se.value},{deep:!0}),ve(()=>t.value.driversLimited,r=>{r||(t.value.incidentCoeff=void 0)});const f=async()=>{if(t.value.vehicle){C.value=!0,T.value=null,y.value=!1;try{const r=await i.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),N=r?.result||r;if(r?.error&&!N)throw new Error(r.error.message||"Failed to verify vehicle");r?.error&&N&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",r.error),Object.assign(t.value.vehicle,N),N?.carType&&n.isLoaded&&(t.value.vehicle.carType=n.findCarType(N.carType.id)),y.value=!0,console.log("[OsgoStore] Vehicle verified:",N)}catch(r){throw T.value=r.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",r),r}finally{C.value=!1}}},S=async()=>{Y.value=!0,G.value=null,$.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",r),console.log("[OsgoStore] Result has id?",!!r?.id),r&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.beneficiary={...l.value},t.value.applicantIsOwner&&(a.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...r},t.value.party={...l.value},x.value=!0)),$.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(r){throw G.value=r.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",r),r}finally{Y.value=!1}},_=async()=>{I.value=!0,O.value=null,x.value=!1;try{const r=await i.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",r),r&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...r},t.value.party={...a.value}),x.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(r){throw O.value=r.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",r),r}finally{I.value=!1}},P=async r=>{if(!r.passportSeries||!r.passportNumber||!r.birthDate)throw new Error("Driver passport data is incomplete");try{const N=at(r.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:r.passportSeries,passportNumber:r.passportNumber,birthDate:r.birthDate,apiBirthDate:N});const W=await i.getDriver({passportSeries:r.passportSeries.toUpperCase(),passportNumber:r.passportNumber,birthDate:N});if(console.log("[OsgoStore] Driver verification result:",W),!W||!W.id)throw new Error("Driver verification failed: invalid response");const Z={...r,...W,birthDate:r.birthDate};return console.log("[OsgoStore] Verified driver:",Z),Z}catch(N){throw console.error("[OsgoStore] Driver verification failed:",N),N}},M=r=>{t.value.drivers||(t.value.drivers=[]);const N={passportSeries:r?.passportSeries||"",passportNumber:r?.passportNumber||"",birthDate:r?.birthDate||""};t.value.drivers.push(N),console.log("[OsgoStore] Driver added, total drivers:",t.value.drivers.length)},U=(r,N)=>{t.value.drivers[r]&&(t.value.drivers[r]=N)},z=r=>{t.value.drivers.splice(r,1)},j=(r,N,W)=>t.value.drivers.some(Z=>Z.passportSeries===r&&Z.passportNumber===N&&Z.birthDate===W),K=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(j(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}M({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},Q=()=>{j(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||M({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},le=r=>{switch(r){case E.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case E.VEHICLE:return{valid:y.value};case E.OWNER:return{valid:$.value&&(t.value.applicantIsOwner||x.value)};case E.DRIVERS:return{valid:!0};case E.SUMMARY:const N=t.value.applicantIsOwner?l.value.id:a.value.id;return{valid:!!(l.value.id&&N&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(W=>W.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case E.PAYMENT:return{valid:!!(t.value.id&&w.value)};default:return{valid:!1}}};return{osgo:t,owner:l,applicant:a,currentStep:p,saving:v,saveError:u,fetching:h,fetchError:V,fundData:g,fundError:c,fetchingFundData:D,selectedPaymentMethod:w,vehicleVerifying:C,vehicleVerified:y,vehicleVerifyError:T,ownerVerifying:Y,ownerVerified:$,ownerVerifyError:G,applicantVerifying:I,applicantVerified:x,applicantVerifyError:O,isEditable:H,canProceedToNextStep:oe,totalSteps:X,displayStepNumber:F,progressPercentage:me,calculatedPremium:Se,amountPayable:k,initialize:b,verifyVehicle:f,verifyOwner:S,verifyApplicant:_,verifyDriver:P,addDriver:M,updateDriver:U,removeDriver:z,hasDriver:j,addOwnerAsDriver:K,addApplicantAsDriver:Q,validateStepData:le,nextStep:()=>{p.value===E.OWNER?p.value=E.SUMMARY:p.value<E.PAYMENT&&p.value++},previousStep:()=>{p.value===E.SUMMARY?p.value=E.OWNER:p.value>0&&p.value--},goToStep:r=>{r>=0&&r<X.value&&(p.value=r)},createPolicy:async()=>{v.value=!0,u.value=null;try{let r=null;try{r=await i.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",r)}catch(Te){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Te),r={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const N=t.value.applicantIsOwner?{...l.value}:{...a.value};N.phone&&(N.phone=N.phone.replace(/[+()-]/g,""));const W={...l.value},Z=t.value.discountType||n.meta?.beneficiary?.find(({coefficient:Te})=>Te===1);if(!t.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(t.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(t.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const We={party:N,beneficiary:W,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:Z,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Be={user:r,osgo:We};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:r?.id,login:r?.login},osgo:{party:{id:N.id,name:N.name},beneficiary:{id:W.id,name:W.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:Z?.id}}});const ye=await i.createOsgoApplication(Be);if(!ye||typeof ye!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ye),new Error("Failed to create policy: invalid response");return t.value.id=ye,t.value.applicantIsOwner?(l.value.phone=N.phone,t.value.party=l.value):(a.value.phone=N.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",ye),ye}catch(r){throw u.value=r.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",r),r}finally{v.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");v.value=!0,u.value=null;try{const r={...t.value,party:t.value.applicantIsOwner?l.value:a.value,beneficiary:l.value};await i.updateOsgoApplication(r),console.log("[OsgoStore] Policy updated")}catch(r){throw u.value=r.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",r),r}finally{v.value=!1}},fetchPolicy:async r=>{h.value=!0,V.value=null;try{const N=await i.fetchOsgoEntity(r);if(t.value=N,N.party?.id){const W=await i.fetchIndividualEntity(N.party.id);a.value=W,t.value.party=W}if(N.beneficiary?.id){const W=await i.fetchIndividualEntity(N.beneficiary.id);l.value=W,t.value.beneficiary=W}if(n.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=n.findCarType(t.value.vehicle.carType.id)),n.isLoaded&&t.value.period&&(t.value.period=n.findPeriod(t.value.period.id)),n.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=n.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const W=Math.max(...t.value.drivers.map(Z=>Z.incidentFrequency?.coefficient||0));t.value.incidentCoeff=W}console.log("[OsgoStore] Policy fetched:",r)}catch(N){throw V.value=N.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",N),N}finally{h.value=!1}},fetchFundData:async()=>{if(t.value.id){D.value=!0,c.value=null;try{const r=await i.getFundPolicy(t.value.id);g.value=r||null,console.log("[OsgoStore] Fund data fetched:",r)}catch(r){c.value=r.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",r)}finally{D.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const r={osgo:t.value,owner:l.value,applicant:a.value,currentStep:p.value};sessionStorage.setItem(Ie.OSGO_DRAFT,JSON.stringify(r)),console.log("[OsgoStore] Saved to session")}catch(r){console.error("[OsgoStore] Error saving to session:",r)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const r=sessionStorage.getItem(Ie.OSGO_DRAFT);if(!r)return!1;const N=JSON.parse(r);return t.value=N.osgo,l.value=N.owner,a.value=N.applicant,p.value=N.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(r){return console.error("[OsgoStore] Error loading from session:",r),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Ie.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{b(),y.value=!1,$.value=!1,x.value=!1,g.value=null,u.value=null,V.value=null}}}),it={class:"language-switcher"},ot=["onClick"],lt=te({__name:"LanguageSwitcher",setup(n){const{locale:i,locales:t}=ie();je();const l=A(()=>i.value),a=A(()=>t.value.filter(v=>v.code!==i.value)),p=v=>{i.value=v,typeof window<"u"&&localStorage.setItem("app-language",v),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Pe(()=>{if(typeof window<"u"){const v=localStorage.getItem("app-language");v&&(v==="ru"||v==="uz")&&(i.value=v)}}),(v,u)=>(d(),m("div",it,[(d(!0),m(ae,null,ge(s(a),h=>(d(),m("button",{key:h.code,class:ee(["lang-btn",{active:s(l)===h.code}]),onClick:V=>p(h.code)},o(h.code.toUpperCase()),11,ot))),128))]))}}),rt=se(lt,[["__scopeId","data-v-e748ef5d"]]),nt={class:"progress-bar-container"},ct={class:"progress-track"},ut={class:"steps-container"},dt=["onClick"],pt={key:0,class:"step-check"},vt={key:1,class:"step-number"},ft={class:"step-label"},ht=te({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(n){const i=n,{t}=ie(),l=A(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.summary"),t("steps.payment")]),a=u=>u<=2?u:u+1,p=A(()=>(i.currentStep+1)/i.totalSteps*100),v=u=>{console.log("Step clicked:",u)};return(u,h)=>(d(),m("div",nt,[e("div",ct,[e("div",{class:"progress-fill",style:qe({width:`${p.value}%`})},null,4)]),e("div",ut,[(d(!0),m(ae,null,ge(l.value,(V,g)=>(d(),m("div",{key:g,class:"step-wrapper",onClick:c=>v(g)},[e("div",{class:ee(["step-circle",{"step-active":a(g)===n.currentStep,"step-completed":a(g)<n.currentStep&&a(g)!==s(E).DRIVERS,"step-pending":a(g)>n.currentStep}])},[a(g)<n.currentStep&&a(g)!==s(E).DRIVERS?(d(),m("span",pt,"✓")):(d(),m("span",vt,o(g+1),1))],2),e("div",ft,o(V),1)],8,dt))),128))])]))}}),mt=se(ht,[["__scopeId","data-v-7805c614"]]),_t={class:"fixed-header"},bt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},yt={class:"flex items-center justify-between mb-3"},gt={class:"flex items-center gap-3"},$t={class:"text-base font-bold text-text"},St=te({__name:"AppHeader",setup(n){const i=pe(),{t}=ie(),l=A(()=>i.currentStep),a=A(()=>i.totalSteps);return(p,v)=>{const u=rt,h=mt;return d(),m("header",_t,[e("div",bt,[e("div",yt,[e("div",gt,[v[1]||(v[1]=e("div",{class:"w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg"},[e("img",{src:Qe,alt:"Temiryo'l Sug'urta Logo"})],-1)),e("div",null,[e("div",$t,o(s(t)("header.appTitle")),1),v[0]||(v[0]=e("div",{class:"text-xs text-text-light"}," Temiryo'l Sug'urta ",-1))])]),B(u)]),B(h,{"current-step":l.value,"total-steps":a.value},null,8,["current-step","total-steps"])])])}}}),wt=se(St,[["__scopeId","data-v-60581198"]]),Dt={class:"fixed-footer"},xt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},Nt=["disabled"],kt={class:"flex-1 text-center"},At={class:"text-sm text-text-light font-medium"},Mt=["disabled"],Ot={key:0,class:"spinner"},Pt={key:0},Vt={key:1},Tt={key:2},It={key:3,class:"text-lg bx bx-chevron-right"},Et=te({__name:"AppFooter",setup(n){const i=pe(),t=he(),l=Oe(),{t:a}=ie(),p=R(!1),v=R(null),u=R(null),h=A(()=>i.currentStep),V=A(()=>i.totalSteps),g=A(()=>i.displayStepNumber),c=A(()=>h.value===0),D=A(()=>h.value===E.PAYMENT),w=A(()=>i.canProceedToNextStep),C=A(()=>i.saving||i.fetching||p.value),y=()=>{c.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),i.previousStep())},T=async()=>{if(!w.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(h.value===E.VEHICLE&&!i.vehicleVerified)await i.verifyVehicle();else if(h.value===E.OWNER)i.ownerVerified||await i.verifyOwner(),!i.osgo.applicantIsOwner&&!i.applicantVerified&&await i.verifyApplicant();else if(h.value===E.SUMMARY)i.osgo.id||(await i.createPolicy(),console.log("[AppFooter] Policy created:",i.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(h.value===E.PAYMENT){if(!i.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const $={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[i.selectedPaymentMethod],G=i.osgo.id,x=(i.osgo.applicantIsOwner?i.owner:i.applicant).phone||"",O=i.calculatedPremium;if(!G||!x||!O){const H="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:G,phone:x,amount:O}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(H));return}try{p.value=!0,v.value=null,u.value=null,await l.sendPaymentLink($,G,x,O),u.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(H){v.value=H.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",H),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(v.value))}finally{p.value=!1}return}D.value?console.log("[AppFooter] Last step reached"):i.nextStep()}catch(Y){console.error("[AppFooter] Error:",Y),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(Y.message||a("errors.unknown")))}};return(Y,$)=>(d(),m("footer",Dt,[e("div",xt,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:c.value||C.value,onClick:y},[$[0]||($[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,o(Y.$t("common.previous")),1)],8,Nt),e("div",kt,[e("div",At,o(Y.$t("common.step",{current:g.value,total:V.value})),1)]),e("button",{type:"button",class:ee(["btn flex-1 max-w-[160px]",{"btn-primary":!D.value||h.value!==s(E).PAYMENT,"btn-success":D.value&&h.value===s(E).PAYMENT}]),disabled:!w.value||C.value,onClick:T},[C.value?(d(),m("span",Ot)):(d(),m(ae,{key:1},[h.value===s(E).SUMMARY&&!s(i).osgo.id?(d(),m("span",Pt,o(Y.$t("step5.confirm")),1)):D.value&&h.value===s(E).PAYMENT?(d(),m("span",Vt,[$[1]||($[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(Y.$t("step5.payment")),1)])):(d(),m("span",Tt,o(Y.$t("common.next")),1)),!D.value&&h.value!==s(E).SUMMARY?(d(),m("i",It)):L("",!0)],64))],10,Mt)])]))}}),Ct=se(Et,[["__scopeId","data-v-9a015344"]]),Lt={class:"step-container"},Yt={key:0,class:"loading-state"},Ft={key:1,class:"error-state"},Rt={key:2,class:"error-state"},Ut={class:"debug-info"},Wt={key:3},Bt={class:"step-header"},zt={class:"step-title"},jt={class:"step-description"},qt={class:"step-content"},Ht={class:"form-section"},Gt={class:"section-title"},Kt={class:"select-wrapper"},Zt=["disabled"],Jt=["value"],Qt={class:"form-section"},Xt={class:"section-title"},es={class:"select-wrapper"},ts=["disabled"],ss=["value"],as={class:"form-section",style:{display:"none"}},is={class:"section-title"},os={class:"select-wrapper"},ls=["disabled"],rs={value:"false"},ns={value:"true"},cs={key:0,class:"form-section"},us={class:"section-title"},ds={class:"select-wrapper"},ps=["disabled"],vs=["value"],fs={class:"form-section"},hs={class:"section-title"},ms={class:"select-wrapper"},_s=["disabled"],bs=["value"],ys={key:0,class:"premium-card"},gs={class:"premium-card-content"},$s={class:"premium-label"},Ss={class:"premium-amount"},ws=te({__name:"Step1Params",setup(n){const i=pe(),t=Ne(),l=he(),{locale:a,t:p}=ie(),v=()=>{t.isLoaded&&(!u.value.vehicle?.carType?.id&&t.carTypes.length>0&&(V.value=t.carTypes[0].id),!u.value.period?.id&&t.periods.length>0&&(g.value=t.periods[0].id),!u.value.drivedArea?.id&&t.drivedAreas.length>0&&(w.value=t.drivedAreas[0].id),u.value.driversLimited===void 0&&(c.value="false"),u.value.driversLimited&&!u.value.incidentCoeff&&t.incidentFrequencies.length>0&&(D.value=t.incidentFrequencies[0].coefficient.toString()))};ve(()=>t.isLoaded,C=>{C&&setTimeout(()=>{v()},0)},{immediate:!0}),Pe(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Car types:",t.carTypes),console.log("[Step1Params] Periods count:",t.periods.length),console.log("[Step1Params] Meta object:",t.meta),v()});const u=A(()=>i.osgo),h=C=>t.getLocalizedName(C,a.value||"uz"),V=A({get:()=>u.value.vehicle?.carType?.id||"",set:C=>{if(!i.isEditable)return;const y=t.carTypes.find(T=>T.id===C);y&&(u.value.vehicle||(u.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),u.value.vehicle.carType=y,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),g=A({get:()=>u.value.period?.id||"",set:C=>{if(!i.isEditable)return;const y=t.periods.find(T=>T.id===C);y&&(u.value.period=y,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),c=A({get:()=>(u.value.driversLimited===void 0&&(u.value.driversLimited=!1),u.value.driversLimited?"true":"false"),set:C=>{i.isEditable&&(u.value.driversLimited=C==="true",u.value.driversLimited||(u.value.incidentCoeff=void 0),l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),D=A({get:()=>u.value.incidentCoeff?.toString()||"",set:C=>{if(!i.isEditable)return;const y=parseFloat(C);isNaN(y)||(u.value.incidentCoeff=y,l.isTelegramWebApp.value&&l.hapticImpact("light"))}}),w=A({get:()=>u.value.drivedArea?.id||"",set:C=>{const y=t.findDrivedArea(C);y&&(u.value.drivedArea=y)}});return(C,y)=>(d(),m("div",Lt,[s(t).fetching?(d(),m("div",Yt,[y[6]||(y[6]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,o(s(p)("common.loading")),1)])):s(t).error?(d(),m("div",Ft,[y[7]||(y[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,o(s(t).error),1),e("button",{onClick:y[0]||(y[0]=T=>s(t).fetchMeta(!0)),class:"btn-retry"},o(s(p)("common.retry")),1)])):!s(t).isLoaded||s(t).carTypes.length===0?(d(),m("div",Rt,[y[10]||(y[10]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,o(s(p)("common.loading")),1),e("p",Ut,[ke(" isLoaded: "+o(s(t).isLoaded),1),y[8]||(y[8]=e("br",null,null,-1)),ke(" carTypes: "+o(s(t).carTypes.length),1),y[9]||(y[9]=e("br",null,null,-1)),ke(" meta: "+o(s(t).meta?"exists":"null"),1)])])):(d(),m("div",Wt,[e("div",Bt,[e("h2",zt,o(s(p)("step1.title")),1),e("p",jt,o(s(p)("step1.description")),1)]),e("div",qt,[e("div",Ht,[e("h3",Gt,o(s(p)("step1.vehicleType")),1),e("div",Kt,[fe(e("select",{"onUpdate:modelValue":y[1]||(y[1]=T=>V.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),m(ae,null,ge(s(t).carTypes,T=>(d(),m("option",{key:T.id,value:T.id},o(h(T)),9,Jt))),128))],8,Zt),[[De,V.value]]),y[11]||(y[11]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",Qt,[e("h3",Xt,o(s(p)("step1.period")),1),e("div",es,[fe(e("select",{"onUpdate:modelValue":y[2]||(y[2]=T=>g.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),m(ae,null,ge(s(t).periods,T=>(d(),m("option",{key:T.id,value:T.id},o(h(T)),9,ss))),128))],8,ts),[[De,g.value]]),y[12]||(y[12]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),e("div",as,[e("h3",is,o(s(p)("step1.driversLimited")),1),e("div",os,[fe(e("select",{"onUpdate:modelValue":y[3]||(y[3]=T=>c.value=T),class:"input",disabled:!s(i).isEditable},[e("option",rs,o(s(p)("step1.driversLimitedNo"))+" - "+o(s(p)("step1.driversLimitedNoDesc")),1),e("option",ns,o(s(p)("step1.driversLimitedYes"))+" - "+o(s(p)("step1.driversLimitedYesDesc")),1)],8,ls),[[De,c.value]]),y[13]||(y[13]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),B(ne,{name:"slide-down"},{default:ce(()=>[u.value.driversLimited?(d(),m("div",cs,[e("h3",us,o(s(p)("step1.incidentFrequency")),1),e("div",ds,[fe(e("select",{"onUpdate:modelValue":y[4]||(y[4]=T=>D.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),m(ae,null,ge(s(t).incidentFrequencies,T=>(d(),m("option",{key:T.id,value:T.coefficient},o(h(T)),9,vs))),128))],8,ps),[[De,D.value]]),y[14]||(y[14]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])])):L("",!0)]),_:1}),e("div",fs,[e("h3",hs,o(s(p)("step1.usageTerritory")),1),e("div",ms,[fe(e("select",{"onUpdate:modelValue":y[5]||(y[5]=T=>w.value=T),class:"input",disabled:!s(i).isEditable},[(d(!0),m(ae,null,ge(s(t).drivedAreas,T=>(d(),m("option",{key:T.id,value:T.id},o(h(T)),9,bs))),128))],8,_s),[[De,w.value]]),y[15]||(y[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),s(i).calculatedPremium>0?(d(),m("div",ys,[e("div",gs,[e("div",$s,[y[16]||(y[16]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(p)("step1.premium")),1)]),e("div",Ss,o(s(Me)(s(i).calculatedPremium)),1)])])):L("",!0)])]))]))}}),Ds=se(ws,[["__scopeId","data-v-dd7fd0cf"]]),xs=["for"],Ns={key:0,class:"text-error"},ks={class:"input-wrapper"},As={key:0,class:"input-icon input-icon-left"},Ms=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Os={key:2,class:"input-icon input-icon-right"},Ps={key:1,class:"input-message"},Vs={key:0,class:"error-message"},Ts={key:1,class:"helper-text"},Is={key:2,class:"input-count"},Es=te({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(n,{expose:i,emit:t}){const l=n,a=t,{locale:p}=ie(),v=A(()=>{if(l.type==="date")return p.value==="uz"?"uz-UZ":"ru-RU"}),u=R(null),h=A(()=>`input-${Math.random().toString(36).substr(2,9)}`),V=A({get:()=>{const I=String(l.modelValue||"");if(l.dateMask&&I){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(I)||/^\d{2}-\d{2}-\d{4}$/.test(I))return I;if(/^\d{4}-\d{2}-\d{2}$/.test(I)){const x=I.split("-");return`${x[2]}-${x[1]}-${x[0]}`}}return I},set:I=>{if(l.uppercase&&(I=I.toUpperCase()),l.dateMask&&I){if(/^\d{4}-\d{2}-\d{2}$/.test(I)){a("update:modelValue",I);return}if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const x=I.split("-");a("update:modelValue",`${x[2]}-${x[1]}-${x[0]}`);return}a("update:modelValue",I);return}a("update:modelValue",I)}}),g=I=>{const x=I.target;let O=x.value;if(l.uppercase&&(O=O.toUpperCase(),x.value!==O&&(x.value=O)),l.dateMask){const H=Y(O);x.value!==H&&(x.value=H),a("update:modelValue",H),a("input",H);return}l.mask&&(O=T(O)),a("update:modelValue",O),a("input",O)},c=()=>{if(l.dateMask&&V.value){const I=String(V.value);if(/^\d{2}-\d{2}-\d{4}$/.test(I)){const x=I.split("-"),O=`${x[2]}-${x[1]}-${x[0]}`,H=new Date(O);isNaN(H.getTime())||a("update:modelValue",O)}}a("blur")},D=()=>{a("focus")},w=I=>{},C=()=>{a("enter")},y=()=>{a("update:modelValue",""),u.value?.focus()},T=I=>{if(l.dateMask)return Y(I);if(!l.mask)return I;let x="",O=0;const H=I.replace(/\D/g,"");for(let oe=0;oe<l.mask.length&&O<H.length;oe++){const X=l.mask[oe];X==="#"?(x+=H[O],O++):x+=X}return x},Y=I=>{const O=I.replace(/\D/g,"").slice(0,8);return O.length===0?"":O.length<=2?O:O.length<=4?`${O.slice(0,2)}-${O.slice(2)}`:`${O.slice(0,2)}-${O.slice(2,4)}-${O.slice(4)}`},$=()=>{u.value?.focus()},G=()=>{u.value?.blur()};return Pe(()=>{l.autofocus&&$()}),i({focus:$,blur:G}),(I,x)=>(d(),m("div",{class:ee(["input-field",{"has-error":n.error}])},[n.label?(d(),m("label",{key:0,class:"input-label",for:h.value},[ke(o(n.label)+" ",1),n.required?(d(),m("span",Ns,"*")):L("",!0)],8,xs)):L("",!0),e("div",ks,[n.icon?(d(),m("div",As,[e("i",{class:ee(n.icon)},null,2)])):L("",!0),fe(e("input",{id:h.value,ref_key:"inputRef",ref:u,"onUpdate:modelValue":x[0]||(x[0]=O=>V.value=O),type:n.dateMask?"text":n.type,placeholder:n.dateMask?n.placeholder||"DD-MM-YYYY":n.placeholder,disabled:n.disabled,readonly:n.readonly,maxlength:n.dateMask?10:n.maxLength,autocomplete:n.autocomplete,inputmode:n.dateMask?"numeric":n.inputMode,lang:v.value,class:ee(["input",{"input-with-icon-left":n.icon,"input-with-icon-right":n.clearable||n.loading,"input-error":n.error}]),onInput:g,onBlur:c,onFocus:D,onKeypress:w,onKeydown:Ge(C,["enter"])},null,42,Ms),[[He,V.value]]),n.clearable&&V.value&&!n.disabled&&!n.readonly?(d(),m("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:y},[...x[1]||(x[1]=[e("i",{class:"bx bx-x"},null,-1)])])):L("",!0),n.loading?(d(),m("div",Os,[...x[2]||(x[2]=[e("div",{class:"spinner-small"},null,-1)])])):L("",!0)]),n.helperText||n.error?(d(),m("div",Ps,[n.error?(d(),m("span",Vs,o(n.error),1)):n.helperText?(d(),m("span",Ts,o(n.helperText),1)):L("",!0)])):L("",!0),n.showCount&&n.maxLength?(d(),m("div",Is,o(V.value.length)+" / "+o(n.maxLength),1)):L("",!0)],2))}}),Le=se(Es,[["__scopeId","data-v-4eb39aee"]]);function Cs(n){if(!n)return{valid:!1,error:"Государственный номер обязателен"};const i=n.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(i)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Ls(n){if(!n)return{valid:!1,error:"Серия техпаспорта обязательна"};const i=n.toUpperCase();return/^[A-Z]{2,3}$/.test(i)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Ys(n){return n?/^\d+$/.test(n)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Fs={class:"step-container"},Rs={class:"step-header"},Us={class:"step-title"},Ws={class:"step-description"},Bs={class:"step-content"},zs={class:"form-section"},js={class:"form-section"},qs={class:"form-section"},Hs={class:"form-section"},Gs=["disabled"],Ks={key:0,class:"spinner"},Zs={key:0,class:"alert alert-error"},Js={key:0,class:"vehicle-info-card"},Qs={class:"card-header"},Xs={class:"card-content"};const ea={class:"vehicle-info-grid"},ta={key:0,class:"vehicle-info-item"},sa={class:"vehicle-info-label"},aa={class:"vehicle-info-value"},ia={key:1,class:"vehicle-info-item"},oa={class:"vehicle-info-label"},la={class:"vehicle-info-value"},ra={key:2,class:"vehicle-info-item"},na={class:"vehicle-info-label"},ca={class:"vehicle-info-value"},ua={key:3,class:"vehicle-info-item"},da={class:"vehicle-info-label"},pa={class:"vehicle-info-value"},va={key:4,class:"vehicle-info-item"},fa={class:"vehicle-info-label"},ha={class:"vehicle-info-value"},ma={key:1,class:"vehicle-info-empty"},_a=te({__name:"Step2Vehicle",setup(n){const i=pe();Ne();const t=he(),{t:l}=ie(),a=A(()=>i.osgo),p=R({}),v=A(()=>!!(a.value.vehicle?.govNumber&&a.value.vehicle?.techPassportSeries&&a.value.vehicle?.techPassportNumber&&Object.keys(p.value).length===0)),u=A(()=>{if(!a.value.vehicle)return 0;const g=a.value.vehicle;let c=0;return g.techPassportIssueDate&&c++,(g.modelName||g.model)&&c++,(g.createdYear||g.year)&&c++,g.engineNumber&&c++,g.bodyNumber&&c++,c}),h=g=>{if(!a.value.vehicle)return;let c;switch(g){case"govNumber":c=Cs(a.value.vehicle.govNumber);break;case"techPassportSeries":c=Ls(a.value.vehicle.techPassportSeries);break;case"techPassportNumber":c=Ys(a.value.vehicle.techPassportNumber);break}c&&!c.valid?p.value[g]=c.error||"":delete p.value[g]},V=async()=>{if(h("govNumber"),h("techPassportSeries"),h("techPassportNumber"),Object.keys(p.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await i.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",a.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(a.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(g,c)=>{const D=Le;return d(),m("div",Fs,[e("div",Rs,[e("h2",Us,o(s(l)("step2.title")),1),e("p",Ws,o(s(l)("step2.description")),1)]),e("div",Bs,[e("div",zs,[B(D,{modelValue:a.value.vehicle.govNumber,"onUpdate:modelValue":c[0]||(c[0]=w=>a.value.vehicle.govNumber=w),label:s(l)("step2.govNumber"),placeholder:s(l)("step2.govNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:c[1]||(c[1]=w=>h("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",js,[B(D,{modelValue:a.value.vehicle.techPassportSeries,"onUpdate:modelValue":c[2]||(c[2]=w=>a.value.vehicle.techPassportSeries=w),label:s(l)("step2.techPassportSeries"),placeholder:s(l)("step2.techPassportSeriesPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:c[3]||(c[3]=w=>h("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",qs,[B(D,{modelValue:a.value.vehicle.techPassportNumber,"onUpdate:modelValue":c[4]||(c[4]=w=>a.value.vehicle.techPassportNumber=w),label:s(l)("step2.techPassportNumber"),placeholder:s(l)("step2.techPassportNumberPlaceholder"),disabled:!s(i).isEditable,error:p.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:c[5]||(c[5]=w=>h("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Hs,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!v.value||s(i).vehicleVerifying,onClick:V},[s(i).vehicleVerifying?(d(),m("span",Ks)):(d(),m(ae,{key:1},[c[6]||(c[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).vehicleVerified?s(l)("step2.verified"):s(l)("step2.verify")),1)],64))],8,Gs)]),s(i).vehicleVerifyError?(d(),m("div",Zs,[c[7]||(c[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(s(i).vehicleVerifyError),1)])):L("",!0),B(ne,{name:"fade"},{default:ce(()=>[s(i).vehicleVerified&&a.value.vehicle?(d(),m("div",Js,[e("div",Qs,[c[8]||(c[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,o(s(l)("step2.vehicleFound")),1)]),e("div",Xs,[L("",!0),e("div",ea,[a.value.vehicle?.techPassportIssueDate?(d(),m("div",ta,[e("div",sa,o(s(l)("step2.techPassportIssueDate")),1),e("div",aa,o(s(Ce)(a.value.vehicle.techPassportIssueDate)),1)])):L("",!0),a.value.vehicle?.modelName||a.value.vehicle?.model?(d(),m("div",ia,[e("div",oa,o(s(l)("step2.model")),1),e("div",la,o(a.value.vehicle?.modelName||a.value.vehicle?.model||"-"),1)])):L("",!0),a.value.vehicle?.createdYear||a.value.vehicle?.year?(d(),m("div",ra,[e("div",na,o(s(l)("step2.year")),1),e("div",ca,o(a.value.vehicle?.createdYear||a.value.vehicle?.year||"-"),1)])):L("",!0),a.value.vehicle?.engineNumber?(d(),m("div",ua,[e("div",da,o(s(l)("step2.engineNumber")),1),e("div",pa,o(a.value.vehicle.engineNumber),1)])):L("",!0),a.value.vehicle?.bodyNumber?(d(),m("div",va,[e("div",fa,o(s(l)("step2.bodyNumber")),1),e("div",ha,o(a.value.vehicle.bodyNumber),1)])):L("",!0)]),u.value===0?(d(),m("div",ma,o(s(l)("step2.vehicleNotFound")),1)):L("",!0)])])):L("",!0)]),_:1})])])}}}),ba=se(_a,[["__scopeId","data-v-3ead2593"]]),ya={class:"step-container"},ga={class:"step-header"},$a={class:"step-title"},Sa={class:"step-description"},wa={class:"step-content"},Da={class:"subsection"},xa={class:"subsection-title"},Na={class:"form-section"},ka={class:"form-section"},Aa={class:"form-section"},Ma={class:"form-section"},Oa=["disabled"],Pa={key:0,class:"spinner"},Va={key:0,class:"info-card success"},Ta={class:"card-header"},Ia={class:"card-content"},Ea={class:"info-grid"},Ca={class:"info-item"},La={class:"info-label"},Ya={class:"info-value"},Fa={class:"info-item"},Ra={class:"info-label"},Ua={class:"info-value"},Wa={class:"info-item info-item-wide"},Ba={class:"info-label"},za={class:"info-value"},ja={class:"info-item"},qa={class:"info-label"},Ha={class:"info-value"},Ga={class:"info-item"},Ka={class:"info-label"},Za={class:"info-value"},Ja={class:"info-item"},Qa={class:"info-label"},Xa={class:"info-value"},ei={class:"info-item"},ti={class:"info-label"},si={class:"info-value"},ai={class:"info-item"},ii={class:"info-label"},oi={class:"info-value"},li={class:"info-item"},ri={class:"info-label"},ni={class:"info-value"},ci={class:"info-item"},ui={class:"info-label"},di={class:"info-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value"},hi={class:"form-section"},mi={class:"checkbox-label"},_i=["disabled"],bi={key:0,class:"subsection"},yi={class:"subsection-title"},gi={class:"form-section"},$i={class:"form-section"},Si={class:"form-section"},wi={class:"form-section"},Di=["disabled"],xi={key:0,class:"spinner"},Ni={key:0,class:"info-card success"},ki={class:"card-header"},Ai={class:"card-content"},Mi={class:"info-grid"},Oi={class:"info-item"},Pi={class:"info-label"},Vi={class:"info-value"},Ti={class:"info-item"},Ii={class:"info-label"},Ei={class:"info-value"},Ci={class:"info-item info-item-wide"},Li={class:"info-label"},Yi={class:"info-value"},Fi={class:"info-item"},Ri={class:"info-label"},Ui={class:"info-value"},Wi={class:"info-item"},Bi={class:"info-label"},zi={class:"info-value"},ji={class:"info-item"},qi={class:"info-label"},Hi={class:"info-value"},Gi={class:"info-item"},Ki={class:"info-label"},Zi={class:"info-value"},Ji={class:"info-item"},Qi={class:"info-label"},Xi={class:"info-value"},eo={class:"info-item"},to={class:"info-label"},so={class:"info-value"},ao={class:"info-item"},io={class:"info-label"},oo={class:"info-value"},lo={class:"info-item"},ro={class:"info-label"},no={class:"info-value"},co=te({__name:"Step3Owner",setup(n){const i=pe(),t=he(),{locale:l,t:a}=ie(),p=A(()=>i.osgo),v=A(()=>i.owner),u=A(()=>i.applicant),h=async()=>{try{await i.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},V=async()=>{try{await i.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(g,c)=>{const D=Le;return d(),m("div",ya,[e("div",ga,[e("h2",$a,o(s(a)("step3.title")),1),e("p",Sa,o(s(a)("step3.description")),1)]),e("div",wa,[e("div",Da,[e("h3",xa,o(s(a)("step3.owner")),1),e("div",Na,[B(D,{modelValue:v.value.passportSeries,"onUpdate:modelValue":c[0]||(c[0]=w=>v.value.passportSeries=w),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ka,[B(D,{modelValue:v.value.passportNumber,"onUpdate:modelValue":c[1]||(c[1]=w=>v.value.passportNumber=w),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Aa,[B(D,{modelValue:v.value.birthDate,"onUpdate:modelValue":c[2]||(c[2]=w=>v.value.birthDate=w),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Ma,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).ownerVerifying,onClick:h},[s(i).ownerVerifying?(d(),m("span",Pa)):(d(),m(ae,{key:1},[c[7]||(c[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).ownerVerified?s(a)("step3.verified"):s(a)("step3.verifyOwner")),1)],64))],8,Oa)]),B(ne,{name:"fade"},{default:ce(()=>[s(i).ownerVerified&&v.value.id?(d(),m("div",Va,[e("div",Ta,[c[8]||(c[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a)("step3.ownerFound")),1)]),e("div",Ia,[e("div",Ea,[e("div",Ca,[e("div",La,o(s(a)("step3.passportIssueDate")),1),e("div",Ya,o(v.value.passportIssueDate?s(Ce)(v.value.passportIssueDate):"-"),1)]),e("div",Fa,[e("div",Ra,o(s(a)("step3.pinfl")),1),e("div",Ua,o(v.value.nationalIdentifier||"-"),1)]),e("div",Wa,[e("div",Ba,o(s(a)("step3.issuedBy")),1),e("div",za,o(v.value.passportIssuedBy||"-"),1)]),e("div",ja,[e("div",qa,o(s(a)("step3.lastName")),1),e("div",Ha,o(v.value.lastName||"-"),1)]),e("div",Ga,[e("div",Ka,o(s(a)("step3.firstName")),1),e("div",Za,o(v.value.firstName||"-"),1)]),e("div",Ja,[e("div",Qa,o(s(a)("step3.middleName")),1),e("div",Xa,o(v.value.middleName||"-"),1)]),e("div",ei,[e("div",ti,o(s(a)("step3.gender")),1),e("div",si,o(v.value.gender?s(Ue)(v.value.gender,s(l).value):"-"),1)]),e("div",ai,[e("div",ii,o(s(a)("step3.country")),1),e("div",oi,o(v.value.country?.langValue1||"-"),1)]),e("div",li,[e("div",ri,o(s(a)("step3.region")),1),e("div",ni,o(v.value.region?.langValue1||"-"),1)]),e("div",ci,[e("div",ui,o(s(a)("step3.district")),1),e("div",di,o(v.value.district?.langValue1||"-"),1)]),e("div",pi,[e("div",vi,o(s(a)("step3.street")),1),e("div",fi,o(v.value.street||"-"),1)])])])])):L("",!0)]),_:1})]),e("div",hi,[e("label",mi,[fe(e("input",{"onUpdate:modelValue":c[3]||(c[3]=w=>p.value.applicantIsOwner=w),type:"checkbox",class:"checkbox",disabled:!s(i).isEditable},null,8,_i),[[Ke,p.value.applicantIsOwner]]),e("span",null,o(s(a)("step3.ownerIsApplicant")),1)])]),B(ne,{name:"slide-down"},{default:ce(()=>[p.value.applicantIsOwner?L("",!0):(d(),m("div",bi,[e("h3",yi,o(s(a)("step3.applicant")),1),e("div",gi,[B(D,{modelValue:u.value.passportSeries,"onUpdate:modelValue":c[4]||(c[4]=w=>u.value.passportSeries=w),label:s(a)("step3.passportSeries"),placeholder:s(a)("step3.passportSeriesPlaceholder"),disabled:!s(i).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",$i,[B(D,{modelValue:u.value.passportNumber,"onUpdate:modelValue":c[5]||(c[5]=w=>u.value.passportNumber=w),label:s(a)("step3.passportNumber"),placeholder:s(a)("step3.passportNumberPlaceholder"),disabled:!s(i).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Si,[B(D,{modelValue:u.value.birthDate,"onUpdate:modelValue":c[6]||(c[6]=w=>u.value.birthDate=w),label:s(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",wi,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:s(i).applicantVerifying,onClick:V},[s(i).applicantVerifying?(d(),m("span",xi)):(d(),m(ae,{key:1},[c[9]||(c[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(i).applicantVerified?s(a)("step3.verified"):s(a)("step3.verifyApplicant")),1)],64))],8,Di)]),B(ne,{name:"fade"},{default:ce(()=>[s(i).applicantVerified&&u.value.id?(d(),m("div",Ni,[e("div",ki,[c[10]||(c[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,o(s(a)("step3.applicantFound")),1)]),e("div",Ai,[e("div",Mi,[e("div",Oi,[e("div",Pi,o(s(a)("step3.passportIssueDate")),1),e("div",Vi,o(u.value.passportIssueDate?s(Ce)(u.value.passportIssueDate):"-"),1)]),e("div",Ti,[e("div",Ii,o(s(a)("step3.pinfl")),1),e("div",Ei,o(u.value.nationalIdentifier||"-"),1)]),e("div",Ci,[e("div",Li,o(s(a)("step3.issuedBy")),1),e("div",Yi,o(u.value.passportIssuedBy||"-"),1)]),e("div",Fi,[e("div",Ri,o(s(a)("step3.lastName")),1),e("div",Ui,o(u.value.lastName||"-"),1)]),e("div",Wi,[e("div",Bi,o(s(a)("step3.firstName")),1),e("div",zi,o(u.value.firstName||"-"),1)]),e("div",ji,[e("div",qi,o(s(a)("step3.middleName")),1),e("div",Hi,o(u.value.middleName||"-"),1)]),e("div",Gi,[e("div",Ki,o(s(a)("step3.gender")),1),e("div",Zi,o(u.value.gender?s(Ue)(u.value.gender,s(l).value):"-"),1)]),e("div",Ji,[e("div",Qi,o(s(a)("step3.country")),1),e("div",Xi,o(u.value.country?.langValue1||"-"),1)]),e("div",eo,[e("div",to,o(s(a)("step3.region")),1),e("div",so,o(u.value.region?.langValue1||"-"),1)]),e("div",ao,[e("div",io,o(s(a)("step3.district")),1),e("div",oo,o(u.value.district?.langValue1||"-"),1)]),e("div",lo,[e("div",ro,o(s(a)("step3.street")),1),e("div",no,o(u.value.street||"-"),1)])])])])):L("",!0)]),_:1})]))]),_:1})])])}}}),uo=se(co,[["__scopeId","data-v-62def220"]]),po={class:"step-container"},vo={class:"step-header"},fo={class:"step-title"},ho={class:"step-description"},mo={class:"step-content"},_o={class:"summary-section"},bo={class:"section-title"},yo={class:"summary-card"},go={class:"card-title"},$o={class:"card-content"},So={class:"info-row"},wo={class:"info-value-full"},Do={class:"summary-card"},xo={class:"card-title"},No={class:"card-content"},ko={class:"info-row"},Ao={class:"info-value-full"},Mo={class:"summary-card"},Oo={class:"card-title"},Po={class:"card-content"},Vo={class:"info-row"},To={class:"info-value-full"},Io={class:"summary-card"},Eo={class:"card-title"},Co={class:"card-content"},Lo={class:"info-row"},Yo={class:"info-value-full"},Fo={class:"info-row"},Ro={class:"info-value-full"},Uo={class:"info-row"},Wo={class:"info-value-full"},Bo={class:"summary-card"},zo={class:"card-title"},jo={class:"card-content"},qo={class:"info-row"},Ho={class:"info-value-full"},Go={class:"summary-section"},Ko={class:"section-title"},Zo={class:"form-section"},Jo={class:"form-section"},Qo={key:0,class:"form-section"},Xo={class:"premium-section"},el={class:"premium-card-large"},tl={class:"premium-header"},sl={class:"premium-amount-large"},al=te({__name:"Step5Summary",setup(n){const i=pe(),t=Ne();he(),Oe();const l=A(()=>i.osgo),a=A(()=>i.owner),p=A(()=>i.applicant);A(()=>i.fundData),R(!1);const v=A({get:()=>(l.value.applicantIsOwner?a.value:p.value).phone||"",set:c=>{l.value.applicantIsOwner?(a.value.phone=c,l.value.party=a.value):(p.value.phone=c,l.value.party=p.value)}}),{locale:u,t:h}=ie(),V=()=>l.value.period?t.getLocalizedName(l.value.period,u.value||"uz"):"-",g=()=>l.value.drivedArea?t.getLocalizedName(l.value.drivedArea,u.value||"uz"):"-";return(c,D)=>{const w=Le;return d(),m("div",po,[e("div",vo,[e("h2",fo,o(s(h)("step5.title")),1),e("p",ho,o(s(h)("step5.description")),1)]),e("div",mo,[e("div",_o,[e("h3",bo,[D[2]||(D[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,o(s(h)("step5.policyInfo")),1)]),e("div",yo,[e("div",go,o(s(h)("step3.owner")),1),e("div",$o,[e("div",So,[e("span",wo,o(a.value.name||"-")+o(a.value.birthDate?` (${a.value.birthDate})`:""),1)])])]),e("div",Do,[e("div",xo,o(s(h)("step3.applicant")),1),e("div",No,[e("div",ko,[e("span",Ao,o((l.value.applicantIsOwner?a.value:p.value).name||"-")+o((l.value.applicantIsOwner?a.value:p.value).birthDate?` (${(l.value.applicantIsOwner?a.value:p.value).birthDate})`:""),1)])])]),e("div",Mo,[e("div",Oo,o(s(h)("step5.vehicleInfo")),1),e("div",Po,[e("div",Vo,[e("span",To,o(l.value.vehicle?.modelName||l.value.vehicle?.model||"-")+" "+o(l.value.vehicle?.govNumber?` (${l.value.vehicle.govNumber})`:""),1)])])]),e("div",Io,[e("div",Eo,o(s(h)("step5.policyInfo")),1),e("div",Co,[e("div",Lo,[e("span",Yo,o(V()),1)]),e("div",Fo,[e("span",Ro,o(g()),1)]),e("div",Uo,[e("span",Wo,o(l.value.driversLimited?s(h)("step5.driversLimited",{count:l.value.drivers?.length||0}):s(h)("step5.noDriversLimitation")),1)])])]),e("div",Bo,[e("div",zo,o(s(h)("step5.compensation")),1),e("div",jo,[e("div",qo,[e("span",Ho,o(s(Me)(s(Ee))),1)])])])]),e("div",Go,[e("h3",Ko,[D[3]||(D[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,o(s(h)("step5.contactInfo")),1)]),e("div",Zo,[B(w,{modelValue:v.value,"onUpdate:modelValue":D[0]||(D[0]=C=>v.value=C),label:s(h)("step5.phone"),placeholder:s(h)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Jo,[B(w,{modelValue:l.value.contractStartDate,"onUpdate:modelValue":D[1]||(D[1]=C=>l.value.contractStartDate=C),label:s(h)("step5.startDate"),type:"text","date-mask":"",placeholder:s(h)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!s(i).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),l.value.contractEndDate?(d(),m("div",Qo,[B(w,{"model-value":l.value.contractEndDate,label:s(h)("step5.endDate"),type:"text","date-mask":"",placeholder:s(h)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):L("",!0)]),e("div",Xo,[e("div",el,[e("div",tl,[D[4]||(D[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(h)("step5.premium")),1)]),e("div",sl,o(s(Me)(s(i).calculatedPremium)),1)])])])])}}}),il=se(al,[["__scopeId","data-v-8e729bee"]]),ol={class:"step-container"},ll={class:"step-header"},rl={class:"step-title"},nl={class:"step-description"},cl={class:"step-content"},ul={class:"premium-section"},dl={class:"premium-card-large"},pl={class:"premium-header"},vl={class:"premium-amount-large"},fl={class:"payment-section"},hl={class:"section-title"},ml={class:"payment-buttons"},_l=["disabled"],bl={key:0,class:"payment-selected-indicator"},yl=["disabled"],gl={key:0,class:"payment-selected-indicator"},$l=["disabled"],Sl={key:0,class:"payment-selected-indicator"},wl={class:"status-section"},Dl=["disabled"],xl={key:0,class:"ml-1"},Nl={key:0,class:"error-message mt-2"},kl={key:0,class:"success-card"},Al={class:"success-title"},Ml={class:"success-description"},Ol={class:"policy-details"},Pl={class:"policy-row"},Vl={class:"policy-label"},Tl={class:"policy-value"},Il={class:"policy-row"},El={class:"policy-label"},Cl={class:"policy-value"},Ll=te({__name:"Step6Payment",setup(n){const i=pe(),t=he();Oe();const{t:l,locale:a}=ie(),p=A(()=>i.osgo),v=A(()=>i.fundData);A(()=>(p.value.applicantIsOwner?i.owner:i.applicant).phone||"");const u=R(!1),h=R(null),V=R(0),g=R(null);let c=null;const D=A({get:()=>i.selectedPaymentMethod,set:Y=>{i.selectedPaymentMethod=Y}}),w=A(()=>{if(!g.value)return"";const Y=g.value.toLowerCase(),$=a.value,G=$==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],I=$==="ru"?["ошибка","не получена"]:["xato","olindi"];return G.some(x=>Y.includes(x))?"status-success":I.some(x=>Y.includes(x))?"status-error":"status-info"}),C=A(()=>w.value==="status-success"?"bx bx-check-circle":w.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),y=Y=>{D.value===Y?D.value=null:D.value=Y,t.isTelegramWebApp.value&&t.hapticImpact("light")},T=async()=>{if(!p.value.id){h.value=l("errors.createApplicationFailed");return}try{u.value=!0,h.value=null,g.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await i.fetchFundData(),v.value?.seria&&v.value?.number?(g.value=l("step5.paymentSuccess"),t.isTelegramWebApp.value&&t.hapticNotification("success")):v.value?g.value=l("step5.paymentProcessing"):g.value=l("step5.paymentNotReceived"),V.value=15,c&&clearInterval(c),c=window.setInterval(()=>{V.value>0?V.value--:c&&(clearInterval(c),c=null)},1e3)}catch(Y){console.error("[Step6Payment] Check status error:",Y),h.value=Y.message||l("errors.paymentFailed"),g.value=l("errors.paymentFailed"),t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{u.value=!1}};return Ze(()=>{c&&clearInterval(c)}),(Y,$)=>(d(),m("div",ol,[e("div",ll,[e("h2",rl,o(s(l)("step5.payment")),1),e("p",nl,o(s(l)("step5.paymentDescription")),1)]),e("div",cl,[e("div",ul,[e("div",dl,[e("div",pl,[$[3]||($[3]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,o(s(l)("step5.premium")),1)]),e("div",vl,o(s(Me)(s(i).calculatedPremium)),1)])]),e("div",fl,[e("h3",hl,[$[4]||($[4]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,o(s(l)("step5.paymentMethod")),1)]),e("div",ml,[e("button",{type:"button",class:ee(["payment-btn payme",{"payment-btn-selected":D.value==="payme"}]),disabled:u.value,onClick:$[0]||($[0]=G=>y("payme"))},[$[6]||($[6]=e("div",{class:"payment-icon"},"💳",-1)),$[7]||($[7]=e("div",{class:"payment-name"},"Payme",-1)),D.value==="payme"?(d(),m("div",bl,[...$[5]||($[5]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,_l),e("button",{type:"button",class:ee(["payment-btn click",{"payment-btn-selected":D.value==="click"}]),disabled:u.value,onClick:$[1]||($[1]=G=>y("click"))},[$[9]||($[9]=e("div",{class:"payment-icon"},"🔵",-1)),$[10]||($[10]=e("div",{class:"payment-name"},"Click",-1)),D.value==="click"?(d(),m("div",gl,[...$[8]||($[8]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,yl),e("button",{type:"button",class:ee(["payment-btn uzum",{"payment-btn-selected":D.value==="uzum"}]),disabled:u.value,onClick:$[2]||($[2]=G=>y("uzum"))},[$[12]||($[12]=e("div",{class:"payment-icon"},"🟣",-1)),$[13]||($[13]=e("div",{class:"payment-name"},"Uzum",-1)),D.value==="uzum"?(d(),m("div",Sl,[...$[11]||($[11]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):L("",!0)],10,$l)])]),e("div",wl,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!V.value||u.value||!p.value.id,onClick:T},[$[14]||($[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,o(s(l)("step5.checkStatus")),1),V.value?(d(),m("span",xl,"("+o(V.value)+")",1)):L("",!0)],8,Dl),B(ne,{name:"fade"},{default:ce(()=>[h.value?(d(),m("div",Nl,[$[15]||($[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,o(h.value),1)])):L("",!0)]),_:1}),B(ne,{name:"fade"},{default:ce(()=>[g.value?(d(),m("div",{key:0,class:ee(["status-text",w.value])},[e("i",{class:ee(C.value)},null,2),e("span",null,o(g.value),1)],2)):L("",!0)]),_:1})]),B(ne,{name:"fade"},{default:ce(()=>[p.value.id&&v.value&&v.value.seria?(d(),m("div",kl,[$[16]||($[16]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Al,o(s(l)("step5.success")),1),e("p",Ml,o(s(l)("step5.policyIssued")),1),e("div",Ol,[e("div",Pl,[e("span",Vl,o(s(l)("step5.policySeries"))+":",1),e("span",Tl,o(v.value.seria),1)]),e("div",Il,[e("span",El,o(s(l)("step5.policyNumber"))+":",1),e("span",Cl,o(v.value.number),1)])])])):L("",!0)]),_:1})])]))}}),Yl=se(Ll,[["__scopeId","data-v-0cbe2eac"]]),Fl={class:"min-h-screen flex flex-col"},Rl={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},Ul={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},Wl={class:"max-w-3xl mx-auto"},Bl={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},zl=te({__name:"index",setup(n){const i=pe(),t=Ne(),l=he();return Pe(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),i.initialize(),i.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{i.currentStep>0?i.previousStep():l.close()});const p=ve(()=>i.osgo,()=>{i.saveToSession()},{deep:!0});Fe(()=>{p()})}),Fe(()=>{i.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),Je({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,p)=>(d(),m("div",Fl,[e("header",Rl,[B(wt)]),e("main",Ul,[e("div",Wl,[B(ne,{name:"fade",mode:"out-in"},{default:ce(()=>[s(i).currentStep===s(E).PARAMS?(d(),xe(Ds,{key:s(E).PARAMS})):s(i).currentStep===s(E).VEHICLE?(d(),xe(ba,{key:s(E).VEHICLE})):s(i).currentStep===s(E).OWNER?(d(),xe(uo,{key:s(E).OWNER})):s(i).currentStep===s(E).SUMMARY?(d(),xe(il,{key:s(E).SUMMARY})):s(i).currentStep===s(E).PAYMENT?(d(),xe(Yl,{key:s(E).PAYMENT})):L("",!0)]),_:1})])]),e("footer",Bl,[B(Ct)])]))}}),Ql=se(zl,[["__scopeId","data-v-4214c6a6"]]);export{Ql as default};
