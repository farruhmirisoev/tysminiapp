import{e as je,f as we,g as Ae,r as L,S as U,h as I,C as Te,i as ge,j as Me,k as ee,l as re,m as qe,n as Ve,c as d,o as c,F as X,p as ve,q as t,s as ae,t as i,a as e,v as He,b as F,x as Ge,y as fe,z as N,A as Ye,d as Se,T as oe,w as le,B as Ce,D as Ke,E as ce,G as Je,H as Ze,I as Qe,J as Xe,K as Be,u as et}from"./D-ONfaFs.js";import{_ as te}from"./DlAUqK2U.js";import{_ as tt}from"./DgM-zN9R.js";function st(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ne={exports:{}},at=Ne.exports,We;function it(){return We||(We=1,(function(r,o){(function(s,l){r.exports=l()})(at,(function(){var s=1e3,l=6e4,a=36e5,h="millisecond",u="second",_="minute",S="hour",g="day",V="week",p="month",x="quarter",f="year",R="date",O="Invalid Date",j=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(P){var $=["th","st","nd","rd"],m=P%100;return"["+P+($[(m-20)%10]||$[m]||$[0])+"]"}},E=function(P,$,m){var D=String(P);return!D||D.length>=$?P:""+Array($+1-D.length).join(m)+P},k={s:E,z:function(P){var $=-P.utcOffset(),m=Math.abs($),D=Math.floor(m/60),b=m%60;return($<=0?"+":"-")+E(D,2,"0")+":"+E(b,2,"0")},m:function P($,m){if($.date()<m.date())return-P(m,$);var D=12*(m.year()-$.year())+(m.month()-$.month()),b=$.clone().add(D,p),M=m-b<0,T=$.clone().add(D+(M?-1:1),p);return+(-(D+(m-b)/(M?b-T:T-b))||0)},a:function(P){return P<0?Math.ceil(P)||0:Math.floor(P)},p:function(P){return{M:p,y:f,w:V,d:g,D:R,h:S,m:_,s:u,ms:h,Q:x}[P]||String(P||"").toLowerCase().replace(/s$/,"")},u:function(P){return P===void 0}},v="en",w={};w[v]=y;var B="$isDayjsObject",ie=function(P){return P instanceof me||!(!P||!P[B])},se=function P($,m,D){var b;if(!$)return v;if(typeof $=="string"){var M=$.toLowerCase();w[M]&&(b=M),m&&(w[M]=m,b=M);var T=$.split("-");if(!b&&T.length>1)return P(T[0])}else{var W=$.name;w[W]=$,b=W}return!D&&b&&(v=b),b||!D&&v},H=function(P,$){if(ie(P))return P.clone();var m=typeof $=="object"?$:{};return m.date=P,m.args=arguments,new me(m)},C=k;C.l=se,C.i=ie,C.w=function(P,$){return H(P,{locale:$.$L,utc:$.$u,x:$.$x,$offset:$.$offset})};var me=(function(){function P(m){this.$L=se(m.locale,null,!0),this.parse(m),this.$x=this.$x||m.x||{},this[B]=!0}var $=P.prototype;return $.parse=function(m){this.$d=(function(D){var b=D.date,M=D.utc;if(b===null)return new Date(NaN);if(C.u(b))return new Date;if(b instanceof Date)return new Date(b);if(typeof b=="string"&&!/Z$/i.test(b)){var T=b.match(j);if(T){var W=T[2]-1||0,q=(T[7]||"0").substring(0,3);return M?new Date(Date.UTC(T[1],W,T[3]||1,T[4]||0,T[5]||0,T[6]||0,q)):new Date(T[1],W,T[3]||1,T[4]||0,T[5]||0,T[6]||0,q)}}return new Date(b)})(m),this.init()},$.init=function(){var m=this.$d;this.$y=m.getFullYear(),this.$M=m.getMonth(),this.$D=m.getDate(),this.$W=m.getDay(),this.$H=m.getHours(),this.$m=m.getMinutes(),this.$s=m.getSeconds(),this.$ms=m.getMilliseconds()},$.$utils=function(){return C},$.isValid=function(){return this.$d.toString()!==O},$.isSame=function(m,D){var b=H(m);return this.startOf(D)<=b&&b<=this.endOf(D)},$.isAfter=function(m,D){return H(m)<this.startOf(D)},$.isBefore=function(m,D){return this.endOf(D)<H(m)},$.$g=function(m,D,b){return C.u(m)?this[D]:this.set(b,m)},$.unix=function(){return Math.floor(this.valueOf()/1e3)},$.valueOf=function(){return this.$d.getTime()},$.startOf=function(m,D){var b=this,M=!!C.u(D)||D,T=C.p(m),W=function(pe,Z){var ne=C.w(b.$u?Date.UTC(b.$y,Z,pe):new Date(b.$y,Z,pe),b);return M?ne:ne.endOf(g)},q=function(pe,Z){return C.w(b.toDate()[pe].apply(b.toDate("s"),(M?[0,0,0,0]:[23,59,59,999]).slice(Z)),b)},G=this.$W,K=this.$M,Q=this.$D,he="set"+(this.$u?"UTC":"");switch(T){case f:return M?W(1,0):W(31,11);case p:return M?W(1,K):W(0,K+1);case V:var ue=this.$locale().weekStart||0,_e=(G<ue?G+7:G)-ue;return W(M?Q-_e:Q+(6-_e),K);case g:case R:return q(he+"Hours",0);case S:return q(he+"Minutes",1);case _:return q(he+"Seconds",2);case u:return q(he+"Milliseconds",3);default:return this.clone()}},$.endOf=function(m){return this.startOf(m,!1)},$.$set=function(m,D){var b,M=C.p(m),T="set"+(this.$u?"UTC":""),W=(b={},b[g]=T+"Date",b[R]=T+"Date",b[p]=T+"Month",b[f]=T+"FullYear",b[S]=T+"Hours",b[_]=T+"Minutes",b[u]=T+"Seconds",b[h]=T+"Milliseconds",b)[M],q=M===g?this.$D+(D-this.$W):D;if(M===p||M===f){var G=this.clone().set(R,1);G.$d[W](q),G.init(),this.$d=G.set(R,Math.min(this.$D,G.daysInMonth())).$d}else W&&this.$d[W](q);return this.init(),this},$.set=function(m,D){return this.clone().$set(m,D)},$.get=function(m){return this[C.p(m)]()},$.add=function(m,D){var b,M=this;m=Number(m);var T=C.p(D),W=function(K){var Q=H(M);return C.w(Q.date(Q.date()+Math.round(K*m)),M)};if(T===p)return this.set(p,this.$M+m);if(T===f)return this.set(f,this.$y+m);if(T===g)return W(1);if(T===V)return W(7);var q=(b={},b[_]=l,b[S]=a,b[u]=s,b)[T]||1,G=this.$d.getTime()+m*q;return C.w(G,this)},$.subtract=function(m,D){return this.add(-1*m,D)},$.format=function(m){var D=this,b=this.$locale();if(!this.isValid())return b.invalidDate||O;var M=m||"YYYY-MM-DDTHH:mm:ssZ",T=C.z(this),W=this.$H,q=this.$m,G=this.$M,K=b.weekdays,Q=b.months,he=b.meridiem,ue=function(Z,ne,be,ke){return Z&&(Z[ne]||Z(D,M))||be[ne].slice(0,ke)},_e=function(Z){return C.s(W%12||12,Z,"0")},pe=he||function(Z,ne,be){var ke=Z<12?"AM":"PM";return be?ke.toLowerCase():ke};return M.replace(Y,(function(Z,ne){return ne||(function(be){switch(be){case"YY":return String(D.$y).slice(-2);case"YYYY":return C.s(D.$y,4,"0");case"M":return G+1;case"MM":return C.s(G+1,2,"0");case"MMM":return ue(b.monthsShort,G,Q,3);case"MMMM":return ue(Q,G);case"D":return D.$D;case"DD":return C.s(D.$D,2,"0");case"d":return String(D.$W);case"dd":return ue(b.weekdaysMin,D.$W,K,2);case"ddd":return ue(b.weekdaysShort,D.$W,K,3);case"dddd":return K[D.$W];case"H":return String(W);case"HH":return C.s(W,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return pe(W,q,!0);case"A":return pe(W,q,!1);case"m":return String(q);case"mm":return C.s(q,2,"0");case"s":return String(D.$s);case"ss":return C.s(D.$s,2,"0");case"SSS":return C.s(D.$ms,3,"0");case"Z":return T}return null})(Z)||T.replace(":","")}))},$.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},$.diff=function(m,D,b){var M,T=this,W=C.p(D),q=H(m),G=(q.utcOffset()-this.utcOffset())*l,K=this-q,Q=function(){return C.m(T,q)};switch(W){case f:M=Q()/12;break;case p:M=Q();break;case x:M=Q()/3;break;case V:M=(K-G)/6048e5;break;case g:M=(K-G)/864e5;break;case S:M=K/a;break;case _:M=K/l;break;case u:M=K/s;break;default:M=K}return b?M:C.a(M)},$.daysInMonth=function(){return this.endOf(p).$D},$.$locale=function(){return w[this.$L]},$.locale=function(m,D){if(!m)return this.$L;var b=this.clone(),M=se(m,D,!0);return M&&(b.$L=M),b},$.clone=function(){return C.w(this.$d,this)},$.toDate=function(){return new Date(this.valueOf())},$.toJSON=function(){return this.isValid()?this.toISOString():null},$.toISOString=function(){return this.$d.toISOString()},$.toString=function(){return this.$d.toUTCString()},P})(),De=me.prototype;return H.prototype=De,[["$ms",h],["$s",u],["$m",_],["$H",S],["$W",g],["$M",p],["$y",f],["$D",R]].forEach((function(P){De[P[1]]=function($){return this.$g($,P[0],P[1])}})),H.extend=function(P,$){return P.$i||(P($,me,H),P.$i=!0),H},H.locale=se,H.isDayjs=ie,H.unix=function(P){return H(1e3*P)},H.en=w[v],H.Ls=w,H.p={},H}))})(Ne)),Ne.exports}var ot=it();const $e=st(ot);function Le(r,o="сум"){return r==null||isNaN(r)?`0 ${o}`:`${r.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${o}`}function xe(r){return r?$e(r).format("DD.MM.YYYY"):""}function Ue(r,o="ru"){return r?o==="uz"&&r.nameUz?r.nameUz:r.name||r.nameUz||"":""}function Ee(r,o="ru"){if(!r)return"";const s=String(r).toLowerCase();return s==="male"||s==="мужской"||s==="erkak"?o==="uz"?"Erkak":"Мужской":s==="female"||s==="женский"||s==="ayol"?o==="uz"?"Ayol":"Женский":String(r)}function lt(r){if(!r)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(r))return r;if(/^\d{2}-\d{2}-\d{4}$/.test(r)){const o=r.split("-");return`${o[2]}-${o[1]}-${o[0]}`}try{return $e(r,"DD-MM-YYYY").format("YYYY-MM-DD")}catch{return r}}const de=je("osgo",()=>{const r=we(),o=Ae(),s=L({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0}),l=L({passportSeries:"",passportNumber:"",birthDate:""}),a=L({passportSeries:"",passportNumber:"",birthDate:""}),h=L(U.PARAMS),u=L(!1),_=L(null),S=L(!1),g=L(null),V=L(null),p=L(null),x=L(!1),f=L(null),R=L(!1),O=L(!1),j=L(null),Y=L(!1),y=L(!1),E=L(null),k=L(!1),v=L(!1),w=L(null),B=I(()=>s.value.status==="DRAFT"),ie=I(()=>K(h.value).valid),se=I(()=>Object.keys(U).length),H=I(()=>Math.round((h.value+1)/se.value*100)),C=I(()=>{if(!s.value.vehicle?.carType||!s.value.period||!s.value.drivedArea)return 0;const n=s.value.vehicle.carType.tariffCompany||0,A=s.value.period.coefficient||0,z=s.value.drivedArea.coefficient||0;let J=3;s.value.driversLimited&&s.value.incidentCoeff&&(J=s.value.incidentCoeff);const Pe=n*A*J*z,Fe=Pe>5*n?Te*5*n:Te*Pe/100;return Math.round(Fe)}),me=I(()=>{const A=(s.value.entriesJournalKt||[]).reduce((z,J)=>z+(J.amount||0),0);return s.value.premium-A}),De=()=>{s.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:$e().format("YYYY-MM-DD"),premium:0},l.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},h.value=U.PARAMS,r.isLoaded&&(s.value.discountType=r.getDefaultDiscountType())};ge(()=>[s.value.contractStartDate,s.value.period],()=>{if(!s.value.contractStartDate||!s.value.period)return;let n=$e(s.value.contractStartDate);s.value.period.periodType==="ONE_YEAR"||s.value.period.periodType==="SEASON"?n=n.add(s.value.period.months||0,"months"):s.value.period.periodType==="TILL_REGISTRATION"&&(n=n.add(s.value.period.days||0,"days")),s.value.contractEndDate=n.subtract(1,"days").format("YYYY-MM-DD")}),ge(()=>s.value.period,n=>{n&&(s.value.periodType=n.periodType)}),ge(()=>s.value.vehicle?.govNumber,n=>{if(!n||n.length<2)return;const A=parseInt(n.slice(0,2)),z=r.findDrivedAreaByRegion(A);z&&(s.value.drivedArea=z)}),ge(()=>[s.value.vehicle?.carType,s.value.period,s.value.driversLimited,s.value.incidentCoeff,s.value.drivedArea],()=>{s.value.premium=C.value},{deep:!0}),ge(()=>s.value.driversLimited,n=>{n||(s.value.incidentCoeff=void 0)});const P=async()=>{if(s.value.vehicle){R.value=!0,j.value=null,O.value=!1;try{const n=await o.getVehicle({govNumber:s.value.vehicle.govNumber,techPassportSeries:s.value.vehicle.techPassportSeries,techPassportNumber:s.value.vehicle.techPassportNumber}),A=n?.result||n;if(n?.error&&!A)throw new Error(n.error.message||"Failed to verify vehicle");n?.error&&A&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",n.error),Object.assign(s.value.vehicle,A),A?.carType&&r.isLoaded&&(s.value.vehicle.carType=r.findCarType(A.carType.id)),O.value=!0,console.log("[OsgoStore] Vehicle verified:",A)}catch(n){throw j.value=n.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",n),n}finally{R.value=!1}}},$=async()=>{Y.value=!0,E.value=null,y.value=!1;try{const n=await o.getIndividualByPassport({passportSeries:l.value.passportSeries?.toUpperCase()||"",passportNumber:l.value.passportNumber,birthDate:l.value.birthDate});console.log("[OsgoStore] API result:",n),console.log("[OsgoStore] Result has id?",!!n?.id),n&&(l.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...n},s.value.beneficiary={...l.value},s.value.applicantIsOwner&&(a.value={passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate,...n},s.value.party={...l.value},v.value=!0)),y.value=!0,console.log("[OsgoStore] Owner after assignment:",l.value),console.log("[OsgoStore] Owner has id?",!!l.value.id)}catch(n){throw E.value=n.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",n),n}finally{Y.value=!1}},m=async()=>{k.value=!0,w.value=null,v.value=!1;try{const n=await o.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",n),n&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...n},s.value.party={...a.value}),v.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(n){throw w.value=n.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",n),n}finally{k.value=!1}},D=async n=>{if(!n.passportSeries||!n.passportNumber||!n.birthDate)throw new Error("Driver passport data is incomplete");try{const A=lt(n.birthDate);console.log("[OsgoStore] Verifying driver:",{passportSeries:n.passportSeries,passportNumber:n.passportNumber,birthDate:n.birthDate,apiBirthDate:A});const z=await o.getDriver({passportSeries:n.passportSeries.toUpperCase(),passportNumber:n.passportNumber,birthDate:A});if(console.log("[OsgoStore] Driver verification result:",z),!z||!z.id)throw new Error("Driver verification failed: invalid response");const J={...n,...z,birthDate:n.birthDate};return console.log("[OsgoStore] Verified driver:",J),J}catch(A){throw console.error("[OsgoStore] Driver verification failed:",A),A}},b=n=>{s.value.drivers||(s.value.drivers=[]);const A={passportSeries:n?.passportSeries||"",passportNumber:n?.passportNumber||"",birthDate:n?.birthDate||""};s.value.drivers.push(A),console.log("[OsgoStore] Driver added, total drivers:",s.value.drivers.length)},M=(n,A)=>{s.value.drivers[n]&&(s.value.drivers[n]=A)},T=n=>{s.value.drivers.splice(n,1)},W=(n,A,z)=>s.value.drivers.some(J=>J.passportSeries===n&&J.passportNumber===A&&J.birthDate===z),q=()=>{if(!l.value.passportSeries||!l.value.passportNumber||!l.value.birthDate)throw console.warn("[OsgoStore] Cannot add owner as driver: owner data incomplete"),new Error("Owner data is incomplete. Please verify owner information first.");if(W(l.value.passportSeries,l.value.passportNumber,l.value.birthDate)){console.log("[OsgoStore] Owner is already added as driver");return}b({passportSeries:l.value.passportSeries,passportNumber:l.value.passportNumber,birthDate:l.value.birthDate}),console.log("[OsgoStore] Owner added as driver")},G=()=>{W(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||b({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},K=n=>{switch(n){case U.PARAMS:return{valid:!!(s.value.vehicle?.carType&&s.value.period&&s.value.drivedArea&&(!s.value.driversLimited||s.value.incidentCoeff))};case U.VEHICLE:return{valid:O.value};case U.OWNER:return{valid:y.value&&(s.value.applicantIsOwner||v.value)};case U.DRIVERS:return{valid:!s.value.driversLimited||s.value.drivers.length>0};case U.SUMMARY:const A=s.value.applicantIsOwner?l.value.id:a.value.id;return{valid:!!(l.value.id&&A&&s.value.vehicle?.id&&(!s.value.driversLimited||s.value.drivers?.length&&s.value.drivers.every(z=>z.id))&&s.value.party?.phone&&s.value.party.phone.replace(/[+()-]/g,"").length===12&&s.value.contractStartDate)};case U.PAYMENT:return{valid:!!(s.value.id&&f.value)};default:return{valid:!1}}};return{osgo:s,owner:l,applicant:a,currentStep:h,saving:u,saveError:_,fetching:S,fetchError:g,fundData:V,fundError:p,fetchingFundData:x,selectedPaymentMethod:f,vehicleVerifying:R,vehicleVerified:O,vehicleVerifyError:j,ownerVerifying:Y,ownerVerified:y,ownerVerifyError:E,applicantVerifying:k,applicantVerified:v,applicantVerifyError:w,isEditable:B,canProceedToNextStep:ie,totalSteps:se,progressPercentage:H,calculatedPremium:C,amountPayable:me,initialize:De,verifyVehicle:P,verifyOwner:$,verifyApplicant:m,verifyDriver:D,addDriver:b,updateDriver:M,removeDriver:T,hasDriver:W,addOwnerAsDriver:q,addApplicantAsDriver:G,validateStepData:K,nextStep:()=>{h.value<se.value-1&&h.value++},previousStep:()=>{h.value>0&&h.value--},goToStep:n=>{n>=0&&n<se.value&&(h.value=n)},createPolicy:async()=>{u.value=!0,_.value=null;try{let n=null;try{n=await o.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",n)}catch(Ie){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Ie),n={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const A=s.value.applicantIsOwner?{...l.value}:{...a.value};A.phone&&(A.phone=A.phone.replace(/[+()-]/g,""));const z={...l.value},J=s.value.discountType||r.meta?.beneficiary?.find(({coefficient:Ie})=>Ie===1);if(!s.value.contractStartDate)throw new Error("Contract start date is required");if(!/^\d{4}-\d{2}-\d{2}$/.test(s.value.contractStartDate))throw new Error("Contract start date must be in YYYY-MM-DD format");if(!$e(s.value.contractStartDate).isValid())throw new Error("Invalid contract start date");const Re={party:A,beneficiary:z,vehicle:s.value.vehicle,period:s.value.period,drivedArea:s.value.drivedArea,discountType:J,drivers:s.value.drivers||[],contractStartDate:s.value.contractStartDate,contractEndDate:s.value.contractEndDate,status:s.value.status||"DRAFT",applicantIsOwner:s.value.applicantIsOwner??!0,periodType:s.value.periodType||s.value.period?.periodType||"ONE_YEAR",premium:s.value.premium||0,driversLimited:s.value.driversLimited??!1,incidentCoeff:s.value.incidentCoeff},ze={user:n,osgo:Re};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:n?.id,login:n?.login},osgo:{party:{id:A.id,name:A.name},beneficiary:{id:z.id,name:z.name},vehicle:{id:s.value.vehicle?.id,govNumber:s.value.vehicle?.govNumber},period:{id:s.value.period?.id},drivedArea:{id:s.value.drivedArea?.id},discountType:{id:J?.id}}});const ye=await o.createOsgoApplication(ze);if(!ye||typeof ye!="string")throw console.error("[OsgoStore] Invalid policy ID returned:",ye),new Error("Failed to create policy: invalid response");return s.value.id=ye,s.value.applicantIsOwner?(l.value.phone=A.phone,s.value.party=l.value):(a.value.phone=A.phone,s.value.party=a.value),console.log("[OsgoStore] Policy created:",ye),ye}catch(n){throw _.value=n.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",n),n}finally{u.value=!1}},updatePolicy:async()=>{if(!s.value.id)throw new Error("Policy ID is required for update");u.value=!0,_.value=null;try{const n={...s.value,party:s.value.applicantIsOwner?l.value:a.value,beneficiary:l.value};await o.updateOsgoApplication(n),console.log("[OsgoStore] Policy updated")}catch(n){throw _.value=n.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",n),n}finally{u.value=!1}},fetchPolicy:async n=>{S.value=!0,g.value=null;try{const A=await o.fetchOsgoEntity(n);if(s.value=A,A.party?.id){const z=await o.fetchIndividualEntity(A.party.id);a.value=z,s.value.party=z}if(A.beneficiary?.id){const z=await o.fetchIndividualEntity(A.beneficiary.id);l.value=z,s.value.beneficiary=z}if(r.isLoaded&&s.value.vehicle?.carType&&(s.value.vehicle.carType=r.findCarType(s.value.vehicle.carType.id)),r.isLoaded&&s.value.period&&(s.value.period=r.findPeriod(s.value.period.id)),r.isLoaded&&s.value.drivedArea&&(s.value.drivedArea=r.findDrivedArea(s.value.drivedArea.id)),s.value.driversLimited&&s.value.drivers.length>0){const z=Math.max(...s.value.drivers.map(J=>J.incidentFrequency?.coefficient||0));s.value.incidentCoeff=z}console.log("[OsgoStore] Policy fetched:",n)}catch(A){throw g.value=A.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",A),A}finally{S.value=!1}},fetchFundData:async()=>{if(s.value.id){x.value=!0,p.value=null;try{const n=await o.getFundPolicy(s.value.id);V.value=n||null,console.log("[OsgoStore] Fund data fetched:",n)}catch(n){p.value=n.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",n)}finally{x.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const n={osgo:s.value,owner:l.value,applicant:a.value,currentStep:h.value};sessionStorage.setItem(Me.OSGO_DRAFT,JSON.stringify(n)),console.log("[OsgoStore] Saved to session")}catch(n){console.error("[OsgoStore] Error saving to session:",n)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const n=sessionStorage.getItem(Me.OSGO_DRAFT);if(!n)return!1;const A=JSON.parse(n);return s.value=A.osgo,l.value=A.owner,a.value=A.applicant,h.value=A.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(n){return console.error("[OsgoStore] Error loading from session:",n),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Me.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{De(),O.value=!1,y.value=!1,v.value=!1,V.value=null,_.value=null,g.value=null}}}),rt={class:"language-switcher"},nt=["onClick"],ct=ee({__name:"LanguageSwitcher",setup(r){const{locale:o,locales:s}=re();qe();const l=I(()=>o.value),a=I(()=>s.value.filter(u=>u.code!==o.value)),h=u=>{o.value=u,typeof window<"u"&&localStorage.setItem("app-language",u),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Ve(()=>{if(typeof window<"u"){const u=localStorage.getItem("app-language");u&&(u==="ru"||u==="uz")&&(o.value=u)}}),(u,_)=>(c(),d("div",rt,[(c(!0),d(X,null,ve(t(a),S=>(c(),d("button",{key:S.code,class:ae(["lang-btn",{active:t(l)===S.code}]),onClick:g=>h(S.code)},i(S.code.toUpperCase()),11,nt))),128))]))}}),dt=te(ct,[["__scopeId","data-v-e748ef5d"]]),ut={class:"progress-bar-container"},pt={class:"progress-track"},vt={class:"steps-container"},ft=["onClick"],ht={key:0,class:"step-check"},mt={key:1,class:"step-number"},_t={class:"step-label"},bt=ee({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(r){const o=r,{t:s}=re(),l=I(()=>[s("steps.params"),s("steps.vehicle"),s("steps.owner"),s("steps.drivers"),s("steps.summary"),s("steps.payment")]),a=I(()=>(o.currentStep+1)/o.totalSteps*100),h=u=>{console.log("Step clicked:",u)};return(u,_)=>(c(),d("div",ut,[e("div",pt,[e("div",{class:"progress-fill",style:He({width:`${a.value}%`})},null,4)]),e("div",vt,[(c(!0),d(X,null,ve(l.value,(S,g)=>(c(),d("div",{key:g,class:"step-wrapper",onClick:V=>h(g)},[e("div",{class:ae(["step-circle",{"step-active":g===r.currentStep,"step-completed":g<r.currentStep,"step-pending":g>r.currentStep}])},[g<r.currentStep?(c(),d("span",ht,"✓")):(c(),d("span",mt,i(g+1),1))],2),e("div",_t,i(S),1)],8,ft))),128))])]))}}),yt=te(bt,[["__scopeId","data-v-b647cd33"]]),gt={class:"fixed-header"},$t={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},St={class:"flex items-center justify-between mb-3"},wt=ee({__name:"AppHeader",setup(r){const o=de(),s=I(()=>o.currentStep),l=I(()=>o.totalSteps);return(a,h)=>{const u=dt,_=yt;return c(),d("header",gt,[e("div",$t,[e("div",St,[h[0]||(h[0]=Ge('<div class="flex items-center gap-3" data-v-67b64b56><div class="w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg" data-v-67b64b56><img src="'+tt+'" alt="Temiryo&#39;l Sug&#39;urta Logo" data-v-67b64b56></div><div data-v-67b64b56><div class="text-base font-bold text-text" data-v-67b64b56>ОСГОВТС</div><div class="text-xs text-text-light" data-v-67b64b56> Temiryo&#39;l Sug&#39;urta </div></div></div>',1)),F(u)]),F(_,{"current-step":s.value,"total-steps":l.value},null,8,["current-step","total-steps"])])])}}}),Dt=te(wt,[["__scopeId","data-v-67b64b56"]]),kt={class:"fixed-footer"},xt={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},Nt=["disabled"],At={class:"flex-1 text-center"},Vt={class:"text-sm text-text-light font-medium"},Ot=["disabled"],Pt={key:0,class:"spinner"},It={key:0},Mt={key:1},Tt={key:2},Et={key:3,class:"text-lg bx bx-chevron-right"},Ct=ee({__name:"AppFooter",setup(r){const o=de(),s=fe(),l=Ae(),{t:a}=re(),h=L(!1),u=L(null),_=L(null),S=I(()=>o.currentStep),g=I(()=>o.totalSteps),V=I(()=>S.value===0),p=I(()=>S.value===g.value-1),x=I(()=>o.canProceedToNextStep),f=I(()=>o.saving||o.fetching||h.value),R=()=>{V.value||(s.isTelegramWebApp.value&&s.hapticImpact("light"),o.previousStep())},O=async()=>{if(!x.value){s.isTelegramWebApp.value&&(s.hapticNotification("error"),await s.showAlert(a("info.fillAllFields")));return}s.isTelegramWebApp.value&&s.hapticImpact("medium");try{if(S.value===U.VEHICLE&&!o.vehicleVerified)await o.verifyVehicle();else if(S.value===U.OWNER)o.ownerVerified||await o.verifyOwner(),!o.osgo.applicantIsOwner&&!o.applicantVerified&&await o.verifyApplicant();else if(S.value===U.SUMMARY)o.osgo.id||(await o.createPolicy(),console.log("[AppFooter] Policy created:",o.osgo.id),s.isTelegramWebApp.value&&s.hapticNotification("success"));else if(S.value===U.PAYMENT){if(!o.selectedPaymentMethod){s.isTelegramWebApp.value&&(s.hapticNotification("error"),await s.showAlert("Выберите способ оплаты"));return}const Y={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[o.selectedPaymentMethod],y=o.osgo.id,k=(o.osgo.applicantIsOwner?o.owner:o.applicant).phone||"",v=o.calculatedPremium;if(!y||!k||!v){const w="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:y,phone:k,amount:v}),s.isTelegramWebApp.value&&(s.hapticNotification("error"),await s.showAlert(w));return}try{h.value=!0,u.value=null,_.value=null,await l.sendPaymentLink(Y,y,k,v),_.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),s.isTelegramWebApp.value&&(s.hapticNotification("success"),await s.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(w){u.value=w.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",w),s.isTelegramWebApp.value&&(s.hapticNotification("error"),await s.showAlert(u.value))}finally{h.value=!1}return}p.value?console.log("[AppFooter] Last step reached"):o.nextStep()}catch(j){console.error("[AppFooter] Error:",j),s.isTelegramWebApp.value&&(s.hapticNotification("error"),await s.showAlert(j.message||a("errors.unknown")))}};return(j,Y)=>(c(),d("footer",kt,[e("div",xt,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:V.value||f.value,onClick:R},[Y[0]||(Y[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,i(j.$t("common.previous")),1)],8,Nt),e("div",At,[e("div",Vt,i(j.$t("common.step",{current:S.value+1,total:g.value})),1)]),e("button",{type:"button",class:ae(["btn flex-1 max-w-[160px]",{"btn-primary":!p.value||S.value!==t(U).PAYMENT,"btn-success":p.value&&S.value===t(U).PAYMENT}]),disabled:!x.value||f.value,onClick:O},[f.value?(c(),d("span",Pt)):(c(),d(X,{key:1},[S.value===t(U).SUMMARY&&!t(o).osgo.id?(c(),d("span",It,i(j.$t("step5.confirm")),1)):p.value&&S.value===t(U).PAYMENT?(c(),d("span",Mt,[Y[1]||(Y[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,i(j.$t("step5.payment")),1)])):(c(),d("span",Tt,i(j.$t("common.next")),1)),!p.value&&S.value!==t(U).SUMMARY?(c(),d("i",Et)):N("",!0)],64))],10,Ot)])]))}}),Lt=te(Ct,[["__scopeId","data-v-4fce94ec"]]),Ft=["disabled"],Yt={key:0,class:"check-icon"},Bt={class:"check-content"},Wt={class:"check-title"},Ut={key:0,class:"check-description"},Rt={class:"check-indicator"},zt={class:"check-circle"},jt={key:0,class:"check-dot"},qt=ee({__name:"CheckButton",props:{title:{default:""},description:{default:""},icon:{default:""},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["click"],setup(r,{emit:o}){const s=r,l=o,a=()=>{s.disabled||l("click")};return(h,u)=>(c(),d("button",{type:"button",class:ae(["check-button",{active:r.active,disabled:r.disabled}]),disabled:r.disabled,onClick:a},[r.icon?(c(),d("div",Yt,i(r.icon),1)):N("",!0),e("div",Bt,[e("div",Wt,[Ye(h.$slots,"default",{},()=>[Se(i(r.title),1)])]),r.description||h.$slots.description?(c(),d("div",Ut,[Ye(h.$slots,"description",{},()=>[Se(i(r.description),1)])])):N("",!0)]),e("div",Rt,[e("div",zt,[r.active?(c(),d("div",jt)):N("",!0)])])],10,Ft))}}),Ht=te(qt,[["__scopeId","data-v-f6637245"]]),Gt={class:"step-container"},Kt={key:0,class:"loading-state"},Jt={key:1,class:"error-state"},Zt={key:2,class:"error-state"},Qt={class:"debug-info"},Xt={key:3},es={class:"step-header"},ts={class:"step-title"},ss={class:"step-description"},as={class:"step-content"},is={class:"form-section"},os={class:"section-title"},ls={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},rs={class:"form-section"},ns={class:"section-title"},cs={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ds={class:"form-section"},us={class:"section-title"},ps={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},vs={key:0,class:"form-section"},fs={class:"section-title"},hs={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ms={class:"form-section"},_s={class:"section-title"},bs={class:"select-wrapper"},ys=["disabled"],gs={value:"",disabled:""},$s=["value"],Ss={key:0,class:"premium-card"},ws={class:"premium-card-content"},Ds={class:"premium-label"},ks={class:"premium-amount"},xs=ee({__name:"Step1Params",setup(r){const o=de(),s=we(),l=fe(),{locale:a,t:h}=re();Ve(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",s.isLoaded),console.log("[Step1Params] Car types count:",s.carTypes.length),console.log("[Step1Params] Car types:",s.carTypes),console.log("[Step1Params] Periods count:",s.periods.length),console.log("[Step1Params] Meta object:",s.meta)});const u=I(()=>o.osgo),_=x=>s.getLocalizedName(x,a.value||"uz"),S=I({get:()=>u.value.drivedArea?.id||"",set:x=>{const f=s.findDrivedArea(x);f&&(u.value.drivedArea=f)}}),g=x=>{o.isEditable&&(u.value.vehicle||(u.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),u.value.vehicle.carType=x,l.isTelegramWebApp.value&&l.hapticImpact("light"))},V=x=>{o.isEditable&&(u.value.period=x,l.isTelegramWebApp.value&&l.hapticImpact("light"))},p=x=>{o.isEditable&&(u.value.incidentCoeff=x.coefficient,l.isTelegramWebApp.value&&l.hapticImpact("light"))};return(x,f)=>{const R=Ht;return c(),d("div",Gt,[t(s).fetching?(c(),d("div",Kt,[f[4]||(f[4]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,i(t(h)("common.loading")),1)])):t(s).error?(c(),d("div",Jt,[f[5]||(f[5]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,i(t(s).error),1),e("button",{onClick:f[0]||(f[0]=O=>t(s).fetchMeta(!0)),class:"btn-retry"},i(t(h)("common.retry")),1)])):!t(s).isLoaded||t(s).carTypes.length===0?(c(),d("div",Zt,[f[8]||(f[8]=e("i",{class:"bx bx-info-circle"},null,-1)),e("p",null,i(t(h)("common.loading")),1),e("p",Qt,[Se(" isLoaded: "+i(t(s).isLoaded),1),f[6]||(f[6]=e("br",null,null,-1)),Se(" carTypes: "+i(t(s).carTypes.length),1),f[7]||(f[7]=e("br",null,null,-1)),Se(" meta: "+i(t(s).meta?"exists":"null"),1)])])):(c(),d("div",Xt,[e("div",es,[e("h2",ts,i(t(h)("step1.title")),1),e("p",ss,i(t(h)("step1.description")),1)]),e("div",as,[e("div",is,[e("h3",os,i(t(h)("step1.vehicleType")),1),e("div",ls,[(c(!0),d(X,null,ve(t(s).carTypes,O=>(c(),ce(R,{key:O.id,title:_(O),active:u.value.vehicle?.carType?.id===O.id,disabled:!t(o).isEditable,onClick:j=>g(O)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",rs,[e("h3",ns,i(t(h)("step1.period")),1),e("div",cs,[(c(!0),d(X,null,ve(t(s).periods,O=>(c(),ce(R,{key:O.id,title:_(O),active:u.value.period?.id===O.id,disabled:!t(o).isEditable,onClick:j=>V(O)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",ds,[e("h3",us,i(t(h)("step1.driversLimited")),1),e("div",ps,[F(R,{title:t(h)("step1.driversLimitedNo"),description:t(h)("step1.driversLimitedNoDesc"),active:!u.value.driversLimited,disabled:!t(o).isEditable,onClick:f[1]||(f[1]=O=>u.value.driversLimited=!1)},null,8,["title","description","active","disabled"]),F(R,{title:t(h)("step1.driversLimitedYes"),description:t(h)("step1.driversLimitedYesDesc"),active:u.value.driversLimited,disabled:!t(o).isEditable,onClick:f[2]||(f[2]=O=>u.value.driversLimited=!0)},null,8,["title","description","active","disabled"])])]),F(oe,{name:"slide-down"},{default:le(()=>[u.value.driversLimited?(c(),d("div",vs,[e("h3",fs,i(t(h)("step1.incidentFrequency")),1),e("div",hs,[(c(!0),d(X,null,ve(t(s).incidentFrequencies,O=>(c(),ce(R,{key:O.id,title:_(O),active:u.value.incidentCoeff===O.coefficient,disabled:!t(o).isEditable,onClick:j=>p(O)},null,8,["title","active","disabled","onClick"]))),128))])])):N("",!0)]),_:1}),e("div",ms,[e("h3",_s,i(t(h)("step1.usageTerritory")),1),e("div",bs,[Ce(e("select",{"onUpdate:modelValue":f[3]||(f[3]=O=>S.value=O),class:"input",disabled:!t(o).isEditable},[e("option",gs,i(t(h)("step1.usageTerritoryPlaceholder")),1),(c(!0),d(X,null,ve(t(s).drivedAreas,O=>(c(),d("option",{key:O.id,value:O.id},i(_(O)),9,$s))),128))],8,ys),[[Ke,S.value]]),f[9]||(f[9]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),t(o).calculatedPremium>0?(c(),d("div",Ss,[e("div",ws,[e("div",Ds,[f[10]||(f[10]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,i(t(h)("step1.premium")),1)]),e("div",ks,i(t(Le)(t(o).calculatedPremium)),1)])])):N("",!0)])]))])}}}),Ns=te(xs,[["__scopeId","data-v-e2cea3d2"]]),As=["for"],Vs={key:0,class:"text-error"},Os={class:"input-wrapper"},Ps={key:0,class:"input-icon input-icon-left"},Is=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],Ms={key:2,class:"input-icon input-icon-right"},Ts={key:1,class:"input-message"},Es={key:0,class:"error-message"},Cs={key:1,class:"helper-text"},Ls={key:2,class:"input-count"},Fs=ee({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(r,{expose:o,emit:s}){const l=r,a=s,{locale:h}=re(),u=I(()=>{if(l.type==="date")return h.value==="uz"?"uz-UZ":"ru-RU"}),_=L(null),S=I(()=>`input-${Math.random().toString(36).substr(2,9)}`),g=I({get:()=>{const k=String(l.modelValue||"");if(l.dateMask&&k){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(k)||/^\d{2}-\d{2}-\d{4}$/.test(k))return k;if(/^\d{4}-\d{2}-\d{2}$/.test(k)){const v=k.split("-");return`${v[2]}-${v[1]}-${v[0]}`}}return k},set:k=>{if(l.uppercase&&(k=k.toUpperCase()),l.dateMask&&k){if(/^\d{4}-\d{2}-\d{2}$/.test(k)){a("update:modelValue",k);return}if(/^\d{2}-\d{2}-\d{4}$/.test(k)){const v=k.split("-");a("update:modelValue",`${v[2]}-${v[1]}-${v[0]}`);return}a("update:modelValue",k);return}a("update:modelValue",k)}}),V=k=>{const v=k.target;let w=v.value;if(l.uppercase&&(w=w.toUpperCase(),v.value!==w&&(v.value=w)),l.dateMask){const B=Y(w);v.value!==B&&(v.value=B),a("update:modelValue",B),a("input",B);return}l.mask&&(w=j(w)),a("update:modelValue",w),a("input",w)},p=()=>{if(l.dateMask&&g.value){const k=String(g.value);if(/^\d{2}-\d{2}-\d{4}$/.test(k)){const v=k.split("-"),w=`${v[2]}-${v[1]}-${v[0]}`,B=new Date(w);isNaN(B.getTime())||a("update:modelValue",w)}}a("blur")},x=()=>{a("focus")},f=k=>{},R=()=>{a("enter")},O=()=>{a("update:modelValue",""),_.value?.focus()},j=k=>{if(l.dateMask)return Y(k);if(!l.mask)return k;let v="",w=0;const B=k.replace(/\D/g,"");for(let ie=0;ie<l.mask.length&&w<B.length;ie++){const se=l.mask[ie];se==="#"?(v+=B[w],w++):v+=se}return v},Y=k=>{const w=k.replace(/\D/g,"").slice(0,8);return w.length===0?"":w.length<=2?w:w.length<=4?`${w.slice(0,2)}-${w.slice(2)}`:`${w.slice(0,2)}-${w.slice(2,4)}-${w.slice(4)}`},y=()=>{_.value?.focus()},E=()=>{_.value?.blur()};return Ve(()=>{l.autofocus&&y()}),o({focus:y,blur:E}),(k,v)=>(c(),d("div",{class:ae(["input-field",{"has-error":r.error}])},[r.label?(c(),d("label",{key:0,class:"input-label",for:S.value},[Se(i(r.label)+" ",1),r.required?(c(),d("span",Vs,"*")):N("",!0)],8,As)):N("",!0),e("div",Os,[r.icon?(c(),d("div",Ps,[e("i",{class:ae(r.icon)},null,2)])):N("",!0),Ce(e("input",{id:S.value,ref_key:"inputRef",ref:_,"onUpdate:modelValue":v[0]||(v[0]=w=>g.value=w),type:r.dateMask?"text":r.type,placeholder:r.dateMask?r.placeholder||"DD-MM-YYYY":r.placeholder,disabled:r.disabled,readonly:r.readonly,maxlength:r.dateMask?10:r.maxLength,autocomplete:r.autocomplete,inputmode:r.dateMask?"numeric":r.inputMode,lang:u.value,class:ae(["input",{"input-with-icon-left":r.icon,"input-with-icon-right":r.clearable||r.loading,"input-error":r.error}]),onInput:V,onBlur:p,onFocus:x,onKeypress:f,onKeydown:Ze(R,["enter"])},null,42,Is),[[Je,g.value]]),r.clearable&&g.value&&!r.disabled&&!r.readonly?(c(),d("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:O},[...v[1]||(v[1]=[e("i",{class:"bx bx-x"},null,-1)])])):N("",!0),r.loading?(c(),d("div",Ms,[...v[2]||(v[2]=[e("div",{class:"spinner-small"},null,-1)])])):N("",!0)]),r.helperText||r.error?(c(),d("div",Ts,[r.error?(c(),d("span",Es,i(r.error),1)):r.helperText?(c(),d("span",Cs,i(r.helperText),1)):N("",!0)])):N("",!0),r.showCount&&r.maxLength?(c(),d("div",Ls,i(g.value.length)+" / "+i(r.maxLength),1)):N("",!0)],2))}}),Oe=te(Fs,[["__scopeId","data-v-4eb39aee"]]);function Ys(r){if(!r)return{valid:!1,error:"Государственный номер обязателен"};const o=r.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(o)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Bs(r){if(!r)return{valid:!1,error:"Серия техпаспорта обязательна"};const o=r.toUpperCase();return/^[A-Z]{2,3}$/.test(o)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Ws(r){return r?/^\d+$/.test(r)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const Us={class:"step-container"},Rs={class:"step-header"},zs={class:"step-title"},js={class:"step-description"},qs={class:"step-content"},Hs={class:"form-section"},Gs={class:"form-section"},Ks={class:"form-section"},Js={class:"form-section"},Zs=["disabled"],Qs={key:0,class:"spinner"},Xs={key:0,class:"alert alert-error"},ea={key:0,class:"vehicle-info-card"},ta={class:"card-header"},sa={class:"card-content"};const aa={class:"vehicle-info-grid"},ia={key:0,class:"vehicle-info-item"},oa={class:"vehicle-info-label"},la={class:"vehicle-info-value"},ra={key:1,class:"vehicle-info-item"},na={class:"vehicle-info-label"},ca={class:"vehicle-info-value"},da={key:2,class:"vehicle-info-item"},ua={class:"vehicle-info-label"},pa={class:"vehicle-info-value"},va={key:3,class:"vehicle-info-item"},fa={class:"vehicle-info-label"},ha={class:"vehicle-info-value"},ma={key:4,class:"vehicle-info-item"},_a={class:"vehicle-info-label"},ba={class:"vehicle-info-value"},ya={key:1,class:"vehicle-info-empty"},ga=ee({__name:"Step2Vehicle",setup(r){const o=de();we();const s=fe(),{t:l}=re(),a=I(()=>o.osgo),h=L({}),u=I(()=>!!(a.value.vehicle?.govNumber&&a.value.vehicle?.techPassportSeries&&a.value.vehicle?.techPassportNumber&&Object.keys(h.value).length===0)),_=I(()=>{if(!a.value.vehicle)return 0;const V=a.value.vehicle;let p=0;return V.techPassportIssueDate&&p++,(V.modelName||V.model)&&p++,(V.createdYear||V.year)&&p++,V.engineNumber&&p++,V.bodyNumber&&p++,p}),S=V=>{if(!a.value.vehicle)return;let p;switch(V){case"govNumber":p=Ys(a.value.vehicle.govNumber);break;case"techPassportSeries":p=Bs(a.value.vehicle.techPassportSeries);break;case"techPassportNumber":p=Ws(a.value.vehicle.techPassportNumber);break}p&&!p.valid?h.value[V]=p.error||"":delete h.value[V]},g=async()=>{if(S("govNumber"),S("techPassportSeries"),S("techPassportNumber"),Object.keys(h.value).length>0){s.isTelegramWebApp.value&&s.hapticNotification("error");return}try{await o.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",a.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(a.value.vehicle||{})),s.isTelegramWebApp.value&&s.hapticNotification("success")}catch{s.isTelegramWebApp.value&&s.hapticNotification("error")}};return(V,p)=>{const x=Oe;return c(),d("div",Us,[e("div",Rs,[e("h2",zs,i(t(l)("step2.title")),1),e("p",js,i(t(l)("step2.description")),1)]),e("div",qs,[e("div",Hs,[F(x,{modelValue:a.value.vehicle.govNumber,"onUpdate:modelValue":p[0]||(p[0]=f=>a.value.vehicle.govNumber=f),label:t(l)("step2.govNumber"),placeholder:t(l)("step2.govNumberPlaceholder"),disabled:!t(o).isEditable,error:h.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:p[1]||(p[1]=f=>S("govNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Gs,[F(x,{modelValue:a.value.vehicle.techPassportSeries,"onUpdate:modelValue":p[2]||(p[2]=f=>a.value.vehicle.techPassportSeries=f),label:t(l)("step2.techPassportSeries"),placeholder:t(l)("step2.techPassportSeriesPlaceholder"),disabled:!t(o).isEditable,error:h.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:p[3]||(p[3]=f=>S("techPassportSeries"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Ks,[F(x,{modelValue:a.value.vehicle.techPassportNumber,"onUpdate:modelValue":p[4]||(p[4]=f=>a.value.vehicle.techPassportNumber=f),label:t(l)("step2.techPassportNumber"),placeholder:t(l)("step2.techPassportNumberPlaceholder"),disabled:!t(o).isEditable,error:h.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:p[5]||(p[5]=f=>S("techPassportNumber"))},null,8,["modelValue","label","placeholder","disabled","error"])]),e("div",Js,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!u.value||t(o).vehicleVerifying,onClick:g},[t(o).vehicleVerifying?(c(),d("span",Qs)):(c(),d(X,{key:1},[p[6]||(p[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(t(o).vehicleVerified?t(l)("step2.verified"):t(l)("step2.verify")),1)],64))],8,Zs)]),t(o).vehicleVerifyError?(c(),d("div",Xs,[p[7]||(p[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,i(t(o).vehicleVerifyError),1)])):N("",!0),F(oe,{name:"fade"},{default:le(()=>[t(o).vehicleVerified&&a.value.vehicle?(c(),d("div",ea,[e("div",ta,[p[8]||(p[8]=e("i",{class:"bx bx-check-circle text-success"},null,-1)),e("span",null,i(t(l)("step2.vehicleFound")),1)]),e("div",sa,[N("",!0),e("div",aa,[a.value.vehicle?.techPassportIssueDate?(c(),d("div",ia,[e("div",oa,i(t(l)("step2.techPassportIssueDate")),1),e("div",la,i(t(xe)(a.value.vehicle.techPassportIssueDate)),1)])):N("",!0),a.value.vehicle?.modelName||a.value.vehicle?.model?(c(),d("div",ra,[e("div",na,i(t(l)("step2.model")),1),e("div",ca,i(a.value.vehicle?.modelName||a.value.vehicle?.model||"-"),1)])):N("",!0),a.value.vehicle?.createdYear||a.value.vehicle?.year?(c(),d("div",da,[e("div",ua,i(t(l)("step2.year")),1),e("div",pa,i(a.value.vehicle?.createdYear||a.value.vehicle?.year||"-"),1)])):N("",!0),a.value.vehicle?.engineNumber?(c(),d("div",va,[e("div",fa,i(t(l)("step2.engineNumber")),1),e("div",ha,i(a.value.vehicle.engineNumber),1)])):N("",!0),a.value.vehicle?.bodyNumber?(c(),d("div",ma,[e("div",_a,i(t(l)("step2.bodyNumber")),1),e("div",ba,i(a.value.vehicle.bodyNumber),1)])):N("",!0)]),_.value===0?(c(),d("div",ya,i(t(l)("step2.vehicleNotFound")),1)):N("",!0)])])):N("",!0)]),_:1})])])}}}),$a=te(ga,[["__scopeId","data-v-3ead2593"]]),Sa={class:"step-container"},wa={class:"step-header"},Da={class:"step-title"},ka={class:"step-description"},xa={class:"step-content"},Na={class:"subsection"},Aa={class:"subsection-title"},Va={class:"form-section"},Oa={class:"form-section"},Pa={class:"form-section"},Ia={class:"form-section"},Ma=["disabled"],Ta={key:0,class:"spinner"},Ea={key:0,class:"info-card success"},Ca={class:"card-header"},La={class:"card-content"},Fa={class:"info-grid"},Ya={class:"info-item"},Ba={class:"info-label"},Wa={class:"info-value"},Ua={class:"info-item"},Ra={class:"info-label"},za={class:"info-value"},ja={class:"info-item info-item-wide"},qa={class:"info-label"},Ha={class:"info-value"},Ga={class:"info-item"},Ka={class:"info-label"},Ja={class:"info-value"},Za={class:"info-item"},Qa={class:"info-label"},Xa={class:"info-value"},ei={class:"info-item"},ti={class:"info-label"},si={class:"info-value"},ai={class:"info-item"},ii={class:"info-label"},oi={class:"info-value"},li={class:"info-item"},ri={class:"info-label"},ni={class:"info-value"},ci={class:"info-item"},di={class:"info-label"},ui={class:"info-value"},pi={class:"info-item"},vi={class:"info-label"},fi={class:"info-value"},hi={class:"info-item"},mi={class:"info-label"},_i={class:"info-value"},bi={class:"form-section"},yi={class:"checkbox-label"},gi=["disabled"],$i={key:0,class:"subsection"},Si={class:"subsection-title"},wi={class:"form-section"},Di={class:"form-section"},ki={class:"form-section"},xi={class:"form-section"},Ni=["disabled"],Ai={key:0,class:"spinner"},Vi={key:0,class:"info-card success"},Oi={class:"card-header"},Pi={class:"card-content"},Ii={class:"info-grid"},Mi={class:"info-item"},Ti={class:"info-label"},Ei={class:"info-value"},Ci={class:"info-item"},Li={class:"info-label"},Fi={class:"info-value"},Yi={class:"info-item info-item-wide"},Bi={class:"info-label"},Wi={class:"info-value"},Ui={class:"info-item"},Ri={class:"info-label"},zi={class:"info-value"},ji={class:"info-item"},qi={class:"info-label"},Hi={class:"info-value"},Gi={class:"info-item"},Ki={class:"info-label"},Ji={class:"info-value"},Zi={class:"info-item"},Qi={class:"info-label"},Xi={class:"info-value"},eo={class:"info-item"},to={class:"info-label"},so={class:"info-value"},ao={class:"info-item"},io={class:"info-label"},oo={class:"info-value"},lo={class:"info-item"},ro={class:"info-label"},no={class:"info-value"},co={class:"info-item"},uo={class:"info-label"},po={class:"info-value"},vo=ee({__name:"Step3Owner",setup(r){const o=de(),s=fe(),{locale:l,t:a}=re(),h=I(()=>o.osgo),u=I(()=>o.owner),_=I(()=>o.applicant),S=async()=>{try{await o.verifyOwner(),s.isTelegramWebApp.value&&s.hapticNotification("success")}catch{s.isTelegramWebApp.value&&s.hapticNotification("error")}},g=async()=>{try{await o.verifyApplicant(),s.isTelegramWebApp.value&&s.hapticNotification("success")}catch{s.isTelegramWebApp.value&&s.hapticNotification("error")}};return(V,p)=>{const x=Oe;return c(),d("div",Sa,[e("div",wa,[e("h2",Da,i(t(a)("step3.title")),1),e("p",ka,i(t(a)("step3.description")),1)]),e("div",xa,[e("div",Na,[e("h3",Aa,i(t(a)("step3.owner")),1),e("div",Va,[F(x,{modelValue:u.value.passportSeries,"onUpdate:modelValue":p[0]||(p[0]=f=>u.value.passportSeries=f),label:t(a)("step3.passportSeries"),placeholder:t(a)("step3.passportSeriesPlaceholder"),disabled:!t(o).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Oa,[F(x,{modelValue:u.value.passportNumber,"onUpdate:modelValue":p[1]||(p[1]=f=>u.value.passportNumber=f),label:t(a)("step3.passportNumber"),placeholder:t(a)("step3.passportNumberPlaceholder"),disabled:!t(o).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Pa,[F(x,{modelValue:u.value.birthDate,"onUpdate:modelValue":p[2]||(p[2]=f=>u.value.birthDate=f),label:t(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!t(o).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",Ia,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:t(o).ownerVerifying,onClick:S},[t(o).ownerVerifying?(c(),d("span",Ta)):(c(),d(X,{key:1},[p[7]||(p[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(t(o).ownerVerified?t(a)("step3.verified"):t(a)("step3.verifyOwner")),1)],64))],8,Ma)]),F(oe,{name:"fade"},{default:le(()=>[t(o).ownerVerified&&u.value.id?(c(),d("div",Ea,[e("div",Ca,[p[8]||(p[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(t(a)("step3.ownerFound")),1)]),e("div",La,[e("div",Fa,[e("div",Ya,[e("div",Ba,i(t(a)("step3.passportIssueDate")),1),e("div",Wa,i(u.value.passportIssueDate?t(xe)(u.value.passportIssueDate):"-"),1)]),e("div",Ua,[e("div",Ra,i(t(a)("step3.pinfl")),1),e("div",za,i(u.value.nationalIdentifier||"-"),1)]),e("div",ja,[e("div",qa,i(t(a)("step3.issuedBy")),1),e("div",Ha,i(u.value.passportIssuedBy||"-"),1)]),e("div",Ga,[e("div",Ka,i(t(a)("step3.lastName")),1),e("div",Ja,i(u.value.lastName||"-"),1)]),e("div",Za,[e("div",Qa,i(t(a)("step3.firstName")),1),e("div",Xa,i(u.value.firstName||"-"),1)]),e("div",ei,[e("div",ti,i(t(a)("step3.middleName")),1),e("div",si,i(u.value.middleName||"-"),1)]),e("div",ai,[e("div",ii,i(t(a)("step3.gender")),1),e("div",oi,i(u.value.gender?t(Ee)(u.value.gender,t(l).value):"-"),1)]),e("div",li,[e("div",ri,i(t(a)("step3.country")),1),e("div",ni,i(u.value.country?.langValue1||"-"),1)]),e("div",ci,[e("div",di,i(t(a)("step3.region")),1),e("div",ui,i(u.value.region?.langValue1||"-"),1)]),e("div",pi,[e("div",vi,i(t(a)("step3.district")),1),e("div",fi,i(u.value.district?.langValue1||"-"),1)]),e("div",hi,[e("div",mi,i(t(a)("step3.street")),1),e("div",_i,i(u.value.street||"-"),1)])])])])):N("",!0)]),_:1})]),e("div",bi,[e("label",yi,[Ce(e("input",{"onUpdate:modelValue":p[3]||(p[3]=f=>h.value.applicantIsOwner=f),type:"checkbox",class:"checkbox",disabled:!t(o).isEditable},null,8,gi),[[Qe,h.value.applicantIsOwner]]),e("span",null,i(t(a)("step3.ownerIsApplicant")),1)])]),F(oe,{name:"slide-down"},{default:le(()=>[h.value.applicantIsOwner?N("",!0):(c(),d("div",$i,[e("h3",Si,i(t(a)("step3.applicant")),1),e("div",wi,[F(x,{modelValue:_.value.passportSeries,"onUpdate:modelValue":p[4]||(p[4]=f=>_.value.passportSeries=f),label:t(a)("step3.passportSeries"),placeholder:t(a)("step3.passportSeriesPlaceholder"),disabled:!t(o).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",Di,[F(x,{modelValue:_.value.passportNumber,"onUpdate:modelValue":p[5]||(p[5]=f=>_.value.passportNumber=f),label:t(a)("step3.passportNumber"),placeholder:t(a)("step3.passportNumberPlaceholder"),disabled:!t(o).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ki,[F(x,{modelValue:_.value.birthDate,"onUpdate:modelValue":p[6]||(p[6]=f=>_.value.birthDate=f),label:t(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!t(o).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",xi,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:t(o).applicantVerifying,onClick:g},[t(o).applicantVerifying?(c(),d("span",Ai)):(c(),d(X,{key:1},[p[9]||(p[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(t(o).applicantVerified?t(a)("step3.verified"):t(a)("step3.verifyApplicant")),1)],64))],8,Ni)]),F(oe,{name:"fade"},{default:le(()=>[t(o).applicantVerified&&_.value.id?(c(),d("div",Vi,[e("div",Oi,[p[10]||(p[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(t(a)("step3.applicantFound")),1)]),e("div",Pi,[e("div",Ii,[e("div",Mi,[e("div",Ti,i(t(a)("step3.passportIssueDate")),1),e("div",Ei,i(_.value.passportIssueDate?t(xe)(_.value.passportIssueDate):"-"),1)]),e("div",Ci,[e("div",Li,i(t(a)("step3.pinfl")),1),e("div",Fi,i(_.value.nationalIdentifier||"-"),1)]),e("div",Yi,[e("div",Bi,i(t(a)("step3.issuedBy")),1),e("div",Wi,i(_.value.passportIssuedBy||"-"),1)]),e("div",Ui,[e("div",Ri,i(t(a)("step3.lastName")),1),e("div",zi,i(_.value.lastName||"-"),1)]),e("div",ji,[e("div",qi,i(t(a)("step3.firstName")),1),e("div",Hi,i(_.value.firstName||"-"),1)]),e("div",Gi,[e("div",Ki,i(t(a)("step3.middleName")),1),e("div",Ji,i(_.value.middleName||"-"),1)]),e("div",Zi,[e("div",Qi,i(t(a)("step3.gender")),1),e("div",Xi,i(_.value.gender?t(Ee)(_.value.gender,t(l).value):"-"),1)]),e("div",eo,[e("div",to,i(t(a)("step3.country")),1),e("div",so,i(_.value.country?.langValue1||"-"),1)]),e("div",ao,[e("div",io,i(t(a)("step3.region")),1),e("div",oo,i(_.value.region?.langValue1||"-"),1)]),e("div",lo,[e("div",ro,i(t(a)("step3.district")),1),e("div",no,i(_.value.district?.langValue1||"-"),1)]),e("div",co,[e("div",uo,i(t(a)("step3.street")),1),e("div",po,i(_.value.street||"-"),1)])])])])):N("",!0)]),_:1})]))]),_:1})])])}}}),fo=te(vo,[["__scopeId","data-v-62def220"]]),ho={class:"step-container"},mo={class:"step-header"},_o={class:"step-title"},bo={class:"step-description"},yo={class:"step-content"},go={key:0,class:"info-card"},$o={class:"info-title"},So={class:"info-text"},wo={class:"actions-row"},Do=["disabled"],ko=["disabled"],xo=["disabled"],No={key:0,class:"empty-state"},Ao={key:1,class:"drivers-list"},Vo={class:"driver-header"},Oo={class:"driver-number"},Po=["onClick"],Io={class:"driver-content"},Mo=["disabled","onClick"],To={key:0,class:"driver-info"},Eo={class:"driver-info-grid"},Co={key:0,class:"info-item"},Lo={class:"info-label"},Fo={class:"info-value"},Yo={key:1,class:"info-item"},Bo={class:"info-label"},Wo={class:"info-value"},Uo={key:2,class:"info-item info-item-wide"},Ro={class:"info-label"},zo={class:"info-value"},jo={key:3,class:"info-item"},qo={class:"info-label"},Ho={class:"info-value"},Go={key:4,class:"info-item"},Ko={class:"info-label"},Jo={class:"info-value"},Zo={key:5,class:"info-item"},Qo={class:"info-label"},Xo={class:"info-value"},el={key:6,class:"info-item"},tl={class:"info-label"},sl={class:"info-value"},al={key:7,class:"info-item info-item-full"},il={class:"info-label"},ol={class:"info-value"},ll={key:8,class:"info-item"},rl={class:"info-label"},nl={class:"info-value"},cl={key:9,class:"info-item"},dl={class:"info-label"},ul={class:"info-value"},pl={key:10,class:"info-item"},vl={class:"info-label"},fl={class:"info-value"},hl={key:11,class:"info-item"},ml={class:"info-label"},_l=["value","onChange"],bl={value:""},yl=["value"],gl={key:1,class:"info-value"},$l=ee({__name:"Step4Drivers",setup(r){const o=de(),s=we(),l=fe(),{t:a,locale:h}=re(),u=I(()=>o.osgo),_=I(()=>o.owner),S=I(()=>o.applicant),g=I(()=>o.hasDriver(_.value.passportSeries,_.value.passportNumber,_.value.birthDate)),V=I(()=>o.hasDriver(S.value.passportSeries,S.value.passportNumber,S.value.birthDate)),p=()=>{if(o.isEditable)try{o.addDriver(),l.isTelegramWebApp.value&&l.hapticImpact("light"),console.log("[Step4Drivers] Driver added, total drivers:",u.value.drivers.length)}catch(y){console.error("[Step4Drivers] Error adding driver:",y),l.isTelegramWebApp.value&&l.showAlert(a("errors.driverNotFound"))}},x=()=>{if(!o.isEditable||!o.ownerVerified){l.isTelegramWebApp.value&&l.showAlert(a("validation.verifyOwner"));return}if(!_.value.passportSeries||!_.value.passportNumber||!_.value.birthDate){l.isTelegramWebApp.value&&l.showAlert(a("validation.fillAllFields"));return}try{o.addOwnerAsDriver(),l.isTelegramWebApp.value&&l.hapticImpact("medium"),console.log("[Step4Drivers] Owner added as driver, total drivers:",u.value.drivers.length)}catch(y){console.error("[Step4Drivers] Error adding owner as driver:",y),l.isTelegramWebApp.value&&l.showAlert(a("errors.driverNotFound"))}},f=()=>{o.addApplicantAsDriver(),l.isTelegramWebApp.value&&l.hapticImpact("medium")},R=y=>{o.removeDriver(y),l.isTelegramWebApp.value&&l.hapticImpact("light")},O=y=>!!(y.passportSeries&&y.passportNumber&&y.birthDate),j=async y=>{const E=u.value.drivers[y];if(O(E))try{const k=await o.verifyDriver(E);if(!k||!k.id)throw new Error("Driver not found or verification failed");o.updateDriver(y,k),l.isTelegramWebApp.value&&(l.hapticNotification("success"),l.showAlert(a("step4.driverVerified")))}catch(k){console.error("[Step4Drivers] Driver verification error:",k),l.isTelegramWebApp.value&&(l.hapticNotification("error"),l.showAlert(k?.message||a("step4.verifyError")))}},Y=(y,E)=>{const v=E.target.value,w=u.value.drivers[y];if(w){if(v){const B=s.relatives.find(ie=>ie.id===v);w.relative=B||null}else w.relative=null;o.updateDriver(y,w)}};return(y,E)=>{const k=Oe;return c(),d("div",ho,[e("div",mo,[e("h2",_o,i(t(a)("step4.title")),1),e("p",bo,i(t(a)("step4.description")),1)]),e("div",yo,[u.value.driversLimited?(c(),d(X,{key:1},[e("div",wo,[e("button",{type:"button",class:"btn btn-primary-outlined",disabled:!t(o).isEditable,onClick:p},[E[1]||(E[1]=e("i",{class:"bx bx-plus"},null,-1)),e("span",null,i(t(a)("step4.addDriver")),1)],8,Do),g.value?N("",!0):(c(),d("button",{key:0,type:"button",class:"btn btn-primary-outlined",disabled:!t(o).isEditable||!t(o).ownerVerified,onClick:x},[E[2]||(E[2]=e("i",{class:"bx bx-user"},null,-1)),e("span",null,i(t(a)("step4.ownerIsDriver")),1)],8,ko)),!u.value.applicantIsOwner&&!V.value?(c(),d("button",{key:1,type:"button",class:"btn btn-primary-outlined",disabled:!t(o).isEditable||!t(o).applicantVerified,onClick:f},[E[3]||(E[3]=e("i",{class:"bx bx-user"},null,-1)),e("span",null,i(t(a)("step4.applicantIsDriver")),1)],8,xo)):N("",!0)]),u.value.drivers.length===0?(c(),d("div",No,[E[4]||(E[4]=e("i",{class:"bx bx-user-plus"},null,-1)),e("p",null,i(t(a)("validation.addAtLeastOneDriver")),1)])):(c(),d("div",Ao,[(c(!0),d(X,null,ve(u.value.drivers,(v,w)=>(c(),d("div",{key:w,class:"driver-card"},[e("div",Vo,[e("div",Oo,[E[5]||(E[5]=e("i",{class:"bx bx-user"},null,-1)),e("span",null,i(t(a)("step4.driver"))+" "+i(w+1),1)]),t(o).isEditable?(c(),d("button",{key:0,type:"button",class:"btn-icon btn-danger",onClick:B=>R(w)},[...E[6]||(E[6]=[e("i",{class:"bx bx-trash"},null,-1)])],8,Po)):N("",!0)]),e("div",Io,[F(k,{modelValue:v.passportSeries,"onUpdate:modelValue":B=>v.passportSeries=B,label:t(a)("step4.passportSeries"),placeholder:t(a)("step4.passportSeriesPlaceholder"),disabled:!t(o).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","onUpdate:modelValue","label","placeholder","disabled"]),F(k,{modelValue:v.passportNumber,"onUpdate:modelValue":B=>v.passportNumber=B,label:t(a)("step4.passportNumber"),placeholder:t(a)("step4.passportNumberPlaceholder"),disabled:!t(o).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","onUpdate:modelValue","label","placeholder","disabled"]),F(k,{modelValue:v.birthDate,"onUpdate:modelValue":B=>v.birthDate=B,label:t(a)("step4.birthDate"),type:"text","date-mask":"",placeholder:t(a)("step4.birthDatePlaceholder"),disabled:!t(o).isEditable,required:""},null,8,["modelValue","onUpdate:modelValue","label","placeholder","disabled"]),e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!O(v),onClick:B=>j(w)},[E[7]||(E[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,i(v.name?t(a)("step4.verified"):t(a)("step4.verify")),1)],8,Mo),F(oe,{name:"fade"},{default:le(()=>[v.id?(c(),d("div",To,[e("div",Eo,[v.passportIssueDate?(c(),d("div",Co,[e("div",Lo,i(t(a)("step3.passportIssueDate")),1),e("div",Fo,i(t(xe)(v.passportIssueDate)),1)])):N("",!0),v.pinfl?(c(),d("div",Yo,[e("div",Bo,i(t(a)("step3.pinfl")),1),e("div",Wo,i(v.pinfl),1)])):N("",!0),v.passportIssuedBy?(c(),d("div",Uo,[e("div",Ro,i(t(a)("step3.issuedBy")),1),e("div",zo,i(v.passportIssuedBy),1)])):N("",!0),v.lastName?(c(),d("div",jo,[e("div",qo,i(t(a)("step3.lastName")),1),e("div",Ho,i(v.lastName),1)])):N("",!0),v.firstName?(c(),d("div",Go,[e("div",Ko,i(t(a)("step3.firstName")),1),e("div",Jo,i(v.firstName),1)])):N("",!0),v.middleName?(c(),d("div",Zo,[e("div",Qo,i(t(a)("step3.middleName")),1),e("div",Xo,i(v.middleName),1)])):N("",!0),v.gender?(c(),d("div",el,[e("div",tl,i(t(a)("step3.gender")),1),e("div",sl,i(t(Ee)(v.gender,t(h).value)),1)])):N("",!0),v.address?(c(),d("div",al,[e("div",il,i(t(a)("step3.address")),1),e("div",ol,i(v.address),1)])):N("",!0),v.licenseSeries?(c(),d("div",ll,[e("div",rl,i(t(a)("step4.licenseSeries")),1),e("div",nl,i(v.licenseSeries),1)])):N("",!0),v.licenseNumber?(c(),d("div",cl,[e("div",dl,i(t(a)("step4.licenseNumber")),1),e("div",ul,i(v.licenseNumber),1)])):N("",!0),v.licenseDate?(c(),d("div",pl,[e("div",vl,i(t(a)("step4.licenseDate")),1),e("div",fl,i(t(xe)(v.licenseDate)),1)])):N("",!0),t(s).relatives.length>0?(c(),d("div",hl,[e("div",ml,i(t(a)("step4.relationship")),1),t(o).isEditable?(c(),d("select",{key:0,value:v.relative?.id||"",class:"info-select",onChange:B=>Y(w,B)},[e("option",bl,i(t(a)("step4.selectRelationship")),1),(c(!0),d(X,null,ve(t(s).relatives,B=>(c(),d("option",{key:B.id,value:B.id},i(t(Ue)(B)),9,yl))),128))],40,_l)):(c(),d("div",gl,i(v.relative?t(Ue)(v.relative):"-"),1))])):N("",!0)])])):N("",!0)]),_:2},1024)])]))),128))]))],64)):(c(),d("div",go,[E[0]||(E[0]=e("i",{class:"bx bx-info-circle"},null,-1)),e("div",null,[e("div",$o,i(t(a)("step4.unlimitedDriversTitle")),1),e("div",So,i(t(a)("step4.unlimitedDriversDesc")),1)])]))])])}}}),Sl=te($l,[["__scopeId","data-v-a1a9d331"]]),wl={class:"step-container"},Dl={class:"step-header"},kl={class:"step-title"},xl={class:"step-description"},Nl={class:"step-content"},Al={class:"summary-section"},Vl={class:"section-title"},Ol={class:"summary-card"},Pl={class:"card-title"},Il={class:"card-content"},Ml={class:"info-row"},Tl={class:"info-value-full"},El={class:"summary-card"},Cl={class:"card-title"},Ll={class:"card-content"},Fl={class:"info-row"},Yl={class:"info-value-full"},Bl={class:"summary-card"},Wl={class:"card-title"},Ul={class:"card-content"},Rl={class:"info-row"},zl={class:"info-value-full"},jl={class:"summary-card"},ql={class:"card-title"},Hl={class:"card-content"},Gl={class:"info-row"},Kl={class:"info-value-full"},Jl={class:"info-row"},Zl={class:"info-value-full"},Ql={class:"info-row"},Xl={class:"info-value-full"},er={class:"summary-card"},tr={class:"card-title"},sr={class:"card-content"},ar={class:"info-row"},ir={class:"info-value-full"},or={class:"summary-section"},lr={class:"section-title"},rr={class:"form-section"},nr={class:"form-section"},cr={key:0,class:"form-section"},dr={class:"premium-section"},ur={class:"premium-card-large"},pr={class:"premium-header"},vr={class:"premium-amount-large"},fr=ee({__name:"Step5Summary",setup(r){const o=x=>x.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "),s=de(),l=we();fe(),Ae();const a=I(()=>s.osgo),h=I(()=>s.owner),u=I(()=>s.applicant);I(()=>s.fundData),L(!1);const _=I({get:()=>(a.value.applicantIsOwner?h.value:u.value).phone||"",set:x=>{a.value.applicantIsOwner?(h.value.phone=x,a.value.party=h.value):(u.value.phone=x,a.value.party=u.value)}}),{locale:S,t:g}=re(),V=()=>a.value.period?l.getLocalizedName(a.value.period,S.value||"uz"):"-",p=()=>a.value.drivedArea?l.getLocalizedName(a.value.drivedArea,S.value||"uz"):"-";return(x,f)=>{const R=Oe;return c(),d("div",wl,[e("div",Dl,[e("h2",kl,i(t(g)("step5.title")),1),e("p",xl,i(t(g)("step5.description")),1)]),e("div",Nl,[e("div",Al,[e("h3",Vl,[f[2]||(f[2]=e("i",{class:"bx bx-file-blank"},null,-1)),e("span",null,i(t(g)("step5.policyInfo")),1)]),e("div",Ol,[e("div",Pl,i(t(g)("step3.owner")),1),e("div",Il,[e("div",Ml,[e("span",Tl,i(h.value.name||"-")+i(h.value.birthDate?` (${h.value.birthDate})`:""),1)])])]),e("div",El,[e("div",Cl,i(t(g)("step3.applicant")),1),e("div",Ll,[e("div",Fl,[e("span",Yl,i((a.value.applicantIsOwner?h.value:u.value).name||"-")+i((a.value.applicantIsOwner?h.value:u.value).birthDate?` (${(a.value.applicantIsOwner?h.value:u.value).birthDate})`:""),1)])])]),e("div",Bl,[e("div",Wl,i(t(g)("step5.vehicleInfo")),1),e("div",Ul,[e("div",Rl,[e("span",zl,i(a.value.vehicle?.modelName||a.value.vehicle?.model||"-")+" "+i(a.value.vehicle?.govNumber?` (${a.value.vehicle.govNumber})`:""),1)])])]),e("div",jl,[e("div",ql,i(t(g)("step5.policyInfo")),1),e("div",Hl,[e("div",Gl,[e("span",Kl,i(V()),1)]),e("div",Jl,[e("span",Zl,i(p()),1)]),e("div",Ql,[e("span",Xl,i(a.value.driversLimited?t(g)("step5.driversLimited",{count:a.value.drivers?.length||0}):t(g)("step5.noDriversLimitation")),1)])])]),e("div",er,[e("div",tr,i(t(g)("step5.compensation")),1),e("div",sr,[e("div",ar,[e("span",ir,i(o(t(Te)))+" сум",1)])])])]),e("div",or,[e("h3",lr,[f[3]||(f[3]=e("i",{class:"bx bx-phone"},null,-1)),e("span",null,i(t(g)("step5.contactInfo")),1)]),e("div",rr,[F(R,{modelValue:_.value,"onUpdate:modelValue":f[0]||(f[0]=O=>_.value=O),label:t(g)("step5.phone"),placeholder:t(g)("step5.phonePlaceholder"),type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!t(s).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",nr,[F(R,{modelValue:a.value.contractStartDate,"onUpdate:modelValue":f[1]||(f[1]=O=>a.value.contractStartDate=O),label:t(g)("step5.startDate"),type:"text","date-mask":"",placeholder:t(g)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:!t(s).isEditable,required:""},null,8,["modelValue","label","placeholder","disabled"])]),a.value.contractEndDate?(c(),d("div",cr,[F(R,{"model-value":a.value.contractEndDate,label:t(g)("step5.endDate"),type:"text","date-mask":"",placeholder:t(g)("step5.startDatePlaceholder"),icon:"bx bx-calendar",disabled:""},null,8,["model-value","label","placeholder"])])):N("",!0)]),e("div",dr,[e("div",ur,[e("div",pr,[f[4]||(f[4]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,i(t(g)("step5.premium")),1)]),e("div",vr,i(t(Le)(t(s).calculatedPremium))+" сум ",1)])])])])}}}),hr=te(fr,[["__scopeId","data-v-ad4e13fe"]]),mr={class:"step-container"},_r={class:"step-header"},br={class:"step-title"},yr={class:"step-description"},gr={class:"step-content"},$r={class:"premium-section"},Sr={class:"premium-card-large"},wr={class:"premium-header"},Dr={class:"premium-amount-large"},kr={class:"payment-section"},xr={class:"section-title"},Nr={class:"payment-buttons"},Ar=["disabled"],Vr={key:0,class:"payment-selected-indicator"},Or=["disabled"],Pr={key:0,class:"payment-selected-indicator"},Ir=["disabled"],Mr={key:0,class:"payment-selected-indicator"},Tr={class:"status-section"},Er=["disabled"],Cr={key:0,class:"ml-1"},Lr={key:0,class:"error-message mt-2"},Fr={key:0,class:"success-card"},Yr={class:"success-title"},Br={class:"success-description"},Wr={class:"policy-details"},Ur={class:"policy-row"},Rr={class:"policy-label"},zr={class:"policy-value"},jr={class:"policy-row"},qr={class:"policy-label"},Hr={class:"policy-value"},Gr=ee({__name:"Step6Payment",setup(r){const o=de(),s=fe();Ae();const{t:l,locale:a}=re(),h=I(()=>o.osgo),u=I(()=>o.fundData);I(()=>(h.value.applicantIsOwner?o.owner:o.applicant).phone||"");const _=L(!1),S=L(null),g=L(0),V=L(null);let p=null;const x=I({get:()=>o.selectedPaymentMethod,set:Y=>{o.selectedPaymentMethod=Y}}),f=I(()=>{if(!V.value)return"";const Y=V.value.toLowerCase(),y=a.value,E=y==="ru"?["оплачен","успешно","завершена"]:["to'langan","muvaffaqiyatli","yakunlandi"],k=y==="ru"?["ошибка","не получена"]:["xato","olindi"];return E.some(v=>Y.includes(v))?"status-success":k.some(v=>Y.includes(v))?"status-error":"status-info"}),R=I(()=>f.value==="status-success"?"bx bx-check-circle":f.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),O=Y=>{x.value===Y?x.value=null:x.value=Y,s.isTelegramWebApp.value&&s.hapticImpact("light")},j=async()=>{if(!h.value.id){S.value=l("errors.createApplicationFailed");return}try{_.value=!0,S.value=null,V.value=null,s.isTelegramWebApp.value&&s.hapticImpact("light"),await o.fetchFundData(),u.value?.seria&&u.value?.number?(V.value=l("step5.paymentSuccess"),s.isTelegramWebApp.value&&s.hapticNotification("success")):u.value?V.value=l("step5.paymentProcessing"):V.value=l("step5.paymentNotReceived"),g.value=15,p&&clearInterval(p),p=window.setInterval(()=>{g.value>0?g.value--:p&&(clearInterval(p),p=null)},1e3)}catch(Y){console.error("[Step6Payment] Check status error:",Y),S.value=Y.message||l("errors.paymentFailed"),V.value=l("errors.paymentFailed"),s.isTelegramWebApp.value&&s.hapticNotification("error")}finally{_.value=!1}};return Xe(()=>{p&&clearInterval(p)}),(Y,y)=>(c(),d("div",mr,[e("div",_r,[e("h2",br,i(t(l)("step5.payment")),1),e("p",yr,i(t(l)("step5.paymentDescription")),1)]),e("div",gr,[e("div",$r,[e("div",Sr,[e("div",wr,[y[3]||(y[3]=e("i",{class:"bx bx-shield-alt-2"},null,-1)),e("span",null,i(t(l)("step5.premium")),1)]),e("div",Dr,i(t(Le)(t(o).calculatedPremium))+" сум ",1)])]),e("div",kr,[e("h3",xr,[y[4]||(y[4]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,i(t(l)("step5.paymentMethod")),1)]),e("div",Nr,[e("button",{type:"button",class:ae(["payment-btn payme",{"payment-btn-selected":x.value==="payme"}]),disabled:_.value,onClick:y[0]||(y[0]=E=>O("payme"))},[y[6]||(y[6]=e("div",{class:"payment-icon"},"💳",-1)),y[7]||(y[7]=e("div",{class:"payment-name"},"Payme",-1)),x.value==="payme"?(c(),d("div",Vr,[...y[5]||(y[5]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):N("",!0)],10,Ar),e("button",{type:"button",class:ae(["payment-btn click",{"payment-btn-selected":x.value==="click"}]),disabled:_.value,onClick:y[1]||(y[1]=E=>O("click"))},[y[9]||(y[9]=e("div",{class:"payment-icon"},"🔵",-1)),y[10]||(y[10]=e("div",{class:"payment-name"},"Click",-1)),x.value==="click"?(c(),d("div",Pr,[...y[8]||(y[8]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):N("",!0)],10,Or),e("button",{type:"button",class:ae(["payment-btn uzum",{"payment-btn-selected":x.value==="uzum"}]),disabled:_.value,onClick:y[2]||(y[2]=E=>O("uzum"))},[y[12]||(y[12]=e("div",{class:"payment-icon"},"🟣",-1)),y[13]||(y[13]=e("div",{class:"payment-name"},"Uzum",-1)),x.value==="uzum"?(c(),d("div",Mr,[...y[11]||(y[11]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):N("",!0)],10,Ir)])]),e("div",Tr,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!g.value||_.value||!h.value.id,onClick:j},[y[14]||(y[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,i(t(l)("step5.checkStatus")),1),g.value?(c(),d("span",Cr,"("+i(g.value)+")",1)):N("",!0)],8,Er),F(oe,{name:"fade"},{default:le(()=>[S.value?(c(),d("div",Lr,[y[15]||(y[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,i(S.value),1)])):N("",!0)]),_:1}),F(oe,{name:"fade"},{default:le(()=>[V.value?(c(),d("div",{key:0,class:ae(["status-text",f.value])},[e("i",{class:ae(R.value)},null,2),e("span",null,i(V.value),1)],2)):N("",!0)]),_:1})]),F(oe,{name:"fade"},{default:le(()=>[h.value.id&&u.value&&u.value.seria?(c(),d("div",Fr,[y[16]||(y[16]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),e("h3",Yr,i(t(l)("step5.success")),1),e("p",Br,i(t(l)("step5.policyIssued")),1),e("div",Wr,[e("div",Ur,[e("span",Rr,i(t(l)("step5.policySeries"))+":",1),e("span",zr,i(u.value.seria),1)]),e("div",jr,[e("span",qr,i(t(l)("step5.policyNumber"))+":",1),e("span",Hr,i(u.value.number),1)])])])):N("",!0)]),_:1})])]))}}),Kr=te(Gr,[["__scopeId","data-v-f963a176"]]),Jr={class:"min-h-screen flex flex-col"},Zr={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},Qr={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},Xr={class:"max-w-3xl mx-auto"},en={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},tn=ee({__name:"index",setup(r){const o=de(),s=we(),l=fe();return Ve(async()=>{console.log("[IndexPage] Mounted"),await s.lazyFetch(),o.initialize(),o.loadFromSession()&&console.log("[IndexPage] Restored data from session"),l.isTelegramWebApp.value&&l.showBackButton(()=>{o.currentStep>0?o.previousStep():l.close()});const h=ge(()=>o.osgo,()=>{o.saveToSession()},{deep:!0});Be(()=>{h()})}),Be(()=>{o.saveToSession(),l.isTelegramWebApp.value&&(l.hideBackButton(),l.hideMainButton())}),et({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,h)=>(c(),d("div",Jr,[e("header",Zr,[F(Dt)]),e("main",Qr,[e("div",Xr,[F(oe,{name:"fade",mode:"out-in"},{default:le(()=>[t(o).currentStep===t(U).PARAMS?(c(),ce(Ns,{key:t(U).PARAMS})):t(o).currentStep===t(U).VEHICLE?(c(),ce($a,{key:t(U).VEHICLE})):t(o).currentStep===t(U).OWNER?(c(),ce(fo,{key:t(U).OWNER})):t(o).currentStep===t(U).DRIVERS?(c(),ce(Sl,{key:t(U).DRIVERS})):t(o).currentStep===t(U).SUMMARY?(c(),ce(hr,{key:t(U).SUMMARY})):t(o).currentStep===t(U).PAYMENT?(c(),ce(Kr,{key:t(U).PAYMENT})):N("",!0)]),_:1})])]),e("footer",en,[F(Lt)])]))}}),nn=te(tn,[["__scopeId","data-v-8561f7bb"]]);export{nn as default};
