import{e as Ue,f as we,g as Ne,r as Y,S as W,h as A,C as Ie,i as ye,j as Te,k as X,l as ge,m as Re,n as Ae,c as v,o as u,F as ae,p as fe,q as i,s as se,t as c,a as e,v as je,b as F,x as ze,y as ve,z as I,A as Ye,d as _e,T as ie,w as le,B as Ee,D as He,E as re,G as qe,H as Ge,I as Je,J as Ze,K as Fe,u as Ke}from"./DLs_pXcx.js";import{_ as ee}from"./DlAUqK2U.js";import{_ as Qe}from"./DgM-zN9R.js";function Xe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xe={exports:{}},et=xe.exports,Be;function tt(){return Be||(Be=1,(function(r,s){(function(t,o){r.exports=o()})(et,(function(){var t=1e3,o=6e4,a=36e5,b="millisecond",p="second",_="minute",w="hour",y="day",d="week",l="month",V="quarter",$="year",E="date",P="Invalid Date",C=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,R={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(D){var g=["th","st","nd","rd"],m=D%100;return"["+D+(g[(m-20)%10]||g[m]||g[0])+"]"}},G=function(D,g,m){var S=String(D);return!S||S.length>=g?D:""+Array(g+1-S.length).join(m)+D},T={s:G,z:function(D){var g=-D.utcOffset(),m=Math.abs(g),S=Math.floor(m/60),h=m%60;return(g<=0?"+":"-")+G(S,2,"0")+":"+G(h,2,"0")},m:function D(g,m){if(g.date()<m.date())return-D(m,g);var S=12*(m.year()-g.year())+(m.month()-g.month()),h=g.clone().add(S,l),M=m-h<0,O=g.clone().add(S+(M?-1:1),l);return+(-(S+(m-h)/(M?h-O:O-h))||0)},a:function(D){return D<0?Math.ceil(D)||0:Math.floor(D)},p:function(D){return{M:l,y:$,w:d,d:y,D:E,h:w,m:_,s:p,ms:b,Q:V}[D]||String(D||"").toLowerCase().replace(/s$/,"")},u:function(D){return D===void 0}},x="en",N={};N[x]=R;var Z="$isDayjsObject",oe=function(D){return D instanceof me||!(!D||!D[Z])},te=function D(g,m,S){var h;if(!g)return x;if(typeof g=="string"){var M=g.toLowerCase();N[M]&&(h=M),m&&(N[M]=m,h=M);var O=g.split("-");if(!h&&O.length>1)return D(O[0])}else{var B=g.name;N[B]=g,h=B}return!S&&h&&(x=h),h||!S&&x},z=function(D,g){if(oe(D))return D.clone();var m=typeof g=="object"?g:{};return m.date=D,m.args=arguments,new me(m)},L=T;L.l=te,L.i=oe,L.w=function(D,g){return z(D,{locale:g.$L,utc:g.$u,x:g.$x,$offset:g.$offset})};var me=(function(){function D(m){this.$L=te(m.locale,null,!0),this.parse(m),this.$x=this.$x||m.x||{},this[Z]=!0}var g=D.prototype;return g.parse=function(m){this.$d=(function(S){var h=S.date,M=S.utc;if(h===null)return new Date(NaN);if(L.u(h))return new Date;if(h instanceof Date)return new Date(h);if(typeof h=="string"&&!/Z$/i.test(h)){var O=h.match(C);if(O){var B=O[2]-1||0,U=(O[7]||"0").substring(0,3);return M?new Date(Date.UTC(O[1],B,O[3]||1,O[4]||0,O[5]||0,O[6]||0,U)):new Date(O[1],B,O[3]||1,O[4]||0,O[5]||0,O[6]||0,U)}}return new Date(h)})(m),this.init()},g.init=function(){var m=this.$d;this.$y=m.getFullYear(),this.$M=m.getMonth(),this.$D=m.getDate(),this.$W=m.getDay(),this.$H=m.getHours(),this.$m=m.getMinutes(),this.$s=m.getSeconds(),this.$ms=m.getMilliseconds()},g.$utils=function(){return L},g.isValid=function(){return this.$d.toString()!==P},g.isSame=function(m,S){var h=z(m);return this.startOf(S)<=h&&h<=this.endOf(S)},g.isAfter=function(m,S){return z(m)<this.startOf(S)},g.isBefore=function(m,S){return this.endOf(S)<z(m)},g.$g=function(m,S,h){return L.u(m)?this[S]:this.set(h,m)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(m,S){var h=this,M=!!L.u(S)||S,O=L.p(m),B=function(de,J){var ne=L.w(h.$u?Date.UTC(h.$y,J,de):new Date(h.$y,J,de),h);return M?ne:ne.endOf(y)},U=function(de,J){return L.w(h.toDate()[de].apply(h.toDate("s"),(M?[0,0,0,0]:[23,59,59,999]).slice(J)),h)},H=this.$W,q=this.$M,K=this.$D,pe="set"+(this.$u?"UTC":"");switch(O){case $:return M?B(1,0):B(31,11);case l:return M?B(1,q):B(0,q+1);case d:var ue=this.$locale().weekStart||0,he=(H<ue?H+7:H)-ue;return B(M?K-he:K+(6-he),q);case y:case E:return U(pe+"Hours",0);case w:return U(pe+"Minutes",1);case _:return U(pe+"Seconds",2);case p:return U(pe+"Milliseconds",3);default:return this.clone()}},g.endOf=function(m){return this.startOf(m,!1)},g.$set=function(m,S){var h,M=L.p(m),O="set"+(this.$u?"UTC":""),B=(h={},h[y]=O+"Date",h[E]=O+"Date",h[l]=O+"Month",h[$]=O+"FullYear",h[w]=O+"Hours",h[_]=O+"Minutes",h[p]=O+"Seconds",h[b]=O+"Milliseconds",h)[M],U=M===y?this.$D+(S-this.$W):S;if(M===l||M===$){var H=this.clone().set(E,1);H.$d[B](U),H.init(),this.$d=H.set(E,Math.min(this.$D,H.daysInMonth())).$d}else B&&this.$d[B](U);return this.init(),this},g.set=function(m,S){return this.clone().$set(m,S)},g.get=function(m){return this[L.p(m)]()},g.add=function(m,S){var h,M=this;m=Number(m);var O=L.p(S),B=function(q){var K=z(M);return L.w(K.date(K.date()+Math.round(q*m)),M)};if(O===l)return this.set(l,this.$M+m);if(O===$)return this.set($,this.$y+m);if(O===y)return B(1);if(O===d)return B(7);var U=(h={},h[_]=o,h[w]=a,h[p]=t,h)[O]||1,H=this.$d.getTime()+m*U;return L.w(H,this)},g.subtract=function(m,S){return this.add(-1*m,S)},g.format=function(m){var S=this,h=this.$locale();if(!this.isValid())return h.invalidDate||P;var M=m||"YYYY-MM-DDTHH:mm:ssZ",O=L.z(this),B=this.$H,U=this.$m,H=this.$M,q=h.weekdays,K=h.months,pe=h.meridiem,ue=function(J,ne,be,Se){return J&&(J[ne]||J(S,M))||be[ne].slice(0,Se)},he=function(J){return L.s(B%12||12,J,"0")},de=pe||function(J,ne,be){var Se=J<12?"AM":"PM";return be?Se.toLowerCase():Se};return M.replace(f,(function(J,ne){return ne||(function(be){switch(be){case"YY":return String(S.$y).slice(-2);case"YYYY":return L.s(S.$y,4,"0");case"M":return H+1;case"MM":return L.s(H+1,2,"0");case"MMM":return ue(h.monthsShort,H,K,3);case"MMMM":return ue(K,H);case"D":return S.$D;case"DD":return L.s(S.$D,2,"0");case"d":return String(S.$W);case"dd":return ue(h.weekdaysMin,S.$W,q,2);case"ddd":return ue(h.weekdaysShort,S.$W,q,3);case"dddd":return q[S.$W];case"H":return String(B);case"HH":return L.s(B,2,"0");case"h":return he(1);case"hh":return he(2);case"a":return de(B,U,!0);case"A":return de(B,U,!1);case"m":return String(U);case"mm":return L.s(U,2,"0");case"s":return String(S.$s);case"ss":return L.s(S.$s,2,"0");case"SSS":return L.s(S.$ms,3,"0");case"Z":return O}return null})(J)||O.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(m,S,h){var M,O=this,B=L.p(S),U=z(m),H=(U.utcOffset()-this.utcOffset())*o,q=this-U,K=function(){return L.m(O,U)};switch(B){case $:M=K()/12;break;case l:M=K();break;case V:M=K()/3;break;case d:M=(q-H)/6048e5;break;case y:M=(q-H)/864e5;break;case w:M=q/a;break;case _:M=q/o;break;case p:M=q/t;break;default:M=q}return h?M:L.a(M)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return N[this.$L]},g.locale=function(m,S){if(!m)return this.$L;var h=this.clone(),M=te(m,S,!0);return M&&(h.$L=M),h},g.clone=function(){return L.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},D})(),$e=me.prototype;return z.prototype=$e,[["$ms",b],["$s",p],["$m",_],["$H",w],["$W",y],["$M",l],["$y",$],["$D",E]].forEach((function(D){$e[D[1]]=function(g){return this.$g(g,D[0],D[1])}})),z.extend=function(D,g){return D.$i||(D(g,me,z),D.$i=!0),z},z.locale=te,z.isDayjs=oe,z.unix=function(D){return z(1e3*D)},z.en=N[x],z.Ls=N,z.p={},z}))})(xe)),xe.exports}var st=tt();const De=Xe(st),ce=Ue("osgo",()=>{const r=we(),s=Ne(),t=Y({status:"DRAFT",vehicle:null,party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:De().format("YYYY-MM-DD"),premium:0}),o=Y({passportSeries:"",passportNumber:"",birthDate:""}),a=Y({passportSeries:"",passportNumber:"",birthDate:""}),b=Y(W.PARAMS),p=Y(!1),_=Y(null),w=Y(!1),y=Y(null),d=Y(null),l=Y(null),V=Y(!1),$=Y(null),E=Y(!1),P=Y(!1),C=Y(null),f=Y(!1),R=Y(!1),G=Y(null),T=Y(!1),x=Y(!1),N=Y(null),Z=A(()=>t.value.status==="DRAFT"),oe=A(()=>q(b.value).valid),te=A(()=>Object.keys(W).length),z=A(()=>Math.round((b.value+1)/te.value*100)),L=A(()=>{if(!t.value.vehicle?.carType||!t.value.period||!t.value.drivedArea)return 0;const n=t.value.vehicle.carType.tariffCompany||0,k=t.value.period.coefficient||0,j=t.value.drivedArea.coefficient||0;let Q=3;t.value.driversLimited&&t.value.incidentCoeff&&(Q=t.value.incidentCoeff);const ke=n*k*Q*j,Me=ke>5*n?Ie*5*n:Ie*ke/100;return Math.round(Me)}),me=A(()=>{const k=(t.value.entriesJournalKt||[]).reduce((j,Q)=>j+(Q.amount||0),0);return t.value.premium-k}),$e=()=>{t.value={status:"DRAFT",vehicle:{govNumber:"",techPassportSeries:"",techPassportNumber:""},party:null,beneficiary:null,applicantIsOwner:!0,drivers:[],driversLimited:!1,contractStartDate:De().format("YYYY-MM-DD"),premium:0},o.value={passportSeries:"",passportNumber:"",birthDate:""},a.value={passportSeries:"",passportNumber:"",birthDate:""},b.value=W.PARAMS,r.isLoaded&&(t.value.discountType=r.getDefaultDiscountType())};ye(()=>[t.value.contractStartDate,t.value.period],()=>{if(!t.value.contractStartDate||!t.value.period)return;let n=De(t.value.contractStartDate);t.value.period.periodType==="ONE_YEAR"||t.value.period.periodType==="SEASON"?n=n.add(t.value.period.months||0,"months"):t.value.period.periodType==="TILL_REGISTRATION"&&(n=n.add(t.value.period.days||0,"days")),t.value.contractEndDate=n.subtract(1,"days").format("YYYY-MM-DD")}),ye(()=>t.value.period,n=>{n&&(t.value.periodType=n.periodType)}),ye(()=>t.value.vehicle?.govNumber,n=>{if(!n||n.length<2)return;const k=parseInt(n.slice(0,2)),j=r.findDrivedAreaByRegion(k);j&&(t.value.drivedArea=j)}),ye(()=>[t.value.vehicle?.carType,t.value.period,t.value.driversLimited,t.value.incidentCoeff,t.value.drivedArea],()=>{t.value.premium=L.value},{deep:!0}),ye(()=>t.value.driversLimited,n=>{n||(t.value.incidentCoeff=void 0)});const D=async()=>{if(t.value.vehicle){E.value=!0,C.value=null,P.value=!1;try{const n=await s.getVehicle({govNumber:t.value.vehicle.govNumber,techPassportSeries:t.value.vehicle.techPassportSeries,techPassportNumber:t.value.vehicle.techPassportNumber}),k=n?.result||n;if(n?.error&&!k)throw new Error(n.error.message||"Failed to verify vehicle");n?.error&&k&&console.warn("[OsgoStore] Vehicle verification returned error but also has result:",n.error),Object.assign(t.value.vehicle,k),k?.carType&&r.isLoaded&&(t.value.vehicle.carType=r.findCarType(k.carType.id)),P.value=!0,console.log("[OsgoStore] Vehicle verified:",k)}catch(n){throw C.value=n.message||"Failed to verify vehicle",console.error("[OsgoStore] Vehicle verification failed:",n),n}finally{E.value=!1}}},g=async()=>{f.value=!0,G.value=null,R.value=!1;try{const n=await s.getIndividualByPassport({passportSeries:o.value.passportSeries?.toUpperCase()||"",passportNumber:o.value.passportNumber,birthDate:o.value.birthDate});console.log("[OsgoStore] API result:",n),console.log("[OsgoStore] Result has id?",!!n?.id),n&&(o.value={passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate,...n},t.value.beneficiary={...o.value},t.value.applicantIsOwner&&(a.value={passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate,...n},t.value.party={...o.value},x.value=!0)),R.value=!0,console.log("[OsgoStore] Owner after assignment:",o.value),console.log("[OsgoStore] Owner has id?",!!o.value.id)}catch(n){throw G.value=n.message||"Failed to verify owner",console.error("[OsgoStore] Owner verification failed:",n),n}finally{f.value=!1}},m=async()=>{T.value=!0,N.value=null,x.value=!1;try{const n=await s.getIndividualByPassport({passportSeries:a.value.passportSeries?.toUpperCase()||"",passportNumber:a.value.passportNumber,birthDate:a.value.birthDate});console.log("[OsgoStore] API result for applicant:",n),n&&(a.value={passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate,...n},t.value.party={...a.value}),x.value=!0,console.log("[OsgoStore] Applicant after assignment:",a.value)}catch(n){throw N.value=n.message||"Failed to verify applicant",console.error("[OsgoStore] Applicant verification failed:",n),n}finally{T.value=!1}},S=async n=>{try{const k=await s.getDriver({passportSeries:n.passportSeries?.toUpperCase()||"",passportNumber:n.passportNumber,birthDate:n.birthDate});return{...n,...k}}catch(k){throw console.error("[OsgoStore] Driver verification failed:",k),k}},h=n=>{const k={passportSeries:n?.passportSeries||"",passportNumber:n?.passportNumber||"",birthDate:n?.birthDate||""};t.value.drivers.push(k)},M=(n,k)=>{t.value.drivers[n]&&(t.value.drivers[n]=k)},O=n=>{t.value.drivers.splice(n,1)},B=(n,k,j)=>t.value.drivers.some(Q=>Q.passportSeries===n&&Q.passportNumber===k&&Q.birthDate===j),U=()=>{B(o.value.passportSeries,o.value.passportNumber,o.value.birthDate)||h({passportSeries:o.value.passportSeries,passportNumber:o.value.passportNumber,birthDate:o.value.birthDate})},H=()=>{B(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)||h({passportSeries:a.value.passportSeries,passportNumber:a.value.passportNumber,birthDate:a.value.birthDate})},q=n=>{switch(n){case W.PARAMS:return{valid:!!(t.value.vehicle?.carType&&t.value.period&&t.value.drivedArea&&(!t.value.driversLimited||t.value.incidentCoeff))};case W.VEHICLE:return{valid:P.value};case W.OWNER:return{valid:R.value&&(t.value.applicantIsOwner||x.value)};case W.DRIVERS:return{valid:!t.value.driversLimited||t.value.drivers.length>0};case W.SUMMARY:const k=t.value.applicantIsOwner?o.value.id:a.value.id;return{valid:!!(o.value.id&&k&&t.value.vehicle?.id&&(!t.value.driversLimited||t.value.drivers?.length&&t.value.drivers.every(j=>j.id))&&t.value.party?.phone&&t.value.party.phone.replace(/[+()-]/g,"").length===12&&t.value.contractStartDate)};case W.PAYMENT:return{valid:!!(t.value.id&&$.value)};default:return{valid:!1}}};return{osgo:t,owner:o,applicant:a,currentStep:b,saving:p,saveError:_,fetching:w,fetchError:y,fundData:d,fundError:l,fetchingFundData:V,selectedPaymentMethod:$,vehicleVerifying:E,vehicleVerified:P,vehicleVerifyError:C,ownerVerifying:f,ownerVerified:R,ownerVerifyError:G,applicantVerifying:T,applicantVerified:x,applicantVerifyError:N,isEditable:Z,canProceedToNextStep:oe,totalSteps:te,progressPercentage:z,calculatedPremium:L,amountPayable:me,initialize:$e,verifyVehicle:D,verifyOwner:g,verifyApplicant:m,verifyDriver:S,addDriver:h,updateDriver:M,removeDriver:O,hasDriver:B,addOwnerAsDriver:U,addApplicantAsDriver:H,validateStepData:q,nextStep:()=>{b.value<te.value-1&&b.value++},previousStep:()=>{b.value>0&&b.value--},goToStep:n=>{n>=0&&n<te.value&&(b.value=n)},createPolicy:async()=>{p.value=!0,_.value=null;try{let n=null;try{n=await s.fetchUserInfo(),console.log("[OsgoStore] User info fetched:",n)}catch(Pe){console.warn("[OsgoStore] Failed to fetch user info, using minimal user object:",Pe),n={id:void 0,login:void 0,name:null,firstName:null,middleName:null,lastName:null,position:null,email:null,timeZone:"Asia/Tashkent",language:"ru",locale:"ru",_instanceName:""}}const k=t.value.applicantIsOwner?{...o.value}:{...a.value};k.phone&&(k.phone=k.phone.replace(/[+()-]/g,""));const j={...o.value},Q=t.value.discountType||r.meta?.beneficiary?.find(({coefficient:Pe})=>Pe===1),ke={party:k,beneficiary:j,vehicle:t.value.vehicle,period:t.value.period,drivedArea:t.value.drivedArea,discountType:Q,drivers:t.value.drivers||[],contractStartDate:t.value.contractStartDate,contractEndDate:t.value.contractEndDate,status:t.value.status||"DRAFT",applicantIsOwner:t.value.applicantIsOwner??!0,periodType:t.value.periodType||t.value.period?.periodType||"ONE_YEAR",premium:t.value.premium||0,driversLimited:t.value.driversLimited??!1,incidentCoeff:t.value.incidentCoeff},Me={user:n,osgo:ke};console.log("[OsgoStore] Creating policy with payload structure:",{user:{id:n?.id,login:n?.login},osgo:{party:{id:k.id,name:k.name},beneficiary:{id:j.id,name:j.name},vehicle:{id:t.value.vehicle?.id,govNumber:t.value.vehicle?.govNumber},period:{id:t.value.period?.id},drivedArea:{id:t.value.drivedArea?.id},discountType:{id:Q?.id}}});const Oe=await s.createOsgoApplication(Me);return t.value.id=Oe,t.value.applicantIsOwner?(o.value.phone=k.phone,t.value.party=o.value):(a.value.phone=k.phone,t.value.party=a.value),console.log("[OsgoStore] Policy created:",Oe),Oe}catch(n){throw _.value=n.message||"Failed to create policy",console.error("[OsgoStore] Policy creation failed:",n),n}finally{p.value=!1}},updatePolicy:async()=>{if(!t.value.id)throw new Error("Policy ID is required for update");p.value=!0,_.value=null;try{const n={...t.value,party:t.value.applicantIsOwner?o.value:a.value,beneficiary:o.value};await s.updateOsgoApplication(n),console.log("[OsgoStore] Policy updated")}catch(n){throw _.value=n.message||"Failed to update policy",console.error("[OsgoStore] Policy update failed:",n),n}finally{p.value=!1}},fetchPolicy:async n=>{w.value=!0,y.value=null;try{const k=await s.fetchOsgoEntity(n);if(t.value=k,k.party?.id){const j=await s.fetchIndividualEntity(k.party.id);a.value=j,t.value.party=j}if(k.beneficiary?.id){const j=await s.fetchIndividualEntity(k.beneficiary.id);o.value=j,t.value.beneficiary=j}if(r.isLoaded&&t.value.vehicle?.carType&&(t.value.vehicle.carType=r.findCarType(t.value.vehicle.carType.id)),r.isLoaded&&t.value.period&&(t.value.period=r.findPeriod(t.value.period.id)),r.isLoaded&&t.value.drivedArea&&(t.value.drivedArea=r.findDrivedArea(t.value.drivedArea.id)),t.value.driversLimited&&t.value.drivers.length>0){const j=Math.max(...t.value.drivers.map(Q=>Q.incidentFrequency?.coefficient||0));t.value.incidentCoeff=j}console.log("[OsgoStore] Policy fetched:",n)}catch(k){throw y.value=k.message||"Failed to fetch policy",console.error("[OsgoStore] Policy fetch failed:",k),k}finally{w.value=!1}},fetchFundData:async()=>{if(t.value.id){V.value=!0,l.value=null;try{const n=await s.getFundPolicy(t.value.id);d.value=n||null,console.log("[OsgoStore] Fund data fetched:",n)}catch(n){l.value=n.message||"Failed to fetch fund data",console.error("[OsgoStore] Fund data fetch failed:",n)}finally{V.value=!1}}},saveToSession:()=>{if(!(typeof window>"u"))try{const n={osgo:t.value,owner:o.value,applicant:a.value,currentStep:b.value};sessionStorage.setItem(Te.OSGO_DRAFT,JSON.stringify(n)),console.log("[OsgoStore] Saved to session")}catch(n){console.error("[OsgoStore] Error saving to session:",n)}},loadFromSession:()=>{if(typeof window>"u")return!1;try{const n=sessionStorage.getItem(Te.OSGO_DRAFT);if(!n)return!1;const k=JSON.parse(n);return t.value=k.osgo,o.value=k.owner,a.value=k.applicant,b.value=k.currentStep||0,console.log("[OsgoStore] Loaded from session"),!0}catch(n){return console.error("[OsgoStore] Error loading from session:",n),!1}},clearSession:()=>{typeof window>"u"||(sessionStorage.removeItem(Te.OSGO_DRAFT),console.log("[OsgoStore] Session cleared"))},reset:()=>{$e(),P.value=!1,R.value=!1,x.value=!1,d.value=null,_.value=null,y.value=null}}}),at={class:"language-switcher"},it=["onClick"],lt=X({__name:"LanguageSwitcher",setup(r){const{locale:s,locales:t}=ge();Re();const o=A(()=>s.value),a=A(()=>t.value.filter(p=>p.code!==s.value)),b=p=>{s.value=p,typeof window<"u"&&localStorage.setItem("app-language",p),window.Telegram?.WebApp?.HapticFeedback&&window.Telegram.WebApp.HapticFeedback.impactOccurred("light")};return Ae(()=>{if(typeof window<"u"){const p=localStorage.getItem("app-language");p&&(p==="ru"||p==="uz")&&(s.value=p)}}),(p,_)=>(u(),v("div",at,[(u(!0),v(ae,null,fe(i(a),w=>(u(),v("button",{key:w.code,class:se(["lang-btn",{active:i(o)===w.code}]),onClick:y=>b(w.code)},c(w.code.toUpperCase()),11,it))),128))]))}}),ot=ee(lt,[["__scopeId","data-v-e748ef5d"]]),nt={class:"progress-bar-container"},rt={class:"progress-track"},ct={class:"steps-container"},ut=["onClick"],dt={key:0,class:"step-check"},vt={key:1,class:"step-number"},pt={class:"step-label"},ft=X({__name:"ProgressBar",props:{currentStep:{},totalSteps:{}},setup(r){const s=r,{t}=ge(),o=A(()=>[t("steps.params"),t("steps.vehicle"),t("steps.owner"),t("steps.drivers"),t("steps.summary"),t("steps.payment")]),a=A(()=>(s.currentStep+1)/s.totalSteps*100),b=p=>{console.log("Step clicked:",p)};return(p,_)=>(u(),v("div",nt,[e("div",rt,[e("div",{class:"progress-fill",style:je({width:`${a.value}%`})},null,4)]),e("div",ct,[(u(!0),v(ae,null,fe(o.value,(w,y)=>(u(),v("div",{key:y,class:"step-wrapper",onClick:d=>b(y)},[e("div",{class:se(["step-circle",{"step-active":y===r.currentStep,"step-completed":y<r.currentStep,"step-pending":y>r.currentStep}])},[y<r.currentStep?(u(),v("span",dt,"✓")):(u(),v("span",vt,c(y+1),1))],2),e("div",pt,c(w),1)],8,ut))),128))])]))}}),mt=ee(ft,[["__scopeId","data-v-b647cd33"]]),ht={class:"fixed-header"},bt={class:"max-w-container mx-auto px-4 h-full flex flex-col justify-center"},yt={class:"flex items-center justify-between mb-3"},_t=X({__name:"AppHeader",setup(r){const s=ce(),t=A(()=>s.currentStep),o=A(()=>s.totalSteps);return(a,b)=>{const p=ot,_=mt;return u(),v("header",ht,[e("div",bt,[e("div",yt,[b[0]||(b[0]=ze('<div class="flex items-center gap-3" data-v-67b64b56><div class="w-10 h-10 bg-primary overflow-hidden rounded-lg flex items-center justify-center text-white font-bold text-lg" data-v-67b64b56><img src="'+Qe+'" alt="Temiryo&#39;l Sug&#39;urta Logo" data-v-67b64b56></div><div data-v-67b64b56><div class="text-base font-bold text-text" data-v-67b64b56>ОСГОВТС</div><div class="text-xs text-text-light" data-v-67b64b56> Temiryo&#39;l Sug&#39;urta </div></div></div>',1)),F(p)]),F(_,{"current-step":t.value,"total-steps":o.value},null,8,["current-step","total-steps"])])])}}}),gt=ee(_t,[["__scopeId","data-v-67b64b56"]]),$t={class:"fixed-footer"},St={class:"max-w-container mx-auto px-4 h-full flex items-center justify-between gap-4"},wt=["disabled"],kt={class:"flex-1 text-center"},xt={class:"text-sm text-text-light font-medium"},Dt=["disabled"],Nt={key:0,class:"spinner"},At={key:0},Vt={key:1},Mt={key:2},Ot={key:3,class:"text-lg bx bx-chevron-right"},Pt=X({__name:"AppFooter",setup(r){const s=ce(),t=ve(),o=Ne(),{t:a}=ge(),b=Y(!1),p=Y(null),_=Y(null),w=A(()=>s.currentStep),y=A(()=>s.totalSteps),d=A(()=>w.value===0),l=A(()=>w.value===y.value-1),V=A(()=>s.canProceedToNextStep),$=A(()=>s.saving||s.fetching||b.value),E=()=>{d.value||(t.isTelegramWebApp.value&&t.hapticImpact("light"),s.previousStep())},P=async()=>{if(!V.value){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(a("info.fillAllFields")));return}t.isTelegramWebApp.value&&t.hapticImpact("medium");try{if(w.value===W.VEHICLE&&!s.vehicleVerified)await s.verifyVehicle();else if(w.value===W.OWNER)s.ownerVerified||await s.verifyOwner(),!s.osgo.applicantIsOwner&&!s.applicantVerified&&await s.verifyApplicant();else if(w.value===W.SUMMARY)s.osgo.id||(await s.createPolicy(),console.log("[AppFooter] Policy created:",s.osgo.id),t.isTelegramWebApp.value&&t.hapticNotification("success"));else if(w.value===W.PAYMENT){if(!s.selectedPaymentMethod){t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert("Выберите способ оплаты"));return}const f={payme:"sendSmsPayme",click:"sendSmsClick",uzum:"sendSmsUzum"}[s.selectedPaymentMethod],R=s.osgo.id,T=(s.osgo.applicantIsOwner?s.owner:s.applicant).phone||"",x=s.calculatedPremium;if(!R||!T||!x){const N="Недостаточно данных для отправки платежной ссылки";console.error("[AppFooter] Missing payment data:",{contractId:R,phone:T,amount:x}),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(N));return}try{b.value=!0,p.value=null,_.value=null,await o.sendPaymentLink(f,R,T,x),_.value="Платежная ссылка отправлена на ваш номер телефона",console.log("[AppFooter] Payment link sent successfully"),t.isTelegramWebApp.value&&(t.hapticNotification("success"),await t.showAlert("Платежная ссылка отправлена на ваш номер телефона"))}catch(N){p.value=N.message||"Ошибка при отправке платежной ссылки",console.error("[AppFooter] Payment link error:",N),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(p.value))}finally{b.value=!1}return}l.value?console.log("[AppFooter] Last step reached"):s.nextStep()}catch(C){console.error("[AppFooter] Error:",C),t.isTelegramWebApp.value&&(t.hapticNotification("error"),await t.showAlert(C.message||a("errors.unknown")))}};return(C,f)=>(u(),v("footer",$t,[e("div",St,[e("button",{type:"button",class:"btn btn-secondary flex-1 max-w-[160px]",disabled:d.value||$.value,onClick:E},[f[0]||(f[0]=e("i",{class:"text-lg bx bx-chevron-left"},null,-1)),e("span",null,c(C.$t("common.previous")),1)],8,wt),e("div",kt,[e("div",xt,c(C.$t("common.step",{current:w.value+1,total:y.value})),1)]),e("button",{type:"button",class:se(["btn flex-1 max-w-[160px]",{"btn-primary":!l.value||w.value!==i(W).PAYMENT,"btn-success":l.value&&w.value===i(W).PAYMENT}]),disabled:!V.value||$.value,onClick:P},[$.value?(u(),v("span",Nt)):(u(),v(ae,{key:1},[w.value===i(W).SUMMARY&&!i(s).osgo.id?(u(),v("span",At,c(C.$t("step5.confirm")),1)):l.value&&w.value===i(W).PAYMENT?(u(),v("span",Vt,[f[1]||(f[1]=e("i",{class:"bx bx-credit-card"},null,-1)),e("span",null,c(C.$t("step5.payment")),1)])):(u(),v("span",Mt,c(C.$t("common.next")),1)),!l.value&&w.value!==i(W).SUMMARY?(u(),v("i",Ot)):I("",!0)],64))],10,Dt)])]))}}),Tt=ee(Pt,[["__scopeId","data-v-4fce94ec"]]),It=["disabled"],Ct={key:0,class:"check-icon"},Et={class:"check-content"},Lt={class:"check-title"},Yt={key:0,class:"check-description"},Ft={class:"check-indicator"},Bt={class:"check-circle"},Wt={key:0,class:"check-dot"},Ut=X({__name:"CheckButton",props:{title:{default:""},description:{default:""},icon:{default:""},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["click"],setup(r,{emit:s}){const t=r,o=s,a=()=>{t.disabled||o("click")};return(b,p)=>(u(),v("button",{type:"button",class:se(["check-button",{active:r.active,disabled:r.disabled}]),disabled:r.disabled,onClick:a},[r.icon?(u(),v("div",Ct,c(r.icon),1)):I("",!0),e("div",Et,[e("div",Lt,[Ye(b.$slots,"default",{},()=>[_e(c(r.title),1)])]),r.description||b.$slots.description?(u(),v("div",Yt,[Ye(b.$slots,"description",{},()=>[_e(c(r.description),1)])])):I("",!0)]),e("div",Ft,[e("div",Bt,[r.active?(u(),v("div",Wt)):I("",!0)])])],10,It))}}),Rt=ee(Ut,[["__scopeId","data-v-f6637245"]]);function Le(r,s="сум"){return r==null||isNaN(r)?`0 ${s}`:`${r.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")} ${s}`}function Ce(r){return r?De(r).format("DD.MM.YYYY"):""}function We(r,s="ru"){if(!r)return"";const t=String(r).toLowerCase();return t==="male"||t==="мужской"||t==="erkak"?s==="uz"?"Erkak":"Мужской":t==="female"||t==="женский"||t==="ayol"?s==="uz"?"Ayol":"Женский":String(r)}const jt={class:"step-container"},zt={key:0,class:"loading-state"},Ht={key:1,class:"error-state"},qt={key:2,class:"error-state"},Gt={class:"debug-info"},Jt={key:3},Zt={class:"step-content"},Kt={class:"form-section"},Qt={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Xt={class:"form-section"},es={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ts={class:"form-section"},ss={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},as={key:0,class:"form-section"},is={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ls={class:"form-section"},os={class:"select-wrapper"},ns=["disabled"],rs=["value"],cs={key:0,class:"premium-card"},us={class:"premium-card-content"},ds={class:"premium-amount"},vs=X({__name:"Step1Params",setup(r){const s=ce(),t=we(),o=ve();Ae(()=>{console.log("[Step1Params] Mounted"),console.log("[Step1Params] Meta loaded:",t.isLoaded),console.log("[Step1Params] Car types count:",t.carTypes.length),console.log("[Step1Params] Car types:",t.carTypes),console.log("[Step1Params] Periods count:",t.periods.length),console.log("[Step1Params] Meta object:",t.meta)});const a=A(()=>s.osgo),b=d=>t.getLocalizedName(d,"ru"),p=A({get:()=>a.value.drivedArea?.id||"",set:d=>{const l=t.findDrivedArea(d);l&&(a.value.drivedArea=l)}}),_=d=>{s.isEditable&&(a.value.vehicle||(a.value.vehicle={govNumber:"",techPassportSeries:"",techPassportNumber:""}),a.value.vehicle.carType=d,o.isTelegramWebApp.value&&o.hapticImpact("light"))},w=d=>{s.isEditable&&(a.value.period=d,o.isTelegramWebApp.value&&o.hapticImpact("light"))},y=d=>{s.isEditable&&(a.value.incidentCoeff=d.coefficient,o.isTelegramWebApp.value&&o.hapticImpact("light"))};return(d,l)=>{const V=Rt;return u(),v("div",jt,[i(t).fetching?(u(),v("div",zt,[...l[4]||(l[4]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Загрузка данных...",-1)])])):i(t).error?(u(),v("div",Ht,[l[5]||(l[5]=e("i",{class:"bx bx-error-circle"},null,-1)),e("p",null,c(i(t).error),1),e("button",{onClick:l[0]||(l[0]=$=>i(t).fetchMeta(!0)),class:"btn-retry"}," Попробовать снова ")])):!i(t).isLoaded||i(t).carTypes.length===0?(u(),v("div",qt,[l[8]||(l[8]=e("i",{class:"bx bx-info-circle"},null,-1)),l[9]||(l[9]=e("p",null,"Нет данных. Загрузка...",-1)),e("p",Gt,[_e(" isLoaded: "+c(i(t).isLoaded),1),l[6]||(l[6]=e("br",null,null,-1)),_e(" carTypes: "+c(i(t).carTypes.length),1),l[7]||(l[7]=e("br",null,null,-1)),_e(" meta: "+c(i(t).meta?"exists":"null"),1)])])):(u(),v("div",Jt,[l[18]||(l[18]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Параметры полиса"),e("p",{class:"step-description"}," Выберите тип транспорта, период страхования и параметры использования ")],-1)),e("div",Zt,[e("div",Kt,[l[10]||(l[10]=e("h3",{class:"section-title"},"Тип транспортного средства",-1)),e("div",Qt,[(u(!0),v(ae,null,fe(i(t).carTypes,$=>(u(),re(V,{key:$.id,title:b($),active:a.value.vehicle?.carType?.id===$.id,disabled:!i(s).isEditable,onClick:E=>_($)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",Xt,[l[11]||(l[11]=e("h3",{class:"section-title"},"Период страхования",-1)),e("div",es,[(u(!0),v(ae,null,fe(i(t).periods,$=>(u(),re(V,{key:$.id,title:b($),active:a.value.period?.id===$.id,disabled:!i(s).isEditable,onClick:E=>w($)},null,8,["title","active","disabled","onClick"]))),128))])]),e("div",ts,[l[12]||(l[12]=e("h3",{class:"section-title"},"Количество водителей",-1)),e("div",ss,[F(V,{title:"Без ограничений",description:"Любое количество водителей",active:!a.value.driversLimited,disabled:!i(s).isEditable,onClick:l[1]||(l[1]=$=>a.value.driversLimited=!1)},null,8,["active","disabled"]),F(V,{title:"Ограниченное",description:"Указанные водители",active:a.value.driversLimited,disabled:!i(s).isEditable,onClick:l[2]||(l[2]=$=>a.value.driversLimited=!0)},null,8,["active","disabled"])])]),F(ie,{name:"slide-down"},{default:le(()=>[a.value.driversLimited?(u(),v("div",as,[l[13]||(l[13]=e("h3",{class:"section-title"},"Частота страховых случаев",-1)),e("div",is,[(u(!0),v(ae,null,fe(i(t).incidentFrequencies,$=>(u(),re(V,{key:$.id,title:b($),active:a.value.incidentCoeff===$.coefficient,disabled:!i(s).isEditable,onClick:E=>y($)},null,8,["title","active","disabled","onClick"]))),128))])])):I("",!0)]),_:1}),e("div",ls,[l[16]||(l[16]=e("h3",{class:"section-title"},"Территория использования",-1)),e("div",os,[Ee(e("select",{"onUpdate:modelValue":l[3]||(l[3]=$=>p.value=$),class:"input",disabled:!i(s).isEditable},[l[14]||(l[14]=e("option",{value:"",disabled:""}," Выберите территорию ",-1)),(u(!0),v(ae,null,fe(i(t).drivedAreas,$=>(u(),v("option",{key:$.id,value:$.id},c(b($)),9,rs))),128))],8,ns),[[He,p.value]]),l[15]||(l[15]=e("div",{class:"select-icon"},[e("i",{class:"bx bx-chevron-down"})],-1))])]),i(s).calculatedPremium>0?(u(),v("div",cs,[e("div",us,[l[17]||(l[17]=e("div",{class:"premium-label"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",ds,c(i(Le)(i(s).calculatedPremium)),1)])])):I("",!0)])]))])}}}),ps=ee(vs,[["__scopeId","data-v-067515fa"]]),fs=["for"],ms={key:0,class:"text-error"},hs={class:"input-wrapper"},bs={key:0,class:"input-icon input-icon-left"},ys=["id","type","placeholder","disabled","readonly","maxlength","autocomplete","inputmode","lang"],_s={key:2,class:"input-icon input-icon-right"},gs={key:1,class:"input-message"},$s={key:0,class:"error-message"},Ss={key:1,class:"helper-text"},ws={key:2,class:"input-count"},ks=X({__name:"InputField",props:{modelValue:{},label:{default:""},placeholder:{default:""},type:{default:"text"},icon:{default:""},error:{default:""},helperText:{default:""},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},maxLength:{default:void 0},showCount:{type:Boolean,default:!1},autocomplete:{default:"off"},inputMode:{default:"text"},mask:{default:""},autofocus:{type:Boolean,default:!1},uppercase:{type:Boolean,default:!1},dateMask:{type:Boolean,default:!1}},emits:["update:modelValue","blur","focus","enter","input"],setup(r,{expose:s,emit:t}){const o=r,a=t,{locale:b}=ge(),p=A(()=>{if(o.type==="date")return b.value==="uz"?"uz-UZ":"ru-RU"}),_=Y(null),w=A(()=>`input-${Math.random().toString(36).substr(2,9)}`),y=A({get:()=>{const T=String(o.modelValue||"");if(o.dateMask&&T){if(/^\d{1,2}(-\d{1,2}(-\d{0,4})?)?$/.test(T)||/^\d{2}-\d{2}-\d{4}$/.test(T))return T;if(/^\d{4}-\d{2}-\d{2}$/.test(T)){const x=T.split("-");return`${x[2]}-${x[1]}-${x[0]}`}}return T},set:T=>{if(o.uppercase&&(T=T.toUpperCase()),o.dateMask&&T){if(/^\d{4}-\d{2}-\d{2}$/.test(T)){a("update:modelValue",T);return}if(/^\d{2}-\d{2}-\d{4}$/.test(T)){const x=T.split("-");a("update:modelValue",`${x[2]}-${x[1]}-${x[0]}`);return}a("update:modelValue",T);return}a("update:modelValue",T)}}),d=T=>{const x=T.target;let N=x.value;if(o.uppercase&&(N=N.toUpperCase(),x.value!==N&&(x.value=N)),o.dateMask){const Z=f(N);x.value!==Z&&(x.value=Z),a("update:modelValue",Z),a("input",Z);return}o.mask&&(N=C(N)),a("update:modelValue",N),a("input",N)},l=()=>{if(o.dateMask&&y.value){const T=String(y.value);if(/^\d{2}-\d{2}-\d{4}$/.test(T)){const x=T.split("-"),N=`${x[2]}-${x[1]}-${x[0]}`,Z=new Date(N);isNaN(Z.getTime())||a("update:modelValue",N)}}a("blur")},V=()=>{a("focus")},$=T=>{},E=()=>{a("enter")},P=()=>{a("update:modelValue",""),_.value?.focus()},C=T=>{if(o.dateMask)return f(T);if(!o.mask)return T;let x="",N=0;const Z=T.replace(/\D/g,"");for(let oe=0;oe<o.mask.length&&N<Z.length;oe++){const te=o.mask[oe];te==="#"?(x+=Z[N],N++):x+=te}return x},f=T=>{const N=T.replace(/\D/g,"").slice(0,8);return N.length===0?"":N.length<=2?N:N.length<=4?`${N.slice(0,2)}-${N.slice(2)}`:`${N.slice(0,2)}-${N.slice(2,4)}-${N.slice(4)}`},R=()=>{_.value?.focus()},G=()=>{_.value?.blur()};return Ae(()=>{o.autofocus&&R()}),s({focus:R,blur:G}),(T,x)=>(u(),v("div",{class:se(["input-field",{"has-error":r.error}])},[r.label?(u(),v("label",{key:0,class:"input-label",for:w.value},[_e(c(r.label)+" ",1),r.required?(u(),v("span",ms,"*")):I("",!0)],8,fs)):I("",!0),e("div",hs,[r.icon?(u(),v("div",bs,[e("i",{class:se(r.icon)},null,2)])):I("",!0),Ee(e("input",{id:w.value,ref_key:"inputRef",ref:_,"onUpdate:modelValue":x[0]||(x[0]=N=>y.value=N),type:r.dateMask?"text":r.type,placeholder:r.dateMask?r.placeholder||"DD-MM-YYYY":r.placeholder,disabled:r.disabled,readonly:r.readonly,maxlength:r.dateMask?10:r.maxLength,autocomplete:r.autocomplete,inputmode:r.dateMask?"numeric":r.inputMode,lang:p.value,class:se(["input",{"input-with-icon-left":r.icon,"input-with-icon-right":r.clearable||r.loading,"input-error":r.error}]),onInput:d,onBlur:l,onFocus:V,onKeypress:$,onKeydown:Ge(E,["enter"])},null,42,ys),[[qe,y.value]]),r.clearable&&y.value&&!r.disabled&&!r.readonly?(u(),v("button",{key:1,type:"button",class:"input-icon input-icon-right input-clear",onClick:P},[...x[1]||(x[1]=[e("i",{class:"bx bx-x"},null,-1)])])):I("",!0),r.loading?(u(),v("div",_s,[...x[2]||(x[2]=[e("div",{class:"spinner-small"},null,-1)])])):I("",!0)]),r.helperText||r.error?(u(),v("div",gs,[r.error?(u(),v("span",$s,c(r.error),1)):r.helperText?(u(),v("span",Ss,c(r.helperText),1)):I("",!0)])):I("",!0),r.showCount&&r.maxLength?(u(),v("div",ws,c(y.value.length)+" / "+c(r.maxLength),1)):I("",!0)],2))}}),Ve=ee(ks,[["__scopeId","data-v-4eb39aee"]]);function xs(r){if(!r)return{valid:!1,error:"Государственный номер обязателен"};const s=r.replace(/\s/g,"").toUpperCase();return/^\d{2}[A-Z]\d{3}[A-Z]{2}$/.test(s)?{valid:!0}:{valid:!1,error:"Неверный формат. Пример: 01W273FA"}}function Ds(r){if(!r)return{valid:!1,error:"Серия техпаспорта обязательна"};const s=r.toUpperCase();return/^[A-Z]{2,3}$/.test(s)?{valid:!0}:{valid:!1,error:"Серия должна состоять из 2-3 букв"}}function Ns(r){return r?/^\d+$/.test(r)?{valid:!0}:{valid:!1,error:"Номер должен содержать только цифры"}:{valid:!1,error:"Номер техпаспорта обязателен"}}const As={class:"step-container"},Vs={class:"step-content"},Ms={class:"form-section"},Os={class:"form-section"},Ps={class:"form-section"},Ts={class:"form-section"},Is=["disabled"],Cs={key:0,class:"spinner"},Es={key:0,class:"alert alert-error"},Ls={key:0,class:"vehicle-info-card"},Ys={class:"card-content"};const Fs={class:"vehicle-info-grid"},Bs={key:0,class:"vehicle-info-item"},Ws={class:"vehicle-info-value"},Us={key:1,class:"vehicle-info-item"},Rs={class:"vehicle-info-value"},js={key:2,class:"vehicle-info-item"},zs={class:"vehicle-info-value"},Hs={key:3,class:"vehicle-info-item"},qs={class:"vehicle-info-value"},Gs={key:4,class:"vehicle-info-item"},Js={class:"vehicle-info-value"},Zs={key:1,class:"vehicle-info-empty"},Ks=X({__name:"Step2Vehicle",setup(r){const s=ce();we();const t=ve(),o=A(()=>s.osgo),a=Y({}),b=A(()=>!!(o.value.vehicle?.govNumber&&o.value.vehicle?.techPassportSeries&&o.value.vehicle?.techPassportNumber&&Object.keys(a.value).length===0)),p=A(()=>{if(!o.value.vehicle)return 0;const y=o.value.vehicle;let d=0;return y.techPassportIssueDate&&d++,(y.modelName||y.model)&&d++,(y.createdYear||y.year)&&d++,y.engineNumber&&d++,y.bodyNumber&&d++,d}),_=y=>{if(!o.value.vehicle)return;let d;switch(y){case"govNumber":d=xs(o.value.vehicle.govNumber);break;case"techPassportSeries":d=Ds(o.value.vehicle.techPassportSeries);break;case"techPassportNumber":d=Ns(o.value.vehicle.techPassportNumber);break}d&&!d.valid?a.value[y]=d.error||"":delete a.value[y]},w=async()=>{if(_("govNumber"),_("techPassportSeries"),_("techPassportNumber"),Object.keys(a.value).length>0){t.isTelegramWebApp.value&&t.hapticNotification("error");return}try{await s.verifyVehicle(),console.log("[Step2Vehicle] Vehicle after verification:",o.value.vehicle),console.log("[Step2Vehicle] Vehicle keys:",Object.keys(o.value.vehicle||{})),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(y,d)=>{const l=Ve;return u(),v("div",As,[d[20]||(d[20]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Информация о транспорте"),e("p",{class:"step-description"}," Введите данные транспортного средства для проверки ")],-1)),e("div",Vs,[e("div",Ms,[F(l,{modelValue:o.value.vehicle.govNumber,"onUpdate:modelValue":d[0]||(d[0]=V=>o.value.vehicle.govNumber=V),label:"Государственный номер",placeholder:"01A000AA",disabled:!i(s).isEditable,error:a.value.govNumber,icon:"bx bx-car",required:"",uppercase:"",onBlur:d[1]||(d[1]=V=>_("govNumber"))},null,8,["modelValue","disabled","error"])]),e("div",Os,[F(l,{modelValue:o.value.vehicle.techPassportSeries,"onUpdate:modelValue":d[2]||(d[2]=V=>o.value.vehicle.techPassportSeries=V),label:"Серия техпаспорта",placeholder:"AAA",disabled:!i(s).isEditable,error:a.value.techPassportSeries,"max-length":3,required:"",uppercase:"",onBlur:d[3]||(d[3]=V=>_("techPassportSeries"))},null,8,["modelValue","disabled","error"])]),e("div",Ps,[F(l,{modelValue:o.value.vehicle.techPassportNumber,"onUpdate:modelValue":d[4]||(d[4]=V=>o.value.vehicle.techPassportNumber=V),label:"Номер техпаспорта",placeholder:"1234567",disabled:!i(s).isEditable,error:a.value.techPassportNumber,"input-mode":"numeric",required:"",onBlur:d[5]||(d[5]=V=>_("techPassportNumber"))},null,8,["modelValue","disabled","error"])]),e("div",Ts,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:!b.value||i(s).vehicleVerifying,onClick:w},[i(s).vehicleVerifying?(u(),v("span",Cs)):(u(),v(ae,{key:1},[d[6]||(d[6]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,c(i(s).vehicleVerified?"Проверено":"Проверить"),1)],64))],8,Is)]),i(s).vehicleVerifyError?(u(),v("div",Es,[d[7]||(d[7]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,c(i(s).vehicleVerifyError),1)])):I("",!0),F(ie,{name:"fade"},{default:le(()=>[i(s).vehicleVerified&&o.value.vehicle?(u(),v("div",Ls,[d[19]||(d[19]=e("div",{class:"card-header"},[e("i",{class:"bx bx-check-circle text-success"}),e("span",null,"Транспорт найден")],-1)),e("div",Ys,[I("",!0),e("div",Fs,[o.value.vehicle?.techPassportIssueDate?(u(),v("div",Bs,[d[14]||(d[14]=e("div",{class:"vehicle-info-label"},"Дата выдачи техпаспорта",-1)),e("div",Ws,c(i(Ce)(o.value.vehicle.techPassportIssueDate)),1)])):I("",!0),o.value.vehicle?.modelName||o.value.vehicle?.model?(u(),v("div",Us,[d[15]||(d[15]=e("div",{class:"vehicle-info-label"},"Модель",-1)),e("div",Rs,c(o.value.vehicle?.modelName||o.value.vehicle?.model||"-"),1)])):I("",!0),o.value.vehicle?.createdYear||o.value.vehicle?.year?(u(),v("div",js,[d[16]||(d[16]=e("div",{class:"vehicle-info-label"},"Год выпуска",-1)),e("div",zs,c(o.value.vehicle?.createdYear||o.value.vehicle?.year||"-"),1)])):I("",!0),o.value.vehicle?.engineNumber?(u(),v("div",Hs,[d[17]||(d[17]=e("div",{class:"vehicle-info-label"},"Номер двигателя",-1)),e("div",qs,c(o.value.vehicle.engineNumber),1)])):I("",!0),o.value.vehicle?.bodyNumber?(u(),v("div",Gs,[d[18]||(d[18]=e("div",{class:"vehicle-info-label"},"Номер кузова/шасси",-1)),e("div",Js,c(o.value.vehicle.bodyNumber),1)])):I("",!0)]),p.value===0?(u(),v("div",Zs," Нет данных о транспортном средстве ")):I("",!0)])])):I("",!0)]),_:1})])])}}}),Qs=ee(Ks,[["__scopeId","data-v-7b02d127"]]),Xs={class:"step-container"},ea={class:"step-header"},ta={class:"step-title"},sa={class:"step-description"},aa={class:"step-content"},ia={class:"subsection"},la={class:"subsection-title"},oa={class:"form-section"},na={class:"form-section"},ra={class:"form-section"},ca={class:"form-section"},ua=["disabled"],da={key:0,class:"spinner"},va={key:0,class:"info-card success"},pa={class:"card-header"},fa={class:"card-content"},ma={class:"info-grid"},ha={class:"info-item"},ba={class:"info-label"},ya={class:"info-value"},_a={class:"info-item"},ga={class:"info-label"},$a={class:"info-value"},Sa={class:"info-item info-item-wide"},wa={class:"info-label"},ka={class:"info-value"},xa={class:"info-item"},Da={class:"info-label"},Na={class:"info-value"},Aa={class:"info-item"},Va={class:"info-label"},Ma={class:"info-value"},Oa={class:"info-item"},Pa={class:"info-label"},Ta={class:"info-value"},Ia={class:"info-item"},Ca={class:"info-label"},Ea={class:"info-value"},La={class:"info-item"},Ya={class:"info-label"},Fa={class:"info-value"},Ba={class:"info-item"},Wa={class:"info-label"},Ua={class:"info-value"},Ra={class:"info-item"},ja={class:"info-label"},za={class:"info-value"},Ha={class:"info-item"},qa={class:"info-label"},Ga={class:"info-value"},Ja={class:"form-section"},Za={class:"checkbox-label"},Ka=["disabled"],Qa={key:0,class:"subsection"},Xa={class:"subsection-title"},ei={class:"form-section"},ti={class:"form-section"},si={class:"form-section"},ai={class:"form-section"},ii=["disabled"],li={key:0,class:"spinner"},oi={key:0,class:"info-card success"},ni={class:"card-header"},ri={class:"card-content"},ci={class:"info-grid"},ui={class:"info-item"},di={class:"info-label"},vi={class:"info-value"},pi={class:"info-item"},fi={class:"info-label"},mi={class:"info-value"},hi={class:"info-item info-item-wide"},bi={class:"info-label"},yi={class:"info-value"},_i={class:"info-item"},gi={class:"info-label"},$i={class:"info-value"},Si={class:"info-item"},wi={class:"info-label"},ki={class:"info-value"},xi={class:"info-item"},Di={class:"info-label"},Ni={class:"info-value"},Ai={class:"info-item"},Vi={class:"info-label"},Mi={class:"info-value"},Oi={class:"info-item"},Pi={class:"info-label"},Ti={class:"info-value"},Ii={class:"info-item"},Ci={class:"info-label"},Ei={class:"info-value"},Li={class:"info-item"},Yi={class:"info-label"},Fi={class:"info-value"},Bi={class:"info-item"},Wi={class:"info-label"},Ui={class:"info-value"},Ri=X({__name:"Step3Owner",setup(r){const s=ce(),t=ve(),{locale:o,t:a}=ge(),b=A(()=>s.osgo),p=A(()=>s.owner),_=A(()=>s.applicant),w=async()=>{try{await s.verifyOwner(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}},y=async()=>{try{await s.verifyApplicant(),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(d,l)=>{const V=Ve;return u(),v("div",Xs,[e("div",ea,[e("h2",ta,c(i(a)("step3.title")),1),e("p",sa,c(i(a)("step3.description")),1)]),e("div",aa,[e("div",ia,[e("h3",la,c(i(a)("step3.owner")),1),e("div",oa,[F(V,{modelValue:p.value.passportSeries,"onUpdate:modelValue":l[0]||(l[0]=$=>p.value.passportSeries=$),label:i(a)("step3.passportSeries"),placeholder:i(a)("step3.passportSeriesPlaceholder"),disabled:!i(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",na,[F(V,{modelValue:p.value.passportNumber,"onUpdate:modelValue":l[1]||(l[1]=$=>p.value.passportNumber=$),label:i(a)("step3.passportNumber"),placeholder:i(a)("step3.passportNumberPlaceholder"),disabled:!i(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ra,[F(V,{modelValue:p.value.birthDate,"onUpdate:modelValue":l[2]||(l[2]=$=>p.value.birthDate=$),label:i(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"31-12-2025",disabled:!i(s).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",ca,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:i(s).ownerVerifying,onClick:w},[i(s).ownerVerifying?(u(),v("span",da)):(u(),v(ae,{key:1},[l[7]||(l[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,c(i(s).ownerVerified?i(a)("step3.verified"):i(a)("step3.verifyOwner")),1)],64))],8,ua)]),F(ie,{name:"fade"},{default:le(()=>[i(s).ownerVerified&&p.value.id?(u(),v("div",va,[e("div",pa,[l[8]||(l[8]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,c(i(a)("step3.ownerFound")),1)]),e("div",fa,[e("div",ma,[e("div",ha,[e("div",ba,c(i(a)("step3.passportIssueDate")),1),e("div",ya,c(p.value.passportIssueDate?i(Ce)(p.value.passportIssueDate):"-"),1)]),e("div",_a,[e("div",ga,c(i(a)("step3.pinfl")),1),e("div",$a,c(p.value.nationalIdentifier||"-"),1)]),e("div",Sa,[e("div",wa,c(i(a)("step3.issuedBy")),1),e("div",ka,c(p.value.passportIssuedBy||"-"),1)]),e("div",xa,[e("div",Da,c(i(a)("step3.lastName")),1),e("div",Na,c(p.value.lastName||"-"),1)]),e("div",Aa,[e("div",Va,c(i(a)("step3.firstName")),1),e("div",Ma,c(p.value.firstName||"-"),1)]),e("div",Oa,[e("div",Pa,c(i(a)("step3.middleName")),1),e("div",Ta,c(p.value.middleName||"-"),1)]),e("div",Ia,[e("div",Ca,c(i(a)("step3.gender")),1),e("div",Ea,c(p.value.gender?i(We)(p.value.gender,i(o).value):"-"),1)]),e("div",La,[e("div",Ya,c(i(a)("step3.country")),1),e("div",Fa,c(p.value.country?.langValue1||"-"),1)]),e("div",Ba,[e("div",Wa,c(i(a)("step3.region")),1),e("div",Ua,c(p.value.region?.langValue1||"-"),1)]),e("div",Ra,[e("div",ja,c(i(a)("step3.district")),1),e("div",za,c(p.value.district?.langValue1||"-"),1)]),e("div",Ha,[e("div",qa,c(i(a)("step3.street")),1),e("div",Ga,c(p.value.street||"-"),1)])])])])):I("",!0)]),_:1})]),e("div",Ja,[e("label",Za,[Ee(e("input",{"onUpdate:modelValue":l[3]||(l[3]=$=>b.value.applicantIsOwner=$),type:"checkbox",class:"checkbox",disabled:!i(s).isEditable},null,8,Ka),[[Je,b.value.applicantIsOwner]]),e("span",null,c(i(a)("step3.ownerIsApplicant")),1)])]),F(ie,{name:"slide-down"},{default:le(()=>[b.value.applicantIsOwner?I("",!0):(u(),v("div",Qa,[e("h3",Xa,c(i(a)("step3.applicant")),1),e("div",ei,[F(V,{modelValue:_.value.passportSeries,"onUpdate:modelValue":l[4]||(l[4]=$=>_.value.passportSeries=$),label:i(a)("step3.passportSeries"),placeholder:i(a)("step3.passportSeriesPlaceholder"),disabled:!i(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",ti,[F(V,{modelValue:_.value.passportNumber,"onUpdate:modelValue":l[5]||(l[5]=$=>_.value.passportNumber=$),label:i(a)("step3.passportNumber"),placeholder:i(a)("step3.passportNumberPlaceholder"),disabled:!i(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","label","placeholder","disabled"])]),e("div",si,[F(V,{modelValue:_.value.birthDate,"onUpdate:modelValue":l[6]||(l[6]=$=>_.value.birthDate=$),label:i(a)("step3.birthDate"),type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!i(s).isEditable,required:""},null,8,["modelValue","label","disabled"])]),e("div",ai,[e("button",{type:"button",class:"btn btn-primary w-full",disabled:i(s).applicantVerifying,onClick:y},[i(s).applicantVerifying?(u(),v("span",li)):(u(),v(ae,{key:1},[l[9]||(l[9]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,c(i(s).applicantVerified?i(a)("step3.verified"):i(a)("step3.verifyApplicant")),1)],64))],8,ii)]),F(ie,{name:"fade"},{default:le(()=>[i(s).applicantVerified&&_.value.id?(u(),v("div",oi,[e("div",ni,[l[10]||(l[10]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,c(i(a)("step3.applicantFound")),1)]),e("div",ri,[e("div",ci,[e("div",ui,[e("div",di,c(i(a)("step3.passportIssueDate")),1),e("div",vi,c(_.value.passportIssueDate?i(Ce)(_.value.passportIssueDate):"-"),1)]),e("div",pi,[e("div",fi,c(i(a)("step3.pinfl")),1),e("div",mi,c(_.value.nationalIdentifier||"-"),1)]),e("div",hi,[e("div",bi,c(i(a)("step3.issuedBy")),1),e("div",yi,c(_.value.passportIssuedBy||"-"),1)]),e("div",_i,[e("div",gi,c(i(a)("step3.lastName")),1),e("div",$i,c(_.value.lastName||"-"),1)]),e("div",Si,[e("div",wi,c(i(a)("step3.firstName")),1),e("div",ki,c(_.value.firstName||"-"),1)]),e("div",xi,[e("div",Di,c(i(a)("step3.middleName")),1),e("div",Ni,c(_.value.middleName||"-"),1)]),e("div",Ai,[e("div",Vi,c(i(a)("step3.gender")),1),e("div",Mi,c(_.value.gender?i(We)(_.value.gender,i(o).value):"-"),1)]),e("div",Oi,[e("div",Pi,c(i(a)("step3.country")),1),e("div",Ti,c(_.value.country?.langValue1||"-"),1)]),e("div",Ii,[e("div",Ci,c(i(a)("step3.region")),1),e("div",Ei,c(_.value.region?.langValue1||"-"),1)]),e("div",Li,[e("div",Yi,c(i(a)("step3.district")),1),e("div",Fi,c(_.value.district?.langValue1||"-"),1)]),e("div",Bi,[e("div",Wi,c(i(a)("step3.street")),1),e("div",Ui,c(_.value.street||"-"),1)])])])])):I("",!0)]),_:1})]))]),_:1})])])}}}),ji=ee(Ri,[["__scopeId","data-v-62def220"]]),zi={class:"step-container"},Hi={class:"step-content"},qi={key:0,class:"info-card"},Gi={class:"actions-row"},Ji=["disabled"],Zi=["disabled"],Ki=["disabled"],Qi={key:0,class:"empty-state"},Xi={key:1,class:"drivers-list"},el={class:"driver-header"},tl={class:"driver-number"},sl=["onClick"],al={class:"driver-content"},il=["disabled","onClick"],ll={key:0,class:"driver-info"},ol={class:"info-row"},nl={class:"info-value"},rl={key:0,class:"info-row"},cl={class:"info-value"},ul=X({__name:"Step4Drivers",setup(r){const s=ce(),t=ve(),o=A(()=>s.osgo),a=A(()=>s.owner),b=A(()=>s.applicant),p=A(()=>s.hasDriver(a.value.passportSeries,a.value.passportNumber,a.value.birthDate)),_=A(()=>s.hasDriver(b.value.passportSeries,b.value.passportNumber,b.value.birthDate)),w=()=>{s.addDriver(),t.isTelegramWebApp.value&&t.hapticImpact("light")},y=()=>{s.addOwnerAsDriver(),t.isTelegramWebApp.value&&t.hapticImpact("medium")},d=()=>{s.addApplicantAsDriver(),t.isTelegramWebApp.value&&t.hapticImpact("medium")},l=E=>{s.removeDriver(E),t.isTelegramWebApp.value&&t.hapticImpact("light")},V=E=>!!(E.passportSeries&&E.passportNumber&&E.birthDate),$=async E=>{try{const P=o.value.drivers[E],C=await s.verifyDriver(P);s.updateDriver(E,C),t.isTelegramWebApp.value&&t.hapticNotification("success")}catch{t.isTelegramWebApp.value&&t.hapticNotification("error")}};return(E,P)=>{const C=Ve;return u(),v("div",zi,[P[10]||(P[10]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Информация о водителях"),e("p",{class:"step-description"}," Добавьте водителей, допущенных к управлению транспортным средством ")],-1)),e("div",Hi,[o.value.driversLimited?(u(),v(ae,{key:1},[e("div",Gi,[e("button",{type:"button",class:"btn btn-primary-outlined",disabled:!i(s).isEditable,onClick:w},[...P[1]||(P[1]=[e("i",{class:"bx bx-plus"},null,-1),e("span",null,"Добавить водителя",-1)])],8,Ji),p.value?I("",!0):(u(),v("button",{key:0,type:"button",class:"btn btn-primary-outlined",disabled:!i(s).isEditable||!i(s).ownerVerified,onClick:y},[...P[2]||(P[2]=[e("i",{class:"bx bx-user"},null,-1),e("span",null,"Владелец - водитель",-1)])],8,Zi)),!o.value.applicantIsOwner&&!_.value?(u(),v("button",{key:1,type:"button",class:"btn btn-primary-outlined",disabled:!i(s).isEditable||!i(s).applicantVerified,onClick:d},[...P[3]||(P[3]=[e("i",{class:"bx bx-user"},null,-1),e("span",null,"Страхователь - водитель",-1)])],8,Ki)):I("",!0)]),o.value.drivers.length===0?(u(),v("div",Qi,[...P[4]||(P[4]=[e("i",{class:"bx bx-user-plus"},null,-1),e("p",null,"Добавьте хотя бы одного водителя",-1)])])):(u(),v("div",Xi,[(u(!0),v(ae,null,fe(o.value.drivers,(f,R)=>(u(),v("div",{key:R,class:"driver-card"},[e("div",el,[e("div",tl,[P[5]||(P[5]=e("i",{class:"bx bx-user"},null,-1)),e("span",null,"Водитель "+c(R+1),1)]),i(s).isEditable?(u(),v("button",{key:0,type:"button",class:"btn-icon btn-danger",onClick:G=>l(R)},[...P[6]||(P[6]=[e("i",{class:"bx bx-trash"},null,-1)])],8,sl)):I("",!0)]),e("div",al,[F(C,{modelValue:f.passportSeries,"onUpdate:modelValue":G=>f.passportSeries=G,label:"Серия паспорта",placeholder:"AA",disabled:!i(s).isEditable,"max-length":2,uppercase:"",required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),F(C,{modelValue:f.passportNumber,"onUpdate:modelValue":G=>f.passportNumber=G,label:"Номер паспорта",placeholder:"1234567",disabled:!i(s).isEditable,"input-mode":"numeric","max-length":7,required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),F(C,{modelValue:f.birthDate,"onUpdate:modelValue":G=>f.birthDate=G,label:"Дата рождения",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",disabled:!i(s).isEditable,required:""},null,8,["modelValue","onUpdate:modelValue","disabled"]),e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!V(f),onClick:G=>$(R)},[P[7]||(P[7]=e("i",{class:"bx bx-check-circle"},null,-1)),e("span",null,c(f.name?"Проверено":"Проверить"),1)],8,il),F(ie,{name:"fade"},{default:le(()=>[f.name?(u(),v("div",ll,[e("div",ol,[P[8]||(P[8]=e("span",{class:"info-label"},"ФИО:",-1)),e("span",nl,c(f.name),1)]),f.licenseNumber?(u(),v("div",rl,[P[9]||(P[9]=e("span",{class:"info-label"},"Водительское удостоверение:",-1)),e("span",cl,c(f.licenseNumber),1)])):I("",!0)])):I("",!0)]),_:2},1024)])]))),128))]))],64)):(u(),v("div",qi,[...P[0]||(P[0]=[e("i",{class:"bx bx-info-circle"},null,-1),e("div",null,[e("div",{class:"info-title"},"Неограниченное количество водителей"),e("div",{class:"info-text"}," Вы выбрали полис без ограничения по количеству водителей. Добавление водителей не требуется. ")],-1)])]))])])}}}),dl=ee(ul,[["__scopeId","data-v-2c37d9a6"]]),vl={class:"step-container"},pl={class:"step-content"},fl={class:"summary-section"},ml={class:"summary-card"},hl={class:"card-content"},bl={class:"info-row"},yl={class:"info-value-full"},_l={class:"summary-card"},gl={class:"card-content"},$l={class:"info-row"},Sl={class:"info-value-full"},wl={class:"summary-card"},kl={class:"card-content"},xl={class:"info-row"},Dl={class:"info-value-full"},Nl={class:"summary-card"},Al={class:"card-content"},Vl={class:"info-row"},Ml={class:"info-value-full"},Ol={class:"info-row"},Pl={class:"info-value-full"},Tl={class:"info-row"},Il={class:"info-value-full"},Cl={class:"summary-card"},El={class:"card-content"},Ll={class:"info-row"},Yl={class:"info-value-full"},Fl={class:"summary-section"},Bl={class:"form-section"},Wl={class:"form-section"},Ul={key:0,class:"form-section"},Rl={class:"premium-section"},jl={class:"premium-card-large"},zl={class:"premium-amount-large"},Hl=X({__name:"Step5Summary",setup(r){const s=d=>d.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1 "),t=ce(),o=we();ve(),Ne();const a=A(()=>t.osgo),b=A(()=>t.owner),p=A(()=>t.applicant);A(()=>t.fundData),Y(!1);const _=A({get:()=>(a.value.applicantIsOwner?b.value:p.value).phone||"",set:d=>{a.value.applicantIsOwner?(b.value.phone=d,a.value.party=b.value):(p.value.phone=d,a.value.party=p.value)}}),w=()=>a.value.period?o.getLocalizedName(a.value.period,"ru"):"-",y=()=>a.value.drivedArea?o.getLocalizedName(a.value.drivedArea,"ru"):"-";return(d,l)=>{const V=Ve;return u(),v("div",vl,[l[10]||(l[10]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Подтверждение"),e("p",{class:"step-description"}," Проверьте данные полиса перед оформлением ")],-1)),e("div",pl,[e("div",fl,[l[7]||(l[7]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-file-blank"}),e("span",null,"Информация о страховке")],-1)),e("div",ml,[l[2]||(l[2]=e("div",{class:"card-title"},"Собственник",-1)),e("div",hl,[e("div",bl,[e("span",yl,c(b.value.name||"-")+c(b.value.birthDate?` (${b.value.birthDate})`:""),1)])])]),e("div",_l,[l[3]||(l[3]=e("div",{class:"card-title"},"Заявитель",-1)),e("div",gl,[e("div",$l,[e("span",Sl,c((a.value.applicantIsOwner?b.value:p.value).name||"-")+c((a.value.applicantIsOwner?b.value:p.value).birthDate?` (${(a.value.applicantIsOwner?b.value:p.value).birthDate})`:""),1)])])]),e("div",wl,[l[4]||(l[4]=e("div",{class:"card-title"},"Транспортное средство",-1)),e("div",kl,[e("div",xl,[e("span",Dl,c(a.value.vehicle?.modelName||a.value.vehicle?.model||"-")+" "+c(a.value.vehicle?.govNumber?` (${a.value.vehicle.govNumber})`:""),1)])])]),e("div",Nl,[l[5]||(l[5]=e("div",{class:"card-title"},"Условия страхования",-1)),e("div",Al,[e("div",Vl,[e("span",Ml,c(w()),1)]),e("div",Ol,[e("span",Pl,c(y()),1)]),e("div",Tl,[e("span",Il,c(a.value.driversLimited?`Ограниченно (${a.value.drivers?.length||0})`:"Не ограничено"),1)])])]),e("div",Cl,[l[6]||(l[6]=e("div",{class:"card-title"},"Страховая сумма",-1)),e("div",El,[e("div",Ll,[e("span",Yl,c(s(i(Ie)))+" сум",1)])])])]),e("div",Fl,[l[8]||(l[8]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-phone"}),e("span",null,"Контактные данные")],-1)),e("div",Bl,[F(V,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=$=>_.value=$),label:"Номер телефона",placeholder:"+998 90 123 45 67",type:"tel",icon:"bx bx-phone","input-mode":"tel",disabled:!i(t).isEditable,required:""},null,8,["modelValue","disabled"])]),e("div",Wl,[F(V,{modelValue:a.value.contractStartDate,"onUpdate:modelValue":l[1]||(l[1]=$=>a.value.contractStartDate=$),label:"Дата начала действия полиса",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",icon:"bx bx-calendar",disabled:!i(t).isEditable,required:""},null,8,["modelValue","disabled"])]),a.value.contractEndDate?(u(),v("div",Ul,[F(V,{"model-value":a.value.contractEndDate,label:"Дата окончания действия полиса",type:"text","date-mask":"",placeholder:"DD-MM-YYYY",icon:"bx bx-calendar",disabled:""},null,8,["model-value"])])):I("",!0)]),e("div",Rl,[e("div",jl,[l[9]||(l[9]=e("div",{class:"premium-header"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",zl,c(i(Le)(i(t).calculatedPremium))+" сум ",1)])])])])}}}),ql=ee(Hl,[["__scopeId","data-v-68c99eac"]]),Gl={class:"step-container"},Jl={class:"step-content"},Zl={class:"premium-section"},Kl={class:"premium-card-large"},Ql={class:"premium-amount-large"},Xl={class:"payment-section"},eo={class:"payment-buttons"},to=["disabled"],so={key:0,class:"payment-selected-indicator"},ao=["disabled"],io={key:0,class:"payment-selected-indicator"},lo=["disabled"],oo={key:0,class:"payment-selected-indicator"},no={class:"status-section"},ro=["disabled"],co={key:0,class:"ml-1"},uo={key:0,class:"error-message mt-2"},vo={key:0,class:"success-card"},po={class:"policy-details"},fo={class:"policy-row"},mo={class:"policy-value"},ho={class:"policy-row"},bo={class:"policy-value"},yo=X({__name:"Step6Payment",setup(r){const s=ce(),t=ve();Ne();const{t:o}=ge(),a=A(()=>s.osgo),b=A(()=>s.fundData);A(()=>(a.value.applicantIsOwner?s.owner:s.applicant).phone||"");const p=Y(!1),_=Y(null),w=Y(0),y=Y(null);let d=null;const l=A({get:()=>s.selectedPaymentMethod,set:C=>{s.selectedPaymentMethod=C}}),V=A(()=>y.value?y.value.toLowerCase().includes("оплачен")||y.value.toLowerCase().includes("успешно")?"status-success":y.value.toLowerCase().includes("ошибка")||y.value.toLowerCase().includes("не")?"status-error":"status-info":""),$=A(()=>V.value==="status-success"?"bx bx-check-circle":V.value==="status-error"?"bx bx-error-circle":"bx bx-info-circle"),E=C=>{l.value===C?l.value=null:l.value=C,t.isTelegramWebApp.value&&t.hapticImpact("light")},P=async()=>{if(!a.value.id){_.value="Полис не создан";return}try{p.value=!0,_.value=null,y.value=null,t.isTelegramWebApp.value&&t.hapticImpact("light"),await s.fetchFundData(),b.value?.seria&&b.value?.number?(y.value="Оплата успешно завершена. Полис оформлен.",t.isTelegramWebApp.value&&t.hapticNotification("success")):b.value?y.value="Оплата обрабатывается. Проверьте статус позже.":y.value="Оплата не получена. Проверьте SMS или попробуйте снова.",w.value=15,d&&clearInterval(d),d=window.setInterval(()=>{w.value>0?w.value--:d&&(clearInterval(d),d=null)},1e3)}catch(C){console.error("[Step6Payment] Check status error:",C),_.value=C.message||"Ошибка при проверке статуса оплаты",y.value="Ошибка при проверке статуса. Попробуйте позже.",t.isTelegramWebApp.value&&t.hapticNotification("error")}finally{p.value=!1}};return Ze(()=>{d&&clearInterval(d)}),(C,f)=>(u(),v("div",Gl,[f[21]||(f[21]=e("div",{class:"step-header"},[e("h2",{class:"step-title"},"Оплата"),e("p",{class:"step-description"}," Выберите способ оплаты для завершения оформления полиса ")],-1)),e("div",Jl,[e("div",Zl,[e("div",Kl,[f[3]||(f[3]=e("div",{class:"premium-header"},[e("i",{class:"bx bx-shield-alt-2"}),e("span",null,"Страховая премия")],-1)),e("div",Ql,c(i(Le)(i(s).calculatedPremium))+" сум ",1)])]),e("div",Xl,[f[13]||(f[13]=e("h3",{class:"section-title"},[e("i",{class:"bx bx-credit-card"}),e("span",null,"Выберите способ оплаты")],-1)),e("div",eo,[e("button",{type:"button",class:se(["payment-btn payme",{"payment-btn-selected":l.value==="payme"}]),disabled:p.value,onClick:f[0]||(f[0]=R=>E("payme"))},[f[5]||(f[5]=e("div",{class:"payment-icon"},"💳",-1)),f[6]||(f[6]=e("div",{class:"payment-name"},"Payme",-1)),l.value==="payme"?(u(),v("div",so,[...f[4]||(f[4]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):I("",!0)],10,to),e("button",{type:"button",class:se(["payment-btn click",{"payment-btn-selected":l.value==="click"}]),disabled:p.value,onClick:f[1]||(f[1]=R=>E("click"))},[f[8]||(f[8]=e("div",{class:"payment-icon"},"🔵",-1)),f[9]||(f[9]=e("div",{class:"payment-name"},"Click",-1)),l.value==="click"?(u(),v("div",io,[...f[7]||(f[7]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):I("",!0)],10,ao),e("button",{type:"button",class:se(["payment-btn uzum",{"payment-btn-selected":l.value==="uzum"}]),disabled:p.value,onClick:f[2]||(f[2]=R=>E("uzum"))},[f[11]||(f[11]=e("div",{class:"payment-icon"},"🟣",-1)),f[12]||(f[12]=e("div",{class:"payment-name"},"Uzum",-1)),l.value==="uzum"?(u(),v("div",oo,[...f[10]||(f[10]=[e("i",{class:"bx bx-check-circle"},null,-1)])])):I("",!0)],10,lo)])]),e("div",no,[e("button",{type:"button",class:"btn btn-primary-outlined w-full",disabled:!!w.value||p.value||!a.value.id,onClick:P},[f[14]||(f[14]=e("i",{class:"bx bx-refresh"},null,-1)),e("span",null,c(i(o)("step5.checkStatus")),1),w.value?(u(),v("span",co,"("+c(w.value)+")",1)):I("",!0)],8,ro),F(ie,{name:"fade"},{default:le(()=>[_.value?(u(),v("div",uo,[f[15]||(f[15]=e("i",{class:"bx bx-error-circle"},null,-1)),e("span",null,c(_.value),1)])):I("",!0)]),_:1}),F(ie,{name:"fade"},{default:le(()=>[y.value?(u(),v("div",{key:0,class:se(["status-text",V.value])},[e("i",{class:se($.value)},null,2),e("span",null,c(y.value),1)],2)):I("",!0)]),_:1})]),F(ie,{name:"fade"},{default:le(()=>[a.value.id&&b.value&&b.value.seria?(u(),v("div",vo,[f[18]||(f[18]=e("div",{class:"success-icon"},[e("i",{class:"bx bx-check-circle"})],-1)),f[19]||(f[19]=e("h3",{class:"success-title"},"Полис оформлен!",-1)),f[20]||(f[20]=e("p",{class:"success-description"}," Ваш полис ОСГО успешно оформлен и оплачен ",-1)),e("div",po,[e("div",fo,[f[16]||(f[16]=e("span",{class:"policy-label"},"Серия:",-1)),e("span",mo,c(b.value.seria),1)]),e("div",ho,[f[17]||(f[17]=e("span",{class:"policy-label"},"Номер:",-1)),e("span",bo,c(b.value.number),1)])])])):I("",!0)]),_:1})])]))}}),_o=ee(yo,[["__scopeId","data-v-f6910a80"]]),go={class:"min-h-screen flex flex-col"},$o={class:"fixed top-0 left-0 right-0 bg-white shadow-sm z-50",style:{height:"60px"}},So={class:"flex-1 overflow-y-auto",style:{"margin-top":"140px","margin-bottom":"70px",padding:"24px 16px"}},wo={class:"max-w-3xl mx-auto"},ko={class:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-sm z-50",style:{height:"70px"}},xo=X({__name:"index",setup(r){const s=ce(),t=we(),o=ve();return Ae(async()=>{console.log("[IndexPage] Mounted"),await t.lazyFetch(),s.initialize(),s.loadFromSession()&&console.log("[IndexPage] Restored data from session"),o.isTelegramWebApp.value&&o.showBackButton(()=>{s.currentStep>0?s.previousStep():o.close()});const b=ye(()=>s.osgo,()=>{s.saveToSession()},{deep:!0});Fe(()=>{b()})}),Fe(()=>{s.saveToSession(),o.isTelegramWebApp.value&&(o.hideBackButton(),o.hideMainButton())}),Ke({title:"OSGO Insurance - ECCLIVO",meta:[{name:"description",content:"Purchase OSGO insurance policy through Telegram"}]}),(a,b)=>(u(),v("div",go,[e("header",$o,[F(gt)]),e("main",So,[e("div",wo,[F(ie,{name:"fade",mode:"out-in"},{default:le(()=>[i(s).currentStep===i(W).PARAMS?(u(),re(ps,{key:i(W).PARAMS})):i(s).currentStep===i(W).VEHICLE?(u(),re(Qs,{key:i(W).VEHICLE})):i(s).currentStep===i(W).OWNER?(u(),re(ji,{key:i(W).OWNER})):i(s).currentStep===i(W).DRIVERS?(u(),re(dl,{key:i(W).DRIVERS})):i(s).currentStep===i(W).SUMMARY?(u(),re(ql,{key:i(W).SUMMARY})):i(s).currentStep===i(W).PAYMENT?(u(),re(_o,{key:i(W).PAYMENT})):I("",!0)]),_:1})])]),e("footer",ko,[F(Tt)])]))}}),Oo=ee(xo,[["__scopeId","data-v-8561f7bb"]]);export{Oo as default};
